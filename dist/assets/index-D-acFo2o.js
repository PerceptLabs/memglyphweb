var Ve=Object.defineProperty;var Ke=(t,e,n)=>e in t?Ve(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var W=(t,e,n)=>Ke(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const _ of r.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&i(_)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();var te,v,Te,U,me,Re,Fe,xe,ue,le,_e,Q={},De=[],Ye=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,ne=Array.isArray;function H(t,e){for(var n in e)t[n]=e[n];return t}function he(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function Je(t,e,n){var i,s,r,_={};for(r in e)r=="key"?i=e[r]:r=="ref"?s=e[r]:_[r]=e[r];if(arguments.length>2&&(_.children=arguments.length>3?te.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(r in t.defaultProps)_[r]===void 0&&(_[r]=t.defaultProps[r]);return Y(t,_,i,s,null)}function Y(t,e,n,i,s){var r={type:t,props:e,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:s??++Te,__i:-1,__u:0};return s==null&&v.vnode!=null&&v.vnode(r),r}function j(t){return t.children}function J(t,e){this.props=t,this.context=e}function z(t,e){if(e==null)return t.__?z(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?z(t):null}function He(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return He(t)}}function ge(t){(!t.__d&&(t.__d=!0)&&U.push(t)&&!Z.__r++||me!=v.debounceRendering)&&((me=v.debounceRendering)||Re)(Z)}function Z(){for(var t,e,n,i,s,r,_,c=1;U.length;)U.length>c&&U.sort(Fe),t=U.shift(),c=U.length,t.__d&&(n=void 0,i=void 0,s=(i=(e=t).__v).__e,r=[],_=[],e.__P&&((n=H({},i)).__v=i.__v+1,v.vnode&&v.vnode(n),pe(e.__P,n,i,e.__n,e.__P.namespaceURI,32&i.__u?[s]:null,r,s??z(i),!!(32&i.__u),_),n.__v=i.__v,n.__.__k[n.__i]=n,Me(r,n,_),i.__e=i.__=null,n.__e!=s&&He(n)));Z.__r=0}function $e(t,e,n,i,s,r,_,c,h,a,p){var o,f,u,k,C,w,g,m=i&&i.__k||De,T=e.length;for(h=Xe(n,e,m,h,T),o=0;o<T;o++)(u=n.__k[o])!=null&&(f=u.__i==-1?Q:m[u.__i]||Q,u.__i=o,w=pe(t,u,f,s,r,_,c,h,a,p),k=u.__e,u.ref&&f.ref!=u.ref&&(f.ref&&fe(f.ref,null,u),p.push(u.ref,u.__c||k,u)),C==null&&k!=null&&(C=k),(g=!!(4&u.__u))||f.__k===u.__k?h=Ae(u,h,t,g):typeof u.type=="function"&&w!==void 0?h=w:k&&(h=k.nextSibling),u.__u&=-7);return n.__e=C,h}function Xe(t,e,n,i,s){var r,_,c,h,a,p=n.length,o=p,f=0;for(t.__k=new Array(s),r=0;r<s;r++)(_=e[r])!=null&&typeof _!="boolean"&&typeof _!="function"?(h=r+f,(_=t.__k[r]=typeof _=="string"||typeof _=="number"||typeof _=="bigint"||_.constructor==String?Y(null,_,null,null,null):ne(_)?Y(j,{children:_},null,null,null):_.constructor==null&&_.__b>0?Y(_.type,_.props,_.key,_.ref?_.ref:null,_.__v):_).__=t,_.__b=t.__b+1,c=null,(a=_.__i=Ze(_,n,h,o))!=-1&&(o--,(c=n[a])&&(c.__u|=2)),c==null||c.__v==null?(a==-1&&(s>p?f--:s<p&&f++),typeof _.type!="function"&&(_.__u|=4)):a!=h&&(a==h-1?f--:a==h+1?f++:(a>h?f--:f++,_.__u|=4))):t.__k[r]=null;if(o)for(r=0;r<p;r++)(c=n[r])!=null&&!(2&c.__u)&&(c.__e==i&&(i=z(c)),qe(c,c));return i}function Ae(t,e,n,i){var s,r;if(typeof t.type=="function"){for(s=t.__k,r=0;s&&r<s.length;r++)s[r]&&(s[r].__=t,e=Ae(s[r],e,n,i));return e}t.__e!=e&&(i&&(e&&t.type&&!e.parentNode&&(e=z(t)),n.insertBefore(t.__e,e||null)),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function Ze(t,e,n,i){var s,r,_,c=t.key,h=t.type,a=e[n],p=a!=null&&(2&a.__u)==0;if(a===null&&t.key==null||p&&c==a.key&&h==a.type)return n;if(i>(p?1:0)){for(s=n-1,r=n+1;s>=0||r<e.length;)if((a=e[_=s>=0?s--:r++])!=null&&!(2&a.__u)&&c==a.key&&h==a.type)return _}return-1}function ye(t,e,n){e[0]=="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||Ye.test(e)?n:n+"px"}function K(t,e,n,i,s){var r,_;e:if(e=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof i=="string"&&(t.style.cssText=i=""),i)for(e in i)n&&e in n||ye(t.style,e,"");if(n)for(e in n)i&&n[e]==i[e]||ye(t.style,e,n[e])}else if(e[0]=="o"&&e[1]=="n")r=e!=(e=e.replace(xe,"$1")),_=e.toLowerCase(),e=_ in t||e=="onFocusOut"||e=="onFocusIn"?_.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+r]=n,n?i?n.u=i.u:(n.u=ue,t.addEventListener(e,r?_e:le,r)):t.removeEventListener(e,r?_e:le,r);else{if(s=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function ve(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.t==null)e.t=ue++;else if(e.t<n.u)return;return n(v.event?v.event(e):e)}}}function pe(t,e,n,i,s,r,_,c,h,a){var p,o,f,u,k,C,w,g,m,T,N,B,$,G,A,x,R,L=e.type;if(e.constructor!=null)return null;128&n.__u&&(h=!!(32&n.__u),r=[c=e.__e=n.__e]),(p=v.__b)&&p(e);e:if(typeof L=="function")try{if(g=e.props,m="prototype"in L&&L.prototype.render,T=(p=L.contextType)&&i[p.__c],N=p?T?T.props.value:p.__:i,n.__c?w=(o=e.__c=n.__c).__=o.__E:(m?e.__c=o=new L(g,N):(e.__c=o=new J(g,N),o.constructor=L,o.render=tt),T&&T.sub(o),o.props=g,o.state||(o.state={}),o.context=N,o.__n=i,f=o.__d=!0,o.__h=[],o._sb=[]),m&&o.__s==null&&(o.__s=o.state),m&&L.getDerivedStateFromProps!=null&&(o.__s==o.state&&(o.__s=H({},o.__s)),H(o.__s,L.getDerivedStateFromProps(g,o.__s))),u=o.props,k=o.state,o.__v=e,f)m&&L.getDerivedStateFromProps==null&&o.componentWillMount!=null&&o.componentWillMount(),m&&o.componentDidMount!=null&&o.__h.push(o.componentDidMount);else{if(m&&L.getDerivedStateFromProps==null&&g!==u&&o.componentWillReceiveProps!=null&&o.componentWillReceiveProps(g,N),!o.__e&&o.shouldComponentUpdate!=null&&o.shouldComponentUpdate(g,o.__s,N)===!1||e.__v==n.__v){for(e.__v!=n.__v&&(o.props=g,o.state=o.__s,o.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some(function(M){M&&(M.__=e)}),B=0;B<o._sb.length;B++)o.__h.push(o._sb[B]);o._sb=[],o.__h.length&&_.push(o);break e}o.componentWillUpdate!=null&&o.componentWillUpdate(g,o.__s,N),m&&o.componentDidUpdate!=null&&o.__h.push(function(){o.componentDidUpdate(u,k,C)})}if(o.context=N,o.props=g,o.__P=t,o.__e=!1,$=v.__r,G=0,m){for(o.state=o.__s,o.__d=!1,$&&$(e),p=o.render(o.props,o.state,o.context),A=0;A<o._sb.length;A++)o.__h.push(o._sb[A]);o._sb=[]}else do o.__d=!1,$&&$(e),p=o.render(o.props,o.state,o.context),o.state=o.__s;while(o.__d&&++G<25);o.state=o.__s,o.getChildContext!=null&&(i=H(H({},i),o.getChildContext())),m&&!f&&o.getSnapshotBeforeUpdate!=null&&(C=o.getSnapshotBeforeUpdate(u,k)),x=p,p!=null&&p.type===j&&p.key==null&&(x=Oe(p.props.children)),c=$e(t,ne(x)?x:[x],e,n,i,s,r,_,c,h,a),o.base=e.__e,e.__u&=-161,o.__h.length&&_.push(o),w&&(o.__E=o.__=null)}catch(M){if(e.__v=null,h||r!=null)if(M.then){for(e.__u|=h?160:128;c&&c.nodeType==8&&c.nextSibling;)c=c.nextSibling;r[r.indexOf(c)]=null,e.__e=c}else{for(R=r.length;R--;)he(r[R]);ae(e)}else e.__e=n.__e,e.__k=n.__k,M.then||ae(e);v.__e(M,e,n)}else r==null&&e.__v==n.__v?(e.__k=n.__k,e.__e=n.__e):c=e.__e=et(n.__e,e,n,i,s,r,_,h,a);return(p=v.diffed)&&p(e),128&e.__u?void 0:c}function ae(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(ae)}function Me(t,e,n){for(var i=0;i<n.length;i++)fe(n[i],n[++i],n[++i]);v.__c&&v.__c(e,t),t.some(function(s){try{t=s.__h,s.__h=[],t.some(function(r){r.call(s)})}catch(r){v.__e(r,s.__v)}})}function Oe(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:ne(t)?t.map(Oe):H({},t)}function et(t,e,n,i,s,r,_,c,h){var a,p,o,f,u,k,C,w=n.props,g=e.props,m=e.type;if(m=="svg"?s="http://www.w3.org/2000/svg":m=="math"?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),r!=null){for(a=0;a<r.length;a++)if((u=r[a])&&"setAttribute"in u==!!m&&(m?u.localName==m:u.nodeType==3)){t=u,r[a]=null;break}}if(t==null){if(m==null)return document.createTextNode(g);t=document.createElementNS(s,m,g.is&&g),c&&(v.__m&&v.__m(e,r),c=!1),r=null}if(m==null)w===g||c&&t.data==g||(t.data=g);else{if(r=r&&te.call(t.childNodes),w=n.props||Q,!c&&r!=null)for(w={},a=0;a<t.attributes.length;a++)w[(u=t.attributes[a]).name]=u.value;for(a in w)if(u=w[a],a!="children"){if(a=="dangerouslySetInnerHTML")o=u;else if(!(a in g)){if(a=="value"&&"defaultValue"in g||a=="checked"&&"defaultChecked"in g)continue;K(t,a,null,u,s)}}for(a in g)u=g[a],a=="children"?f=u:a=="dangerouslySetInnerHTML"?p=u:a=="value"?k=u:a=="checked"?C=u:c&&typeof u!="function"||w[a]===u||K(t,a,u,w[a],s);if(p)c||o&&(p.__html==o.__html||p.__html==t.innerHTML)||(t.innerHTML=p.__html),e.__k=[];else if(o&&(t.innerHTML=""),$e(e.type=="template"?t.content:t,ne(f)?f:[f],e,n,i,m=="foreignObject"?"http://www.w3.org/1999/xhtml":s,r,_,r?r[0]:n.__k&&z(n,0),c,h),r!=null)for(a=r.length;a--;)he(r[a]);c||(a="value",m=="progress"&&k==null?t.removeAttribute("value"):k!=null&&(k!==t[a]||m=="progress"&&!k||m=="option"&&k!=w[a])&&K(t,a,k,w[a],s),a="checked",C!=null&&C!=t[a]&&K(t,a,C,w[a],s))}return t}function fe(t,e,n){try{if(typeof t=="function"){var i=typeof t.__u=="function";i&&t.__u(),i&&e==null||(t.__u=t(e))}else t.current=e}catch(s){v.__e(s,n)}}function qe(t,e,n){var i,s;if(v.unmount&&v.unmount(t),(i=t.ref)&&(i.current&&i.current!=t.__e||fe(i,null,e)),(i=t.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(r){v.__e(r,e)}i.base=i.__P=null}if(i=t.__k)for(s=0;s<i.length;s++)i[s]&&qe(i[s],e,n||typeof t.type!="function");n||he(t.__e),t.__c=t.__=t.__e=void 0}function tt(t,e,n){return this.constructor(t,n)}function nt(t,e,n){var i,s,r,_;e==document&&(e=document.documentElement),v.__&&v.__(t,e),s=(i=!1)?null:e.__k,r=[],_=[],pe(e,t=e.__k=Je(j,null,[t]),s||Q,Q,e.namespaceURI,s?null:e.firstChild?te.call(e.childNodes):null,r,s?s.__e:e.firstChild,i,_),Me(r,t,_)}te=De.slice,v={__e:function(t,e,n,i){for(var s,r,_;e=e.__;)if((s=e.__c)&&!s.__)try{if((r=s.constructor)&&r.getDerivedStateFromError!=null&&(s.setState(r.getDerivedStateFromError(t)),_=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(t,i||{}),_=s.__d),_)return s.__E=s}catch(c){t=c}throw t}},Te=0,J.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=H({},this.state),typeof t=="function"&&(t=t(H({},n),this.props)),t&&H(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),ge(this))},J.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),ge(this))},J.prototype.render=j,U=[],Re=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Fe=function(t,e){return t.__v.__b-e.__v.__b},Z.__r=0,xe=/(PointerCapture)$|Capture$/i,ue=0,le=ve(!1),_e=ve(!0);var rt=0;function l(t,e,n,i,s,r){e||(e={});var _,c,h=e;if("ref"in h)for(c in h={},e)c=="ref"?_=e[c]:h[c]=e[c];var a={type:t,props:h,key:n,ref:_,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--rt,__i:-1,__u:0,__source:s,__self:r};if(typeof t=="function"&&(_=t.defaultProps))for(c in _)h[c]===void 0&&(h[c]=_[c]);return v.vnode&&v.vnode(a),a}var ee,E,re,be,ce=0,We=[],S=v,ke=S.__b,we=S.__r,Ne=S.diffed,Ee=S.__c,Se=S.unmount,Ce=S.__;function Ge(t,e){S.__h&&S.__h(E,t,ce||e),ce=0;var n=E.__H||(E.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function P(t){return ce=1,it(Ie,t)}function it(t,e,n){var i=Ge(ee++,2);if(i.t=t,!i.__c&&(i.__=[Ie(void 0,e),function(c){var h=i.__N?i.__N[0]:i.__[0],a=i.t(h,c);h!==a&&(i.__N=[a,i.__[1]],i.__c.setState({}))}],i.__c=E,!E.__f)){var s=function(c,h,a){if(!i.__c.__H)return!0;var p=i.__c.__H.__.filter(function(f){return!!f.__c});if(p.every(function(f){return!f.__N}))return!r||r.call(this,c,h,a);var o=i.__c.props!==c;return p.forEach(function(f){if(f.__N){var u=f.__[0];f.__=f.__N,f.__N=void 0,u!==f.__[0]&&(o=!0)}}),r&&r.call(this,c,h,a)||o};E.__f=!0;var r=E.shouldComponentUpdate,_=E.componentWillUpdate;E.componentWillUpdate=function(c,h,a){if(this.__e){var p=r;r=void 0,s(c,h,a),r=p}_&&_.call(this,c,h,a)},E.shouldComponentUpdate=s}return i.__N||i.__}function st(t,e){var n=Ge(ee++,3);!S.__s&&_t(n.__H,e)&&(n.__=t,n.u=e,E.__H.__h.push(n))}function ot(){for(var t;t=We.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(X),t.__H.__h.forEach(de),t.__H.__h=[]}catch(e){t.__H.__h=[],S.__e(e,t.__v)}}S.__b=function(t){E=null,ke&&ke(t)},S.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),Ce&&Ce(t,e)},S.__r=function(t){we&&we(t),ee=0;var e=(E=t.__c).__H;e&&(re===E?(e.__h=[],E.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(e.__h.forEach(X),e.__h.forEach(de),e.__h=[],ee=0)),re=E},S.diffed=function(t){Ne&&Ne(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(We.push(e)!==1&&be===S.requestAnimationFrame||((be=S.requestAnimationFrame)||lt)(ot)),e.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),re=E=null},S.__c=function(t,e){e.some(function(n){try{n.__h.forEach(X),n.__h=n.__h.filter(function(i){return!i.__||de(i)})}catch(i){e.some(function(s){s.__h&&(s.__h=[])}),e=[],S.__e(i,n.__v)}}),Ee&&Ee(t,e)},S.unmount=function(t){Se&&Se(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(i){try{X(i)}catch(s){e=s}}),n.__H=void 0,e&&S.__e(e,n.__v))};var Le=typeof requestAnimationFrame=="function";function lt(t){var e,n=function(){clearTimeout(i),Le&&cancelAnimationFrame(e),setTimeout(t)},i=setTimeout(n,35);Le&&(e=requestAnimationFrame(n))}function X(t){var e=E,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),E=e}function de(t){var e=E;t.__c=t.__(),E=e}function _t(t,e){return!t||t.length!==e.length||e.some(function(n,i){return n!==t[i]})}function Ie(t,e){return typeof e=="function"?e(t):e}class at{constructor(){W(this,"worker",null);W(this,"nextId",1);W(this,"pending",new Map);this.initWorker()}initWorker(){this.worker=new Worker(new URL("/assets/sqlite.worker-_OtizGaN.js",import.meta.url),{type:"module"}),this.worker.onmessage=e=>{const n=e.data;if("type"in n&&n.type==="READY"){console.log("[DbClient] Worker ready");return}const{id:i,response:s}=n,r=this.pending.get(i);r&&(this.pending.delete(i),r.resolve(s))},this.worker.onerror=e=>{console.error("[DbClient] Worker error:",e);for(const n of this.pending.values())n.reject(new Error("Worker error"));this.pending.clear()}}async sendRequest(e){if(!this.worker)throw new Error("Worker not initialized");const n=this.nextId++;return new Promise((i,s)=>{this.pending.set(n,{resolve:_=>{_.ok?i(_.data):s(new Error(_.error))},reject:s});const r={id:n,request:e};this.worker.postMessage(r)})}async openFromFile(e){return this.sendRequest({type:"OPEN_FROM_FILE",file:e})}async openDemo(){return this.sendRequest({type:"OPEN_DEMO"})}async close(){return this.sendRequest({type:"CLOSE"})}async searchFts(e,n=20){return this.sendRequest({type:"FTS_SEARCH",query:e,limit:n})}async searchHybrid(e,n=20,i){return this.sendRequest({type:"HYBRID_SEARCH",query:e,limit:n,weights:i})}async listEntities(e,n=100){return this.sendRequest({type:"LIST_ENTITIES",entityType:e,limit:n})}async getPageList(e=100,n=0){return this.sendRequest({type:"GET_PAGE_LIST",limit:e,offset:n})}async getPageBlob(e){return this.sendRequest({type:"GET_PAGE_BLOB",name:e})}async verifyPage(e){return this.sendRequest({type:"VERIFY_PAGE",gid:e})}async getCheckpoints(){return this.sendRequest({type:"GET_CHECKPOINTS"})}async graphHops(e,n,i,s){return this.sendRequest({type:"GRAPH_HOPS",seedGid:e,predicate:n,maxHops:i,limit:s})}terminate(){this.worker&&(this.worker.terminate(),this.worker=null),this.pending.clear()}}let ie=null;function se(){return ie||(ie=new at),ie}class ct{constructor(){W(this,"worker",null);W(this,"nextId",1);W(this,"pending",new Map);W(this,"progressCallback",null);this.initWorker()}initWorker(){this.worker=new Worker(new URL("/assets/llm.worker-DcSBfjIK.js",import.meta.url),{type:"module"}),this.worker.onmessage=e=>{const n=e.data;if("type"in n&&n.type==="READY"){console.log("[LlmClient] Worker ready");return}if("type"in n&&n.type==="PROGRESS"){this.progressCallback&&this.progressCallback(n.data);return}const{id:i,response:s}=n,r=this.pending.get(i);r&&(this.pending.delete(i),r.resolve(s))},this.worker.onerror=e=>{console.error("[LlmClient] Worker error:",e);for(const n of this.pending.values())n.reject(new Error("Worker error"));this.pending.clear()}}async sendRequest(e){if(!this.worker)throw new Error("Worker not initialized");const n=this.nextId++;return new Promise((i,s)=>{this.pending.set(n,{resolve:_=>{_.ok?i(_.data):s(new Error(_.error))},reject:s});const r={id:n,request:e};this.worker.postMessage(r)})}onProgress(e){this.progressCallback=e}async loadModel(e){return this.sendRequest({type:"LOAD_MODEL",modelUrl:e})}async reason(e){return this.sendRequest({type:"REASON",request:e})}async unloadModel(){return this.sendRequest({type:"UNLOAD_MODEL"})}async getStatus(){return this.sendRequest({type:"GET_STATUS"})}terminate(){this.worker&&(this.worker.terminate(),this.worker=null),this.pending.clear(),this.progressCallback=null}}let oe=null;function Pe(){return oe||(oe=new ct),oe}const dt={"0.6b":"https://huggingface.co/unsloth/Qwen3-0.6B-GGUF/resolve/main/Qwen3-0.6B-Q4_K_M.gguf","1.5b":"https://huggingface.co/ggml-org/Qwen2.5-1.5B-Instruct-GGUF/resolve/main/qwen2.5-1.5b-instruct-q4_k_m.gguf"};function ut(){const[t,e]=P(null),[n,i]=P(!1),[s,r]=P(null),[_,c]=P(null),[h,a]=P(""),[p,o]=P("hybrid"),[f,u]=P([]),[k,C]=P(null),[w,g]=P(!1),[m,T]=P(!1),[N,B]=P(null),[$,G]=P(!1),[A,x]=P(null),[R,L]=P(null);st(()=>{t&&(async()=>{try{const b=await se().listEntities(void 0,50);u(b)}catch(y){console.error("Failed to load entities:",y)}})()},[t]);const M=async()=>{i(!0),r(null);try{const y=await se().openDemo();e(y),console.log("Capsule info:",y)}catch(d){r(String(d)),console.error("Failed to open capsule:",d)}finally{i(!1)}},Ue=async d=>{if(t){i(!0),r(null),a(d),L(null);try{const y=se();let b=[];if(p==="fts")b=(await y.searchFts(d,10)).map(F=>({gid:F.gid,pageNo:F.pageNo,title:F.title,snippet:F.snippet,scores:{fts:F.score,vector:0,entity:0,graph:0,final:F.score}}));else if(p==="hybrid")b=await y.searchHybrid(d,10);else if(p==="graph"){const O=await y.searchFts(d,3);if(O.length>0){const F=O[0].gid,q=await y.graphHops(F,void 0,2,10);b=q.nodes.map(I=>{const V=q.distances[I.gid]||0,D=O.find(je=>je.gid===I.gid);return{gid:I.gid,pageNo:I.pageNo,title:I.title,snippet:(D==null?void 0:D.snippet)||null,scores:{fts:(D==null?void 0:D.score)||0,vector:0,entity:0,graph:1/(V+1),final:((D==null?void 0:D.score)||0)*.3+1/(V+1)*.7}}}),b.sort((I,V)=>V.scores.final-I.scores.final)}}c(b),console.log("Search results:",b),m&&(N!=null&&N.loaded)&&b.length>0&&await Qe(d,b)}catch(y){r(String(y)),console.error("Search failed:",y)}finally{i(!1)}}},Be=async()=>{G(!0),r(null),x(null);try{const d=Pe();d.onProgress(b=>{x(b)});const y=await d.loadModel(dt["0.6b"]);B(y),x(null),console.log("Model loaded:",y)}catch(d){r(String(d)),console.error("Failed to load model:",d)}finally{G(!1)}},ze=async()=>{m?(T(!1),L(null)):(N!=null&&N.loaded||await Be(),T(!0))},Qe=async(d,y)=>{if(N!=null&&N.loaded){G(!0),r(null);try{const b=Pe(),O=y.slice(0,5).map(q=>({gid:q.gid,pageNo:q.pageNo,title:q.title,text:q.snippet||"",score:q.scores.final})),F=await b.reason({question:d,snippets:O,maxTokens:256,temperature:.7});L(F),console.log("Reasoning complete:",F)}catch(b){r(String(b)),console.error("Reasoning failed:",b)}finally{G(!1)}}};return l("div",{className:"app",children:[l("header",{className:"app-header",children:[l("h1",{children:"Glyphcapsule Explorer"}),l("p",{children:"Hybrid Retrieval Demo for MemGlyph"})]}),l("main",{className:"app-main",children:t?l("div",{className:"capsule-view",children:[l("div",{className:"capsule-info",children:[l("h2",{children:["ðŸ“¦ ",t.fileName]}),l("dl",{children:[l("dt",{children:"File Size:"}),l("dd",{children:[(t.fileSize/1024).toFixed(1)," KB"]}),l("dt",{children:"Doc ID:"}),l("dd",{children:l("code",{children:[t.docId.slice(0,24),"..."]})}),l("dt",{children:"Pages:"}),l("dd",{children:t.pageCount}),l("dt",{children:"Entities:"}),l("dd",{children:t.entityCount}),l("dt",{children:"Graph Edges:"}),l("dd",{children:t.edgeCount}),t.hasVectors&&l(j,{children:[l("dt",{children:"Vectors:"}),l("dd",{children:["âœ… ",t.vectorModel," (",t.vectorDim,"-dim)"]})]})]}),l("div",{className:"llm-toggle",children:[l("label",{className:"toggle-label",children:[l("input",{type:"checkbox",checked:m,onChange:ze,disabled:$}),l("span",{className:"toggle-text",children:"ðŸ¤– Enable LLM Reasoning (Qwen 3 0.6B)"})]}),(N==null?void 0:N.loaded)&&l("span",{className:"model-status",children:"âœ… Model loaded"}),A&&l("div",{className:"llm-progress",children:[A.message," (",(A.progress*100).toFixed(0),"%)"]})]})]}),l("div",{className:"search-section",children:[l("div",{className:"search-header",children:[l("h3",{children:"ðŸ” Search"}),l("button",{className:"btn-secondary btn-entities",onClick:()=>g(!w),children:[w?"Hide":"Show"," Entities (",f.length,")"]})]}),l("div",{className:"search-mode-toggle",children:[l("button",{className:`mode-btn ${p==="fts"?"active":""}`,onClick:()=>o("fts"),children:"ðŸ“ FTS Only"}),l("button",{className:`mode-btn ${p==="hybrid"?"active":""}`,onClick:()=>o("hybrid"),children:"âš¡ Hybrid"}),l("button",{className:`mode-btn ${p==="graph"?"active":""}`,onClick:()=>o("graph"),children:"ðŸ•¸ï¸ Graph"})]}),l("p",{className:"search-hint",children:["Try searching: ",l("em",{children:'"vector search"'}),", ",l("em",{children:'"LEANN"'}),", ",l("em",{children:'"SQLite"'}),", or ",l("em",{children:'"hybrid retrieval"'})]}),w&&f.length>0&&l("div",{className:"entity-panel",children:[l("h4",{children:"Filter by Entity Type"}),l("div",{className:"entity-filters",children:[l("button",{className:`entity-filter ${k===null?"active":""}`,onClick:()=>C(null),children:["All (",f.reduce((d,y)=>d+y.count,0),")"]}),Array.from(new Set(f.map(d=>d.entityType))).map(d=>{const y=f.filter(b=>b.entityType===d).reduce((b,O)=>b+O.count,0);return l("button",{className:`entity-filter ${k===d?"active":""}`,onClick:()=>C(d),children:[d," (",y,")"]},d)})]}),l("div",{className:"entity-list",children:f.filter(d=>!k||d.entityType===k).slice(0,20).map(d=>l("div",{className:"entity-item",children:[l("span",{className:"entity-type",children:d.entityType}),l("span",{className:"entity-value",children:d.normalizedValue}),l("span",{className:"entity-count",children:d.count})]},`${d.entityType}-${d.normalizedValue}`))})]}),l("form",{onSubmit:d=>{d.preventDefault();const b=new FormData(d.currentTarget).get("query");b.trim()&&Ue(b.trim())},children:l("div",{className:"search-bar",children:[l("input",{type:"text",name:"query",placeholder:"Search the capsule...",className:"search-input",disabled:n}),l("button",{type:"submit",className:"btn-search",disabled:n,children:n?"Searching...":"Search"})]})}),_&&l("div",{className:"search-results",children:[l("p",{className:"results-header",children:["Found ",_.length," results for ",l("strong",{children:['"',h,'"']})]}),_.map(d=>l("div",{className:"result-item",children:[l("div",{className:"result-header",children:[l("span",{className:"result-page",children:["Page ",d.pageNo]}),l("span",{className:"result-score",children:["Score: ",d.scores.final.toFixed(3)]})]}),l("h4",{className:"result-title",children:d.title}),d.snippet&&l("p",{className:"result-snippet",dangerouslySetInnerHTML:{__html:d.snippet}}),l("div",{className:"result-scores",children:[l("span",{children:["FTS: ",d.scores.fts.toFixed(2)]}),l("span",{children:["Entity: ",d.scores.entity.toFixed(2)]}),l("span",{children:["Graph: ",d.scores.graph.toFixed(2)]})]})]},d.gid))]}),R&&l("div",{className:"reasoning-output",children:[l("div",{className:"reasoning-header",children:[l("h4",{children:"ðŸ¤– LLM Reasoning"}),l("span",{className:"reasoning-meta",children:[R.inferenceTimeMs.toFixed(0),"ms Â· ",R.tokensGenerated," tokens"]})]}),l("div",{className:"reasoning-answer",children:R.answer}),R.usedSnippets.length>0&&l("div",{className:"reasoning-citations",children:[l("strong",{children:"ðŸ“‘ Cited sources:"}),R.usedSnippets.map(d=>{const y=_==null?void 0:_.find(b=>b.gid===d);return l("span",{className:"citation",children:["Page ",(y==null?void 0:y.pageNo)||"?"]},d)})]})]}),$&&!R&&l("div",{className:"reasoning-loading",children:[l("div",{className:"spinner"}),l("p",{children:"LLM is reasoning..."})]})]})]}):l("div",{className:"welcome",children:[l("h2",{children:"Welcome!"}),l("p",{children:"This is an offline-capable PWA for exploring MemGlyph Glyphcapsules with hybrid retrieval (FTS + Vector + Entity + Graph)."}),l("p",{children:[l("strong",{children:"Demo capsule:"})," memglyph-demo.mgx.sqlite",l("br",{}),"(8 pages, 25 entities, 11 edges, 384-dim vectors)"]}),s&&l("div",{className:"error",children:[l("strong",{children:"Error:"})," ",s]}),l("button",{className:"btn-primary",onClick:M,disabled:n,children:n?"Opening...":"Open Demo Capsule"})]})}),l("footer",{className:"app-footer",children:l("p",{children:"Built with Preact + SQLite WASM + OPFS"})})]})}nt(l(ut,{}),document.getElementById("app"));
