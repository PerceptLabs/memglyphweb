var qe=Object.defineProperty;var We=(t,e,n)=>e in t?qe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var $=(t,e,n)=>We(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const i of l)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(l){const i={};return l.integrity&&(i.integrity=l.integrity),l.referrerPolicy&&(i.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?i.credentials="include":l.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(l){if(l.ep)return;l.ep=!0;const i=n(l);fetch(l.href,i)}})();var z,b,Ne,R,ae,we,ke,xe,se,Z,ee,q={},Ee=[],Ae=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,V=Array.isArray;function T(t,e){for(var n in e)t[n]=e[n];return t}function le(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function Ge(t,e,n){var s,l,i,a={};for(i in e)i=="key"?s=e[i]:i=="ref"?l=e[i]:a[i]=e[i];if(arguments.length>2&&(a.children=arguments.length>3?z.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(i in t.defaultProps)a[i]===void 0&&(a[i]=t.defaultProps[i]);return G(t,a,s,l,null)}function G(t,e,n,s,l){var i={type:t,props:e,key:n,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:l??++Ne,__i:-1,__u:0};return l==null&&b.vnode!=null&&b.vnode(i),i}function H(t){return t.children}function I(t,e){this.props=t,this.context=e}function O(t,e){if(e==null)return t.__?O(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?O(t):null}function Se(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return Se(t)}}function ce(t){(!t.__d&&(t.__d=!0)&&R.push(t)&&!B.__r++||ae!=b.debounceRendering)&&((ae=b.debounceRendering)||we)(B)}function B(){for(var t,e,n,s,l,i,a,d=1;R.length;)R.length>d&&R.sort(ke),t=R.shift(),d=R.length,t.__d&&(n=void 0,s=void 0,l=(s=(e=t).__v).__e,i=[],a=[],e.__P&&((n=T({},s)).__v=s.__v+1,b.vnode&&b.vnode(n),ie(e.__P,n,s,e.__n,e.__P.namespaceURI,32&s.__u?[l]:null,i,l??O(s),!!(32&s.__u),a),n.__v=s.__v,n.__.__k[n.__i]=n,Le(i,n,a),s.__e=s.__=null,n.__e!=l&&Se(n)));B.__r=0}function Ce(t,e,n,s,l,i,a,d,_,c,f){var o,h,p,v,w,y,m,u=s&&s.__k||Ee,g=e.length;for(_=Ie(n,e,u,_,g),o=0;o<g;o++)(p=n.__k[o])!=null&&(h=p.__i==-1?q:u[p.__i]||q,p.__i=o,y=ie(t,p,h,l,i,a,d,_,c,f),v=p.__e,p.ref&&h.ref!=p.ref&&(h.ref&&oe(h.ref,null,p),f.push(p.ref,p.__c||v,p)),w==null&&v!=null&&(w=v),(m=!!(4&p.__u))||h.__k===p.__k?_=Me(p,_,t,m):typeof p.type=="function"&&y!==void 0?_=y:v&&(_=v.nextSibling),p.__u&=-7);return n.__e=w,_}function Ie(t,e,n,s,l){var i,a,d,_,c,f=n.length,o=f,h=0;for(t.__k=new Array(l),i=0;i<l;i++)(a=e[i])!=null&&typeof a!="boolean"&&typeof a!="function"?(_=i+h,(a=t.__k[i]=typeof a=="string"||typeof a=="number"||typeof a=="bigint"||a.constructor==String?G(null,a,null,null,null):V(a)?G(H,{children:a},null,null,null):a.constructor==null&&a.__b>0?G(a.type,a.props,a.key,a.ref?a.ref:null,a.__v):a).__=t,a.__b=t.__b+1,d=null,(c=a.__i=Ue(a,n,_,o))!=-1&&(o--,(d=n[c])&&(d.__u|=2)),d==null||d.__v==null?(c==-1&&(l>f?h--:l<f&&h++),typeof a.type!="function"&&(a.__u|=4)):c!=_&&(c==_-1?h--:c==_+1?h++:(c>_?h--:h++,a.__u|=4))):t.__k[i]=null;if(o)for(i=0;i<f;i++)(d=n[i])!=null&&!(2&d.__u)&&(d.__e==s&&(s=O(d)),$e(d,d));return s}function Me(t,e,n,s){var l,i;if(typeof t.type=="function"){for(l=t.__k,i=0;l&&i<l.length;i++)l[i]&&(l[i].__=t,e=Me(l[i],e,n,s));return e}t.__e!=e&&(s&&(e&&t.type&&!e.parentNode&&(e=O(t)),n.insertBefore(t.__e,e||null)),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function Ue(t,e,n,s){var l,i,a,d=t.key,_=t.type,c=e[n],f=c!=null&&(2&c.__u)==0;if(c===null&&t.key==null||f&&d==c.key&&_==c.type)return n;if(s>(f?1:0)){for(l=n-1,i=n+1;l>=0||i<e.length;)if((c=e[a=l>=0?l--:i++])!=null&&!(2&c.__u)&&d==c.key&&_==c.type)return a}return-1}function de(t,e,n){e[0]=="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||Ae.test(e)?n:n+"px"}function A(t,e,n,s,l){var i,a;e:if(e=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof s=="string"&&(t.style.cssText=s=""),s)for(e in s)n&&e in n||de(t.style,e,"");if(n)for(e in n)s&&n[e]==s[e]||de(t.style,e,n[e])}else if(e[0]=="o"&&e[1]=="n")i=e!=(e=e.replace(xe,"$1")),a=e.toLowerCase(),e=a in t||e=="onFocusOut"||e=="onFocusIn"?a.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+i]=n,n?s?n.u=s.u:(n.u=se,t.addEventListener(e,i?ee:Z,i)):t.removeEventListener(e,i?ee:Z,i);else{if(l=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function ue(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.t==null)e.t=se++;else if(e.t<n.u)return;return n(b.event?b.event(e):e)}}}function ie(t,e,n,s,l,i,a,d,_,c){var f,o,h,p,v,w,y,m,u,g,N,S,C,M,F,P,Y,L=e.type;if(e.constructor!=null)return null;128&n.__u&&(_=!!(32&n.__u),i=[d=e.__e=n.__e]),(f=b.__b)&&f(e);e:if(typeof L=="function")try{if(m=e.props,u="prototype"in L&&L.prototype.render,g=(f=L.contextType)&&s[f.__c],N=f?g?g.props.value:f.__:s,n.__c?y=(o=e.__c=n.__c).__=o.__E:(u?e.__c=o=new L(m,N):(e.__c=o=new I(m,N),o.constructor=L,o.render=je),g&&g.sub(o),o.props=m,o.state||(o.state={}),o.context=N,o.__n=s,h=o.__d=!0,o.__h=[],o._sb=[]),u&&o.__s==null&&(o.__s=o.state),u&&L.getDerivedStateFromProps!=null&&(o.__s==o.state&&(o.__s=T({},o.__s)),T(o.__s,L.getDerivedStateFromProps(m,o.__s))),p=o.props,v=o.state,o.__v=e,h)u&&L.getDerivedStateFromProps==null&&o.componentWillMount!=null&&o.componentWillMount(),u&&o.componentDidMount!=null&&o.__h.push(o.componentDidMount);else{if(u&&L.getDerivedStateFromProps==null&&m!==p&&o.componentWillReceiveProps!=null&&o.componentWillReceiveProps(m,N),!o.__e&&o.shouldComponentUpdate!=null&&o.shouldComponentUpdate(m,o.__s,N)===!1||e.__v==n.__v){for(e.__v!=n.__v&&(o.props=m,o.state=o.__s,o.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some(function(D){D&&(D.__=e)}),S=0;S<o._sb.length;S++)o.__h.push(o._sb[S]);o._sb=[],o.__h.length&&a.push(o);break e}o.componentWillUpdate!=null&&o.componentWillUpdate(m,o.__s,N),u&&o.componentDidUpdate!=null&&o.__h.push(function(){o.componentDidUpdate(p,v,w)})}if(o.context=N,o.props=m,o.__P=t,o.__e=!1,C=b.__r,M=0,u){for(o.state=o.__s,o.__d=!1,C&&C(e),f=o.render(o.props,o.state,o.context),F=0;F<o._sb.length;F++)o.__h.push(o._sb[F]);o._sb=[]}else do o.__d=!1,C&&C(e),f=o.render(o.props,o.state,o.context),o.state=o.__s;while(o.__d&&++M<25);o.state=o.__s,o.getChildContext!=null&&(s=T(T({},s),o.getChildContext())),u&&!h&&o.getSnapshotBeforeUpdate!=null&&(w=o.getSnapshotBeforeUpdate(p,v)),P=f,f!=null&&f.type===H&&f.key==null&&(P=Te(f.props.children)),d=Ce(t,V(P)?P:[P],e,n,s,l,i,a,d,_,c),o.base=e.__e,e.__u&=-161,o.__h.length&&a.push(o),y&&(o.__E=o.__=null)}catch(D){if(e.__v=null,_||i!=null)if(D.then){for(e.__u|=_?160:128;d&&d.nodeType==8&&d.nextSibling;)d=d.nextSibling;i[i.indexOf(d)]=null,e.__e=d}else{for(Y=i.length;Y--;)le(i[Y]);te(e)}else e.__e=n.__e,e.__k=n.__k,D.then||te(e);b.__e(D,e,n)}else i==null&&e.__v==n.__v?(e.__k=n.__k,e.__e=n.__e):d=e.__e=Be(n.__e,e,n,s,l,i,a,_,c);return(f=b.diffed)&&f(e),128&e.__u?void 0:d}function te(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(te)}function Le(t,e,n){for(var s=0;s<n.length;s++)oe(n[s],n[++s],n[++s]);b.__c&&b.__c(e,t),t.some(function(l){try{t=l.__h,l.__h=[],t.some(function(i){i.call(l)})}catch(i){b.__e(i,l.__v)}})}function Te(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:V(t)?t.map(Te):T({},t)}function Be(t,e,n,s,l,i,a,d,_){var c,f,o,h,p,v,w,y=n.props,m=e.props,u=e.type;if(u=="svg"?l="http://www.w3.org/2000/svg":u=="math"?l="http://www.w3.org/1998/Math/MathML":l||(l="http://www.w3.org/1999/xhtml"),i!=null){for(c=0;c<i.length;c++)if((p=i[c])&&"setAttribute"in p==!!u&&(u?p.localName==u:p.nodeType==3)){t=p,i[c]=null;break}}if(t==null){if(u==null)return document.createTextNode(m);t=document.createElementNS(l,u,m.is&&m),d&&(b.__m&&b.__m(e,i),d=!1),i=null}if(u==null)y===m||d&&t.data==m||(t.data=m);else{if(i=i&&z.call(t.childNodes),y=n.props||q,!d&&i!=null)for(y={},c=0;c<t.attributes.length;c++)y[(p=t.attributes[c]).name]=p.value;for(c in y)if(p=y[c],c!="children"){if(c=="dangerouslySetInnerHTML")o=p;else if(!(c in m)){if(c=="value"&&"defaultValue"in m||c=="checked"&&"defaultChecked"in m)continue;A(t,c,null,p,l)}}for(c in m)p=m[c],c=="children"?h=p:c=="dangerouslySetInnerHTML"?f=p:c=="value"?v=p:c=="checked"?w=p:d&&typeof p!="function"||y[c]===p||A(t,c,p,y[c],l);if(f)d||o&&(f.__html==o.__html||f.__html==t.innerHTML)||(t.innerHTML=f.__html),e.__k=[];else if(o&&(t.innerHTML=""),Ce(e.type=="template"?t.content:t,V(h)?h:[h],e,n,s,u=="foreignObject"?"http://www.w3.org/1999/xhtml":l,i,a,i?i[0]:n.__k&&O(n,0),d,_),i!=null)for(c=i.length;c--;)le(i[c]);d||(c="value",u=="progress"&&v==null?t.removeAttribute("value"):v!=null&&(v!==t[c]||u=="progress"&&!v||u=="option"&&v!=y[c])&&A(t,c,v,y[c],l),c="checked",w!=null&&w!=t[c]&&A(t,c,w,y[c],l))}return t}function oe(t,e,n){try{if(typeof t=="function"){var s=typeof t.__u=="function";s&&t.__u(),s&&e==null||(t.__u=t(e))}else t.current=e}catch(l){b.__e(l,n)}}function $e(t,e,n){var s,l;if(b.unmount&&b.unmount(t),(s=t.ref)&&(s.current&&s.current!=t.__e||oe(s,null,e)),(s=t.__c)!=null){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(i){b.__e(i,e)}s.base=s.__P=null}if(s=t.__k)for(l=0;l<s.length;l++)s[l]&&$e(s[l],e,n||typeof t.type!="function");n||le(t.__e),t.__c=t.__=t.__e=void 0}function je(t,e,n){return this.constructor(t,n)}function ze(t,e,n){var s,l,i,a;e==document&&(e=document.documentElement),b.__&&b.__(t,e),l=(s=!1)?null:e.__k,i=[],a=[],ie(e,t=e.__k=Ge(H,null,[t]),l||q,q,e.namespaceURI,l?null:e.firstChild?z.call(e.childNodes):null,i,l?l.__e:e.firstChild,s,a),Le(i,t,a)}z=Ee.slice,b={__e:function(t,e,n,s){for(var l,i,a;e=e.__;)if((l=e.__c)&&!l.__)try{if((i=l.constructor)&&i.getDerivedStateFromError!=null&&(l.setState(i.getDerivedStateFromError(t)),a=l.__d),l.componentDidCatch!=null&&(l.componentDidCatch(t,s||{}),a=l.__d),a)return l.__E=l}catch(d){t=d}throw t}},Ne=0,I.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=T({},this.state),typeof t=="function"&&(t=t(T({},n),this.props)),t&&T(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),ce(this))},I.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),ce(this))},I.prototype.render=H,R=[],we=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,ke=function(t,e){return t.__v.__b-e.__v.__b},B.__r=0,xe=/(PointerCapture)$|Capture$/i,se=0,Z=ue(!1),ee=ue(!0);var Ve=0;function r(t,e,n,s,l,i){e||(e={});var a,d,_=e;if("ref"in _)for(d in _={},e)d=="ref"?a=e[d]:_[d]=e[d];var c={type:t,props:_,key:n,ref:a,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Ve,__i:-1,__u:0,__source:l,__self:i};if(typeof t=="function"&&(a=t.defaultProps))for(d in a)_[d]===void 0&&(_[d]=a[d]);return b.vnode&&b.vnode(c),c}var j,x,K,_e,ne=0,Re=[],E=b,he=E.__b,pe=E.__r,fe=E.diffed,me=E.__c,ge=E.unmount,ye=E.__;function Fe(t,e){E.__h&&E.__h(x,t,ne||e),ne=0;var n=x.__H||(x.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function k(t){return ne=1,Qe(De,t)}function Qe(t,e,n){var s=Fe(j++,2);if(s.t=t,!s.__c&&(s.__=[De(void 0,e),function(d){var _=s.__N?s.__N[0]:s.__[0],c=s.t(_,d);_!==c&&(s.__N=[c,s.__[1]],s.__c.setState({}))}],s.__c=x,!x.__f)){var l=function(d,_,c){if(!s.__c.__H)return!0;var f=s.__c.__H.__.filter(function(h){return!!h.__c});if(f.every(function(h){return!h.__N}))return!i||i.call(this,d,_,c);var o=s.__c.props!==d;return f.forEach(function(h){if(h.__N){var p=h.__[0];h.__=h.__N,h.__N=void 0,p!==h.__[0]&&(o=!0)}}),i&&i.call(this,d,_,c)||o};x.__f=!0;var i=x.shouldComponentUpdate,a=x.componentWillUpdate;x.componentWillUpdate=function(d,_,c){if(this.__e){var f=i;i=void 0,l(d,_,c),i=f}a&&a.call(this,d,_,c)},x.shouldComponentUpdate=l}return s.__N||s.__}function Q(t,e){var n=Fe(j++,3);!E.__s&&Xe(n.__H,e)&&(n.__=t,n.u=e,x.__H.__h.push(n))}function Ye(){for(var t;t=Re.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(U),t.__H.__h.forEach(re),t.__H.__h=[]}catch(e){t.__H.__h=[],E.__e(e,t.__v)}}E.__b=function(t){x=null,he&&he(t)},E.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),ye&&ye(t,e)},E.__r=function(t){pe&&pe(t),j=0;var e=(x=t.__c).__H;e&&(K===x?(e.__h=[],x.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(e.__h.forEach(U),e.__h.forEach(re),e.__h=[],j=0)),K=x},E.diffed=function(t){fe&&fe(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(Re.push(e)!==1&&_e===E.requestAnimationFrame||((_e=E.requestAnimationFrame)||Ke)(Ye)),e.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),K=x=null},E.__c=function(t,e){e.some(function(n){try{n.__h.forEach(U),n.__h=n.__h.filter(function(s){return!s.__||re(s)})}catch(s){e.some(function(l){l.__h&&(l.__h=[])}),e=[],E.__e(s,n.__v)}}),me&&me(t,e)},E.unmount=function(t){ge&&ge(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(s){try{U(s)}catch(l){e=l}}),n.__H=void 0,e&&E.__e(e,n.__v))};var ve=typeof requestAnimationFrame=="function";function Ke(t){var e,n=function(){clearTimeout(s),ve&&cancelAnimationFrame(e),setTimeout(t)},s=setTimeout(n,35);ve&&(e=requestAnimationFrame(n))}function U(t){var e=x,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),x=e}function re(t){var e=x;t.__c=t.__(),x=e}function Xe(t,e){return!t||t.length!==e.length||e.some(function(n,s){return n!==t[s]})}function De(t,e){return typeof e=="function"?e(t):e}class Je{constructor(){$(this,"worker",null);$(this,"nextId",1);$(this,"pending",new Map);this.initWorker()}initWorker(){this.worker=new Worker(new URL("/assets/sqlite.worker-_OtizGaN.js",import.meta.url),{type:"module"}),this.worker.onmessage=e=>{const n=e.data;if("type"in n&&n.type==="READY"){console.log("[DbClient] Worker ready");return}const{id:s,response:l}=n,i=this.pending.get(s);i&&(this.pending.delete(s),i.resolve(l))},this.worker.onerror=e=>{console.error("[DbClient] Worker error:",e);for(const n of this.pending.values())n.reject(new Error("Worker error"));this.pending.clear()}}async sendRequest(e){if(!this.worker)throw new Error("Worker not initialized");const n=this.nextId++;return new Promise((s,l)=>{this.pending.set(n,{resolve:a=>{a.ok?s(a.data):l(new Error(a.error))},reject:l});const i={id:n,request:e};this.worker.postMessage(i)})}async openFromFile(e){return this.sendRequest({type:"OPEN_FROM_FILE",file:e})}async openDemo(){return this.sendRequest({type:"OPEN_DEMO"})}async close(){return this.sendRequest({type:"CLOSE"})}async searchFts(e,n=20){return this.sendRequest({type:"FTS_SEARCH",query:e,limit:n})}async searchHybrid(e,n=20,s){return this.sendRequest({type:"HYBRID_SEARCH",query:e,limit:n,weights:s})}async listEntities(e,n=100){return this.sendRequest({type:"LIST_ENTITIES",entityType:e,limit:n})}async getPageList(e=100,n=0){return this.sendRequest({type:"GET_PAGE_LIST",limit:e,offset:n})}async getPageBlob(e){return this.sendRequest({type:"GET_PAGE_BLOB",name:e})}async verifyPage(e){return this.sendRequest({type:"VERIFY_PAGE",gid:e})}async getCheckpoints(){return this.sendRequest({type:"GET_CHECKPOINTS"})}async graphHops(e,n,s,l){return this.sendRequest({type:"GRAPH_HOPS",seedGid:e,predicate:n,maxHops:s,limit:l})}terminate(){this.worker&&(this.worker.terminate(),this.worker=null),this.pending.clear()}}let X=null;function W(){return X||(X=new Je),X}function Ze(t={}){const{defaultMode:e="hybrid",maxResults:n=10,maxGraphHops:s=2}=t,[l,i]=k(e),[a,d]=k(null),[_,c]=k(""),[f,o]=k(!1),[h,p]=k(null);return{mode:l,results:a,lastQuery:_,loading:f,error:h,search:async m=>{if(m.trim()){o(!0),p(null),c(m);try{const u=W();let g=[];switch(l){case"fts":g=await et(u,m,n);break;case"hybrid":g=await u.searchHybrid(m,n);break;case"graph":g=await tt(u,m,n,s);break;default:throw new Error(`Unknown search mode: ${l}`)}return d(g),console.log(`[Search] ${l} mode: ${g.length} results`),g}catch(u){const g=String(u);return p(g),console.error("[Search] Failed:",u),[]}finally{o(!1)}}},clear:()=>{d(null),c(""),p(null)},changeMode:m=>{i(m),d(null)}}}async function et(t,e,n){return(await t.searchFts(e,n)).map(l=>({gid:l.gid,pageNo:l.pageNo,title:l.title,snippet:l.snippet,scores:{fts:l.score,vector:0,entity:0,graph:0,final:l.score}}))}async function tt(t,e,n,s){const l=await t.searchFts(e,3);if(l.length===0)return[];const i=l[0].gid,a=await t.graphHops(i,void 0,s,n),d=a.nodes.map(_=>{const c=a.distances[_.gid]||0,f=l.find(o=>o.gid===_.gid);return{gid:_.gid,pageNo:_.pageNo,title:_.title,snippet:(f==null?void 0:f.snippet)||null,scores:{fts:(f==null?void 0:f.score)||0,vector:0,entity:0,graph:1/(c+1),final:((f==null?void 0:f.score)||0)*.3+1/(c+1)*.7}}});return d.sort((_,c)=>c.scores.final-_.scores.final),d}function nt({mode:t,onModeChange:e,showToggle:n=!0}){return n?r("div",{className:"search-mode-toggle",children:[r("button",{className:`mode-btn ${t==="fts"?"active":""}`,onClick:()=>e("fts"),children:"ðŸ“ FTS Only"}),r("button",{className:`mode-btn ${t==="hybrid"?"active":""}`,onClick:()=>e("hybrid"),children:"âš¡ Hybrid"}),r("button",{className:`mode-btn ${t==="graph"?"active":""}`,onClick:()=>e("graph"),children:"ðŸ•¸ï¸ Graph"})]}):null}function rt({onSearch:t,loading:e,placeholder:n}){return r("form",{onSubmit:s=>{s.preventDefault();const i=new FormData(s.currentTarget).get("query");i!=null&&i.trim()&&t(i.trim())},children:r("div",{className:"search-bar",children:[r("input",{type:"text",name:"query",placeholder:n||"Search the capsule...",className:"search-input",disabled:e}),r("button",{type:"submit",className:"btn-search",disabled:e,children:e?"Searching...":"Search"})]})})}function st({results:t,query:e}){return r("div",{className:"search-results",children:[r("p",{className:"results-header",children:["Found ",t.length," results for ",r("strong",{children:['"',e,'"']})]}),t.map(n=>r("div",{className:"result-item",children:[r("div",{className:"result-header",children:[r("span",{className:"result-page",children:["Page ",n.pageNo]}),r("span",{className:"result-score",children:["Score: ",n.scores.final.toFixed(3)]})]}),r("h4",{className:"result-title",children:n.title}),n.snippet&&r("p",{className:"result-snippet",dangerouslySetInnerHTML:{__html:n.snippet}}),r("div",{className:"result-scores",children:[r("span",{children:["FTS: ",n.scores.fts.toFixed(2)]}),r("span",{children:["Entity: ",n.scores.entity.toFixed(2)]}),r("span",{children:["Graph: ",n.scores.graph.toFixed(2)]})]})]},n.gid))]})}function lt({mode:t,results:e,lastQuery:n,loading:s,onSearch:l,onModeChange:i,showModeToggle:a=!0,placeholder:d,searchHint:_}){return r("div",{className:"search-section",children:[r("div",{className:"search-header",children:r("h3",{children:"ðŸ” Search"})}),r(nt,{mode:t,onModeChange:i,showToggle:a}),_&&r("p",{className:"search-hint",children:_}),r(rt,{onSearch:l,loading:s,placeholder:d}),e&&e.length>0&&r(st,{results:e,query:n}),e&&e.length===0&&r("div",{className:"no-results",children:[r("p",{children:["No results found for ",r("strong",{children:['"',n,'"']})]}),r("p",{className:"search-hint",children:"Try different keywords or search terms."})]})]})}function it(t={}){const{autoLoad:e=!0,maxEntities:n=50}=t,[s,l]=k([]),[i,a]=k(null),[d,_]=k(!1),[c,f]=k(null),o=async()=>{_(!0),f(null);try{const u=await W().listEntities(void 0,n);l(u),console.log("[Entities] Loaded:",u.length)}catch(m){const u=String(m);f(u),console.error("[Entities] Failed to load:",m)}finally{_(!1)}};Q(()=>{e&&o()},[e]);const h=m=>{a(m)},p=()=>Array.from(new Set(s.map(m=>m.entityType))),v=()=>i?s.filter(m=>m.entityType===i):s,w=m=>s.filter(u=>u.entityType===m).reduce((u,g)=>u+g.count,0),y=()=>s.reduce((m,u)=>m+u.count,0);return{entities:s,selectedType:i,loading:d,error:c,types:p(),filteredEntities:v(),totalCount:y(),loadEntities:o,selectType:h,getTypeCount:w}}function ot({types:t,selectedType:e,totalCount:n,onSelectType:s,getTypeCount:l}){return r("div",{className:"entity-filters",children:[r("button",{className:`entity-filter ${e===null?"active":""}`,onClick:()=>s(null),children:["All (",n,")"]}),t.map(i=>{const a=l(i);return r("button",{className:`entity-filter ${e===i?"active":""}`,onClick:()=>s(i),children:[i," (",a,")"]},i)})]})}function at({entities:t,maxDisplay:e=20}){const n=t.slice(0,e);return r("div",{className:"entity-list",children:[n.map(s=>r("div",{className:"entity-item",children:[r("span",{className:"entity-type",children:s.entityType}),r("span",{className:"entity-value",children:s.normalizedValue}),r("span",{className:"entity-count",children:s.count})]},`${s.entityType}-${s.normalizedValue}`)),t.length>e&&r("div",{className:"entity-item entity-more",children:r("span",{className:"entity-value",children:["... and ",t.length-e," more"]})})]})}function ct({entities:t,types:e,selectedType:n,totalCount:s,onSelectType:l,getTypeCount:i,show:a=!0,maxDisplay:d=20}){if(!a||t.length===0)return null;const _=n?t.filter(c=>c.entityType===n):t;return r("div",{className:"entity-panel",children:[r("h4",{children:"Filter by Entity Type"}),r(ot,{types:e,selectedType:n,totalCount:s,onSelectType:l,getTypeCount:i}),r(at,{entities:_,maxDisplay:d})]})}function dt({show:t,entityCount:e,onToggle:n}){return r("button",{className:"btn-secondary btn-entities",onClick:n,children:[t?"Hide":"Show"," Entities (",e,")"]})}class ut{constructor(){$(this,"worker",null);$(this,"nextId",1);$(this,"pending",new Map);$(this,"progressCallback",null);this.initWorker()}initWorker(){this.worker=new Worker(new URL("/assets/llm.worker-DcSBfjIK.js",import.meta.url),{type:"module"}),this.worker.onmessage=e=>{const n=e.data;if("type"in n&&n.type==="READY"){console.log("[LlmClient] Worker ready");return}if("type"in n&&n.type==="PROGRESS"){this.progressCallback&&this.progressCallback(n.data);return}const{id:s,response:l}=n,i=this.pending.get(s);i&&(this.pending.delete(s),i.resolve(l))},this.worker.onerror=e=>{console.error("[LlmClient] Worker error:",e);for(const n of this.pending.values())n.reject(new Error("Worker error"));this.pending.clear()}}async sendRequest(e){if(!this.worker)throw new Error("Worker not initialized");const n=this.nextId++;return new Promise((s,l)=>{this.pending.set(n,{resolve:a=>{a.ok?s(a.data):l(new Error(a.error))},reject:l});const i={id:n,request:e};this.worker.postMessage(i)})}onProgress(e){this.progressCallback=e}async loadModel(e){return this.sendRequest({type:"LOAD_MODEL",modelUrl:e})}async reason(e){return this.sendRequest({type:"REASON",request:e})}async unloadModel(){return this.sendRequest({type:"UNLOAD_MODEL"})}async getStatus(){return this.sendRequest({type:"GET_STATUS"})}terminate(){this.worker&&(this.worker.terminate(),this.worker=null),this.pending.clear(),this.progressCallback=null}}let J=null;function be(){return J||(J=new ut),J}const _t={"0.6b":"https://huggingface.co/unsloth/Qwen3-0.6B-GGUF/resolve/main/Qwen3-0.6B-Q4_K_M.gguf","1.5b":"https://huggingface.co/ggml-org/Qwen2.5-1.5B-Instruct-GGUF/resolve/main/qwen2.5-1.5b-instruct-q4_k_m.gguf"};function ht(t={}){const[e,n]=k(!1),[s,l]=k(null),[i,a]=k(!1),[d,_]=k(null),[c,f]=k(null),[o,h]=k(null),p=async()=>{a(!0),h(null),_(null);try{const m=be();m.onProgress(g=>{_(g)});const u=await m.loadModel(_t["0.6b"]);l(u),_(null),console.log("[LLM] Model loaded:",u)}catch(m){const u=String(m);h(u),console.error("[LLM] Failed to load model:",m)}finally{a(!1)}};return{enabled:e,modelInfo:s,loading:i,progress:d,reasoning:c,error:o,toggle:async()=>{e?(n(!1),f(null)):(s!=null&&s.loaded||await p(),n(!0))},loadModel:p,reason:async(m,u,g=256)=>{if(!(s!=null&&s.loaded)){console.warn("[LLM] Cannot reason: model not loaded");return}a(!0),h(null);try{const N=be(),S=u.slice(0,5).map(M=>({gid:M.gid,pageNo:M.pageNo,title:M.title,text:M.snippet||"",score:M.scores.final})),C=await N.reason({question:m,snippets:S,maxTokens:g,temperature:.7});f(C),console.log("[LLM] Reasoning complete:",C)}catch(N){const S=String(N);h(S),console.error("[LLM] Reasoning failed:",N)}finally{a(!1)}},clearReasoning:()=>{f(null)}}}function pt({enabled:t,loading:e,modelLoaded:n,progress:s,error:l,onToggle:i}){return r("div",{className:"llm-toggle",children:[r("label",{className:"toggle-label",children:[r("input",{type:"checkbox",checked:t,onChange:i,disabled:e}),r("span",{className:"toggle-text",children:"ðŸ¤– Enable LLM Reasoning (Qwen 3 0.6B)"})]}),n&&r("span",{className:"model-status",children:"âœ… Model loaded"}),s&&r("div",{className:"llm-progress",children:[s.message," (",(s.progress*100).toFixed(0),"%)"]}),l&&r("div",{className:"llm-error",children:["âš ï¸ ",l]})]})}function ft({reasoning:t,searchResults:e,loading:n}){return n&&!t?r("div",{className:"reasoning-loading",children:[r("div",{className:"spinner"}),r("p",{children:"LLM is reasoning..."})]}):t?r("div",{className:"reasoning-output",children:[r("div",{className:"reasoning-header",children:[r("h4",{children:"ðŸ¤– LLM Reasoning"}),r("span",{className:"reasoning-meta",children:[t.inferenceTimeMs.toFixed(0),"ms Â· ",t.tokensGenerated," tokens"]})]}),r("div",{className:"reasoning-answer",children:t.answer}),t.usedSnippets.length>0&&r("div",{className:"reasoning-citations",children:[r("strong",{children:"ðŸ“‘ Cited sources:"}),t.usedSnippets.map(s=>{const l=e==null?void 0:e.find(i=>i.gid===s);return r("span",{className:"citation",children:["Page ",(l==null?void 0:l.pageNo)||"?"]},s)})]})]}):null}async function mt(t){const n=(await t.query("SELECT name FROM sqlite_master WHERE type='table'")).map(h=>h.name),s=n.includes("_ui_pages"),l=n.includes("_ui_dashboards"),i=n.includes("_ui_navigation"),a=n.includes("_ui_params"),d=n.includes("_meta_manifest"),_=n.includes("sqlar"),c=n.some(h=>h.startsWith("fts_"));let f="1.0";if(d)try{const h=await t.query("SELECT value FROM _meta_manifest WHERE key='gcui'");h.length>0&&(f=h[0].value)}catch(h){console.warn("Failed to read GCUI version:",h)}let o;return s&&l?o="hybrid":s?o="website":l?o="dashboard":o="generic",{version:f,hasWebsite:s,hasDashboards:l,hasNavigation:i,hasParams:a,hasFTS:c,hasAssets:_,mode:o}}async function gt(t){try{const e=await t.query("SELECT key, value FROM _meta_manifest");if(e.length===0)return null;const n={gcui:"1.0",capsule_kind:"sqlar"};return e.forEach(s=>{n[s.key]=s.value}),n}catch(e){return console.warn("Failed to load manifest:",e),null}}async function yt(t){try{const e=await t.query("SELECT key, value FROM _ui_config"),n={};return e.forEach(s=>{n[s.key]=s.value}),n}catch(e){return console.warn("Failed to load config:",e),{}}}async function vt(t){try{return(await t.query("SELECT slug, title, content, layout, category, order_index FROM _ui_pages ORDER BY order_index ASC, slug ASC")).map(n=>({slug:n.slug,title:n.title,content:n.content||void 0,layout:n.layout||void 0,category:n.category||void 0,order_index:n.order_index||void 0}))}catch(e){return console.warn("Failed to load pages:",e),[]}}async function bt(t){try{return(await t.query("SELECT menu, label, to_slug, order_index, icon_asset FROM _ui_navigation ORDER BY menu, order_index ASC")).map(n=>({menu:n.menu,label:n.label,to_slug:n.to_slug,order_index:n.order_index||void 0,icon_asset:n.icon_asset||void 0}))}catch(e){return console.warn("Failed to load navigation:",e),[]}}async function Nt(t){try{return(await t.query("SELECT name, query, grammar, config FROM _ui_dashboards")).map(n=>({name:n.name,query:n.query,grammar:n.grammar||void 0,config:n.config||void 0}))}catch(e){return console.warn("Failed to load dashboards:",e),[]}}async function wt(t){const e=await mt(t),n=await gt(t)||{gcui:e.version,capsule_kind:"sqlar"},s=await yt(t),l=e.hasWebsite?await vt(t):[],i=e.hasNavigation?await bt(t):[],a=e.hasDashboards?await Nt(t):[];return{manifest:n,capabilities:e,config:s,pages:l,navigation:i,dashboards:a}}function kt({config:t,children:e}){return r("div",{className:"layout-landing",children:[r("section",{className:"hero",children:[r("div",{className:"hero-content",children:[t.logo_asset&&r("img",{src:t.logo_asset,alt:"Logo",className:"hero-logo"}),r("h1",{className:"hero-title",children:t.hero_title||t.site_title||"Welcome"}),t.hero_subtitle&&r("p",{className:"hero-subtitle",children:t.hero_subtitle})]}),t.hero_image&&r("div",{className:"hero-background",style:{backgroundImage:`url(${t.hero_image})`}})]}),r("main",{className:"landing-main",children:e})]})}function xt({config:t,navigation:e,currentPage:n,children:s}){const l=e.filter(i=>i.menu==="sidebar");return r("div",{className:"layout-docs",children:[r("aside",{className:"docs-sidebar",children:r("nav",{className:"docs-nav",children:[r("div",{className:"docs-nav-header",children:[t.logo_asset&&r("img",{src:t.logo_asset,alt:"Logo",className:"docs-logo"}),r("h3",{children:t.site_title||"Documentation"})]}),r("ul",{className:"docs-nav-list",children:l.map(i=>r("li",{className:"docs-nav-item",children:r("a",{href:`#${i.to_slug}`,className:(n==null?void 0:n.slug)===i.to_slug?"active":"",children:[i.icon_asset&&r("img",{src:i.icon_asset,alt:"",className:"nav-icon"}),i.label]})},i.to_slug))})]})}),r("main",{className:"docs-main",children:[n&&r("div",{className:"docs-breadcrumbs",children:[r("a",{href:"#/",children:"Home"}),n.category&&r(H,{children:[r("span",{children:" / "}),r("span",{children:n.category})]}),r("span",{children:" / "}),r("span",{children:n.title})]}),r("article",{className:"docs-content",children:[n&&r("h1",{children:n.title}),s]})]})]})}function Oe({config:t,children:e}){return r("div",{className:"layout-dashboard",children:[r("header",{className:"dashboard-header",children:r("h1",{children:t.site_title||"Dashboard"})}),r("main",{className:"dashboard-content",children:e})]})}function He({config:t,title:e,children:n}){return r("div",{className:"layout-simple",children:[r("header",{className:"simple-header",children:[t.logo_asset&&r("img",{src:t.logo_asset,alt:"Logo",className:"simple-logo"}),e&&r("h1",{children:e})]}),r("main",{className:"simple-content",children:n}),r("footer",{className:"simple-footer",children:r("p",{children:"Powered by GlyphCapsule"})})]})}function Et({data:t,config:e,width:n=600,height:s=400}){if(!t||t.length===0)return r("div",{className:"chart-empty",style:{width:n,height:s},children:r("p",{children:"No data to display"})});switch(e.mark){case"bar":return r(St,{data:t,config:e,width:n,height:s});case"line":return r(Ct,{data:t,config:e,width:n,height:s});case"point":return r(Mt,{data:t,config:e,width:n,height:s});case"area":return r(Lt,{data:t,config:e,width:n,height:s});default:return r("div",{className:"chart-unsupported",style:{width:n,height:s},children:[r("p",{children:["Unsupported chart type: ",e.mark]}),r("p",{children:"Showing data as table:"}),r(Tt,{data:t})]})}}function St({data:t,config:e,width:n,height:s}){var c,f;const{encoding:l}=e,i=((c=l.x)==null?void 0:c.field)||Object.keys(t[0])[0],a=((f=l.y)==null?void 0:f.field)||Object.keys(t[0])[1],d=Math.max(...t.map(o=>Number(o[a])||0)),_=Math.max(20,(n-100)/t.length-10);return r("div",{className:"chart chart-bar",style:{width:n,height:s},children:[e.title&&r("h4",{className:"chart-title",children:e.title}),r("div",{className:"chart-container",style:{height:s-60},children:r("div",{className:"chart-bars",style:{display:"flex",alignItems:"flex-end",height:"100%",gap:"8px"},children:t.map((o,h)=>{const p=Number(o[a])||0,v=p/d*(s-100);return r("div",{className:"chart-bar-item",style:{textAlign:"center"},children:[r("div",{className:"bar",style:{width:_,height:v,backgroundColor:"#6366f1",borderRadius:"4px 4px 0 0"},title:`${o[i]}: ${p}`}),r("div",{className:"bar-label",style:{fontSize:"12px",marginTop:"4px",maxWidth:_,overflow:"hidden",textOverflow:"ellipsis"},children:String(o[i]).slice(0,10)})]},h)})})}),r("div",{className:"chart-legend",style:{fontSize:"12px",marginTop:"8px",textAlign:"center"},children:[r("strong",{children:a})," by ",r("strong",{children:i})]})]})}function Ct({data:t,config:e,width:n,height:s}){var y,m;const{encoding:l}=e,i=((y=l.x)==null?void 0:y.field)||Object.keys(t[0])[0],a=((m=l.y)==null?void 0:m.field)||Object.keys(t[0])[1],d=t.map(u=>Number(u[a])||0),_=Math.max(...d),c=Math.min(...d),f=_-c||1,o=n-80,h=s-100,p=o/(t.length-1||1),v=t.map((u,g)=>{const N=40+g*p,S=Number(u[a])||0,C=h-(S-c)/f*h+20;return{x:N,y:C,value:S,label:u[i]}}),w=v.map((u,g)=>`${g===0?"M":"L"} ${u.x} ${u.y}`).join(" ");return r("div",{className:"chart chart-line",style:{width:n,height:s},children:[e.title&&r("h4",{className:"chart-title",children:e.title}),r("svg",{width:n,height:s-40,style:{overflow:"visible"},children:[[0,.25,.5,.75,1].map(u=>{const g=h-u*h+20,N=c+u*f;return r("g",{children:[r("line",{x1:40,y1:g,x2:n-40,y2:g,stroke:"#e5e7eb",strokeWidth:1}),r("text",{x:10,y:g+4,fontSize:10,fill:"#666",children:N.toFixed(0)})]},u)}),r("path",{d:w,fill:"none",stroke:"#6366f1",strokeWidth:2}),v.map((u,g)=>r("circle",{cx:u.x,cy:u.y,r:4,fill:"#6366f1",children:r("title",{children:`${u.label}: ${u.value}`})},g)),v.map((u,g)=>r("text",{x:u.x,y:h+40,fontSize:10,fill:"#666",textAnchor:"middle",children:String(u.label).slice(0,8)},g))]}),r("div",{className:"chart-legend",style:{fontSize:"12px",textAlign:"center"},children:[r("strong",{children:a})," over ",r("strong",{children:i})]})]})}function Mt({data:t,config:e,width:n,height:s}){var m,u;const{encoding:l}=e,i=((m=l.x)==null?void 0:m.field)||Object.keys(t[0])[0],a=((u=l.y)==null?void 0:u.field)||Object.keys(t[0])[1],d=t.map(g=>Number(g[i])||0),_=t.map(g=>Number(g[a])||0),c=Math.min(...d),f=Math.max(...d),o=Math.min(..._),h=Math.max(..._),p=f-c||1,v=h-o||1,w=n-80,y=s-100;return r("div",{className:"chart chart-scatter",style:{width:n,height:s},children:[e.title&&r("h4",{className:"chart-title",children:e.title}),r("svg",{width:n,height:s-40,children:[[0,.25,.5,.75,1].map(g=>{const N=y-g*y+20;return r("line",{x1:40,y1:N,x2:n-40,y2:N,stroke:"#e5e7eb",strokeWidth:1},g)}),t.map((g,N)=>{const S=Number(g[i])||0,C=Number(g[a])||0,M=40+(S-c)/p*w,F=y-(C-o)/v*y+20;return r("circle",{cx:M,cy:F,r:5,fill:"#6366f1",opacity:.7,children:r("title",{children:`${i}: ${S}, ${a}: ${C}`})},N)})]}),r("div",{className:"chart-legend",style:{fontSize:"12px",textAlign:"center"},children:[r("strong",{children:a})," vs ",r("strong",{children:i})]})]})}function Lt({data:t,config:e,width:n,height:s}){var m,u;const{encoding:l}=e,i=((m=l.x)==null?void 0:m.field)||Object.keys(t[0])[0],a=((u=l.y)==null?void 0:u.field)||Object.keys(t[0])[1],d=t.map(g=>Number(g[a])||0),_=Math.max(...d),c=Math.min(...d),f=_-c||1,o=n-80,h=s-100,p=o/(t.length-1||1),w=t.map((g,N)=>{const S=40+N*p,C=Number(g[a])||0,M=h-(C-c)/f*h+20;return{x:S,y:M}}).map((g,N)=>`${N===0?"M":"L"} ${g.x} ${g.y}`).join(" "),y=`${w} L ${n-40} ${h+20} L 40 ${h+20} Z`;return r("div",{className:"chart chart-area",style:{width:n,height:s},children:[e.title&&r("h4",{className:"chart-title",children:e.title}),r("svg",{width:n,height:s-40,children:[r("path",{d:y,fill:"#6366f1",opacity:.3}),r("path",{d:w,fill:"none",stroke:"#6366f1",strokeWidth:2})]}),r("div",{className:"chart-legend",style:{fontSize:"12px",textAlign:"center"},children:[r("strong",{children:a})," over ",r("strong",{children:i})]})]})}function Tt({data:t}){if(t.length===0)return null;const e=Object.keys(t[0]);return r("table",{className:"data-table",style:{width:"100%",borderCollapse:"collapse",fontSize:"12px"},children:[r("thead",{children:r("tr",{children:e.map(n=>r("th",{style:{borderBottom:"2px solid #ddd",padding:"8px",textAlign:"left"},children:n},n))})}),r("tbody",{children:t.slice(0,10).map((n,s)=>r("tr",{children:e.map(l=>r("td",{style:{borderBottom:"1px solid #eee",padding:"6px"},children:String(n[l])},l))},s))})]})}function Pe({dashboards:t}){return t.length===0?r("div",{className:"dashboard-empty",children:r("p",{children:"No dashboards defined"})}):r("div",{className:"dashboard-grid",children:t.map(e=>r($t,{dashboard:e},e.name))})}function $t({dashboard:t}){const[e,n]=k(null),[s,l]=k(!1),[i,a]=k(null);Q(()=>{d()},[t.query]);const d=async()=>{l(!0),a(null);try{const f=await W().query(t.query);n(f)}catch(c){a(String(c)),console.error(`[Dashboard] Failed to load ${t.name}:`,c)}finally{l(!1)}};if(s)return r("div",{className:"dashboard-panel loading",children:[r("div",{className:"spinner"}),r("p",{children:["Loading ",t.name,"..."]})]});if(i)return r("div",{className:"dashboard-panel error",children:[r("h4",{children:t.name}),r("p",{className:"error-message",children:["Error: ",i]}),r("details",{children:[r("summary",{children:"Query"}),r("pre",{children:t.query})]})]});if(!e||e.length===0)return r("div",{className:"dashboard-panel empty",children:[r("h4",{children:t.name}),r("p",{children:"No data"})]});let _=null;if(t.config)try{_=JSON.parse(t.config)}catch(c){console.error(`[Dashboard] Invalid config for ${t.name}:`,c)}return!_||t.grammar!=="vegalite-lite-v1"?r("div",{className:"dashboard-panel table",children:[r("h4",{children:t.name}),r(Rt,{data:e})]}):r("div",{className:"dashboard-panel chart",children:r(Et,{data:e,config:_,width:600,height:400})})}function Rt({data:t}){const e=Object.keys(t[0]||{});return r("div",{style:{overflowX:"auto"},children:r("table",{className:"dashboard-table",style:{width:"100%",borderCollapse:"collapse",fontSize:"14px"},children:[r("thead",{children:r("tr",{children:e.map(n=>r("th",{style:{borderBottom:"2px solid #ddd",padding:"12px",textAlign:"left",fontWeight:600},children:n},n))})}),r("tbody",{children:t.map((n,s)=>r("tr",{style:{borderBottom:"1px solid #eee"},children:e.map(l=>r("td",{style:{padding:"10px"},children:String(n[l])},l))},s))})]})})}function Ft({content:t}){const e=Dt(t);return r("div",{className:"markdown-content",dangerouslySetInnerHTML:{__html:e}})}function Dt(t){let e=t;return e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),e=e.replace(/^### (.*$)/gim,"<h3>$1</h3>"),e=e.replace(/^## (.*$)/gim,"<h2>$1</h2>"),e=e.replace(/^# (.*$)/gim,"<h1>$1</h1>"),e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/\*(.*?)\*/g,"<em>$1</em>"),e=e.replace(/`(.*?)`/g,"<code>$1</code>"),e=e.replace(/\[(.*?)\]\((.*?)\)/g,'<a href="$2">$1</a>'),e=e.replace(/```(.*?)\n([\s\S]*?)```/g,"<pre><code>$2</code></pre>"),e=e.replace(/^\- (.*$)/gim,"<li>$1</li>"),e=e.replace(/(<li>.*<\/li>)/s,"<ul>$1</ul>"),e=e.replace(/^\d+\. (.*$)/gim,"<li>$1</li>"),e=e.split(`

`).map(s=>s.startsWith("<h")||s.startsWith("<ul>")||s.startsWith("<ol>")||s.startsWith("<pre>")||s.startsWith("<li>")?s:`<p>${s}</p>`).join(`
`),e=e.replace(/\n/g,"<br>"),e}function Ot({context:t}){const[e,n]=k("/");Q(()=>{const l=()=>{const i=window.location.hash.slice(1);n(i||"/")};return window.addEventListener("hashchange",l),l(),()=>window.removeEventListener("hashchange",l)},[]);const s=t.pages.find(l=>l.slug===e)||t.pages[0];return s?r(Ht,{page:s,context:t}):t.dashboards.length>0?r(Oe,{config:t.config,children:r(Pe,{dashboards:t.dashboards})}):r(He,{config:t.config,title:"404 Not Found",children:[r("p",{children:["Page not found: ",e]}),r("p",{children:r("a",{href:"#/",children:"Go home"})})]})}function Ht({page:t,context:e}){const n=t.layout||"simple",s=t.content?r(Ft,{content:t.content}):r("p",{children:"No content"});switch(n){case"landing":return r(kt,{config:e.config,children:s});case"docs":return r(xt,{config:e.config,navigation:e.navigation,currentPage:t,children:s});case"dashboard":return r(Oe,{config:e.config,children:[s,e.dashboards.length>0&&r(Pe,{dashboards:e.dashboards})]});case"simple":default:return r(He,{config:e.config,title:t.title,children:s})}}const Pt={mode:"website",bundledCapsule:"/memglyph-demo.mgx.sqlite",branding:{title:"Memglyph",tagline:"Your knowledge, crystallized",logoUrl:"/logo.svg"},features:{llm:{enabled:!0,autoReason:!1,defaultModel:"qwen3-0.6b",maxTokens:256},search:{defaultMode:"hybrid",enabledModes:["fts","hybrid"],showModeToggle:!1},graph:{enabled:!0,maxHops:2,defaultMaxHops:1},upload:{enabled:!1,acceptedExtensions:[]},gcui:{enabled:!0,fallbackToGeneric:!1},pwa:{enabled:!0,offlineMode:!0}},ui:{showLanding:!0,theme:"documentation"}},qt={mode:"viewer",bundledCapsule:"/memglyph-demo.mgx.sqlite",branding:{title:"SQLAR Viewer",tagline:"Query your knowledge capsules",logoUrl:"/sqlar-logo.svg"},features:{llm:{enabled:!0,autoReason:!1,defaultModel:"qwen3-0.6b",maxTokens:256},search:{defaultMode:"hybrid",enabledModes:["fts","hybrid","graph"],showModeToggle:!0},graph:{enabled:!0,maxHops:3,defaultMaxHops:2},upload:{enabled:!0,acceptedExtensions:[".sqlite",".sqlar",".db",".mgx.sqlite"]},gcui:{enabled:!0,fallbackToGeneric:!0},pwa:{enabled:!0,offlineMode:!0}},ui:{showLanding:!1,theme:"tool"}};function Wt(){return"website"}function At(){return Wt()==="viewer"?qt:Pt}function Gt(){var y;const t=At(),[e,n]=k(null),[s,l]=k(null),[i,a]=k(!1),[d,_]=k(null),[c,f]=k(!1),o=Ze({defaultMode:t.features.search.defaultMode}),h=it({autoLoad:!1}),p=ht({});Q(()=>{e&&(h.loadEntities(),(async()=>{try{const u=W(),g=await wt(u);console.log("[GCUI] Detected capabilities:",g.capabilities),g.capabilities.mode!=="generic"?(l(g),console.log("[GCUI] Rendering in",g.capabilities.mode,"mode")):(console.log("[GCUI] No GCUI tables found, using legacy mode"),l(null))}catch(u){console.warn("[GCUI] Detection failed, using legacy mode:",u),l(null)}})())},[e]);const v=async()=>{a(!0),_(null);try{const u=await W().openDemo();n(u),console.log("Capsule info:",u)}catch(m){_(String(m)),console.error("Failed to open capsule:",m)}finally{a(!1)}},w=async m=>{e&&(p.clearReasoning(),await o.search(m))};return r("div",{className:"app",children:[r("header",{className:"app-header",children:[r("h1",{children:"Glyphcapsule Explorer"}),r("p",{children:"Hybrid Retrieval Demo for MemGlyph"})]}),r("main",{className:"app-main",children:e?s&&t.features.gcui.enabled?r("div",{className:"gcui-mode",children:r(Ot,{context:s})}):r("div",{className:"capsule-view",children:[r("div",{className:"capsule-info",children:[r("h2",{children:["ðŸ“¦ ",e.fileName]}),r("dl",{children:[r("dt",{children:"File Size:"}),r("dd",{children:[(e.fileSize/1024).toFixed(1)," KB"]}),r("dt",{children:"Doc ID:"}),r("dd",{children:r("code",{children:[e.docId.slice(0,24),"..."]})}),r("dt",{children:"Pages:"}),r("dd",{children:e.pageCount}),r("dt",{children:"Entities:"}),r("dd",{children:e.entityCount}),r("dt",{children:"Graph Edges:"}),r("dd",{children:e.edgeCount}),e.hasVectors&&r(H,{children:[r("dt",{children:"Vectors:"}),r("dd",{children:["âœ… ",e.vectorModel," (",e.vectorDim,"-dim)"]})]})]}),r(pt,{enabled:p.enabled,loading:p.loading,modelLoaded:((y=p.modelInfo)==null?void 0:y.loaded)||!1,progress:p.progress,error:p.error,onToggle:p.toggle})]}),r("div",{className:"search-section",children:[r("div",{className:"search-header",children:[r("h3",{children:"ðŸ” Search"}),r(dt,{show:c,entityCount:h.entities.length,onToggle:()=>f(!c)})]}),r(lt,{mode:o.mode,results:o.results,lastQuery:o.lastQuery,loading:o.loading||i,onSearch:w,onModeChange:o.changeMode,showModeToggle:t.features.search.showModeToggle,placeholder:"Search the capsule...",searchHint:'Try searching: "vector search", "LEANN", "SQLite", or "hybrid retrieval"'}),r(ct,{entities:h.entities,types:h.types,selectedType:h.selectedType,totalCount:h.totalCount,onSelectType:h.selectType,getTypeCount:h.getTypeCount,show:c,maxDisplay:20}),p.reasoning&&r(ft,{reasoning:p.reasoning,searchResults:o.results,loading:p.loading}),p.loading&&!p.reasoning&&r("div",{className:"reasoning-loading",children:[r("div",{className:"spinner"}),r("p",{children:"LLM is reasoning..."})]})]})]}):r("div",{className:"welcome",children:[r("h2",{children:"Welcome!"}),r("p",{children:"This is an offline-capable PWA for exploring MemGlyph Glyphcapsules with hybrid retrieval (FTS + Vector + Entity + Graph)."}),r("p",{children:[r("strong",{children:"Demo capsule:"})," memglyph-demo.mgx.sqlite",r("br",{}),"(8 pages, 25 entities, 11 edges, 384-dim vectors)"]}),d&&r("div",{className:"error",children:[r("strong",{children:"Error:"})," ",d]}),r("button",{className:"btn-primary",onClick:v,disabled:i,children:i?"Opening...":"Open Demo Capsule"})]})}),r("footer",{className:"app-footer",children:r("p",{children:"Built with Preact + SQLite WASM + OPFS"})})]})}ze(r(Gt,{}),document.getElementById("app"));
