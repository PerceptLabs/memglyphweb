var ur=Object.defineProperty;var hr=(t,e,r)=>e in t?ur(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var K=(t,e,r)=>hr(t,typeof e!="symbol"?e+"":e,r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function r(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=r(s);fetch(s.href,a)}})();var it,R,On,me,hn,Pn,Fn,Dn,Dt,Ct,Lt,De={},In=[],pr=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,at=Array.isArray;function he(t,e){for(var r in e)t[r]=e[r];return t}function It(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function fr(t,e,r){var i,s,a,c={};for(a in e)a=="key"?i=e[a]:a=="ref"?s=e[a]:c[a]=e[a];if(arguments.length>2&&(c.children=arguments.length>3?it.call(arguments,2):r),typeof t=="function"&&t.defaultProps!=null)for(a in t.defaultProps)c[a]===void 0&&(c[a]=t.defaultProps[a]);return Ke(t,c,i,s,null)}function Ke(t,e,r,i,s){var a={type:t,props:e,key:r,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:s??++On,__i:-1,__u:0};return s==null&&R.vnode!=null&&R.vnode(a),a}function te(t){return t.children}function Ze(t,e){this.props=t,this.context=e}function Ae(t,e){if(e==null)return t.__?Ae(t.__,t.__i+1):null;for(var r;e<t.__k.length;e++)if((r=t.__k[e])!=null&&r.__e!=null)return r.__e;return typeof t.type=="function"?Ae(t):null}function Hn(t){var e,r;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((r=t.__k[e])!=null&&r.__e!=null){t.__e=t.__c.base=r.__e;break}return Hn(t)}}function pn(t){(!t.__d&&(t.__d=!0)&&me.push(t)&&!tt.__r++||hn!=R.debounceRendering)&&((hn=R.debounceRendering)||Pn)(tt)}function tt(){for(var t,e,r,i,s,a,c,p=1;me.length;)me.length>p&&me.sort(Fn),t=me.shift(),p=me.length,t.__d&&(r=void 0,i=void 0,s=(i=(e=t).__v).__e,a=[],c=[],e.__P&&((r=he({},i)).__v=i.__v+1,R.vnode&&R.vnode(r),Ht(e.__P,r,i,e.__n,e.__P.namespaceURI,32&i.__u?[s]:null,a,s??Ae(i),!!(32&i.__u),c),r.__v=i.__v,r.__.__k[r.__i]=r,Gn(a,r,c),i.__e=i.__=null,r.__e!=s&&Hn(r)));tt.__r=0}function $n(t,e,r,i,s,a,c,p,u,d,m){var l,h,g,N,w,b,_,f=i&&i.__k||In,v=e.length;for(u=mr(r,e,f,u,v),l=0;l<v;l++)(g=r.__k[l])!=null&&(h=g.__i==-1?De:f[g.__i]||De,g.__i=l,b=Ht(t,g,h,s,a,c,p,u,d,m),N=g.__e,g.ref&&h.ref!=g.ref&&(h.ref&&$t(h.ref,null,g),m.push(g.ref,g.__c||N,g)),w==null&&N!=null&&(w=N),(_=!!(4&g.__u))||h.__k===g.__k?u=Un(g,u,t,_):typeof g.type=="function"&&b!==void 0?u=b:N&&(u=N.nextSibling),g.__u&=-7);return r.__e=w,u}function mr(t,e,r,i,s){var a,c,p,u,d,m=r.length,l=m,h=0;for(t.__k=new Array(s),a=0;a<s;a++)(c=e[a])!=null&&typeof c!="boolean"&&typeof c!="function"?(u=a+h,(c=t.__k[a]=typeof c=="string"||typeof c=="number"||typeof c=="bigint"||c.constructor==String?Ke(null,c,null,null,null):at(c)?Ke(te,{children:c},null,null,null):c.constructor==null&&c.__b>0?Ke(c.type,c.props,c.key,c.ref?c.ref:null,c.__v):c).__=t,c.__b=t.__b+1,p=null,(d=c.__i=gr(c,r,u,l))!=-1&&(l--,(p=r[d])&&(p.__u|=2)),p==null||p.__v==null?(d==-1&&(s>m?h--:s<m&&h++),typeof c.type!="function"&&(c.__u|=4)):d!=u&&(d==u-1?h--:d==u+1?h++:(d>u?h--:h++,c.__u|=4))):t.__k[a]=null;if(l)for(a=0;a<m;a++)(p=r[a])!=null&&!(2&p.__u)&&(p.__e==i&&(i=Ae(p)),qn(p,p));return i}function Un(t,e,r,i){var s,a;if(typeof t.type=="function"){for(s=t.__k,a=0;s&&a<s.length;a++)s[a]&&(s[a].__=t,e=Un(s[a],e,r,i));return e}t.__e!=e&&(i&&(e&&t.type&&!e.parentNode&&(e=Ae(t)),r.insertBefore(t.__e,e||null)),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function gr(t,e,r,i){var s,a,c,p=t.key,u=t.type,d=e[r],m=d!=null&&(2&d.__u)==0;if(d===null&&t.key==null||m&&p==d.key&&u==d.type)return r;if(i>(m?1:0)){for(s=r-1,a=r+1;s>=0||a<e.length;)if((d=e[c=s>=0?s--:a++])!=null&&!(2&d.__u)&&p==d.key&&u==d.type)return c}return-1}function fn(t,e,r){e[0]=="-"?t.setProperty(e,r??""):t[e]=r==null?"":typeof r!="number"||pr.test(e)?r:r+"px"}function je(t,e,r,i,s){var a,c;e:if(e=="style")if(typeof r=="string")t.style.cssText=r;else{if(typeof i=="string"&&(t.style.cssText=i=""),i)for(e in i)r&&e in r||fn(t.style,e,"");if(r)for(e in r)i&&r[e]==i[e]||fn(t.style,e,r[e])}else if(e[0]=="o"&&e[1]=="n")a=e!=(e=e.replace(Dn,"$1")),c=e.toLowerCase(),e=c in t||e=="onFocusOut"||e=="onFocusIn"?c.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+a]=r,r?i?r.u=i.u:(r.u=Dt,t.addEventListener(e,a?Lt:Ct,a)):t.removeEventListener(e,a?Lt:Ct,a);else{if(s=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=r??"";break e}catch{}typeof r=="function"||(r==null||r===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&r==1?"":r))}}function mn(t){return function(e){if(this.l){var r=this.l[e.type+t];if(e.t==null)e.t=Dt++;else if(e.t<r.u)return;return r(R.event?R.event(e):e)}}}function Ht(t,e,r,i,s,a,c,p,u,d){var m,l,h,g,N,w,b,_,f,v,S,T,L,M,O,J,re,x=e.type;if(e.constructor!=null)return null;128&r.__u&&(u=!!(32&r.__u),a=[p=e.__e=r.__e]),(m=R.__b)&&m(e);e:if(typeof x=="function")try{if(_=e.props,f="prototype"in x&&x.prototype.render,v=(m=x.contextType)&&i[m.__c],S=m?v?v.props.value:m.__:i,r.__c?b=(l=e.__c=r.__c).__=l.__E:(f?e.__c=l=new x(_,S):(e.__c=l=new Ze(_,S),l.constructor=x,l.render=yr),v&&v.sub(l),l.props=_,l.state||(l.state={}),l.context=S,l.__n=i,h=l.__d=!0,l.__h=[],l._sb=[]),f&&l.__s==null&&(l.__s=l.state),f&&x.getDerivedStateFromProps!=null&&(l.__s==l.state&&(l.__s=he({},l.__s)),he(l.__s,x.getDerivedStateFromProps(_,l.__s))),g=l.props,N=l.state,l.__v=e,h)f&&x.getDerivedStateFromProps==null&&l.componentWillMount!=null&&l.componentWillMount(),f&&l.componentDidMount!=null&&l.__h.push(l.componentDidMount);else{if(f&&x.getDerivedStateFromProps==null&&_!==g&&l.componentWillReceiveProps!=null&&l.componentWillReceiveProps(_,S),!l.__e&&l.shouldComponentUpdate!=null&&l.shouldComponentUpdate(_,l.__s,S)===!1||e.__v==r.__v){for(e.__v!=r.__v&&(l.props=_,l.state=l.__s,l.__d=!1),e.__e=r.__e,e.__k=r.__k,e.__k.some(function(Y){Y&&(Y.__=e)}),T=0;T<l._sb.length;T++)l.__h.push(l._sb[T]);l._sb=[],l.__h.length&&c.push(l);break e}l.componentWillUpdate!=null&&l.componentWillUpdate(_,l.__s,S),f&&l.componentDidUpdate!=null&&l.__h.push(function(){l.componentDidUpdate(g,N,w)})}if(l.context=S,l.props=_,l.__P=t,l.__e=!1,L=R.__r,M=0,f){for(l.state=l.__s,l.__d=!1,L&&L(e),m=l.render(l.props,l.state,l.context),O=0;O<l._sb.length;O++)l.__h.push(l._sb[O]);l._sb=[]}else do l.__d=!1,L&&L(e),m=l.render(l.props,l.state,l.context),l.state=l.__s;while(l.__d&&++M<25);l.state=l.__s,l.getChildContext!=null&&(i=he(he({},i),l.getChildContext())),f&&!h&&l.getSnapshotBeforeUpdate!=null&&(w=l.getSnapshotBeforeUpdate(g,N)),J=m,m!=null&&m.type===te&&m.key==null&&(J=Wn(m.props.children)),p=$n(t,at(J)?J:[J],e,r,i,s,a,c,p,u,d),l.base=e.__e,e.__u&=-161,l.__h.length&&c.push(l),b&&(l.__E=l.__=null)}catch(Y){if(e.__v=null,u||a!=null)if(Y.then){for(e.__u|=u?160:128;p&&p.nodeType==8&&p.nextSibling;)p=p.nextSibling;a[a.indexOf(p)]=null,e.__e=p}else{for(re=a.length;re--;)It(a[re]);xt(e)}else e.__e=r.__e,e.__k=r.__k,Y.then||xt(e);R.__e(Y,e,r)}else a==null&&e.__v==r.__v?(e.__k=r.__k,e.__e=r.__e):p=e.__e=_r(r.__e,e,r,i,s,a,c,u,d);return(m=R.diffed)&&m(e),128&e.__u?void 0:p}function xt(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(xt)}function Gn(t,e,r){for(var i=0;i<r.length;i++)$t(r[i],r[++i],r[++i]);R.__c&&R.__c(e,t),t.some(function(s){try{t=s.__h,s.__h=[],t.some(function(a){a.call(s)})}catch(a){R.__e(a,s.__v)}})}function Wn(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:at(t)?t.map(Wn):he({},t)}function _r(t,e,r,i,s,a,c,p,u){var d,m,l,h,g,N,w,b=r.props,_=e.props,f=e.type;if(f=="svg"?s="http://www.w3.org/2000/svg":f=="math"?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),a!=null){for(d=0;d<a.length;d++)if((g=a[d])&&"setAttribute"in g==!!f&&(f?g.localName==f:g.nodeType==3)){t=g,a[d]=null;break}}if(t==null){if(f==null)return document.createTextNode(_);t=document.createElementNS(s,f,_.is&&_),p&&(R.__m&&R.__m(e,a),p=!1),a=null}if(f==null)b===_||p&&t.data==_||(t.data=_);else{if(a=a&&it.call(t.childNodes),b=r.props||De,!p&&a!=null)for(b={},d=0;d<t.attributes.length;d++)b[(g=t.attributes[d]).name]=g.value;for(d in b)if(g=b[d],d!="children"){if(d=="dangerouslySetInnerHTML")l=g;else if(!(d in _)){if(d=="value"&&"defaultValue"in _||d=="checked"&&"defaultChecked"in _)continue;je(t,d,null,g,s)}}for(d in _)g=_[d],d=="children"?h=g:d=="dangerouslySetInnerHTML"?m=g:d=="value"?N=g:d=="checked"?w=g:p&&typeof g!="function"||b[d]===g||je(t,d,g,b[d],s);if(m)p||l&&(m.__html==l.__html||m.__html==t.innerHTML)||(t.innerHTML=m.__html),e.__k=[];else if(l&&(t.innerHTML=""),$n(e.type=="template"?t.content:t,at(h)?h:[h],e,r,i,f=="foreignObject"?"http://www.w3.org/1999/xhtml":s,a,c,a?a[0]:r.__k&&Ae(r,0),p,u),a!=null)for(d=a.length;d--;)It(a[d]);p||(d="value",f=="progress"&&N==null?t.removeAttribute("value"):N!=null&&(N!==t[d]||f=="progress"&&!N||f=="option"&&N!=b[d])&&je(t,d,N,b[d],s),d="checked",w!=null&&w!=t[d]&&je(t,d,w,b[d],s))}return t}function $t(t,e,r){try{if(typeof t=="function"){var i=typeof t.__u=="function";i&&t.__u(),i&&e==null||(t.__u=t(e))}else t.current=e}catch(s){R.__e(s,r)}}function qn(t,e,r){var i,s;if(R.unmount&&R.unmount(t),(i=t.ref)&&(i.current&&i.current!=t.__e||$t(i,null,e)),(i=t.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(a){R.__e(a,e)}i.base=i.__P=null}if(i=t.__k)for(s=0;s<i.length;s++)i[s]&&qn(i[s],e,r||typeof t.type!="function");r||It(t.__e),t.__c=t.__=t.__e=void 0}function yr(t,e,r){return this.constructor(t,r)}function vr(t,e,r){var i,s,a,c;e==document&&(e=document.documentElement),R.__&&R.__(t,e),s=(i=!1)?null:e.__k,a=[],c=[],Ht(e,t=e.__k=fr(te,null,[t]),s||De,De,e.namespaceURI,s?null:e.firstChild?it.call(e.childNodes):null,a,s?s.__e:e.firstChild,i,c),Gn(a,t,c)}it=In.slice,R={__e:function(t,e,r,i){for(var s,a,c;e=e.__;)if((s=e.__c)&&!s.__)try{if((a=s.constructor)&&a.getDerivedStateFromError!=null&&(s.setState(a.getDerivedStateFromError(t)),c=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(t,i||{}),c=s.__d),c)return s.__E=s}catch(p){t=p}throw t}},On=0,Ze.prototype.setState=function(t,e){var r;r=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=he({},this.state),typeof t=="function"&&(t=t(he({},r),this.props)),t&&he(r,t),t!=null&&this.__v&&(e&&this._sb.push(e),pn(this))},Ze.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),pn(this))},Ze.prototype.render=te,me=[],Pn=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Fn=function(t,e){return t.__v.__b-e.__v.__b},tt.__r=0,Dn=/(PointerCapture)$|Capture$/i,Dt=0,Ct=mn(!1),Lt=mn(!0);var br=0;function n(t,e,r,i,s,a){e||(e={});var c,p,u=e;if("ref"in u)for(p in u={},e)p=="ref"?c=e[p]:u[p]=e[p];var d={type:t,props:u,key:r,ref:c,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--br,__i:-1,__u:0,__source:s,__self:a};if(typeof t=="function"&&(c=t.defaultProps))for(p in c)u[p]===void 0&&(u[p]=c[p]);return R.vnode&&R.vnode(d),d}var Ie,I,_t,gn,nt=0,zn=[],$=R,_n=$.__b,yn=$.__r,vn=$.diffed,bn=$.__c,Nn=$.unmount,Tn=$.__;function Ut(t,e){$.__h&&$.__h(I,t,nt||e),nt=0;var r=I.__H||(I.__H={__:[],__h:[]});return t>=r.__.length&&r.__.push({}),r.__[t]}function k(t){return nt=1,Nr(Vn,t)}function Nr(t,e,r){var i=Ut(Ie++,2);if(i.t=t,!i.__c&&(i.__=[Vn(void 0,e),function(p){var u=i.__N?i.__N[0]:i.__[0],d=i.t(u,p);u!==d&&(i.__N=[d,i.__[1]],i.__c.setState({}))}],i.__c=I,!I.__f)){var s=function(p,u,d){if(!i.__c.__H)return!0;var m=i.__c.__H.__.filter(function(h){return!!h.__c});if(m.every(function(h){return!h.__N}))return!a||a.call(this,p,u,d);var l=i.__c.props!==p;return m.forEach(function(h){if(h.__N){var g=h.__[0];h.__=h.__N,h.__N=void 0,g!==h.__[0]&&(l=!0)}}),a&&a.call(this,p,u,d)||l};I.__f=!0;var a=I.shouldComponentUpdate,c=I.componentWillUpdate;I.componentWillUpdate=function(p,u,d){if(this.__e){var m=a;a=void 0,s(p,u,d),a=m}c&&c.call(this,p,u,d)},I.shouldComponentUpdate=s}return i.__N||i.__}function V(t,e){var r=Ut(Ie++,3);!$.__s&&Bn(r.__H,e)&&(r.__=t,r.u=e,I.__H.__h.push(r))}function rt(t){return nt=5,Tr(function(){return{current:t}},[])}function Tr(t,e){var r=Ut(Ie++,7);return Bn(r.__H,e)&&(r.__=t(),r.__H=e,r.__h=t),r.__}function Er(){for(var t;t=zn.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(Je),t.__H.__h.forEach(Rt),t.__H.__h=[]}catch(e){t.__H.__h=[],$.__e(e,t.__v)}}$.__b=function(t){I=null,_n&&_n(t)},$.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),Tn&&Tn(t,e)},$.__r=function(t){yn&&yn(t),Ie=0;var e=(I=t.__c).__H;e&&(_t===I?(e.__h=[],I.__h=[],e.__.forEach(function(r){r.__N&&(r.__=r.__N),r.u=r.__N=void 0})):(e.__h.forEach(Je),e.__h.forEach(Rt),e.__h=[],Ie=0)),_t=I},$.diffed=function(t){vn&&vn(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(zn.push(e)!==1&&gn===$.requestAnimationFrame||((gn=$.requestAnimationFrame)||Sr)(Er)),e.__H.__.forEach(function(r){r.u&&(r.__H=r.u),r.u=void 0})),_t=I=null},$.__c=function(t,e){e.some(function(r){try{r.__h.forEach(Je),r.__h=r.__h.filter(function(i){return!i.__||Rt(i)})}catch(i){e.some(function(s){s.__h&&(s.__h=[])}),e=[],$.__e(i,r.__v)}}),bn&&bn(t,e)},$.unmount=function(t){Nn&&Nn(t);var e,r=t.__c;r&&r.__H&&(r.__H.__.forEach(function(i){try{Je(i)}catch(s){e=s}}),r.__H=void 0,e&&$.__e(e,r.__v))};var En=typeof requestAnimationFrame=="function";function Sr(t){var e,r=function(){clearTimeout(i),En&&cancelAnimationFrame(e),setTimeout(t)},i=setTimeout(r,35);En&&(e=requestAnimationFrame(r))}function Je(t){var e=I,r=t.__c;typeof r=="function"&&(t.__c=void 0,r()),I=e}function Rt(t){var e=I;t.__c=t.__(),I=e}function Bn(t,e){return!t||t.length!==e.length||e.some(function(r,i){return r!==t[i]})}function Vn(t,e){return typeof e=="function"?e(t):e}const wr={maxQueueSize:50,defaultTimeout:1e4,maxTimeout:3e4};class Ar{constructor(e={}){K(this,"queue",[]);K(this,"processing",!1);K(this,"nextId",1);K(this,"config");K(this,"stats",{totalProcessed:0,totalTimeouts:0,totalErrors:0});this.config={...wr,...e}}async enqueue(e,r){if(this.queue.length>=this.config.maxQueueSize)throw new Error(`Query queue full (${this.config.maxQueueSize} items). Too many pending queries.`);const i=Math.min(r||this.config.defaultTimeout,this.config.maxTimeout);return new Promise((s,a)=>{const c={id:this.nextId++,execute:e,resolve:s,reject:a,timeout:i,enqueuedAt:Date.now()};this.queue.push(c),this.processing||this.processQueue()})}async processQueue(){if(!(this.processing||this.queue.length===0)){for(this.processing=!0;this.queue.length>0;){const e=this.queue.shift();try{await this.executeWithTimeout(e)}catch{}}this.processing=!1}}async executeWithTimeout(e){const r=new Promise((i,s)=>{setTimeout(()=>{s(new Error(`Query ${e.id} timed out after ${e.timeout}ms`))},e.timeout)});try{const i=await Promise.race([e.execute(),r]);this.stats.totalProcessed++,e.resolve(i)}catch(i){i instanceof Error&&i.message.includes("timed out")?(this.stats.totalTimeouts++,console.warn(`[QueryQueue] Query ${e.id} timed out`,{timeout:e.timeout,waitTime:Date.now()-e.enqueuedAt})):this.stats.totalErrors++,e.reject(i)}}getStats(){return{queueLength:this.queue.length,busy:this.processing,totalProcessed:this.stats.totalProcessed,totalTimeouts:this.stats.totalTimeouts,totalErrors:this.stats.totalErrors}}isBusy(){return this.processing||this.queue.length>0}clear(){const e=new Error("Query queue cleared");for(const r of this.queue)r.reject(e);this.queue=[]}get length(){return this.queue.length}}let yt=null;function Mt(t){return yt||(yt=new Ar(t)),yt}function kr(t,e){return Mt().enqueue(t,e)}class Cr{constructor(){K(this,"worker",null);K(this,"nextId",1);K(this,"pending",new Map);this.initWorker()}initWorker(){this.worker=new Worker(new URL("/assets/sqlite.worker-BP5VJzs3.js",import.meta.url),{type:"module"}),this.worker.onmessage=e=>{const r=e.data;if("type"in r&&r.type==="READY"){console.log("[DbClient] Worker ready");return}const{id:i,response:s}=r,a=this.pending.get(i);a&&(this.pending.delete(i),a.resolve(s))},this.worker.onerror=e=>{console.error("[DbClient] Worker error:",e);for(const r of this.pending.values())r.reject(new Error("Worker error"));this.pending.clear()}}async sendRequest(e,r=1e4){if(!this.worker)throw new Error("Worker not initialized");const i=this.nextId++;return kr(async()=>new Promise((s,a)=>{const c=setTimeout(()=>{this.pending.delete(i),a(new Error(`Request ${e.type} timed out after ${r}ms`))},r);this.pending.set(i,{resolve:u=>{clearTimeout(c),u.ok?s(u.data):a(new Error(u.error))},reject:u=>{clearTimeout(c),a(u)},timeout:c});const p={id:i,request:e};this.worker.postMessage(p)}),r)}async openFromFile(e){return this.sendRequest({type:"OPEN_FROM_FILE",file:e})}async openFromOpfs(e){return this.sendRequest({type:"OPEN_FROM_OPFS",path:e})}async openDemo(){return this.sendRequest({type:"OPEN_DEMO"})}async saveToOpfs(e){return this.sendRequest({type:"SAVE_TO_OPFS",path:e})}async removeFromOpfs(e){return this.sendRequest({type:"REMOVE_FROM_OPFS",path:e})}async listOpfsFiles(){return this.sendRequest({type:"LIST_OPFS_FILES"})}async close(){return this.sendRequest({type:"CLOSE"})}async searchFts(e,r=20,i,s){return this.sendRequest({type:"FTS_SEARCH",query:e,limit:r,entityType:i,entityValue:s})}async searchHybrid(e,r=20,i){return this.sendRequest({type:"HYBRID_SEARCH",query:e,limit:r,weights:i})}async listEntities(e,r=100){return this.sendRequest({type:"LIST_ENTITIES",entityType:e,limit:r})}async getPageList(e=100,r=0){return this.sendRequest({type:"GET_PAGE_LIST",limit:e,offset:r})}async getPageBlob(e){return this.sendRequest({type:"GET_PAGE_BLOB",name:e})}async verifyPage(e){return this.sendRequest({type:"VERIFY_PAGE",gid:e})}async getCheckpoints(){return this.sendRequest({type:"GET_CHECKPOINTS"})}async graphHops(e,r,i,s){return this.sendRequest({type:"GRAPH_HOPS",seedGid:e,predicate:r,maxHops:i,limit:s})}getQueueStats(){return Mt().getStats()}isQueueBusy(){return Mt().isBusy()}terminate(){this.worker&&(this.worker.terminate(),this.worker=null);for(const e of this.pending.values())clearTimeout(e.timeout),e.reject(new Error("Worker terminated"));this.pending.clear()}}let vt=null;function Z(){return vt||(vt=new Cr),vt}function Qn(t={}){const{defaultMode:e="hybrid",maxResults:r=10,maxGraphHops:i=2,debounceMs:s=300}=t,[a,c]=k(e),[p,u]=k(null),[d,m]=k(""),[l,h]=k(!1),[g,N]=k(null),[w,b]=k({}),[_,f]=k(""),[v,S]=k(()=>{try{const P=localStorage.getItem("memglyph-search-history");return P?JSON.parse(P):[]}catch{return[]}}),T=rt(null);V(()=>{if(_.trim())return T.current&&clearTimeout(T.current),T.current=window.setTimeout(()=>{O(_)},s),()=>{T.current&&clearTimeout(T.current)}},[_,a,w]);const L=P=>{if(!P.trim())return;const ie=P.trim();S(ee=>{const $e=ee.filter(ge=>ge!==ie),Ue=[ie,...$e].slice(0,10);try{localStorage.setItem("memglyph-search-history",JSON.stringify(Ue))}catch(ge){console.warn("[Search] Failed to save history:",ge)}return Ue})},M=()=>{S([]);try{localStorage.removeItem("memglyph-search-history")}catch(P){console.warn("[Search] Failed to clear history:",P)}},O=async P=>{if(P.trim()){h(!0),N(null),m(P),L(P);try{const ie=Z();let ee=[];switch(a){case"fts":ee=await Lr(ie,P,r,w);break;case"hybrid":ee=await ie.searchHybrid(P,r);break;case"graph":ee=await xr(ie,P,r,i,w);break;default:throw new Error(`Unknown search mode: ${a}`)}return u(ee),console.log(`[Search] ${a} mode: ${ee.length} results`),ee}catch(ie){const ee=String(ie);return N(ee),console.error("[Search] Failed:",ie),[]}finally{h(!1)}}};return{mode:a,results:p,lastQuery:d,loading:l,error:g,entityFilter:w,searchHistory:v,search:P=>{f(P)},searchImmediate:P=>(T.current&&clearTimeout(T.current),f(""),O(P)),clear:()=>{u(null),m(""),N(null),f(""),T.current&&clearTimeout(T.current)},changeMode:P=>{c(P),u(null)},setFilter:P=>{b(P),u(null)},clearFilter:()=>{b({}),u(null)},clearHistory:M}}async function Lr(t,e,r,i){return(await t.searchFts(e,r,i.entityType,i.entityValue)).map(a=>({gid:a.gid,pageNo:a.pageNo,title:a.title,snippet:a.snippet,scores:{fts:a.score,vector:0,entity:0,graph:0,final:a.score}}))}async function xr(t,e,r,i,s){const a=await t.searchFts(e,3,s.entityType,s.entityValue);if(a.length===0)return[];const c=a[0].gid,p=await t.graphHops(c,void 0,i,r),u=p.nodes.map(d=>{const m=p.distances[d.gid]||0,l=a.find(h=>h.gid===d.gid);return{gid:d.gid,pageNo:d.pageNo,title:d.title,snippet:(l==null?void 0:l.snippet)||null,scores:{fts:(l==null?void 0:l.score)||0,vector:0,entity:0,graph:1/(m+1),final:((l==null?void 0:l.score)||0)*.3+1/(m+1)*.7}}});return u.sort((d,m)=>m.scores.final-d.scores.final),u}/*! @license DOMPurify 3.3.0 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.0/LICENSE */const{entries:jn,setPrototypeOf:Sn,isFrozen:Rr,getPrototypeOf:Mr,getOwnPropertyDescriptor:Or}=Object;let{freeze:Q,seal:ne,create:Ot}=Object,{apply:Pt,construct:Ft}=typeof Reflect<"u"&&Reflect;Q||(Q=function(e){return e});ne||(ne=function(e){return e});Pt||(Pt=function(e,r){for(var i=arguments.length,s=new Array(i>2?i-2:0),a=2;a<i;a++)s[a-2]=arguments[a];return e.apply(r,s)});Ft||(Ft=function(e){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return new e(...i)});const Ye=j(Array.prototype.forEach),Pr=j(Array.prototype.lastIndexOf),wn=j(Array.prototype.pop),xe=j(Array.prototype.push),Fr=j(Array.prototype.splice),et=j(String.prototype.toLowerCase),bt=j(String.prototype.toString),Nt=j(String.prototype.match),Re=j(String.prototype.replace),Dr=j(String.prototype.indexOf),Ir=j(String.prototype.trim),ae=j(Object.prototype.hasOwnProperty),B=j(RegExp.prototype.test),Me=Hr(TypeError);function j(t){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return Pt(t,e,i)}}function Hr(t){return function(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];return Ft(t,r)}}function C(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:et;Sn&&Sn(t,null);let i=e.length;for(;i--;){let s=e[i];if(typeof s=="string"){const a=r(s);a!==s&&(Rr(e)||(e[i]=a),s=a)}t[s]=!0}return t}function $r(t){for(let e=0;e<t.length;e++)ae(t,e)||(t[e]=null);return t}function ue(t){const e=Ot(null);for(const[r,i]of jn(t))ae(t,r)&&(Array.isArray(i)?e[r]=$r(i):i&&typeof i=="object"&&i.constructor===Object?e[r]=ue(i):e[r]=i);return e}function Oe(t,e){for(;t!==null;){const i=Or(t,e);if(i){if(i.get)return j(i.get);if(typeof i.value=="function")return j(i.value)}t=Mr(t)}function r(){return null}return r}const An=Q(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Tt=Q(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Et=Q(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Ur=Q(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),St=Q(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Gr=Q(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),kn=Q(["#text"]),Cn=Q(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),wt=Q(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Ln=Q(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Xe=Q(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Wr=ne(/\{\{[\w\W]*|[\w\W]*\}\}/gm),qr=ne(/<%[\w\W]*|[\w\W]*%>/gm),zr=ne(/\$\{[\w\W]*/gm),Br=ne(/^data-[\-\w.\u00B7-\uFFFF]+$/),Vr=ne(/^aria-[\-\w]+$/),Yn=ne(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Qr=ne(/^(?:\w+script|data):/i),jr=ne(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Xn=ne(/^html$/i),Yr=ne(/^[a-z][.\w]*(-[.\w]+)+$/i);var xn=Object.freeze({__proto__:null,ARIA_ATTR:Vr,ATTR_WHITESPACE:jr,CUSTOM_ELEMENT:Yr,DATA_ATTR:Br,DOCTYPE_NAME:Xn,ERB_EXPR:qr,IS_ALLOWED_URI:Yn,IS_SCRIPT_OR_DATA:Qr,MUSTACHE_EXPR:Wr,TMPLIT_EXPR:zr});const Pe={element:1,text:3,progressingInstruction:7,comment:8,document:9},Xr=function(){return typeof window>"u"?null:window},Kr=function(e,r){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let i=null;const s="data-tt-policy-suffix";r&&r.hasAttribute(s)&&(i=r.getAttribute(s));const a="dompurify"+(i?"#"+i:"");try{return e.createPolicy(a,{createHTML(c){return c},createScriptURL(c){return c}})}catch{return console.warn("TrustedTypes policy "+a+" could not be created."),null}},Rn=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Kn(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Xr();const e=A=>Kn(A);if(e.version="3.3.0",e.removed=[],!t||!t.document||t.document.nodeType!==Pe.document||!t.Element)return e.isSupported=!1,e;let{document:r}=t;const i=r,s=i.currentScript,{DocumentFragment:a,HTMLTemplateElement:c,Node:p,Element:u,NodeFilter:d,NamedNodeMap:m=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:l,DOMParser:h,trustedTypes:g}=t,N=u.prototype,w=Oe(N,"cloneNode"),b=Oe(N,"remove"),_=Oe(N,"nextSibling"),f=Oe(N,"childNodes"),v=Oe(N,"parentNode");if(typeof c=="function"){const A=r.createElement("template");A.content&&A.content.ownerDocument&&(r=A.content.ownerDocument)}let S,T="";const{implementation:L,createNodeIterator:M,createDocumentFragment:O,getElementsByTagName:J}=r,{importNode:re}=i;let x=Rn();e.isSupported=typeof jn=="function"&&typeof v=="function"&&L&&L.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:Y,ERB_EXPR:se,TMPLIT_EXPR:He,DATA_ATTR:P,ARIA_ATTR:ie,IS_SCRIPT_OR_DATA:ee,ATTR_WHITESPACE:$e,CUSTOM_ELEMENT:Ue}=xn;let{IS_ALLOWED_URI:ge}=xn,U=null;const Wt=C({},[...An,...Tt,...Et,...St,...kn]);let W=null;const qt=C({},[...Cn,...wt,...Ln,...Xe]);let D=Object.seal(Ot(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),ke=null,st=null;const _e=Object.seal(Ot(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let zt=!0,ot=!0,Bt=!1,Vt=!0,ye=!1,Ge=!0,pe=!1,lt=!1,ct=!1,ve=!1,We=!1,qe=!1,Qt=!0,jt=!1;const rr="user-content-";let dt=!0,Ce=!1,be={},Ne=null;const Yt=C({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Xt=null;const Kt=C({},["audio","video","img","source","image","track"]);let ut=null;const Zt=C({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),ze="http://www.w3.org/1998/Math/MathML",Be="http://www.w3.org/2000/svg",le="http://www.w3.org/1999/xhtml";let Te=le,ht=!1,pt=null;const ir=C({},[ze,Be,le],bt);let Ve=C({},["mi","mo","mn","ms","mtext"]),Qe=C({},["annotation-xml"]);const ar=C({},["title","style","font","a","script"]);let Le=null;const sr=["application/xhtml+xml","text/html"],or="text/html";let G=null,Ee=null;const lr=r.createElement("form"),Jt=function(o){return o instanceof RegExp||o instanceof Function},ft=function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Ee&&Ee===o)){if((!o||typeof o!="object")&&(o={}),o=ue(o),Le=sr.indexOf(o.PARSER_MEDIA_TYPE)===-1?or:o.PARSER_MEDIA_TYPE,G=Le==="application/xhtml+xml"?bt:et,U=ae(o,"ALLOWED_TAGS")?C({},o.ALLOWED_TAGS,G):Wt,W=ae(o,"ALLOWED_ATTR")?C({},o.ALLOWED_ATTR,G):qt,pt=ae(o,"ALLOWED_NAMESPACES")?C({},o.ALLOWED_NAMESPACES,bt):ir,ut=ae(o,"ADD_URI_SAFE_ATTR")?C(ue(Zt),o.ADD_URI_SAFE_ATTR,G):Zt,Xt=ae(o,"ADD_DATA_URI_TAGS")?C(ue(Kt),o.ADD_DATA_URI_TAGS,G):Kt,Ne=ae(o,"FORBID_CONTENTS")?C({},o.FORBID_CONTENTS,G):Yt,ke=ae(o,"FORBID_TAGS")?C({},o.FORBID_TAGS,G):ue({}),st=ae(o,"FORBID_ATTR")?C({},o.FORBID_ATTR,G):ue({}),be=ae(o,"USE_PROFILES")?o.USE_PROFILES:!1,zt=o.ALLOW_ARIA_ATTR!==!1,ot=o.ALLOW_DATA_ATTR!==!1,Bt=o.ALLOW_UNKNOWN_PROTOCOLS||!1,Vt=o.ALLOW_SELF_CLOSE_IN_ATTR!==!1,ye=o.SAFE_FOR_TEMPLATES||!1,Ge=o.SAFE_FOR_XML!==!1,pe=o.WHOLE_DOCUMENT||!1,ve=o.RETURN_DOM||!1,We=o.RETURN_DOM_FRAGMENT||!1,qe=o.RETURN_TRUSTED_TYPE||!1,ct=o.FORCE_BODY||!1,Qt=o.SANITIZE_DOM!==!1,jt=o.SANITIZE_NAMED_PROPS||!1,dt=o.KEEP_CONTENT!==!1,Ce=o.IN_PLACE||!1,ge=o.ALLOWED_URI_REGEXP||Yn,Te=o.NAMESPACE||le,Ve=o.MATHML_TEXT_INTEGRATION_POINTS||Ve,Qe=o.HTML_INTEGRATION_POINTS||Qe,D=o.CUSTOM_ELEMENT_HANDLING||{},o.CUSTOM_ELEMENT_HANDLING&&Jt(o.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(D.tagNameCheck=o.CUSTOM_ELEMENT_HANDLING.tagNameCheck),o.CUSTOM_ELEMENT_HANDLING&&Jt(o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(D.attributeNameCheck=o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),o.CUSTOM_ELEMENT_HANDLING&&typeof o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(D.allowCustomizedBuiltInElements=o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),ye&&(ot=!1),We&&(ve=!0),be&&(U=C({},kn),W=[],be.html===!0&&(C(U,An),C(W,Cn)),be.svg===!0&&(C(U,Tt),C(W,wt),C(W,Xe)),be.svgFilters===!0&&(C(U,Et),C(W,wt),C(W,Xe)),be.mathMl===!0&&(C(U,St),C(W,Ln),C(W,Xe))),o.ADD_TAGS&&(typeof o.ADD_TAGS=="function"?_e.tagCheck=o.ADD_TAGS:(U===Wt&&(U=ue(U)),C(U,o.ADD_TAGS,G))),o.ADD_ATTR&&(typeof o.ADD_ATTR=="function"?_e.attributeCheck=o.ADD_ATTR:(W===qt&&(W=ue(W)),C(W,o.ADD_ATTR,G))),o.ADD_URI_SAFE_ATTR&&C(ut,o.ADD_URI_SAFE_ATTR,G),o.FORBID_CONTENTS&&(Ne===Yt&&(Ne=ue(Ne)),C(Ne,o.FORBID_CONTENTS,G)),dt&&(U["#text"]=!0),pe&&C(U,["html","head","body"]),U.table&&(C(U,["tbody"]),delete ke.tbody),o.TRUSTED_TYPES_POLICY){if(typeof o.TRUSTED_TYPES_POLICY.createHTML!="function")throw Me('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof o.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Me('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');S=o.TRUSTED_TYPES_POLICY,T=S.createHTML("")}else S===void 0&&(S=Kr(g,s)),S!==null&&typeof T=="string"&&(T=S.createHTML(""));Q&&Q(o),Ee=o}},en=C({},[...Tt,...Et,...Ur]),tn=C({},[...St,...Gr]),cr=function(o){let y=v(o);(!y||!y.tagName)&&(y={namespaceURI:Te,tagName:"template"});const E=et(o.tagName),F=et(y.tagName);return pt[o.namespaceURI]?o.namespaceURI===Be?y.namespaceURI===le?E==="svg":y.namespaceURI===ze?E==="svg"&&(F==="annotation-xml"||Ve[F]):!!en[E]:o.namespaceURI===ze?y.namespaceURI===le?E==="math":y.namespaceURI===Be?E==="math"&&Qe[F]:!!tn[E]:o.namespaceURI===le?y.namespaceURI===Be&&!Qe[F]||y.namespaceURI===ze&&!Ve[F]?!1:!tn[E]&&(ar[E]||!en[E]):!!(Le==="application/xhtml+xml"&&pt[o.namespaceURI]):!1},oe=function(o){xe(e.removed,{element:o});try{v(o).removeChild(o)}catch{b(o)}},fe=function(o,y){try{xe(e.removed,{attribute:y.getAttributeNode(o),from:y})}catch{xe(e.removed,{attribute:null,from:y})}if(y.removeAttribute(o),o==="is")if(ve||We)try{oe(y)}catch{}else try{y.setAttribute(o,"")}catch{}},nn=function(o){let y=null,E=null;if(ct)o="<remove></remove>"+o;else{const H=Nt(o,/^[\r\n\t ]+/);E=H&&H[0]}Le==="application/xhtml+xml"&&Te===le&&(o='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+o+"</body></html>");const F=S?S.createHTML(o):o;if(Te===le)try{y=new h().parseFromString(F,Le)}catch{}if(!y||!y.documentElement){y=L.createDocument(Te,"template",null);try{y.documentElement.innerHTML=ht?T:F}catch{}}const z=y.body||y.documentElement;return o&&E&&z.insertBefore(r.createTextNode(E),z.childNodes[0]||null),Te===le?J.call(y,pe?"html":"body")[0]:pe?y.documentElement:z},rn=function(o){return M.call(o.ownerDocument||o,o,d.SHOW_ELEMENT|d.SHOW_COMMENT|d.SHOW_TEXT|d.SHOW_PROCESSING_INSTRUCTION|d.SHOW_CDATA_SECTION,null)},mt=function(o){return o instanceof l&&(typeof o.nodeName!="string"||typeof o.textContent!="string"||typeof o.removeChild!="function"||!(o.attributes instanceof m)||typeof o.removeAttribute!="function"||typeof o.setAttribute!="function"||typeof o.namespaceURI!="string"||typeof o.insertBefore!="function"||typeof o.hasChildNodes!="function")},an=function(o){return typeof p=="function"&&o instanceof p};function ce(A,o,y){Ye(A,E=>{E.call(e,o,y,Ee)})}const sn=function(o){let y=null;if(ce(x.beforeSanitizeElements,o,null),mt(o))return oe(o),!0;const E=G(o.nodeName);if(ce(x.uponSanitizeElement,o,{tagName:E,allowedTags:U}),Ge&&o.hasChildNodes()&&!an(o.firstElementChild)&&B(/<[/\w!]/g,o.innerHTML)&&B(/<[/\w!]/g,o.textContent)||o.nodeType===Pe.progressingInstruction||Ge&&o.nodeType===Pe.comment&&B(/<[/\w]/g,o.data))return oe(o),!0;if(!(_e.tagCheck instanceof Function&&_e.tagCheck(E))&&(!U[E]||ke[E])){if(!ke[E]&&ln(E)&&(D.tagNameCheck instanceof RegExp&&B(D.tagNameCheck,E)||D.tagNameCheck instanceof Function&&D.tagNameCheck(E)))return!1;if(dt&&!Ne[E]){const F=v(o)||o.parentNode,z=f(o)||o.childNodes;if(z&&F){const H=z.length;for(let X=H-1;X>=0;--X){const de=w(z[X],!0);de.__removalCount=(o.__removalCount||0)+1,F.insertBefore(de,_(o))}}}return oe(o),!0}return o instanceof u&&!cr(o)||(E==="noscript"||E==="noembed"||E==="noframes")&&B(/<\/no(script|embed|frames)/i,o.innerHTML)?(oe(o),!0):(ye&&o.nodeType===Pe.text&&(y=o.textContent,Ye([Y,se,He],F=>{y=Re(y,F," ")}),o.textContent!==y&&(xe(e.removed,{element:o.cloneNode()}),o.textContent=y)),ce(x.afterSanitizeElements,o,null),!1)},on=function(o,y,E){if(Qt&&(y==="id"||y==="name")&&(E in r||E in lr))return!1;if(!(ot&&!st[y]&&B(P,y))){if(!(zt&&B(ie,y))){if(!(_e.attributeCheck instanceof Function&&_e.attributeCheck(y,o))){if(!W[y]||st[y]){if(!(ln(o)&&(D.tagNameCheck instanceof RegExp&&B(D.tagNameCheck,o)||D.tagNameCheck instanceof Function&&D.tagNameCheck(o))&&(D.attributeNameCheck instanceof RegExp&&B(D.attributeNameCheck,y)||D.attributeNameCheck instanceof Function&&D.attributeNameCheck(y,o))||y==="is"&&D.allowCustomizedBuiltInElements&&(D.tagNameCheck instanceof RegExp&&B(D.tagNameCheck,E)||D.tagNameCheck instanceof Function&&D.tagNameCheck(E))))return!1}else if(!ut[y]){if(!B(ge,Re(E,$e,""))){if(!((y==="src"||y==="xlink:href"||y==="href")&&o!=="script"&&Dr(E,"data:")===0&&Xt[o])){if(!(Bt&&!B(ee,Re(E,$e,"")))){if(E)return!1}}}}}}}return!0},ln=function(o){return o!=="annotation-xml"&&Nt(o,Ue)},cn=function(o){ce(x.beforeSanitizeAttributes,o,null);const{attributes:y}=o;if(!y||mt(o))return;const E={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:W,forceKeepAttr:void 0};let F=y.length;for(;F--;){const z=y[F],{name:H,namespaceURI:X,value:de}=z,Se=G(H),gt=de;let q=H==="value"?gt:Ir(gt);if(E.attrName=Se,E.attrValue=q,E.keepAttr=!0,E.forceKeepAttr=void 0,ce(x.uponSanitizeAttribute,o,E),q=E.attrValue,jt&&(Se==="id"||Se==="name")&&(fe(H,o),q=rr+q),Ge&&B(/((--!?|])>)|<\/(style|title|textarea)/i,q)){fe(H,o);continue}if(Se==="attributename"&&Nt(q,"href")){fe(H,o);continue}if(E.forceKeepAttr)continue;if(!E.keepAttr){fe(H,o);continue}if(!Vt&&B(/\/>/i,q)){fe(H,o);continue}ye&&Ye([Y,se,He],un=>{q=Re(q,un," ")});const dn=G(o.nodeName);if(!on(dn,Se,q)){fe(H,o);continue}if(S&&typeof g=="object"&&typeof g.getAttributeType=="function"&&!X)switch(g.getAttributeType(dn,Se)){case"TrustedHTML":{q=S.createHTML(q);break}case"TrustedScriptURL":{q=S.createScriptURL(q);break}}if(q!==gt)try{X?o.setAttributeNS(X,H,q):o.setAttribute(H,q),mt(o)?oe(o):wn(e.removed)}catch{fe(H,o)}}ce(x.afterSanitizeAttributes,o,null)},dr=function A(o){let y=null;const E=rn(o);for(ce(x.beforeSanitizeShadowDOM,o,null);y=E.nextNode();)ce(x.uponSanitizeShadowNode,y,null),sn(y),cn(y),y.content instanceof a&&A(y.content);ce(x.afterSanitizeShadowDOM,o,null)};return e.sanitize=function(A){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},y=null,E=null,F=null,z=null;if(ht=!A,ht&&(A="<!-->"),typeof A!="string"&&!an(A))if(typeof A.toString=="function"){if(A=A.toString(),typeof A!="string")throw Me("dirty is not a string, aborting")}else throw Me("toString is not a function");if(!e.isSupported)return A;if(lt||ft(o),e.removed=[],typeof A=="string"&&(Ce=!1),Ce){if(A.nodeName){const de=G(A.nodeName);if(!U[de]||ke[de])throw Me("root node is forbidden and cannot be sanitized in-place")}}else if(A instanceof p)y=nn("<!---->"),E=y.ownerDocument.importNode(A,!0),E.nodeType===Pe.element&&E.nodeName==="BODY"||E.nodeName==="HTML"?y=E:y.appendChild(E);else{if(!ve&&!ye&&!pe&&A.indexOf("<")===-1)return S&&qe?S.createHTML(A):A;if(y=nn(A),!y)return ve?null:qe?T:""}y&&ct&&oe(y.firstChild);const H=rn(Ce?A:y);for(;F=H.nextNode();)sn(F),cn(F),F.content instanceof a&&dr(F.content);if(Ce)return A;if(ve){if(We)for(z=O.call(y.ownerDocument);y.firstChild;)z.appendChild(y.firstChild);else z=y;return(W.shadowroot||W.shadowrootmode)&&(z=re.call(i,z,!0)),z}let X=pe?y.outerHTML:y.innerHTML;return pe&&U["!doctype"]&&y.ownerDocument&&y.ownerDocument.doctype&&y.ownerDocument.doctype.name&&B(Xn,y.ownerDocument.doctype.name)&&(X="<!DOCTYPE "+y.ownerDocument.doctype.name+`>
`+X),ye&&Ye([Y,se,He],de=>{X=Re(X,de," ")}),S&&qe?S.createHTML(X):X},e.setConfig=function(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ft(A),lt=!0},e.clearConfig=function(){Ee=null,lt=!1},e.isValidAttribute=function(A,o,y){Ee||ft({});const E=G(A),F=G(o);return on(E,F,y)},e.addHook=function(A,o){typeof o=="function"&&xe(x[A],o)},e.removeHook=function(A,o){if(o!==void 0){const y=Pr(x[A],o);return y===-1?void 0:Fr(x[A],y,1)[0]}return wn(x[A])},e.removeHooks=function(A){x[A]=[]},e.removeAllHooks=function(){x=Rn()},e}var Gt=Kn();function Zr({mode:t,onModeChange:e,showToggle:r=!0}){return r?n("div",{className:"search-mode-toggle",children:[n("button",{className:`mode-btn ${t==="fts"?"active":""}`,onClick:()=>e("fts"),children:"ðŸ“ FTS Only"}),n("button",{className:`mode-btn ${t==="hybrid"?"active":""}`,onClick:()=>e("hybrid"),children:"âš¡ Hybrid"}),n("button",{className:`mode-btn ${t==="graph"?"active":""}`,onClick:()=>e("graph"),children:"ðŸ•¸ï¸ Graph"})]}):null}function Jr({onSearch:t,loading:e,placeholder:r,searchHistory:i,onClearHistory:s}){return n(te,{children:[n("form",{onSubmit:a=>{a.preventDefault();const p=new FormData(a.currentTarget).get("query");p!=null&&p.trim()&&t(p.trim())},children:n("div",{className:"search-bar",children:[n("input",{type:"text",name:"query",placeholder:r||"Search the capsule...",className:"search-input",disabled:e}),n("button",{type:"submit",className:"btn-search",disabled:e,children:e?"Searching...":"Search"})]})}),i&&i.length>0&&n("div",{className:"search-history",children:[n("div",{className:"search-history-header",children:[n("span",{className:"search-history-label",children:"Recent searches:"}),s&&n("button",{className:"search-history-clear",onClick:s,type:"button",children:"Clear"})]}),n("div",{className:"search-history-items",children:i.map((a,c)=>n("button",{className:"search-history-item",onClick:()=>t(a),type:"button",children:a},c))})]})]})}function ei({results:t,query:e,onResultClick:r}){return n("div",{className:"search-results",children:[n("p",{className:"results-header",children:["Found ",t.length," results for ",n("strong",{children:['"',e,'"']})]}),t.map(i=>n("div",{className:`result-item ${r?"result-item-clickable":""}`,onClick:()=>r==null?void 0:r(i.gid),style:{cursor:r?"pointer":"default"},children:[n("div",{className:"result-header",children:[n("span",{className:"result-page",children:["Page ",i.pageNo]}),n("span",{className:"result-score",children:["Score: ",i.scores.final.toFixed(3)]})]}),n("h4",{className:"result-title",children:i.title}),i.snippet&&n("p",{className:"result-snippet",dangerouslySetInnerHTML:{__html:Gt.sanitize(i.snippet,{ALLOWED_TAGS:["mark","strong","em","b","i"],ALLOWED_ATTR:[]})}}),n("div",{className:"result-scores",children:[n("span",{children:["FTS: ",i.scores.fts.toFixed(2)]}),n("span",{children:["Entity: ",i.scores.entity.toFixed(2)]}),n("span",{children:["Graph: ",i.scores.graph.toFixed(2)]})]})]},i.gid))]})}function ti({mode:t,results:e,lastQuery:r,loading:i,onSearch:s,onModeChange:a,onResultClick:c,showModeToggle:p=!0,placeholder:u,searchHint:d,searchHistory:m,onClearHistory:l}){return n("div",{className:"search-section",children:[n("div",{className:"search-header",children:n("h3",{children:"ðŸ” Search"})}),n(Zr,{mode:t,onModeChange:a,showToggle:p}),d&&n("p",{className:"search-hint",children:d}),n("div",{className:"keyboard-shortcuts-hint",children:[n("span",{className:"shortcut-item",children:[n("kbd",{children:"/"})," Focus search"]}),n("span",{className:"shortcut-item",children:[n("kbd",{children:"Ctrl+L"})," Toggle LLM"]}),n("span",{className:"shortcut-item",children:[n("kbd",{children:"Esc"})," Clear focus"]})]}),n(Jr,{onSearch:s,loading:i,placeholder:u,searchHistory:m,onClearHistory:l}),e&&e.length>0&&n(ei,{results:e,query:r,onResultClick:c}),e&&e.length===0&&n("div",{className:"no-results",children:[n("p",{children:["No results found for ",n("strong",{children:['"',r,'"']})]}),n("p",{className:"search-hint",children:"Try different keywords or search terms."})]})]})}function Zn(t={}){const{autoLoad:e=!0,maxEntities:r=50}=t,[i,s]=k([]),[a,c]=k(null),[p,u]=k(!1),[d,m]=k(null),l=async()=>{u(!0),m(null);try{const f=await Z().listEntities(void 0,r);s(f),console.log("[Entities] Loaded:",f.length)}catch(_){const f=String(_);m(f),console.error("[Entities] Failed to load:",_)}finally{u(!1)}};V(()=>{e&&l()},[e]);const h=_=>{c(_)},g=()=>Array.from(new Set(i.map(_=>_.entityType))),N=()=>a?i.filter(_=>_.entityType===a):i,w=_=>i.filter(f=>f.entityType===_).reduce((f,v)=>f+v.count,0),b=()=>i.reduce((_,f)=>_+f.count,0);return{entities:i,selectedType:a,loading:p,error:d,types:g(),filteredEntities:N(),totalCount:b(),loadEntities:l,selectType:h,getTypeCount:w}}function ni({types:t,selectedType:e,totalCount:r,onSelectType:i,getTypeCount:s}){return n("div",{className:"entity-filters",children:[n("button",{className:`entity-filter ${e===null?"active":""}`,onClick:()=>i(null),children:["All (",r,")"]}),t.map(a=>{const c=s(a);return n("button",{className:`entity-filter ${e===a?"active":""}`,onClick:()=>i(a),children:[a," (",c,")"]},a)})]})}function ri({entities:t,maxDisplay:e=20}){const r=t.slice(0,e);return n("div",{className:"entity-list",children:[r.map(i=>n("div",{className:"entity-item",children:[n("span",{className:"entity-type",children:i.entityType}),n("span",{className:"entity-value",children:i.normalizedValue}),n("span",{className:"entity-count",children:i.count})]},`${i.entityType}-${i.normalizedValue}`)),t.length>e&&n("div",{className:"entity-item entity-more",children:n("span",{className:"entity-value",children:["... and ",t.length-e," more"]})})]})}function ii({entities:t,types:e,selectedType:r,totalCount:i,onSelectType:s,getTypeCount:a,show:c=!0,maxDisplay:p=20}){if(!c||t.length===0)return null;const u=r?t.filter(d=>d.entityType===r):t;return n("div",{className:"entity-panel",children:[n("h4",{children:"Filter by Entity Type"}),n(ni,{types:e,selectedType:r,totalCount:i,onSelectType:s,getTypeCount:a}),n(ri,{entities:u,maxDisplay:p})]})}class ai{constructor(){K(this,"worker",null);K(this,"nextId",1);K(this,"pending",new Map);K(this,"progressCallback",null);this.initWorker()}initWorker(){this.worker=new Worker(new URL("/assets/llm.worker-BXtIo8pX.js",import.meta.url),{type:"module"}),this.worker.onmessage=e=>{const r=e.data;if("type"in r&&r.type==="READY"){console.log("[LlmClient] Worker ready");return}if("type"in r&&r.type==="PROGRESS"){this.progressCallback&&this.progressCallback(r.data);return}const{id:i,response:s}=r,a=this.pending.get(i);a&&(this.pending.delete(i),a.resolve(s))},this.worker.onerror=e=>{console.error("[LlmClient] Worker error:",e);for(const r of this.pending.values())r.reject(new Error("Worker error"));this.pending.clear()}}async sendRequest(e){if(!this.worker)throw new Error("Worker not initialized");const r=this.nextId++;return new Promise((i,s)=>{this.pending.set(r,{resolve:c=>{c.ok?i(c.data):s(new Error(c.error))},reject:s});const a={id:r,request:e};this.worker.postMessage(a)})}onProgress(e){this.progressCallback=e}async loadModel(e){return this.sendRequest({type:"LOAD_MODEL",modelUrl:e})}async reason(e){return this.sendRequest({type:"REASON",request:e})}async unloadModel(){return this.sendRequest({type:"UNLOAD_MODEL"})}async getStatus(){return this.sendRequest({type:"GET_STATUS"})}terminate(){this.worker&&(this.worker.terminate(),this.worker=null),this.pending.clear(),this.progressCallback=null}}let At=null;function Mn(){return At||(At=new ai),At}const si={"0.6b":"https://huggingface.co/unsloth/Qwen3-0.6B-GGUF/resolve/main/Qwen3-0.6B-Q4_K_M.gguf","1.5b":"https://huggingface.co/ggml-org/Qwen2.5-1.5B-Instruct-GGUF/resolve/main/qwen2.5-1.5b-instruct-q4_k_m.gguf"};function Jn(t={}){const[e,r]=k(!1),[i,s]=k(null),[a,c]=k(!1),[p,u]=k(null),[d,m]=k(null),[l,h]=k(null),[g,N]=k(0),[w,b]=k(.7),_=rt(0),f=rt(null);V(()=>{if(a&&!p)return _.current=Date.now(),N(0),f.current=window.setInterval(()=>{const M=(Date.now()-_.current)/1e3;N(M)},100),()=>{f.current&&clearInterval(f.current)};f.current&&(clearInterval(f.current),f.current=null),N(0)},[a,p]);const v=async()=>{c(!0),h(null),u(null);try{const M=Mn();M.onProgress(J=>{u(J)});const O=await M.loadModel(si["0.6b"]);s(O),u(null),console.log("[LLM] Model loaded:",O)}catch(M){const O=String(M);h(O),console.error("[LLM] Failed to load model:",M)}finally{c(!1)}};return{enabled:e,modelInfo:i,loading:a,progress:p,reasoning:d,error:l,elapsedTime:g,temperature:w,toggle:async()=>{e?(r(!1),m(null)):(i!=null&&i.loaded||await v(),r(!0))},loadModel:v,reason:async(M,O,J=256)=>{if(!(i!=null&&i.loaded)){console.warn("[LLM] Cannot reason: model not loaded");return}c(!0),h(null);try{const re=Mn(),x=O.slice(0,5).map(se=>({gid:se.gid,pageNo:se.pageNo,title:se.title,text:se.snippet||"",score:se.scores.final})),Y=await re.reason({question:M,snippets:x,maxTokens:J,temperature:w});m(Y),console.log("[LLM] Reasoning complete:",Y)}catch(re){const x=String(re);h(x),console.error("[LLM] Reasoning failed:",re)}finally{c(!1)}},clearReasoning:()=>{m(null)},setTemperature:b}}function oi({reasoning:t,searchResults:e,loading:r}){const[i,s]=k(null);return r&&!t?n("div",{className:"reasoning-loading",children:[n("div",{className:"spinner"}),n("p",{children:"LLM is reasoning..."})]}):t?n("div",{className:"reasoning-output",children:[n("div",{className:"reasoning-header",children:[n("h4",{children:"ðŸ¤– LLM Reasoning"}),n("span",{className:"reasoning-meta",children:[t.inferenceTimeMs.toFixed(0),"ms Â· ",t.tokensGenerated," tokens"]})]}),n("div",{className:"reasoning-answer",children:t.answer}),t.usedSnippets.length>0&&n("div",{className:"reasoning-citations",children:[n("strong",{children:"ðŸ“‘ Cited sources:"}),t.usedSnippets.map(a=>{const c=e==null?void 0:e.find(p=>p.gid===a);return n("span",{className:"citation",onMouseEnter:()=>s(a),onMouseLeave:()=>s(null),style:{position:"relative"},children:["Page ",(c==null?void 0:c.pageNo)||"?",i===a&&c&&n("div",{className:"citation-tooltip",children:[n("div",{className:"citation-tooltip-title",children:c.title}),c.snippet&&n("div",{className:"citation-tooltip-snippet",dangerouslySetInnerHTML:{__html:Gt.sanitize(c.snippet,{ALLOWED_TAGS:["mark","strong","em","b","i"],ALLOWED_ATTR:[]})}}),n("div",{className:"citation-tooltip-meta",children:["Score: ",c.scores.final.toFixed(3)," â€¢ GID: ",a.slice(0,8),"..."]})]})]},a)})]})]}):null}function we(){return typeof navigator<"u"&&"storage"in navigator&&"getDirectory"in navigator.storage}async function li(){if(!we())throw new Error("OPFS not supported in this browser");return await navigator.storage.getDirectory()}async function ci(){return await(await li()).getDirectoryHandle("capsules",{create:!0})}function di(t){const e=t.replace(/[^a-z0-9._-]/gi,"-");return e.endsWith(".mgx.sqlite")?e:`${e}.mgx.sqlite`}async function ui(t,e){if(!we())throw new Error("OPFS not supported - cannot persist file");const r=await ci(),i=e||di(t.name),a=await(await r.getFileHandle(i,{create:!0})).createWritable();try{return await a.write(t),await a.close(),console.log(`[OPFS] Copied file to ${i} (${t.size} bytes)`),{path:i,size:t.size}}catch(c){throw await a.close(),c}}async function hi(){if(!navigator.storage||!navigator.storage.estimate)return null;try{const t=await navigator.storage.estimate(),e=t.usage||0,r=t.quota||0;return{usage:e,quota:r,available:r-e,percentUsed:r>0?e/r*100:0}}catch(t){return console.error("[OPFS] Failed to get storage quota:",t),null}}async function pi(){if(!navigator.storage||!navigator.storage.persist)return!1;try{const t=await navigator.storage.persist();return console.log(`[OPFS] Persistent storage: ${t}`),t}catch(t){return console.error("[OPFS] Failed to request persistent storage:",t),!1}}function Fe(t){if(t===0)return"0 B";const e=1024,r=["B","KB","MB","GB"],i=Math.floor(Math.log(t)/Math.log(e));return`${(t/Math.pow(e,i)).toFixed(2)} ${r[i]}`}async function fi(t,e=500*1024*1024){if(t.size===0)return{valid:!1,error:"File is empty"};if(t.size>e)return{valid:!1,error:`File too large (${Fe(t.size)} > ${Fe(e)})`};const r=t.name.toLowerCase();if(!r.endsWith(".mgx.sqlite")&&!r.endsWith(".sqlite"))return{valid:!1,error:"File must have .mgx.sqlite or .sqlite extension"};try{const i=await t.slice(0,16).arrayBuffer();if(!new TextDecoder().decode(i).startsWith("SQLite format 3"))return{valid:!1,error:"Not a valid SQLite file (invalid header)"}}catch(i){return{valid:!1,error:`Failed to read file header: ${i}`}}return{valid:!0}}function mi({onFileSelected:t,onOpfsFileSelected:e,onError:r}){const[i,s]=k([]),[a,c]=k(null),[p,u]=k(!1),[d,m]=k(!1),l=Z();V(()=>{h(),g()},[]);async function h(){try{const f=await l.listOpfsFiles();s(f)}catch(f){console.error("[FilePicker] Failed to list OPFS files:",f)}}async function g(){var f,v;try{const S=await hi();c(S);const T=await((v=(f=navigator.storage)==null?void 0:f.persisted)==null?void 0:v.call(f));m(T||!1)}catch(S){console.error("[FilePicker] Failed to get quota:",S)}}async function N(f){var T;const v=f.target,S=(T=v.files)==null?void 0:T[0];if(S){u(!0);try{const L=await fi(S);if(!L.valid){r(L.error),u(!1);return}if(we()){const{path:M}=await ui(S);await h(),await g(),t(S,M)}else t(S)}catch(L){r(`Failed to load file: ${L}`)}finally{u(!1),v.value=""}}}async function w(f){u(!0);try{e(f)}catch(v){r(`Failed to open from OPFS: ${v}`)}finally{u(!1)}}async function b(f,v){if(v.stopPropagation(),!!confirm(`Remove "${f}" from device storage?`))try{await l.removeFromOpfs(f),await h(),await g()}catch(S){r(`Failed to remove file: ${S}`)}}async function _(){try{await pi()?m(!0):r("Persistent storage not granted. Files may be evicted under storage pressure.")}catch(f){r(`Failed to request persistence: ${f}`)}}return n("div",{class:"file-picker",children:[n("div",{class:"file-picker-header",children:[n("h2",{children:"Open Capsule"}),a&&n("div",{class:"storage-quota",children:[n("div",{class:"quota-bar",children:n("div",{class:"quota-used",style:`width: ${Math.min(a.percentUsed,100)}%`})}),n("p",{class:"quota-text",children:[Fe(a.usage)," / ",Fe(a.quota)," used (",a.percentUsed.toFixed(1),"%)"]}),!d&&we()&&n("button",{class:"btn-secondary btn-sm",onClick:_,children:"Request Persistent Storage"})]})]}),n("div",{class:"file-input-section",children:[n("label",{class:"file-input-label",children:[n("input",{type:"file",accept:".mgx.sqlite,.sqlite",onChange:N,disabled:p,style:"display: none"}),n("button",{class:"btn-primary",disabled:p,children:p?"Loading...":"Select File from Device"})]}),n("p",{class:"help-text",children:"Choose a .mgx.sqlite or .sqlite file from your device"})]}),we()&&i.length>0&&n("div",{class:"opfs-files-section",children:[n("h3",{children:"Stored on Device"}),n("ul",{class:"opfs-files-list",children:i.map(f=>n("li",{class:"opfs-file-item",children:[n("button",{class:"opfs-file-button",onClick:()=>w(f.path),disabled:p,children:n("div",{class:"file-info",children:[n("span",{class:"file-name",children:f.path}),n("span",{class:"file-meta",children:[Fe(f.size)," â€¢"," ",new Date(f.lastModified).toLocaleDateString()]})]})}),n("button",{class:"btn-remove",onClick:v=>b(f.path,v),title:"Remove from device","aria-label":"Remove from device",children:"Ã—"})]},f.path))})]}),!we()&&n("div",{class:"opfs-warning",children:n("p",{children:[n("strong",{children:"Note:"})," Your browser doesn't support persistent storage. Files will only be kept in memory and lost when you close the tab."]})})]})}function gi(t={}){const{autoLoad:e=!1,maxHops:r=2,limit:i=50}=t,[s,a]=k(null),[c,p]=k(null),[u,d]=k(void 0),[m,l]=k(!1),[h,g]=k(null),N=async(T,L)=>{l(!0),g(null),p(T),d(L);try{const O=await Z().graphHops(T,L,r,i);a(O),console.log("[Graph] Loaded:",O.nodes.length,"nodes,",O.edges.length,"edges")}catch(M){const O=String(M);g(O),console.error("[Graph] Failed to load:",M)}finally{l(!1)}},w=async T=>{await N(T,u)},b=async T=>{c&&await N(c,T)},_=()=>{a(null),p(null),d(void 0),g(null)},f=()=>s?Array.from(new Set(s.edges.map(T=>T.predicate))):[],v=T=>s==null?void 0:s.nodes.find(L=>L.gid===T),S=T=>s?s.edges.filter(L=>L.fromGid===T):[];return V(()=>{e&&c&&N(c,u)},[e]),{graphData:s,seedGid:c,predicate:u,loading:m,error:h,predicates:f(),nodeCount:(s==null?void 0:s.nodes.length)||0,edgeCount:(s==null?void 0:s.edges.length)||0,loadGraph:N,navigateToNode:w,filterByPredicate:b,clear:_,getNode:v,getNodeEdges:S}}function _i({nodes:t,edges:e,seedGid:r,onNodeClick:i,width:s=800,height:a=600}){const[c,p]=k(new Map),u=rt();return V(()=>{const d=new Map,m=s/2,l=a/2;t.forEach((h,g)=>{const N=g/t.length*2*Math.PI,w=Math.min(s,a)/3;d.set(h.gid,{gid:h.gid,x:m+w*Math.cos(N),y:l+w*Math.sin(N),vx:0,vy:0})}),p(d)},[t,s,a]),V(()=>{if(c.size===0)return;const d=()=>{const l=new Map(c),h=.3;l.forEach(g=>{l.forEach(N=>{if(g.gid===N.gid)return;const w=N.x-g.x,b=N.y-g.y,_=w*w+b*b+1,f=Math.sqrt(_),v=2e3/_;g.vx-=w/f*v*h,g.vy-=b/f*v*h})}),e.forEach(g=>{const N=l.get(g.fromGid),w=l.get(g.toGid);if(!N||!w)return;const b=w.x-N.x,_=w.y-N.y,f=Math.sqrt(b*b+_*_)+1,v=f*.01;N.vx+=b/f*v*h,N.vy+=_/f*v*h,w.vx-=b/f*v*h,w.vy-=_/f*v*h}),l.forEach(g=>{g.x+=g.vx,g.y+=g.vy,g.vx*=.8,g.vy*=.8,g.x=Math.max(30,Math.min(s-30,g.x)),g.y=Math.max(30,Math.min(a-30,g.y))}),p(l),u.current=requestAnimationFrame(d)};u.current=requestAnimationFrame(d);const m=setTimeout(()=>{u.current&&cancelAnimationFrame(u.current)},3e3);return()=>{u.current&&cancelAnimationFrame(u.current),clearTimeout(m)}},[e,s,a]),n("svg",{width:s,height:a,className:"graph-view",style:{border:"1px solid var(--color-border)",borderRadius:"8px"},children:[n("g",{className:"graph-edges",children:e.map((d,m)=>{const l=c.get(d.fromGid),h=c.get(d.toGid);return!l||!h?null:n("line",{x1:l.x,y1:l.y,x2:h.x,y2:h.y,stroke:"#94a3b8",strokeWidth:Math.max(1,d.weight*2),strokeOpacity:.6,markerEnd:"url(#arrowhead)"},`${d.fromGid}-${d.toGid}-${m}`)})}),n("defs",{children:n("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"10",refX:"9",refY:"3",orient:"auto",markerUnits:"strokeWidth",children:n("path",{d:"M0,0 L0,6 L9,3 z",fill:"#94a3b8"})})}),n("g",{className:"graph-nodes",children:t.map(d=>{const m=c.get(d.gid);if(!m)return null;const l=d.gid===r,h=l?12:8,g=l?"#3b82f6":"#64748b";return n("g",{className:"graph-node",onClick:()=>i==null?void 0:i(d.gid),style:{cursor:i?"pointer":"default"},children:[n("circle",{cx:m.x,cy:m.y,r:h,fill:g,stroke:"#ffffff",strokeWidth:2,opacity:.9}),n("text",{x:m.x,y:m.y-h-5,textAnchor:"middle",fontSize:"11",fill:"var(--color-fg)",style:{pointerEvents:"none",userSelect:"none"},children:d.title||`Page ${d.pageNo}`})]},d.gid)})})]})}function yi({nodes:t,edges:e,seedGid:r,onNodeClick:i,loading:s,error:a}){return s?n("div",{className:"graph-panel-loading",children:[n("div",{className:"spinner"}),n("p",{children:"Loading graph..."})]}):a?n("div",{className:"graph-panel-error",children:n("p",{children:["Error: ",a]})}):t.length===0?n("div",{className:"graph-panel-empty",children:[n("p",{children:"No graph data to display"}),n("p",{className:"hint",children:"Search for a page or select a result to explore its connections"})]}):n("div",{className:"graph-panel",children:[n("div",{className:"graph-info",children:[n("span",{children:[t.length," nodes"]}),n("span",{children:[e.length," edges"]})]}),n(_i,{nodes:t,edges:e,seedGid:r,onNodeClick:i,width:800,height:600})]})}function vi({predicates:t,selectedPredicate:e,onPredicateChange:r,onReset:i}){return n("div",{className:"graph-controls",children:[n("div",{className:"graph-controls-section",children:[n("label",{className:"graph-controls-label",children:"Filter by Relationship:"}),n("select",{className:"graph-controls-select",value:e||"",onChange:s=>{const a=s.target.value;r(a||void 0)},children:[n("option",{value:"",children:"All Relationships"}),t.map(s=>n("option",{value:s,children:s},s))]})]}),i&&n("button",{className:"btn-secondary btn-sm",onClick:i,children:"Reset View"})]})}function bi({nodeCount:t,edgeCount:e,predicateCount:r,seedNode:i}){return n("div",{className:"graph-stats",children:[n("div",{className:"graph-stat",children:[n("span",{className:"graph-stat-label",children:"Nodes:"}),n("span",{className:"graph-stat-value",children:t})]}),n("div",{className:"graph-stat",children:[n("span",{className:"graph-stat-label",children:"Edges:"}),n("span",{className:"graph-stat-value",children:e})]}),n("div",{className:"graph-stat",children:[n("span",{className:"graph-stat-label",children:"Relationships:"}),n("span",{className:"graph-stat-value",children:r})]}),i&&n("div",{className:"graph-stat",children:[n("span",{className:"graph-stat-label",children:"Seed:"}),n("span",{className:"graph-stat-value",children:i})]})]})}function Ni(t={}){const{autoLoadCheckpoints:e=!1}=t,[r,i]=k([]),[s,a]=k(null),[c,p]=k(!1),[u,d]=k(!1),[m,l]=k(null),h=async()=>{p(!0),l(null);try{const b=await Z().getCheckpoints();i(b),console.log("[Provenance] Loaded",b.length,"checkpoints")}catch(w){const b=String(w);l(b),console.error("[Provenance] Failed to load checkpoints:",w)}finally{p(!1)}},g=async w=>{d(!0),l(null);try{const _=await Z().verifyPage(w);a(_),console.log("[Provenance] Verification result:",_)}catch(b){const _=String(b);l(_),console.error("[Provenance] Failed to verify page:",b)}finally{d(!1)}},N=()=>{a(null)};return V(()=>{e&&h()},[e]),{checkpoints:r,verificationResult:s,loading:c,verifying:u,error:m,checkpointCount:r.length,latestCheckpoint:r[0]||null,loadCheckpoints:h,verifyPage:g,clearVerification:N}}function Ti({checkpoint:t,isLatest:e}){return n("div",{className:`checkpoint-item ${e?"checkpoint-latest":""}`,children:[n("div",{className:"checkpoint-header",children:[n("div",{className:"checkpoint-epoch",children:[e&&n("span",{className:"checkpoint-badge",children:"Latest"}),n("span",{className:"checkpoint-epoch-value",children:["Epoch ",t.epoch]})]}),n("div",{className:"checkpoint-date",children:new Date(t.createdTs).toLocaleString()})]}),n("div",{className:"checkpoint-body",children:[n("div",{className:"checkpoint-field",children:[n("span",{className:"field-label",children:"Merkle Root:"}),n("code",{className:"field-value",title:t.merkleRoot,children:[t.merkleRoot.substring(0,16),"..."]})]}),n("div",{className:"checkpoint-field",children:[n("span",{className:"field-label",children:"Pages:"}),n("span",{className:"field-value",children:t.pagesCount})]}),t.anchors&&t.anchors.length>0&&n("div",{className:"checkpoint-field",children:[n("span",{className:"field-label",children:"Anchors:"}),n("span",{className:"field-value",children:t.anchors.length})]})]})]})}function Ei({checkpoints:t,loading:e,error:r}){return e?n("div",{className:"checkpoint-timeline-loading",children:[n("div",{className:"spinner"}),n("p",{children:"Loading checkpoints..."})]}):r?n("div",{className:"checkpoint-timeline-error",children:n("p",{children:["Error: ",r]})}):t.length===0?n("div",{className:"checkpoint-timeline-empty",children:[n("p",{children:"No checkpoints found"}),n("p",{className:"hint",children:"This capsule has not been checkpointed yet"})]}):n("div",{className:"checkpoint-timeline",children:t.map((i,s)=>n(Ti,{checkpoint:i,isLatest:s===0},i.epoch))})}function Si({result:t,verifying:e,onVerify:r}){return e?n("div",{className:"verification-panel verification-loading",children:[n("div",{className:"spinner"}),n("p",{children:"Verifying page integrity..."})]}):t?n("div",{className:`verification-panel ${t.verified?"verification-success":"verification-failure"}`,children:[n("div",{className:"verification-header",children:n("div",{className:"verification-status",children:t.verified?n(te,{children:[n("span",{className:"status-icon",children:"âœ“"}),n("span",{className:"status-text",children:"Verified"})]}):n(te,{children:[n("span",{className:"status-icon",children:"âœ—"}),n("span",{className:"status-text",children:"Verification Failed"})]})})}),n("div",{className:"verification-body",children:[n("div",{className:"verification-field",children:[n("span",{className:"field-label",children:"Content SHA:"}),n("code",{className:"field-value",title:t.contentSha,children:[t.contentSha.substring(0,16),"..."]})]}),t.expectedSha&&n("div",{className:"verification-field",children:[n("span",{className:"field-label",children:"Expected SHA:"}),n("code",{className:"field-value",title:t.expectedSha,children:[t.expectedSha.substring(0,16),"..."]})]}),t.epoch&&n("div",{className:"verification-field",children:[n("span",{className:"field-label",children:"Checkpoint Epoch:"}),n("span",{className:"field-value",children:t.epoch})]}),t.merkleRoot&&n("div",{className:"verification-field",children:[n("span",{className:"field-label",children:"Merkle Root:"}),n("code",{className:"field-value",title:t.merkleRoot,children:[t.merkleRoot.substring(0,16),"..."]})]}),t.signer&&n("div",{className:"verification-field",children:[n("span",{className:"field-label",children:"Signer:"}),n("code",{className:"field-value",children:t.signer})]}),t.signature&&n("div",{className:"verification-field",children:[n("span",{className:"field-label",children:"Signature:"}),n("code",{className:"field-value",title:t.signature,children:[t.signature.substring(0,16),"..."]})]})]}),r&&n("div",{className:"verification-footer",children:n("button",{className:"btn-secondary btn-sm",onClick:r,children:"Verify Again"})})]}):n("div",{className:"verification-panel verification-empty",children:[n("p",{children:'Click "Verify Page" to check integrity'}),r&&n("button",{className:"btn-primary btn-sm",onClick:r,children:"Verify Page"})]})}function wi({checkpoints:t,verificationResult:e,loading:r,verifying:i,error:s,onVerify:a}){const[c,p]=k("checkpoints");return n("div",{className:"provenance-panel",children:[n("div",{className:"provenance-header",children:n("h3",{children:"Provenance & Trust"})}),n("div",{className:"provenance-tabs",children:[n("button",{className:`provenance-tab ${c==="checkpoints"?"active":""}`,onClick:()=>p("checkpoints"),children:["ðŸ“œ Checkpoints (",t.length,")"]}),n("button",{className:`provenance-tab ${c==="verification"?"active":""}`,onClick:()=>p("verification"),children:"ðŸ” Verification"})]}),n("div",{className:"provenance-content",children:[c==="checkpoints"&&n(Ei,{checkpoints:t,loading:r,error:s}),c==="verification"&&n(Si,{result:e,verifying:i,onVerify:a})]})]})}function Ai(t){const{onFocusSearch:e,onToggleLlm:r,onEscape:i}=t;V(()=>{function s(a){const c=a.target,p=c.tagName==="INPUT"||c.tagName==="TEXTAREA"||c.isContentEditable;if(a.key==="/"&&!p){a.preventDefault(),e==null||e();return}if((a.ctrlKey||a.metaKey)&&a.key==="l"){a.preventDefault(),r==null||r();return}if(a.key==="Escape"){i==null||i();return}}return window.addEventListener("keydown",s),()=>{window.removeEventListener("keydown",s)}},[e,r,i])}function ki(t){return t.startsWith("asset://")?{protocol:"asset",path:t.slice(8)}:null}const kt=new Map,Ci=new Map;async function Li(t){if(kt.has(t))return kt.get(t);const e=ki(t);if(!e)return console.error("[Assets] Invalid asset URL:",t),null;try{const i=await Z().getPageBlob(e.path);if(!i||i.size===0)return console.warn("[Assets] Asset not found or empty:",e.path),null;const s=URL.createObjectURL(i);return kt.set(t,s),Ci.set(t,i),console.log("[Assets] Loaded:",e.path,`(${i.size} bytes, ${i.type||"unknown type"})`),s}catch(r){return console.error("[Assets] Failed to load asset:",t,r),null}}function xi(t){const[e,r]=k(null);return V(()=>{if(!t){r(null);return}if(!t.startsWith("asset://")){r(t);return}Li(t).then(r)},[t]),e}function Ri({gid:t,onClose:e}){const[r,i]=k(null),[s,a]=k(!0),[c,p]=k(null);V(()=>{(async()=>{a(!0),p(null);try{const h=await Z().query("SELECT gid, doc_id, page_no, title, tags, updated_ts FROM meta_index WHERE gid = ? LIMIT 1",[t]);h.length>0?i(h[0]):p("Page not found")}catch(l){p(String(l)),console.error("[PagePreview] Failed to load page:",l)}finally{a(!1)}})()},[t]);const u=r?`asset://glyphs/page_${String(r.pageNo).padStart(4,"0")}.mgx.png`:void 0,d=xi(u);return s?n("div",{className:"page-preview",children:n("div",{className:"page-preview-loading",children:[n("div",{className:"spinner"}),n("p",{children:"Loading page..."})]})}):c||!r?n("div",{className:"page-preview",children:n("div",{className:"page-preview-error",children:[n("p",{children:["Error: ",c||"Page not found"]}),e&&n("button",{className:"btn-secondary",onClick:e,children:"Close"})]})}):n("div",{className:"page-preview",children:[n("div",{className:"page-preview-header",children:[n("div",{className:"page-preview-title",children:[n("span",{className:"page-number",children:["Page ",r.pageNo]}),n("h3",{children:r.title||"(Untitled)"})]}),e&&n("button",{className:"btn-icon",onClick:e,title:"Close preview",children:"âœ•"})]}),n("div",{className:"page-preview-content",children:d?n("img",{src:d,alt:`Page ${r.pageNo}`,className:"page-image"}):n("div",{className:"page-preview-placeholder",children:n("p",{children:"No image available for this page"})})}),n("div",{className:"page-preview-metadata",children:n("dl",{children:[n("dt",{children:"GID:"}),n("dd",{children:n("code",{title:r.gid,children:[r.gid.substring(0,16),"..."]})}),r.tags&&n(te,{children:[n("dt",{children:"Tags:"}),n("dd",{children:r.tags})]}),n("dt",{children:"Updated:"}),n("dd",{children:new Date(r.updatedTs).toLocaleString()})]})})]})}function Mi({selectedGid:t,onClose:e}){return t?n(Ri,{gid:t,onClose:e}):n("div",{className:"page-preview-panel-empty",children:n("p",{children:"Select a search result to preview the page"})})}function Oi({config:t,children:e}){return n("div",{className:"layout-landing",children:[n("section",{className:"hero",children:[n("div",{className:"hero-content",children:[t.logo_asset&&n("img",{src:t.logo_asset,alt:"Logo",className:"hero-logo"}),n("h1",{className:"hero-title",children:t.hero_title||t.site_title||"Welcome"}),t.hero_subtitle&&n("p",{className:"hero-subtitle",children:t.hero_subtitle})]}),t.hero_image&&n("div",{className:"hero-background",style:{backgroundImage:`url(${t.hero_image})`}})]}),n("main",{className:"landing-main",children:e})]})}function Pi({config:t,navigation:e,currentPage:r,children:i}){const s=e.filter(a=>a.menu==="sidebar");return n("div",{className:"layout-docs",children:[n("aside",{className:"docs-sidebar",children:n("nav",{className:"docs-nav",children:[n("div",{className:"docs-nav-header",children:[t.logo_asset&&n("img",{src:t.logo_asset,alt:"Logo",className:"docs-logo"}),n("h3",{children:t.site_title||"Documentation"})]}),n("ul",{className:"docs-nav-list",children:s.map(a=>n("li",{className:"docs-nav-item",children:n("a",{href:`#${a.to_slug}`,className:(r==null?void 0:r.slug)===a.to_slug?"active":"",children:[a.icon_asset&&n("img",{src:a.icon_asset,alt:"",className:"nav-icon"}),a.label]})},a.to_slug))})]})}),n("main",{className:"docs-main",children:[r&&n("div",{className:"docs-breadcrumbs",children:[n("a",{href:"#/",children:"Home"}),r.category&&n(te,{children:[n("span",{children:" / "}),n("span",{children:r.category})]}),n("span",{children:" / "}),n("span",{children:r.title})]}),n("article",{className:"docs-content",children:[r&&n("h1",{children:r.title}),i]})]})]})}function er({config:t,children:e}){return n("div",{className:"layout-dashboard",children:[n("header",{className:"dashboard-header",children:n("h1",{children:t.site_title||"Dashboard"})}),n("main",{className:"dashboard-content",children:e})]})}function tr({config:t,title:e,children:r}){return n("div",{className:"layout-simple",children:[n("header",{className:"simple-header",children:[t.logo_asset&&n("img",{src:t.logo_asset,alt:"Logo",className:"simple-logo"}),e&&n("h1",{children:e})]}),n("main",{className:"simple-content",children:r}),n("footer",{className:"simple-footer",children:n("p",{children:"Powered by GlyphCapsule"})})]})}function Fi({topBar:t,leftSidebar:e,centerPanel:r,rightSidebar:i,showLeftSidebar:s=!0,showRightSidebar:a=!1}){return n("div",{className:"capsule-layout",children:[n("div",{className:"capsule-topbar",children:t}),n("div",{className:"capsule-content",children:[s&&e&&n("aside",{className:"capsule-sidebar capsule-sidebar-left",children:e}),n("main",{className:"capsule-main",children:r}),a&&i&&n("aside",{className:"capsule-sidebar capsule-sidebar-right",children:i})]})]})}function Di({capsuleName:t,onClose:e,actions:r}){return n("div",{className:"topbar-content",children:[n("div",{className:"topbar-left",children:n("h2",{className:"topbar-title",children:["ðŸ“¦ ",t]})}),n("div",{className:"topbar-right",children:[r,e&&n("button",{className:"btn-secondary btn-sm",onClick:e,children:"Close Capsule"})]})]})}function Ii({title:t,children:e,onClear:r,hasActiveFilters:i=!1}){return n("div",{className:"filter-panel",children:[n("div",{className:"filter-panel-header",children:[n("h3",{children:t}),i&&r&&n("button",{className:"btn-link btn-sm",onClick:r,children:"Clear All"})]}),n("div",{className:"filter-panel-content",children:e})]})}function Hi({capsuleInfo:t,onClose:e}){var S;const[r,i]=k("search"),[s,a]=k(null),[c,p]=k(!1),u=Qn({defaultMode:"fts"}),d=Zn({autoLoad:!0}),m=gi({maxHops:2,limit:50}),l=Ni({autoLoadCheckpoints:!0}),h=Jn({});Ai({onFocusSearch:()=>{const T=document.querySelector('input[name="query"]');T==null||T.focus(),T==null||T.select()},onToggleLlm:()=>{h.toggle()},onEscape:()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()}});const g=T=>{a(T)},N=T=>{m.navigateToNode(T),a(T)},w=T=>{i("graph"),m.loadGraph(T),a(T)},b=()=>{u.clearFilter(),u.lastQuery&&u.search(u.lastQuery)},_=()=>{s&&(l.verifyPage(s),p(!0))},f=async()=>{h.enabled&&u.results&&u.results.length>0&&u.lastQuery&&(h.clearReasoning(),await h.reason(u.lastQuery,u.results,1500))};V(()=>{h.enabled&&u.results&&u.results.length>0&&u.lastQuery&&(!h.reasoning||h.reasoning.usedSnippets.length===0)&&f()},[h.enabled,u.results,u.lastQuery]);const v=!!(u.entityFilter.entityType||u.entityFilter.entityValue);return n(Fi,{topBar:n(Di,{capsuleName:t.fileName,onClose:e,actions:n(te,{children:[n("div",{className:"capsule-stats",children:[n("span",{children:[t.pageCount," pages"]}),n("span",{children:[t.entityCount," entities"]}),n("span",{children:[t.edgeCount," edges"]})]}),n("button",{className:`btn-secondary btn-sm ${h.enabled?"active":""}`,onClick:h.toggle,disabled:h.loading,title:(S=h.modelInfo)!=null&&S.loaded?"LLM Ready":"Click to load LLM",children:["ðŸ¤– ",h.enabled?"LLM On":"LLM Off"]}),n("button",{className:`btn-secondary btn-sm ${c?"active":""}`,onClick:()=>p(!c),children:[c?"âœ“":""," Provenance"]})]})}),leftSidebar:n(Ii,{title:"Entity Filters",onClear:b,hasActiveFilters:v,children:[v&&n("div",{className:"active-filters",children:[n("p",{className:"filter-label",children:"Active Filter:"}),u.entityFilter.entityType&&n("span",{className:"filter-tag",children:["Type: ",u.entityFilter.entityType]}),u.entityFilter.entityValue&&n("span",{className:"filter-tag",children:["Value: ",u.entityFilter.entityValue]})]}),n(ii,{entities:d.entities,types:d.types,selectedType:d.selectedType,totalCount:d.totalCount,onSelectType:d.selectType,getTypeCount:d.getTypeCount,show:!0,maxDisplay:20})]}),centerPanel:n("div",{className:"capsule-center",children:[n("div",{className:"view-mode-tabs",children:[n("button",{className:`tab-btn ${r==="search"?"active":""}`,onClick:()=>i("search"),children:"ðŸ” Search"}),n("button",{className:`tab-btn ${r==="graph"?"active":""}`,onClick:()=>i("graph"),children:"ðŸ•¸ï¸ Graph"})]}),r==="search"&&n(te,{children:[n(ti,{mode:u.mode,results:u.results,lastQuery:u.lastQuery,loading:u.loading,onSearch:u.search,onModeChange:u.changeMode,onResultClick:g,showModeToggle:!0,placeholder:"Search the capsule...",searchHint:'Try: "vector search", "LEANN", "SQLite", or "hybrid retrieval"',searchHistory:u.searchHistory,onClearHistory:u.clearHistory}),h.enabled&&u.results&&u.results.length>0&&n("div",{className:"llm-section",children:[n("div",{className:"llm-temperature-control",children:[n("label",{htmlFor:"temperature-slider",className:"temperature-label",children:["Creativity:",n("input",{id:"temperature-slider",type:"range",min:"0",max:"1",step:"0.1",value:h.temperature,onChange:T=>h.setTemperature(parseFloat(T.currentTarget.value)),className:"temperature-slider"}),n("span",{className:"temperature-value",children:h.temperature.toFixed(1)})]}),n("small",{className:"temperature-hint",children:[h.temperature<.3&&"â„ï¸ Very factual",h.temperature>=.3&&h.temperature<.6&&"ðŸ“ Mostly factual",h.temperature>=.6&&h.temperature<.8&&"âš–ï¸ Balanced",h.temperature>=.8&&"ðŸŽ¨ Creative"]})]}),h.progress&&n("div",{className:"llm-progress-bar",children:[n("div",{className:"llm-progress-info",children:[n("span",{children:["ðŸ¤– ",h.progress.message]}),n("span",{children:[(h.progress.progress*100).toFixed(0),"%"]})]}),n("div",{className:"llm-progress-track",children:n("div",{className:"llm-progress-fill",style:{width:`${h.progress.progress*100}%`}})})]}),h.reasoning&&n(oi,{reasoning:h.reasoning,searchResults:u.results,loading:h.loading}),h.loading&&!h.reasoning&&!h.progress&&n("div",{className:"reasoning-loading",children:[n("div",{className:"spinner"}),n("p",{children:"LLM is reasoning over search results..."}),h.elapsedTime>0&&n("p",{className:"inference-time",children:["Elapsed: ",h.elapsedTime.toFixed(1),"s",h.elapsedTime>3&&" â€¢ Typically takes 2-5s"]})]}),h.error&&n("div",{className:"llm-error-panel",children:[n("strong",{children:"âš ï¸ LLM Error:"})," ",h.error,n("button",{className:"btn-secondary btn-sm",onClick:f,disabled:h.loading,style:{marginLeft:"1rem"},children:h.loading?"Retrying...":"Try Again"})]})]}),h.enabled&&(!u.results||u.results.length===0)&&u.lastQuery&&n("div",{className:"llm-no-results",children:n("p",{children:"ðŸ¤– LLM needs search results to reason. Try searching first!"})})]}),r==="graph"&&n("div",{className:"graph-view-container",children:[!m.graphData&&n("div",{className:"graph-view-empty",children:[n("p",{children:"Select a search result to explore its graph connections"}),n("p",{className:"hint",children:"Or switch to Search tab to find pages"})]}),m.graphData&&n(te,{children:[n(bi,{nodeCount:m.nodeCount,edgeCount:m.edgeCount,predicateCount:m.predicates.length,seedNode:m.seedGid||void 0}),n(vi,{predicates:m.predicates,selectedPredicate:m.predicate,onPredicateChange:m.filterByPredicate,onReset:m.clear}),n(yi,{nodes:m.graphData.nodes,edges:m.graphData.edges,seedGid:m.seedGid||void 0,onNodeClick:N,loading:m.loading,error:m.error})]})]}),s&&n("div",{className:"page-preview-section",children:[n("div",{className:"page-preview-header-actions",children:[n("h3",{children:"Page Preview"}),n("div",{className:"page-preview-actions",children:[r==="search"&&n("button",{className:"btn-secondary btn-sm",onClick:()=>w(s),children:"Explore Graph"}),n("button",{className:"btn-primary btn-sm",onClick:_,disabled:l.verifying,children:l.verifying?"Verifying...":"Verify Page"})]})]}),n(Mi,{selectedGid:s,onClose:()=>a(null)})]})]}),rightSidebar:c&&n(wi,{checkpoints:l.checkpoints,verificationResult:l.verificationResult,loading:l.loading,verifying:l.verifying,error:l.error,onVerify:_}),showLeftSidebar:!0,showRightSidebar:c})}async function $i(t){const r=(await t.query("SELECT name FROM sqlite_master WHERE type='table'")).map(h=>h.name),i=r.includes("_ui_pages"),s=r.includes("_ui_dashboards"),a=r.includes("_ui_navigation"),c=r.includes("_ui_params"),p=r.includes("_meta_manifest"),u=r.includes("sqlar"),d=r.some(h=>h.startsWith("fts_"));let m="1.0";if(p)try{const h=await t.query("SELECT value FROM _meta_manifest WHERE key='gcui'");h.length>0&&(m=h[0].value)}catch(h){console.warn("Failed to read GCUI version:",h)}let l;return i&&s?l="hybrid":i?l="website":s?l="dashboard":l="generic",{version:m,hasWebsite:i,hasDashboards:s,hasNavigation:a,hasParams:c,hasFTS:d,hasAssets:u,mode:l}}async function Ui(t){try{const e=await t.query("SELECT key, value FROM _meta_manifest");if(e.length===0)return null;const r={gcui:"1.0",capsule_kind:"sqlar"};return e.forEach(i=>{r[i.key]=i.value}),r}catch(e){return console.warn("Failed to load manifest:",e),null}}async function Gi(t){try{const e=await t.query("SELECT key, value FROM _ui_config"),r={};return e.forEach(i=>{r[i.key]=i.value}),r}catch(e){return console.warn("Failed to load config:",e),{}}}async function Wi(t){try{return(await t.query("SELECT slug, title, content, layout, category, order_index FROM _ui_pages ORDER BY order_index ASC, slug ASC")).map(r=>({slug:r.slug,title:r.title,content:r.content||void 0,layout:r.layout||void 0,category:r.category||void 0,order_index:r.order_index||void 0}))}catch(e){return console.warn("Failed to load pages:",e),[]}}async function qi(t){try{return(await t.query("SELECT menu, label, to_slug, order_index, icon_asset FROM _ui_navigation ORDER BY menu, order_index ASC")).map(r=>({menu:r.menu,label:r.label,to_slug:r.to_slug,order_index:r.order_index||void 0,icon_asset:r.icon_asset||void 0}))}catch(e){return console.warn("Failed to load navigation:",e),[]}}async function zi(t){try{return(await t.query("SELECT name, query, grammar, config FROM _ui_dashboards")).map(r=>({name:r.name,query:r.query,grammar:r.grammar||void 0,config:r.config||void 0}))}catch(e){return console.warn("Failed to load dashboards:",e),[]}}async function Bi(t){const e=await $i(t),r=await Ui(t)||{gcui:e.version,capsule_kind:"sqlar"},i=await Gi(t),s=e.hasWebsite?await Wi(t):[],a=e.hasNavigation?await qi(t):[],c=e.hasDashboards?await zi(t):[];return{manifest:r,capabilities:e,config:i,pages:s,navigation:a,dashboards:c}}function Vi({data:t,config:e,width:r=600,height:i=400}){if(!t||t.length===0)return n("div",{className:"chart-empty",style:{width:r,height:i},children:n("p",{children:"No data to display"})});switch(e.mark){case"bar":return n(Qi,{data:t,config:e,width:r,height:i});case"line":return n(ji,{data:t,config:e,width:r,height:i});case"point":return n(Yi,{data:t,config:e,width:r,height:i});case"area":return n(Xi,{data:t,config:e,width:r,height:i});default:return n("div",{className:"chart-unsupported",style:{width:r,height:i},children:[n("p",{children:["Unsupported chart type: ",e.mark]}),n("p",{children:"Showing data as table:"}),n(Ki,{data:t})]})}}function Qi({data:t,config:e,width:r,height:i}){var d,m;const{encoding:s}=e,a=((d=s.x)==null?void 0:d.field)||Object.keys(t[0])[0],c=((m=s.y)==null?void 0:m.field)||Object.keys(t[0])[1],p=Math.max(...t.map(l=>Number(l[c])||0)),u=Math.max(20,(r-100)/t.length-10);return n("div",{className:"chart chart-bar",style:{width:r,height:i},children:[e.title&&n("h4",{className:"chart-title",children:e.title}),n("div",{className:"chart-container",style:{height:i-60},children:n("div",{className:"chart-bars",style:{display:"flex",alignItems:"flex-end",height:"100%",gap:"8px"},children:t.map((l,h)=>{const g=Number(l[c])||0,N=g/p*(i-100);return n("div",{className:"chart-bar-item",style:{textAlign:"center"},children:[n("div",{className:"bar",style:{width:u,height:N,backgroundColor:"#6366f1",borderRadius:"4px 4px 0 0"},title:`${l[a]}: ${g}`}),n("div",{className:"bar-label",style:{fontSize:"12px",marginTop:"4px",maxWidth:u,overflow:"hidden",textOverflow:"ellipsis"},children:String(l[a]).slice(0,10)})]},h)})})}),n("div",{className:"chart-legend",style:{fontSize:"12px",marginTop:"8px",textAlign:"center"},children:[n("strong",{children:c})," by ",n("strong",{children:a})]})]})}function ji({data:t,config:e,width:r,height:i}){var b,_;const{encoding:s}=e,a=((b=s.x)==null?void 0:b.field)||Object.keys(t[0])[0],c=((_=s.y)==null?void 0:_.field)||Object.keys(t[0])[1],p=t.map(f=>Number(f[c])||0),u=Math.max(...p),d=Math.min(...p),m=u-d||1,l=r-80,h=i-100,g=l/(t.length-1||1),N=t.map((f,v)=>{const S=40+v*g,T=Number(f[c])||0,L=h-(T-d)/m*h+20;return{x:S,y:L,value:T,label:f[a]}}),w=N.map((f,v)=>`${v===0?"M":"L"} ${f.x} ${f.y}`).join(" ");return n("div",{className:"chart chart-line",style:{width:r,height:i},children:[e.title&&n("h4",{className:"chart-title",children:e.title}),n("svg",{width:r,height:i-40,style:{overflow:"visible"},children:[[0,.25,.5,.75,1].map(f=>{const v=h-f*h+20,S=d+f*m;return n("g",{children:[n("line",{x1:40,y1:v,x2:r-40,y2:v,stroke:"#e5e7eb",strokeWidth:1}),n("text",{x:10,y:v+4,fontSize:10,fill:"#666",children:S.toFixed(0)})]},f)}),n("path",{d:w,fill:"none",stroke:"#6366f1",strokeWidth:2}),N.map((f,v)=>n("circle",{cx:f.x,cy:f.y,r:4,fill:"#6366f1",children:n("title",{children:`${f.label}: ${f.value}`})},v)),N.map((f,v)=>n("text",{x:f.x,y:h+40,fontSize:10,fill:"#666",textAnchor:"middle",children:String(f.label).slice(0,8)},v))]}),n("div",{className:"chart-legend",style:{fontSize:"12px",textAlign:"center"},children:[n("strong",{children:c})," over ",n("strong",{children:a})]})]})}function Yi({data:t,config:e,width:r,height:i}){var _,f;const{encoding:s}=e,a=((_=s.x)==null?void 0:_.field)||Object.keys(t[0])[0],c=((f=s.y)==null?void 0:f.field)||Object.keys(t[0])[1],p=t.map(v=>Number(v[a])||0),u=t.map(v=>Number(v[c])||0),d=Math.min(...p),m=Math.max(...p),l=Math.min(...u),h=Math.max(...u),g=m-d||1,N=h-l||1,w=r-80,b=i-100;return n("div",{className:"chart chart-scatter",style:{width:r,height:i},children:[e.title&&n("h4",{className:"chart-title",children:e.title}),n("svg",{width:r,height:i-40,children:[[0,.25,.5,.75,1].map(v=>{const S=b-v*b+20;return n("line",{x1:40,y1:S,x2:r-40,y2:S,stroke:"#e5e7eb",strokeWidth:1},v)}),t.map((v,S)=>{const T=Number(v[a])||0,L=Number(v[c])||0,M=40+(T-d)/g*w,O=b-(L-l)/N*b+20;return n("circle",{cx:M,cy:O,r:5,fill:"#6366f1",opacity:.7,children:n("title",{children:`${a}: ${T}, ${c}: ${L}`})},S)})]}),n("div",{className:"chart-legend",style:{fontSize:"12px",textAlign:"center"},children:[n("strong",{children:c})," vs ",n("strong",{children:a})]})]})}function Xi({data:t,config:e,width:r,height:i}){var _,f;const{encoding:s}=e,a=((_=s.x)==null?void 0:_.field)||Object.keys(t[0])[0],c=((f=s.y)==null?void 0:f.field)||Object.keys(t[0])[1],p=t.map(v=>Number(v[c])||0),u=Math.max(...p),d=Math.min(...p),m=u-d||1,l=r-80,h=i-100,g=l/(t.length-1||1),w=t.map((v,S)=>{const T=40+S*g,L=Number(v[c])||0,M=h-(L-d)/m*h+20;return{x:T,y:M}}).map((v,S)=>`${S===0?"M":"L"} ${v.x} ${v.y}`).join(" "),b=`${w} L ${r-40} ${h+20} L 40 ${h+20} Z`;return n("div",{className:"chart chart-area",style:{width:r,height:i},children:[e.title&&n("h4",{className:"chart-title",children:e.title}),n("svg",{width:r,height:i-40,children:[n("path",{d:b,fill:"#6366f1",opacity:.3}),n("path",{d:w,fill:"none",stroke:"#6366f1",strokeWidth:2})]}),n("div",{className:"chart-legend",style:{fontSize:"12px",textAlign:"center"},children:[n("strong",{children:c})," over ",n("strong",{children:a})]})]})}function Ki({data:t}){if(t.length===0)return null;const e=Object.keys(t[0]);return n("table",{className:"data-table",style:{width:"100%",borderCollapse:"collapse",fontSize:"12px"},children:[n("thead",{children:n("tr",{children:e.map(r=>n("th",{style:{borderBottom:"2px solid #ddd",padding:"8px",textAlign:"left"},children:r},r))})}),n("tbody",{children:t.slice(0,10).map((r,i)=>n("tr",{children:e.map(s=>n("td",{style:{borderBottom:"1px solid #eee",padding:"6px"},children:String(r[s])},s))},i))})]})}function nr({dashboards:t}){return t.length===0?n("div",{className:"dashboard-empty",children:n("p",{children:"No dashboards defined"})}):n("div",{className:"dashboard-grid",children:t.map(e=>n(Zi,{dashboard:e},e.name))})}function Zi({dashboard:t}){const[e,r]=k(null),[i,s]=k(!1),[a,c]=k(null);V(()=>{p()},[t.query]);const p=async()=>{s(!0),c(null);try{const m=await Z().query(t.query);r(m)}catch(d){c(String(d)),console.error(`[Dashboard] Failed to load ${t.name}:`,d)}finally{s(!1)}};if(i)return n("div",{className:"dashboard-panel loading",children:[n("div",{className:"spinner"}),n("p",{children:["Loading ",t.name,"..."]})]});if(a)return n("div",{className:"dashboard-panel error",children:[n("h4",{children:t.name}),n("p",{className:"error-message",children:["Error: ",a]}),n("details",{children:[n("summary",{children:"Query"}),n("pre",{children:t.query})]})]});if(!e||e.length===0)return n("div",{className:"dashboard-panel empty",children:[n("h4",{children:t.name}),n("p",{children:"No data"})]});let u=null;if(t.config)try{u=JSON.parse(t.config)}catch(d){console.error(`[Dashboard] Invalid config for ${t.name}:`,d)}return!u||t.grammar!=="vegalite-lite-v1"?n("div",{className:"dashboard-panel table",children:[n("h4",{children:t.name}),n(Ji,{data:e})]}):n("div",{className:"dashboard-panel chart",children:n(Vi,{data:e,config:u,width:600,height:400})})}function Ji({data:t}){const e=Object.keys(t[0]||{});return n("div",{style:{overflowX:"auto"},children:n("table",{className:"dashboard-table",style:{width:"100%",borderCollapse:"collapse",fontSize:"14px"},children:[n("thead",{children:n("tr",{children:e.map(r=>n("th",{style:{borderBottom:"2px solid #ddd",padding:"12px",textAlign:"left",fontWeight:600},children:r},r))})}),n("tbody",{children:t.map((r,i)=>n("tr",{style:{borderBottom:"1px solid #eee"},children:e.map(s=>n("td",{style:{padding:"10px"},children:String(r[s])},s))},i))})]})})}function ea({content:t}){const e=ta(t),r=Gt.sanitize(e,{ALLOWED_TAGS:["h1","h2","h3","h4","h5","h6","p","br","strong","em","code","pre","a","ul","ol","li"],ALLOWED_ATTR:["href"],ALLOW_DATA_ATTR:!1});return n("div",{className:"markdown-content",dangerouslySetInnerHTML:{__html:r}})}function ta(t){let e=t;return e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),e=e.replace(/^### (.*$)/gim,"<h3>$1</h3>"),e=e.replace(/^## (.*$)/gim,"<h2>$1</h2>"),e=e.replace(/^# (.*$)/gim,"<h1>$1</h1>"),e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/\*(.*?)\*/g,"<em>$1</em>"),e=e.replace(/`(.*?)`/g,"<code>$1</code>"),e=e.replace(/\[(.*?)\]\((.*?)\)/g,'<a href="$2">$1</a>'),e=e.replace(/```(.*?)\n([\s\S]*?)```/g,"<pre><code>$2</code></pre>"),e=e.replace(/^\- (.*$)/gim,"<li>$1</li>"),e=e.replace(/(<li>.*<\/li>)/s,"<ul>$1</ul>"),e=e.replace(/^\d+\. (.*$)/gim,"<li>$1</li>"),e=e.split(`

`).map(i=>i.startsWith("<h")||i.startsWith("<ul>")||i.startsWith("<ol>")||i.startsWith("<pre>")||i.startsWith("<li>")?i:`<p>${i}</p>`).join(`
`),e=e.replace(/\n/g,"<br>"),e}function na({context:t}){const[e,r]=k("/");V(()=>{const s=()=>{const a=window.location.hash.slice(1);r(a||"/")};return window.addEventListener("hashchange",s),s(),()=>window.removeEventListener("hashchange",s)},[]);const i=t.pages.find(s=>s.slug===e)||t.pages[0];return i?n(ra,{page:i,context:t}):t.dashboards.length>0?n(er,{config:t.config,children:n(nr,{dashboards:t.dashboards})}):n(tr,{config:t.config,title:"404 Not Found",children:[n("p",{children:["Page not found: ",e]}),n("p",{children:n("a",{href:"#/",children:"Go home"})})]})}function ra({page:t,context:e}){const r=t.layout||"simple",i=t.content?n(ea,{content:t.content}):n("p",{children:"No content"});switch(r){case"landing":return n(Oi,{config:e.config,children:i});case"docs":return n(Pi,{config:e.config,navigation:e.navigation,currentPage:t,children:i});case"dashboard":return n(er,{config:e.config,children:[i,e.dashboards.length>0&&n(nr,{dashboards:e.dashboards})]});case"simple":default:return n(tr,{config:e.config,title:t.title,children:i})}}const ia={mode:"website",bundledCapsule:"/memglyph-demo.mgx.sqlite",branding:{title:"Memglyph",tagline:"Your knowledge, crystallized",logoUrl:"/logo.svg"},features:{llm:{enabled:!0,autoReason:!1,defaultModel:"qwen3-0.6b",maxTokens:256},search:{defaultMode:"hybrid",enabledModes:["fts","hybrid"],showModeToggle:!1},graph:{enabled:!0,maxHops:2,defaultMaxHops:1},upload:{enabled:!1,acceptedExtensions:[]},gcui:{enabled:!0,fallbackToGeneric:!1},pwa:{enabled:!0,offlineMode:!0}},ui:{showLanding:!0,theme:"documentation"}},aa={mode:"viewer",bundledCapsule:"/memglyph-demo.mgx.sqlite",branding:{title:"SQLAR Viewer",tagline:"Query your knowledge capsules",logoUrl:"/sqlar-logo.svg"},features:{llm:{enabled:!0,autoReason:!1,defaultModel:"qwen3-0.6b",maxTokens:256},search:{defaultMode:"hybrid",enabledModes:["fts","hybrid","graph"],showModeToggle:!0},graph:{enabled:!0,maxHops:3,defaultMaxHops:2},upload:{enabled:!0,acceptedExtensions:[".sqlite",".sqlar",".db",".mgx.sqlite"]},gcui:{enabled:!0,fallbackToGeneric:!0},pwa:{enabled:!0,offlineMode:!0}},ui:{showLanding:!1,theme:"tool"}};function sa(){return"website"}function oa(){return sa()==="viewer"?aa:ia}function la(){const t=oa(),[e,r]=k(null),[i,s]=k(null),[a,c]=k(!1),[p,u]=k(null),[d,m]=k(!1);Qn({defaultMode:t.features.search.defaultMode});const l=Zn({autoLoad:!1});return Jn({}),V(()=>{e&&(l.loadEntities(),(async()=>{try{const _=Z(),f=await Bi(_);console.log("[GCUI] Detected capabilities:",f.capabilities),f.capabilities.mode!=="generic"?(s(f),console.log("[GCUI] Rendering in",f.capabilities.mode,"mode")):(console.log("[GCUI] No GCUI tables found, using legacy mode"),s(null))}catch(_){console.warn("[GCUI] Detection failed, using legacy mode:",_),s(null)}})())},[e]),n("div",{className:"app",children:[n("header",{className:"app-header",children:[n("h1",{children:"Glyphcapsule Explorer"}),n("p",{children:"Hybrid Retrieval Demo for MemGlyph"})]}),n("main",{className:"app-main",children:e?i&&t.features.gcui.enabled?n("div",{className:"gcui-mode",children:n(na,{context:i})}):n(Hi,{capsuleInfo:e,onClose:()=>r(null)}):n("div",{className:"welcome",children:[p&&n("div",{className:"error",style:"max-width: 600px; margin: 1rem auto;",children:[n("strong",{children:"Error:"})," ",p]}),n(mi,{onFileSelected:async(b,_)=>{c(!0),u(null);try{const v=await Z().openFromFile(b);r(v),console.log("Capsule opened:",v)}catch(f){u(String(f)),console.error("Failed to open file:",f)}finally{c(!1)}},onOpfsFileSelected:async b=>{c(!0),u(null);try{const f=await Z().openFromOpfs(b);r(f),console.log("Capsule opened from OPFS:",f)}catch(_){u(String(_)),console.error("Failed to open from OPFS:",_)}finally{c(!1)}},onError:b=>{u(b)}}),n("div",{style:"text-align: center; margin-top: 1.5rem;",children:[n("p",{style:"margin-bottom: 0.5rem; opacity: 0.7;",children:"Or try the demo:"}),n("button",{className:"btn-secondary",onClick:async()=>{c(!0),u(null);try{const _=await Z().openDemo();r(_),console.log("Capsule info:",_)}catch(b){u(String(b)),console.error("Failed to open capsule:",b)}finally{c(!1)}},disabled:a,children:a?"Loading Demo...":"Load Demo Capsule"})]})]})}),n("footer",{className:"app-footer",children:n("p",{children:"Built with Preact + SQLite WASM + OPFS"})})]})}vr(n(la,{}),document.getElementById("app"));
