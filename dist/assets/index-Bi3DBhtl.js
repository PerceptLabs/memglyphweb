var Ae=Object.defineProperty;var Ie=(t,e,n)=>e in t?Ae(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var T=(t,e,n)=>Ie(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();var j,b,ke,F,de,xe,Ee,Se,oe,ee,te,H={},Ce=[],Ge=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,z=Array.isArray;function $(t,e){for(var n in e)t[n]=e[n];return t}function le(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function Ue(t,e,n){var s,i,o,a={};for(o in e)o=="key"?s=e[o]:o=="ref"?i=e[o]:a[o]=e[o];if(arguments.length>2&&(a.children=arguments.length>3?j.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(o in t.defaultProps)a[o]===void 0&&(a[o]=t.defaultProps[o]);return I(t,a,s,i,null)}function I(t,e,n,s,i){var o={type:t,props:e,key:n,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++ke,__i:-1,__u:0};return i==null&&b.vnode!=null&&b.vnode(o),o}function D(t){return t.children}function G(t,e){this.props=t,this.context=e}function O(t,e){if(e==null)return t.__?O(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?O(t):null}function Te(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return Te(t)}}function ue(t){(!t.__d&&(t.__d=!0)&&F.push(t)&&!Q.__r++||de!=b.debounceRendering)&&((de=b.debounceRendering)||xe)(Q)}function Q(){for(var t,e,n,s,i,o,a,d=1;F.length;)F.length>d&&F.sort(Ee),t=F.shift(),d=F.length,t.__d&&(n=void 0,s=void 0,i=(s=(e=t).__v).__e,o=[],a=[],e.__P&&((n=$({},s)).__v=s.__v+1,b.vnode&&b.vnode(n),ae(e.__P,n,s,e.__n,e.__P.namespaceURI,32&s.__u?[i]:null,o,i??O(s),!!(32&s.__u),a),n.__v=s.__v,n.__.__k[n.__i]=n,$e(o,n,a),s.__e=s.__=null,n.__e!=i&&Te(n)));Q.__r=0}function Me(t,e,n,s,i,o,a,d,u,c,m){var l,_,p,v,w,y,f,h=s&&s.__k||Ce,g=e.length;for(u=Qe(n,e,h,u,g),l=0;l<g;l++)(p=n.__k[l])!=null&&(_=p.__i==-1?H:h[p.__i]||H,p.__i=l,y=ae(t,p,_,i,o,a,d,u,c,m),v=p.__e,p.ref&&_.ref!=p.ref&&(_.ref&&ce(_.ref,null,p),m.push(p.ref,p.__c||v,p)),w==null&&v!=null&&(w=v),(f=!!(4&p.__u))||_.__k===p.__k?u=Le(p,u,t,f):typeof p.type=="function"&&y!==void 0?u=y:v&&(u=v.nextSibling),p.__u&=-7);return n.__e=w,u}function Qe(t,e,n,s,i){var o,a,d,u,c,m=n.length,l=m,_=0;for(t.__k=new Array(i),o=0;o<i;o++)(a=e[o])!=null&&typeof a!="boolean"&&typeof a!="function"?(u=o+_,(a=t.__k[o]=typeof a=="string"||typeof a=="number"||typeof a=="bigint"||a.constructor==String?I(null,a,null,null,null):z(a)?I(D,{children:a},null,null,null):a.constructor==null&&a.__b>0?I(a.type,a.props,a.key,a.ref?a.ref:null,a.__v):a).__=t,a.__b=t.__b+1,d=null,(c=a.__i=Be(a,n,u,l))!=-1&&(l--,(d=n[c])&&(d.__u|=2)),d==null||d.__v==null?(c==-1&&(i>m?_--:i<m&&_++),typeof a.type!="function"&&(a.__u|=4)):c!=u&&(c==u-1?_--:c==u+1?_++:(c>u?_--:_++,a.__u|=4))):t.__k[o]=null;if(l)for(o=0;o<m;o++)(d=n[o])!=null&&!(2&d.__u)&&(d.__e==s&&(s=O(d)),Re(d,d));return s}function Le(t,e,n,s){var i,o;if(typeof t.type=="function"){for(i=t.__k,o=0;i&&o<i.length;o++)i[o]&&(i[o].__=t,e=Le(i[o],e,n,s));return e}t.__e!=e&&(s&&(e&&t.type&&!e.parentNode&&(e=O(t)),n.insertBefore(t.__e,e||null)),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function Be(t,e,n,s){var i,o,a,d=t.key,u=t.type,c=e[n],m=c!=null&&(2&c.__u)==0;if(c===null&&t.key==null||m&&d==c.key&&u==c.type)return n;if(s>(m?1:0)){for(i=n-1,o=n+1;i>=0||o<e.length;)if((c=e[a=i>=0?i--:o++])!=null&&!(2&c.__u)&&d==c.key&&u==c.type)return a}return-1}function he(t,e,n){e[0]=="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||Ge.test(e)?n:n+"px"}function A(t,e,n,s,i){var o,a;e:if(e=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof s=="string"&&(t.style.cssText=s=""),s)for(e in s)n&&e in n||he(t.style,e,"");if(n)for(e in n)s&&n[e]==s[e]||he(t.style,e,n[e])}else if(e[0]=="o"&&e[1]=="n")o=e!=(e=e.replace(Se,"$1")),a=e.toLowerCase(),e=a in t||e=="onFocusOut"||e=="onFocusIn"?a.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+o]=n,n?s?n.u=s.u:(n.u=oe,t.addEventListener(e,o?te:ee,o)):t.removeEventListener(e,o?te:ee,o);else{if(i=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function _e(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.t==null)e.t=oe++;else if(e.t<n.u)return;return n(b.event?b.event(e):e)}}}function ae(t,e,n,s,i,o,a,d,u,c){var m,l,_,p,v,w,y,f,h,g,N,S,C,M,R,P,Y,L=e.type;if(e.constructor!=null)return null;128&n.__u&&(u=!!(32&n.__u),o=[d=e.__e=n.__e]),(m=b.__b)&&m(e);e:if(typeof L=="function")try{if(f=e.props,h="prototype"in L&&L.prototype.render,g=(m=L.contextType)&&s[m.__c],N=m?g?g.props.value:m.__:s,n.__c?y=(l=e.__c=n.__c).__=l.__E:(h?e.__c=l=new L(f,N):(e.__c=l=new G(f,N),l.constructor=L,l.render=ze),g&&g.sub(l),l.props=f,l.state||(l.state={}),l.context=N,l.__n=s,_=l.__d=!0,l.__h=[],l._sb=[]),h&&l.__s==null&&(l.__s=l.state),h&&L.getDerivedStateFromProps!=null&&(l.__s==l.state&&(l.__s=$({},l.__s)),$(l.__s,L.getDerivedStateFromProps(f,l.__s))),p=l.props,v=l.state,l.__v=e,_)h&&L.getDerivedStateFromProps==null&&l.componentWillMount!=null&&l.componentWillMount(),h&&l.componentDidMount!=null&&l.__h.push(l.componentDidMount);else{if(h&&L.getDerivedStateFromProps==null&&f!==p&&l.componentWillReceiveProps!=null&&l.componentWillReceiveProps(f,N),!l.__e&&l.shouldComponentUpdate!=null&&l.shouldComponentUpdate(f,l.__s,N)===!1||e.__v==n.__v){for(e.__v!=n.__v&&(l.props=f,l.state=l.__s,l.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some(function(q){q&&(q.__=e)}),S=0;S<l._sb.length;S++)l.__h.push(l._sb[S]);l._sb=[],l.__h.length&&a.push(l);break e}l.componentWillUpdate!=null&&l.componentWillUpdate(f,l.__s,N),h&&l.componentDidUpdate!=null&&l.__h.push(function(){l.componentDidUpdate(p,v,w)})}if(l.context=N,l.props=f,l.__P=t,l.__e=!1,C=b.__r,M=0,h){for(l.state=l.__s,l.__d=!1,C&&C(e),m=l.render(l.props,l.state,l.context),R=0;R<l._sb.length;R++)l.__h.push(l._sb[R]);l._sb=[]}else do l.__d=!1,C&&C(e),m=l.render(l.props,l.state,l.context),l.state=l.__s;while(l.__d&&++M<25);l.state=l.__s,l.getChildContext!=null&&(s=$($({},s),l.getChildContext())),h&&!_&&l.getSnapshotBeforeUpdate!=null&&(w=l.getSnapshotBeforeUpdate(p,v)),P=m,m!=null&&m.type===D&&m.key==null&&(P=Fe(m.props.children)),d=Me(t,z(P)?P:[P],e,n,s,i,o,a,d,u,c),l.base=e.__e,e.__u&=-161,l.__h.length&&a.push(l),y&&(l.__E=l.__=null)}catch(q){if(e.__v=null,u||o!=null)if(q.then){for(e.__u|=u?160:128;d&&d.nodeType==8&&d.nextSibling;)d=d.nextSibling;o[o.indexOf(d)]=null,e.__e=d}else{for(Y=o.length;Y--;)le(o[Y]);ne(e)}else e.__e=n.__e,e.__k=n.__k,q.then||ne(e);b.__e(q,e,n)}else o==null&&e.__v==n.__v?(e.__k=n.__k,e.__e=n.__e):d=e.__e=je(n.__e,e,n,s,i,o,a,u,c);return(m=b.diffed)&&m(e),128&e.__u?void 0:d}function ne(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(ne)}function $e(t,e,n){for(var s=0;s<n.length;s++)ce(n[s],n[++s],n[++s]);b.__c&&b.__c(e,t),t.some(function(i){try{t=i.__h,i.__h=[],t.some(function(o){o.call(i)})}catch(o){b.__e(o,i.__v)}})}function Fe(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:z(t)?t.map(Fe):$({},t)}function je(t,e,n,s,i,o,a,d,u){var c,m,l,_,p,v,w,y=n.props,f=e.props,h=e.type;if(h=="svg"?i="http://www.w3.org/2000/svg":h=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),o!=null){for(c=0;c<o.length;c++)if((p=o[c])&&"setAttribute"in p==!!h&&(h?p.localName==h:p.nodeType==3)){t=p,o[c]=null;break}}if(t==null){if(h==null)return document.createTextNode(f);t=document.createElementNS(i,h,f.is&&f),d&&(b.__m&&b.__m(e,o),d=!1),o=null}if(h==null)y===f||d&&t.data==f||(t.data=f);else{if(o=o&&j.call(t.childNodes),y=n.props||H,!d&&o!=null)for(y={},c=0;c<t.attributes.length;c++)y[(p=t.attributes[c]).name]=p.value;for(c in y)if(p=y[c],c!="children"){if(c=="dangerouslySetInnerHTML")l=p;else if(!(c in f)){if(c=="value"&&"defaultValue"in f||c=="checked"&&"defaultChecked"in f)continue;A(t,c,null,p,i)}}for(c in f)p=f[c],c=="children"?_=p:c=="dangerouslySetInnerHTML"?m=p:c=="value"?v=p:c=="checked"?w=p:d&&typeof p!="function"||y[c]===p||A(t,c,p,y[c],i);if(m)d||l&&(m.__html==l.__html||m.__html==t.innerHTML)||(t.innerHTML=m.__html),e.__k=[];else if(l&&(t.innerHTML=""),Me(e.type=="template"?t.content:t,z(_)?_:[_],e,n,s,h=="foreignObject"?"http://www.w3.org/1999/xhtml":i,o,a,o?o[0]:n.__k&&O(n,0),d,u),o!=null)for(c=o.length;c--;)le(o[c]);d||(c="value",h=="progress"&&v==null?t.removeAttribute("value"):v!=null&&(v!==t[c]||h=="progress"&&!v||h=="option"&&v!=y[c])&&A(t,c,v,y[c],i),c="checked",w!=null&&w!=t[c]&&A(t,c,w,y[c],i))}return t}function ce(t,e,n){try{if(typeof t=="function"){var s=typeof t.__u=="function";s&&t.__u(),s&&e==null||(t.__u=t(e))}else t.current=e}catch(i){b.__e(i,n)}}function Re(t,e,n){var s,i;if(b.unmount&&b.unmount(t),(s=t.ref)&&(s.current&&s.current!=t.__e||ce(s,null,e)),(s=t.__c)!=null){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(o){b.__e(o,e)}s.base=s.__P=null}if(s=t.__k)for(i=0;i<s.length;i++)s[i]&&Re(s[i],e,n||typeof t.type!="function");n||le(t.__e),t.__c=t.__=t.__e=void 0}function ze(t,e,n){return this.constructor(t,n)}function Ve(t,e,n){var s,i,o,a;e==document&&(e=document.documentElement),b.__&&b.__(t,e),i=(s=!1)?null:e.__k,o=[],a=[],ae(e,t=e.__k=Ue(D,null,[t]),i||H,H,e.namespaceURI,i?null:e.firstChild?j.call(e.childNodes):null,o,i?i.__e:e.firstChild,s,a),$e(o,t,a)}j=Ce.slice,b={__e:function(t,e,n,s){for(var i,o,a;e=e.__;)if((i=e.__c)&&!i.__)try{if((o=i.constructor)&&o.getDerivedStateFromError!=null&&(i.setState(o.getDerivedStateFromError(t)),a=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(t,s||{}),a=i.__d),a)return i.__E=i}catch(d){t=d}throw t}},ke=0,G.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=$({},this.state),typeof t=="function"&&(t=t($({},n),this.props)),t&&$(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),ue(this))},G.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),ue(this))},G.prototype.render=D,F=[],xe=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Ee=function(t,e){return t.__v.__b-e.__v.__b},Q.__r=0,Se=/(PointerCapture)$|Capture$/i,oe=0,ee=_e(!1),te=_e(!0);var Ye=0;function r(t,e,n,s,i,o){e||(e={});var a,d,u=e;if("ref"in u)for(d in u={},e)d=="ref"?a=e[d]:u[d]=e[d];var c={type:t,props:u,key:n,ref:a,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Ye,__i:-1,__u:0,__source:i,__self:o};if(typeof t=="function"&&(a=t.defaultProps))for(d in a)u[d]===void 0&&(u[d]=a[d]);return b.vnode&&b.vnode(c),c}var B,x,K,pe,re=0,qe=[],E=b,me=E.__b,fe=E.__r,ge=E.diffed,ye=E.__c,ve=E.unmount,be=E.__;function Oe(t,e){E.__h&&E.__h(x,t,re||e),re=0;var n=x.__H||(x.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function k(t){return re=1,Ke(De,t)}function Ke(t,e,n){var s=Oe(B++,2);if(s.t=t,!s.__c&&(s.__=[De(void 0,e),function(d){var u=s.__N?s.__N[0]:s.__[0],c=s.t(u,d);u!==c&&(s.__N=[c,s.__[1]],s.__c.setState({}))}],s.__c=x,!x.__f)){var i=function(d,u,c){if(!s.__c.__H)return!0;var m=s.__c.__H.__.filter(function(_){return!!_.__c});if(m.every(function(_){return!_.__N}))return!o||o.call(this,d,u,c);var l=s.__c.props!==d;return m.forEach(function(_){if(_.__N){var p=_.__[0];_.__=_.__N,_.__N=void 0,p!==_.__[0]&&(l=!0)}}),o&&o.call(this,d,u,c)||l};x.__f=!0;var o=x.shouldComponentUpdate,a=x.componentWillUpdate;x.componentWillUpdate=function(d,u,c){if(this.__e){var m=o;o=void 0,i(d,u,c),o=m}a&&a.call(this,d,u,c)},x.shouldComponentUpdate=i}return s.__N||s.__}function V(t,e){var n=Oe(B++,3);!E.__s&&Ze(n.__H,e)&&(n.__=t,n.u=e,x.__H.__h.push(n))}function Xe(){for(var t;t=qe.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(U),t.__H.__h.forEach(se),t.__H.__h=[]}catch(e){t.__H.__h=[],E.__e(e,t.__v)}}E.__b=function(t){x=null,me&&me(t)},E.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),be&&be(t,e)},E.__r=function(t){fe&&fe(t),B=0;var e=(x=t.__c).__H;e&&(K===x?(e.__h=[],x.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(e.__h.forEach(U),e.__h.forEach(se),e.__h=[],B=0)),K=x},E.diffed=function(t){ge&&ge(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(qe.push(e)!==1&&pe===E.requestAnimationFrame||((pe=E.requestAnimationFrame)||Je)(Xe)),e.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),K=x=null},E.__c=function(t,e){e.some(function(n){try{n.__h.forEach(U),n.__h=n.__h.filter(function(s){return!s.__||se(s)})}catch(s){e.some(function(i){i.__h&&(i.__h=[])}),e=[],E.__e(s,n.__v)}}),ye&&ye(t,e)},E.unmount=function(t){ve&&ve(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(s){try{U(s)}catch(i){e=i}}),n.__H=void 0,e&&E.__e(e,n.__v))};var Ne=typeof requestAnimationFrame=="function";function Je(t){var e,n=function(){clearTimeout(s),Ne&&cancelAnimationFrame(e),setTimeout(t)},s=setTimeout(n,35);Ne&&(e=requestAnimationFrame(n))}function U(t){var e=x,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),x=e}function se(t){var e=x;t.__c=t.__(),x=e}function Ze(t,e){return!t||t.length!==e.length||e.some(function(n,s){return n!==t[s]})}function De(t,e){return typeof e=="function"?e(t):e}const et={maxQueueSize:50,defaultTimeout:1e4,maxTimeout:3e4};class tt{constructor(e={}){T(this,"queue",[]);T(this,"processing",!1);T(this,"nextId",1);T(this,"config");T(this,"stats",{totalProcessed:0,totalTimeouts:0,totalErrors:0});this.config={...et,...e}}async enqueue(e,n){if(this.queue.length>=this.config.maxQueueSize)throw new Error(`Query queue full (${this.config.maxQueueSize} items). Too many pending queries.`);const s=Math.min(n||this.config.defaultTimeout,this.config.maxTimeout);return new Promise((i,o)=>{const a={id:this.nextId++,execute:e,resolve:i,reject:o,timeout:s,enqueuedAt:Date.now()};this.queue.push(a),this.processing||this.processQueue()})}async processQueue(){if(!(this.processing||this.queue.length===0)){for(this.processing=!0;this.queue.length>0;){const e=this.queue.shift();try{await this.executeWithTimeout(e)}catch{}}this.processing=!1}}async executeWithTimeout(e){const n=new Promise((s,i)=>{setTimeout(()=>{i(new Error(`Query ${e.id} timed out after ${e.timeout}ms`))},e.timeout)});try{const s=await Promise.race([e.execute(),n]);this.stats.totalProcessed++,e.resolve(s)}catch(s){s instanceof Error&&s.message.includes("timed out")?(this.stats.totalTimeouts++,console.warn(`[QueryQueue] Query ${e.id} timed out`,{timeout:e.timeout,waitTime:Date.now()-e.enqueuedAt})):this.stats.totalErrors++,e.reject(s)}}getStats(){return{queueLength:this.queue.length,busy:this.processing,totalProcessed:this.stats.totalProcessed,totalTimeouts:this.stats.totalTimeouts,totalErrors:this.stats.totalErrors}}isBusy(){return this.processing||this.queue.length>0}clear(){const e=new Error("Query queue cleared");for(const n of this.queue)n.reject(e);this.queue=[]}get length(){return this.queue.length}}let X=null;function ie(t){return X||(X=new tt(t)),X}function nt(t,e){return ie().enqueue(t,e)}class rt{constructor(){T(this,"worker",null);T(this,"nextId",1);T(this,"pending",new Map);this.initWorker()}initWorker(){this.worker=new Worker(new URL("/assets/sqlite.worker-Bv26vho5.js",import.meta.url),{type:"module"}),this.worker.onmessage=e=>{const n=e.data;if("type"in n&&n.type==="READY"){console.log("[DbClient] Worker ready");return}const{id:s,response:i}=n,o=this.pending.get(s);o&&(this.pending.delete(s),o.resolve(i))},this.worker.onerror=e=>{console.error("[DbClient] Worker error:",e);for(const n of this.pending.values())n.reject(new Error("Worker error"));this.pending.clear()}}async sendRequest(e,n=1e4){if(!this.worker)throw new Error("Worker not initialized");const s=this.nextId++;return nt(async()=>new Promise((i,o)=>{const a=setTimeout(()=>{this.pending.delete(s),o(new Error(`Request ${e.type} timed out after ${n}ms`))},n);this.pending.set(s,{resolve:u=>{clearTimeout(a),u.ok?i(u.data):o(new Error(u.error))},reject:u=>{clearTimeout(a),o(u)},timeout:a});const d={id:s,request:e};this.worker.postMessage(d)}),n)}async openFromFile(e){return this.sendRequest({type:"OPEN_FROM_FILE",file:e})}async openFromOpfs(e){return this.sendRequest({type:"OPEN_FROM_OPFS",path:e})}async openDemo(){return this.sendRequest({type:"OPEN_DEMO"})}async saveToOpfs(e){return this.sendRequest({type:"SAVE_TO_OPFS",path:e})}async removeFromOpfs(e){return this.sendRequest({type:"REMOVE_FROM_OPFS",path:e})}async listOpfsFiles(){return this.sendRequest({type:"LIST_OPFS_FILES"})}async close(){return this.sendRequest({type:"CLOSE"})}async searchFts(e,n=20){return this.sendRequest({type:"FTS_SEARCH",query:e,limit:n})}async searchHybrid(e,n=20,s){return this.sendRequest({type:"HYBRID_SEARCH",query:e,limit:n,weights:s})}async listEntities(e,n=100){return this.sendRequest({type:"LIST_ENTITIES",entityType:e,limit:n})}async getPageList(e=100,n=0){return this.sendRequest({type:"GET_PAGE_LIST",limit:e,offset:n})}async getPageBlob(e){return this.sendRequest({type:"GET_PAGE_BLOB",name:e})}async verifyPage(e){return this.sendRequest({type:"VERIFY_PAGE",gid:e})}async getCheckpoints(){return this.sendRequest({type:"GET_CHECKPOINTS"})}async graphHops(e,n,s,i){return this.sendRequest({type:"GRAPH_HOPS",seedGid:e,predicate:n,maxHops:s,limit:i})}getQueueStats(){return ie().getStats()}isQueueBusy(){return ie().isBusy()}terminate(){this.worker&&(this.worker.terminate(),this.worker=null);for(const e of this.pending.values())clearTimeout(e.timeout),e.reject(new Error("Worker terminated"));this.pending.clear()}}let J=null;function W(){return J||(J=new rt),J}function st(t={}){const{defaultMode:e="hybrid",maxResults:n=10,maxGraphHops:s=2}=t,[i,o]=k(e),[a,d]=k(null),[u,c]=k(""),[m,l]=k(!1),[_,p]=k(null);return{mode:i,results:a,lastQuery:u,loading:m,error:_,search:async f=>{if(f.trim()){l(!0),p(null),c(f);try{const h=W();let g=[];switch(i){case"fts":g=await it(h,f,n);break;case"hybrid":g=await h.searchHybrid(f,n);break;case"graph":g=await ot(h,f,n,s);break;default:throw new Error(`Unknown search mode: ${i}`)}return d(g),console.log(`[Search] ${i} mode: ${g.length} results`),g}catch(h){const g=String(h);return p(g),console.error("[Search] Failed:",h),[]}finally{l(!1)}}},clear:()=>{d(null),c(""),p(null)},changeMode:f=>{o(f),d(null)}}}async function it(t,e,n){return(await t.searchFts(e,n)).map(i=>({gid:i.gid,pageNo:i.pageNo,title:i.title,snippet:i.snippet,scores:{fts:i.score,vector:0,entity:0,graph:0,final:i.score}}))}async function ot(t,e,n,s){const i=await t.searchFts(e,3);if(i.length===0)return[];const o=i[0].gid,a=await t.graphHops(o,void 0,s,n),d=a.nodes.map(u=>{const c=a.distances[u.gid]||0,m=i.find(l=>l.gid===u.gid);return{gid:u.gid,pageNo:u.pageNo,title:u.title,snippet:(m==null?void 0:m.snippet)||null,scores:{fts:(m==null?void 0:m.score)||0,vector:0,entity:0,graph:1/(c+1),final:((m==null?void 0:m.score)||0)*.3+1/(c+1)*.7}}});return d.sort((u,c)=>c.scores.final-u.scores.final),d}function lt({mode:t,onModeChange:e,showToggle:n=!0}){return n?r("div",{className:"search-mode-toggle",children:[r("button",{className:`mode-btn ${t==="fts"?"active":""}`,onClick:()=>e("fts"),children:"ðŸ“ FTS Only"}),r("button",{className:`mode-btn ${t==="hybrid"?"active":""}`,onClick:()=>e("hybrid"),children:"âš¡ Hybrid"}),r("button",{className:`mode-btn ${t==="graph"?"active":""}`,onClick:()=>e("graph"),children:"ðŸ•¸ï¸ Graph"})]}):null}function at({onSearch:t,loading:e,placeholder:n}){return r("form",{onSubmit:s=>{s.preventDefault();const o=new FormData(s.currentTarget).get("query");o!=null&&o.trim()&&t(o.trim())},children:r("div",{className:"search-bar",children:[r("input",{type:"text",name:"query",placeholder:n||"Search the capsule...",className:"search-input",disabled:e}),r("button",{type:"submit",className:"btn-search",disabled:e,children:e?"Searching...":"Search"})]})})}function ct({results:t,query:e}){return r("div",{className:"search-results",children:[r("p",{className:"results-header",children:["Found ",t.length," results for ",r("strong",{children:['"',e,'"']})]}),t.map(n=>r("div",{className:"result-item",children:[r("div",{className:"result-header",children:[r("span",{className:"result-page",children:["Page ",n.pageNo]}),r("span",{className:"result-score",children:["Score: ",n.scores.final.toFixed(3)]})]}),r("h4",{className:"result-title",children:n.title}),n.snippet&&r("p",{className:"result-snippet",dangerouslySetInnerHTML:{__html:n.snippet}}),r("div",{className:"result-scores",children:[r("span",{children:["FTS: ",n.scores.fts.toFixed(2)]}),r("span",{children:["Entity: ",n.scores.entity.toFixed(2)]}),r("span",{children:["Graph: ",n.scores.graph.toFixed(2)]})]})]},n.gid))]})}function dt({mode:t,results:e,lastQuery:n,loading:s,onSearch:i,onModeChange:o,showModeToggle:a=!0,placeholder:d,searchHint:u}){return r("div",{className:"search-section",children:[r("div",{className:"search-header",children:r("h3",{children:"ðŸ” Search"})}),r(lt,{mode:t,onModeChange:o,showToggle:a}),u&&r("p",{className:"search-hint",children:u}),r(at,{onSearch:i,loading:s,placeholder:d}),e&&e.length>0&&r(ct,{results:e,query:n}),e&&e.length===0&&r("div",{className:"no-results",children:[r("p",{children:["No results found for ",r("strong",{children:['"',n,'"']})]}),r("p",{className:"search-hint",children:"Try different keywords or search terms."})]})]})}function ut(t={}){const{autoLoad:e=!0,maxEntities:n=50}=t,[s,i]=k([]),[o,a]=k(null),[d,u]=k(!1),[c,m]=k(null),l=async()=>{u(!0),m(null);try{const h=await W().listEntities(void 0,n);i(h),console.log("[Entities] Loaded:",h.length)}catch(f){const h=String(f);m(h),console.error("[Entities] Failed to load:",f)}finally{u(!1)}};V(()=>{e&&l()},[e]);const _=f=>{a(f)},p=()=>Array.from(new Set(s.map(f=>f.entityType))),v=()=>o?s.filter(f=>f.entityType===o):s,w=f=>s.filter(h=>h.entityType===f).reduce((h,g)=>h+g.count,0),y=()=>s.reduce((f,h)=>f+h.count,0);return{entities:s,selectedType:o,loading:d,error:c,types:p(),filteredEntities:v(),totalCount:y(),loadEntities:l,selectType:_,getTypeCount:w}}function ht({types:t,selectedType:e,totalCount:n,onSelectType:s,getTypeCount:i}){return r("div",{className:"entity-filters",children:[r("button",{className:`entity-filter ${e===null?"active":""}`,onClick:()=>s(null),children:["All (",n,")"]}),t.map(o=>{const a=i(o);return r("button",{className:`entity-filter ${e===o?"active":""}`,onClick:()=>s(o),children:[o," (",a,")"]},o)})]})}function _t({entities:t,maxDisplay:e=20}){const n=t.slice(0,e);return r("div",{className:"entity-list",children:[n.map(s=>r("div",{className:"entity-item",children:[r("span",{className:"entity-type",children:s.entityType}),r("span",{className:"entity-value",children:s.normalizedValue}),r("span",{className:"entity-count",children:s.count})]},`${s.entityType}-${s.normalizedValue}`)),t.length>e&&r("div",{className:"entity-item entity-more",children:r("span",{className:"entity-value",children:["... and ",t.length-e," more"]})})]})}function pt({entities:t,types:e,selectedType:n,totalCount:s,onSelectType:i,getTypeCount:o,show:a=!0,maxDisplay:d=20}){if(!a||t.length===0)return null;const u=n?t.filter(c=>c.entityType===n):t;return r("div",{className:"entity-panel",children:[r("h4",{children:"Filter by Entity Type"}),r(ht,{types:e,selectedType:n,totalCount:s,onSelectType:i,getTypeCount:o}),r(_t,{entities:u,maxDisplay:d})]})}function mt({show:t,entityCount:e,onToggle:n}){return r("button",{className:"btn-secondary btn-entities",onClick:n,children:[t?"Hide":"Show"," Entities (",e,")"]})}class ft{constructor(){T(this,"worker",null);T(this,"nextId",1);T(this,"pending",new Map);T(this,"progressCallback",null);this.initWorker()}initWorker(){this.worker=new Worker(new URL("/assets/llm.worker-DcSBfjIK.js",import.meta.url),{type:"module"}),this.worker.onmessage=e=>{const n=e.data;if("type"in n&&n.type==="READY"){console.log("[LlmClient] Worker ready");return}if("type"in n&&n.type==="PROGRESS"){this.progressCallback&&this.progressCallback(n.data);return}const{id:s,response:i}=n,o=this.pending.get(s);o&&(this.pending.delete(s),o.resolve(i))},this.worker.onerror=e=>{console.error("[LlmClient] Worker error:",e);for(const n of this.pending.values())n.reject(new Error("Worker error"));this.pending.clear()}}async sendRequest(e){if(!this.worker)throw new Error("Worker not initialized");const n=this.nextId++;return new Promise((s,i)=>{this.pending.set(n,{resolve:a=>{a.ok?s(a.data):i(new Error(a.error))},reject:i});const o={id:n,request:e};this.worker.postMessage(o)})}onProgress(e){this.progressCallback=e}async loadModel(e){return this.sendRequest({type:"LOAD_MODEL",modelUrl:e})}async reason(e){return this.sendRequest({type:"REASON",request:e})}async unloadModel(){return this.sendRequest({type:"UNLOAD_MODEL"})}async getStatus(){return this.sendRequest({type:"GET_STATUS"})}terminate(){this.worker&&(this.worker.terminate(),this.worker=null),this.pending.clear(),this.progressCallback=null}}let Z=null;function we(){return Z||(Z=new ft),Z}const gt={"0.6b":"https://huggingface.co/unsloth/Qwen3-0.6B-GGUF/resolve/main/Qwen3-0.6B-Q4_K_M.gguf","1.5b":"https://huggingface.co/ggml-org/Qwen2.5-1.5B-Instruct-GGUF/resolve/main/qwen2.5-1.5b-instruct-q4_k_m.gguf"};function yt(t={}){const[e,n]=k(!1),[s,i]=k(null),[o,a]=k(!1),[d,u]=k(null),[c,m]=k(null),[l,_]=k(null),p=async()=>{a(!0),_(null),u(null);try{const f=we();f.onProgress(g=>{u(g)});const h=await f.loadModel(gt["0.6b"]);i(h),u(null),console.log("[LLM] Model loaded:",h)}catch(f){const h=String(f);_(h),console.error("[LLM] Failed to load model:",f)}finally{a(!1)}};return{enabled:e,modelInfo:s,loading:o,progress:d,reasoning:c,error:l,toggle:async()=>{e?(n(!1),m(null)):(s!=null&&s.loaded||await p(),n(!0))},loadModel:p,reason:async(f,h,g=256)=>{if(!(s!=null&&s.loaded)){console.warn("[LLM] Cannot reason: model not loaded");return}a(!0),_(null);try{const N=we(),S=h.slice(0,5).map(M=>({gid:M.gid,pageNo:M.pageNo,title:M.title,text:M.snippet||"",score:M.scores.final})),C=await N.reason({question:f,snippets:S,maxTokens:g,temperature:.7});m(C),console.log("[LLM] Reasoning complete:",C)}catch(N){const S=String(N);_(S),console.error("[LLM] Reasoning failed:",N)}finally{a(!1)}},clearReasoning:()=>{m(null)}}}function vt({enabled:t,loading:e,modelLoaded:n,progress:s,error:i,onToggle:o}){return r("div",{className:"llm-toggle",children:[r("label",{className:"toggle-label",children:[r("input",{type:"checkbox",checked:t,onChange:o,disabled:e}),r("span",{className:"toggle-text",children:"ðŸ¤– Enable LLM Reasoning (Qwen 3 0.6B)"})]}),n&&r("span",{className:"model-status",children:"âœ… Model loaded"}),s&&r("div",{className:"llm-progress",children:[s.message," (",(s.progress*100).toFixed(0),"%)"]}),i&&r("div",{className:"llm-error",children:["âš ï¸ ",i]})]})}function bt({reasoning:t,searchResults:e,loading:n}){return n&&!t?r("div",{className:"reasoning-loading",children:[r("div",{className:"spinner"}),r("p",{children:"LLM is reasoning..."})]}):t?r("div",{className:"reasoning-output",children:[r("div",{className:"reasoning-header",children:[r("h4",{children:"ðŸ¤– LLM Reasoning"}),r("span",{className:"reasoning-meta",children:[t.inferenceTimeMs.toFixed(0),"ms Â· ",t.tokensGenerated," tokens"]})]}),r("div",{className:"reasoning-answer",children:t.answer}),t.usedSnippets.length>0&&r("div",{className:"reasoning-citations",children:[r("strong",{children:"ðŸ“‘ Cited sources:"}),t.usedSnippets.map(s=>{const i=e==null?void 0:e.find(o=>o.gid===s);return r("span",{className:"citation",children:["Page ",(i==null?void 0:i.pageNo)||"?"]},s)})]})]}):null}async function Nt(t){const n=(await t.query("SELECT name FROM sqlite_master WHERE type='table'")).map(_=>_.name),s=n.includes("_ui_pages"),i=n.includes("_ui_dashboards"),o=n.includes("_ui_navigation"),a=n.includes("_ui_params"),d=n.includes("_meta_manifest"),u=n.includes("sqlar"),c=n.some(_=>_.startsWith("fts_"));let m="1.0";if(d)try{const _=await t.query("SELECT value FROM _meta_manifest WHERE key='gcui'");_.length>0&&(m=_[0].value)}catch(_){console.warn("Failed to read GCUI version:",_)}let l;return s&&i?l="hybrid":s?l="website":i?l="dashboard":l="generic",{version:m,hasWebsite:s,hasDashboards:i,hasNavigation:o,hasParams:a,hasFTS:c,hasAssets:u,mode:l}}async function wt(t){try{const e=await t.query("SELECT key, value FROM _meta_manifest");if(e.length===0)return null;const n={gcui:"1.0",capsule_kind:"sqlar"};return e.forEach(s=>{n[s.key]=s.value}),n}catch(e){return console.warn("Failed to load manifest:",e),null}}async function kt(t){try{const e=await t.query("SELECT key, value FROM _ui_config"),n={};return e.forEach(s=>{n[s.key]=s.value}),n}catch(e){return console.warn("Failed to load config:",e),{}}}async function xt(t){try{return(await t.query("SELECT slug, title, content, layout, category, order_index FROM _ui_pages ORDER BY order_index ASC, slug ASC")).map(n=>({slug:n.slug,title:n.title,content:n.content||void 0,layout:n.layout||void 0,category:n.category||void 0,order_index:n.order_index||void 0}))}catch(e){return console.warn("Failed to load pages:",e),[]}}async function Et(t){try{return(await t.query("SELECT menu, label, to_slug, order_index, icon_asset FROM _ui_navigation ORDER BY menu, order_index ASC")).map(n=>({menu:n.menu,label:n.label,to_slug:n.to_slug,order_index:n.order_index||void 0,icon_asset:n.icon_asset||void 0}))}catch(e){return console.warn("Failed to load navigation:",e),[]}}async function St(t){try{return(await t.query("SELECT name, query, grammar, config FROM _ui_dashboards")).map(n=>({name:n.name,query:n.query,grammar:n.grammar||void 0,config:n.config||void 0}))}catch(e){return console.warn("Failed to load dashboards:",e),[]}}async function Ct(t){const e=await Nt(t),n=await wt(t)||{gcui:e.version,capsule_kind:"sqlar"},s=await kt(t),i=e.hasWebsite?await xt(t):[],o=e.hasNavigation?await Et(t):[],a=e.hasDashboards?await St(t):[];return{manifest:n,capabilities:e,config:s,pages:i,navigation:o,dashboards:a}}function Tt({config:t,children:e}){return r("div",{className:"layout-landing",children:[r("section",{className:"hero",children:[r("div",{className:"hero-content",children:[t.logo_asset&&r("img",{src:t.logo_asset,alt:"Logo",className:"hero-logo"}),r("h1",{className:"hero-title",children:t.hero_title||t.site_title||"Welcome"}),t.hero_subtitle&&r("p",{className:"hero-subtitle",children:t.hero_subtitle})]}),t.hero_image&&r("div",{className:"hero-background",style:{backgroundImage:`url(${t.hero_image})`}})]}),r("main",{className:"landing-main",children:e})]})}function Mt({config:t,navigation:e,currentPage:n,children:s}){const i=e.filter(o=>o.menu==="sidebar");return r("div",{className:"layout-docs",children:[r("aside",{className:"docs-sidebar",children:r("nav",{className:"docs-nav",children:[r("div",{className:"docs-nav-header",children:[t.logo_asset&&r("img",{src:t.logo_asset,alt:"Logo",className:"docs-logo"}),r("h3",{children:t.site_title||"Documentation"})]}),r("ul",{className:"docs-nav-list",children:i.map(o=>r("li",{className:"docs-nav-item",children:r("a",{href:`#${o.to_slug}`,className:(n==null?void 0:n.slug)===o.to_slug?"active":"",children:[o.icon_asset&&r("img",{src:o.icon_asset,alt:"",className:"nav-icon"}),o.label]})},o.to_slug))})]})}),r("main",{className:"docs-main",children:[n&&r("div",{className:"docs-breadcrumbs",children:[r("a",{href:"#/",children:"Home"}),n.category&&r(D,{children:[r("span",{children:" / "}),r("span",{children:n.category})]}),r("span",{children:" / "}),r("span",{children:n.title})]}),r("article",{className:"docs-content",children:[n&&r("h1",{children:n.title}),s]})]})]})}function Pe({config:t,children:e}){return r("div",{className:"layout-dashboard",children:[r("header",{className:"dashboard-header",children:r("h1",{children:t.site_title||"Dashboard"})}),r("main",{className:"dashboard-content",children:e})]})}function He({config:t,title:e,children:n}){return r("div",{className:"layout-simple",children:[r("header",{className:"simple-header",children:[t.logo_asset&&r("img",{src:t.logo_asset,alt:"Logo",className:"simple-logo"}),e&&r("h1",{children:e})]}),r("main",{className:"simple-content",children:n}),r("footer",{className:"simple-footer",children:r("p",{children:"Powered by GlyphCapsule"})})]})}function Lt({data:t,config:e,width:n=600,height:s=400}){if(!t||t.length===0)return r("div",{className:"chart-empty",style:{width:n,height:s},children:r("p",{children:"No data to display"})});switch(e.mark){case"bar":return r($t,{data:t,config:e,width:n,height:s});case"line":return r(Ft,{data:t,config:e,width:n,height:s});case"point":return r(Rt,{data:t,config:e,width:n,height:s});case"area":return r(qt,{data:t,config:e,width:n,height:s});default:return r("div",{className:"chart-unsupported",style:{width:n,height:s},children:[r("p",{children:["Unsupported chart type: ",e.mark]}),r("p",{children:"Showing data as table:"}),r(Ot,{data:t})]})}}function $t({data:t,config:e,width:n,height:s}){var c,m;const{encoding:i}=e,o=((c=i.x)==null?void 0:c.field)||Object.keys(t[0])[0],a=((m=i.y)==null?void 0:m.field)||Object.keys(t[0])[1],d=Math.max(...t.map(l=>Number(l[a])||0)),u=Math.max(20,(n-100)/t.length-10);return r("div",{className:"chart chart-bar",style:{width:n,height:s},children:[e.title&&r("h4",{className:"chart-title",children:e.title}),r("div",{className:"chart-container",style:{height:s-60},children:r("div",{className:"chart-bars",style:{display:"flex",alignItems:"flex-end",height:"100%",gap:"8px"},children:t.map((l,_)=>{const p=Number(l[a])||0,v=p/d*(s-100);return r("div",{className:"chart-bar-item",style:{textAlign:"center"},children:[r("div",{className:"bar",style:{width:u,height:v,backgroundColor:"#6366f1",borderRadius:"4px 4px 0 0"},title:`${l[o]}: ${p}`}),r("div",{className:"bar-label",style:{fontSize:"12px",marginTop:"4px",maxWidth:u,overflow:"hidden",textOverflow:"ellipsis"},children:String(l[o]).slice(0,10)})]},_)})})}),r("div",{className:"chart-legend",style:{fontSize:"12px",marginTop:"8px",textAlign:"center"},children:[r("strong",{children:a})," by ",r("strong",{children:o})]})]})}function Ft({data:t,config:e,width:n,height:s}){var y,f;const{encoding:i}=e,o=((y=i.x)==null?void 0:y.field)||Object.keys(t[0])[0],a=((f=i.y)==null?void 0:f.field)||Object.keys(t[0])[1],d=t.map(h=>Number(h[a])||0),u=Math.max(...d),c=Math.min(...d),m=u-c||1,l=n-80,_=s-100,p=l/(t.length-1||1),v=t.map((h,g)=>{const N=40+g*p,S=Number(h[a])||0,C=_-(S-c)/m*_+20;return{x:N,y:C,value:S,label:h[o]}}),w=v.map((h,g)=>`${g===0?"M":"L"} ${h.x} ${h.y}`).join(" ");return r("div",{className:"chart chart-line",style:{width:n,height:s},children:[e.title&&r("h4",{className:"chart-title",children:e.title}),r("svg",{width:n,height:s-40,style:{overflow:"visible"},children:[[0,.25,.5,.75,1].map(h=>{const g=_-h*_+20,N=c+h*m;return r("g",{children:[r("line",{x1:40,y1:g,x2:n-40,y2:g,stroke:"#e5e7eb",strokeWidth:1}),r("text",{x:10,y:g+4,fontSize:10,fill:"#666",children:N.toFixed(0)})]},h)}),r("path",{d:w,fill:"none",stroke:"#6366f1",strokeWidth:2}),v.map((h,g)=>r("circle",{cx:h.x,cy:h.y,r:4,fill:"#6366f1",children:r("title",{children:`${h.label}: ${h.value}`})},g)),v.map((h,g)=>r("text",{x:h.x,y:_+40,fontSize:10,fill:"#666",textAnchor:"middle",children:String(h.label).slice(0,8)},g))]}),r("div",{className:"chart-legend",style:{fontSize:"12px",textAlign:"center"},children:[r("strong",{children:a})," over ",r("strong",{children:o})]})]})}function Rt({data:t,config:e,width:n,height:s}){var f,h;const{encoding:i}=e,o=((f=i.x)==null?void 0:f.field)||Object.keys(t[0])[0],a=((h=i.y)==null?void 0:h.field)||Object.keys(t[0])[1],d=t.map(g=>Number(g[o])||0),u=t.map(g=>Number(g[a])||0),c=Math.min(...d),m=Math.max(...d),l=Math.min(...u),_=Math.max(...u),p=m-c||1,v=_-l||1,w=n-80,y=s-100;return r("div",{className:"chart chart-scatter",style:{width:n,height:s},children:[e.title&&r("h4",{className:"chart-title",children:e.title}),r("svg",{width:n,height:s-40,children:[[0,.25,.5,.75,1].map(g=>{const N=y-g*y+20;return r("line",{x1:40,y1:N,x2:n-40,y2:N,stroke:"#e5e7eb",strokeWidth:1},g)}),t.map((g,N)=>{const S=Number(g[o])||0,C=Number(g[a])||0,M=40+(S-c)/p*w,R=y-(C-l)/v*y+20;return r("circle",{cx:M,cy:R,r:5,fill:"#6366f1",opacity:.7,children:r("title",{children:`${o}: ${S}, ${a}: ${C}`})},N)})]}),r("div",{className:"chart-legend",style:{fontSize:"12px",textAlign:"center"},children:[r("strong",{children:a})," vs ",r("strong",{children:o})]})]})}function qt({data:t,config:e,width:n,height:s}){var f,h;const{encoding:i}=e,o=((f=i.x)==null?void 0:f.field)||Object.keys(t[0])[0],a=((h=i.y)==null?void 0:h.field)||Object.keys(t[0])[1],d=t.map(g=>Number(g[a])||0),u=Math.max(...d),c=Math.min(...d),m=u-c||1,l=n-80,_=s-100,p=l/(t.length-1||1),w=t.map((g,N)=>{const S=40+N*p,C=Number(g[a])||0,M=_-(C-c)/m*_+20;return{x:S,y:M}}).map((g,N)=>`${N===0?"M":"L"} ${g.x} ${g.y}`).join(" "),y=`${w} L ${n-40} ${_+20} L 40 ${_+20} Z`;return r("div",{className:"chart chart-area",style:{width:n,height:s},children:[e.title&&r("h4",{className:"chart-title",children:e.title}),r("svg",{width:n,height:s-40,children:[r("path",{d:y,fill:"#6366f1",opacity:.3}),r("path",{d:w,fill:"none",stroke:"#6366f1",strokeWidth:2})]}),r("div",{className:"chart-legend",style:{fontSize:"12px",textAlign:"center"},children:[r("strong",{children:a})," over ",r("strong",{children:o})]})]})}function Ot({data:t}){if(t.length===0)return null;const e=Object.keys(t[0]);return r("table",{className:"data-table",style:{width:"100%",borderCollapse:"collapse",fontSize:"12px"},children:[r("thead",{children:r("tr",{children:e.map(n=>r("th",{style:{borderBottom:"2px solid #ddd",padding:"8px",textAlign:"left"},children:n},n))})}),r("tbody",{children:t.slice(0,10).map((n,s)=>r("tr",{children:e.map(i=>r("td",{style:{borderBottom:"1px solid #eee",padding:"6px"},children:String(n[i])},i))},s))})]})}function We({dashboards:t}){return t.length===0?r("div",{className:"dashboard-empty",children:r("p",{children:"No dashboards defined"})}):r("div",{className:"dashboard-grid",children:t.map(e=>r(Dt,{dashboard:e},e.name))})}function Dt({dashboard:t}){const[e,n]=k(null),[s,i]=k(!1),[o,a]=k(null);V(()=>{d()},[t.query]);const d=async()=>{i(!0),a(null);try{const m=await W().query(t.query);n(m)}catch(c){a(String(c)),console.error(`[Dashboard] Failed to load ${t.name}:`,c)}finally{i(!1)}};if(s)return r("div",{className:"dashboard-panel loading",children:[r("div",{className:"spinner"}),r("p",{children:["Loading ",t.name,"..."]})]});if(o)return r("div",{className:"dashboard-panel error",children:[r("h4",{children:t.name}),r("p",{className:"error-message",children:["Error: ",o]}),r("details",{children:[r("summary",{children:"Query"}),r("pre",{children:t.query})]})]});if(!e||e.length===0)return r("div",{className:"dashboard-panel empty",children:[r("h4",{children:t.name}),r("p",{children:"No data"})]});let u=null;if(t.config)try{u=JSON.parse(t.config)}catch(c){console.error(`[Dashboard] Invalid config for ${t.name}:`,c)}return!u||t.grammar!=="vegalite-lite-v1"?r("div",{className:"dashboard-panel table",children:[r("h4",{children:t.name}),r(Pt,{data:e})]}):r("div",{className:"dashboard-panel chart",children:r(Lt,{data:e,config:u,width:600,height:400})})}function Pt({data:t}){const e=Object.keys(t[0]||{});return r("div",{style:{overflowX:"auto"},children:r("table",{className:"dashboard-table",style:{width:"100%",borderCollapse:"collapse",fontSize:"14px"},children:[r("thead",{children:r("tr",{children:e.map(n=>r("th",{style:{borderBottom:"2px solid #ddd",padding:"12px",textAlign:"left",fontWeight:600},children:n},n))})}),r("tbody",{children:t.map((n,s)=>r("tr",{style:{borderBottom:"1px solid #eee"},children:e.map(i=>r("td",{style:{padding:"10px"},children:String(n[i])},i))},s))})]})})}function Ht({content:t}){const e=Wt(t);return r("div",{className:"markdown-content",dangerouslySetInnerHTML:{__html:e}})}function Wt(t){let e=t;return e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),e=e.replace(/^### (.*$)/gim,"<h3>$1</h3>"),e=e.replace(/^## (.*$)/gim,"<h2>$1</h2>"),e=e.replace(/^# (.*$)/gim,"<h1>$1</h1>"),e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/\*(.*?)\*/g,"<em>$1</em>"),e=e.replace(/`(.*?)`/g,"<code>$1</code>"),e=e.replace(/\[(.*?)\]\((.*?)\)/g,'<a href="$2">$1</a>'),e=e.replace(/```(.*?)\n([\s\S]*?)```/g,"<pre><code>$2</code></pre>"),e=e.replace(/^\- (.*$)/gim,"<li>$1</li>"),e=e.replace(/(<li>.*<\/li>)/s,"<ul>$1</ul>"),e=e.replace(/^\d+\. (.*$)/gim,"<li>$1</li>"),e=e.split(`

`).map(s=>s.startsWith("<h")||s.startsWith("<ul>")||s.startsWith("<ol>")||s.startsWith("<pre>")||s.startsWith("<li>")?s:`<p>${s}</p>`).join(`
`),e=e.replace(/\n/g,"<br>"),e}function At({context:t}){const[e,n]=k("/");V(()=>{const i=()=>{const o=window.location.hash.slice(1);n(o||"/")};return window.addEventListener("hashchange",i),i(),()=>window.removeEventListener("hashchange",i)},[]);const s=t.pages.find(i=>i.slug===e)||t.pages[0];return s?r(It,{page:s,context:t}):t.dashboards.length>0?r(Pe,{config:t.config,children:r(We,{dashboards:t.dashboards})}):r(He,{config:t.config,title:"404 Not Found",children:[r("p",{children:["Page not found: ",e]}),r("p",{children:r("a",{href:"#/",children:"Go home"})})]})}function It({page:t,context:e}){const n=t.layout||"simple",s=t.content?r(Ht,{content:t.content}):r("p",{children:"No content"});switch(n){case"landing":return r(Tt,{config:e.config,children:s});case"docs":return r(Mt,{config:e.config,navigation:e.navigation,currentPage:t,children:s});case"dashboard":return r(Pe,{config:e.config,children:[s,e.dashboards.length>0&&r(We,{dashboards:e.dashboards})]});case"simple":default:return r(He,{config:e.config,title:t.title,children:s})}}const Gt={mode:"website",bundledCapsule:"/memglyph-demo.mgx.sqlite",branding:{title:"Memglyph",tagline:"Your knowledge, crystallized",logoUrl:"/logo.svg"},features:{llm:{enabled:!0,autoReason:!1,defaultModel:"qwen3-0.6b",maxTokens:256},search:{defaultMode:"hybrid",enabledModes:["fts","hybrid"],showModeToggle:!1},graph:{enabled:!0,maxHops:2,defaultMaxHops:1},upload:{enabled:!1,acceptedExtensions:[]},gcui:{enabled:!0,fallbackToGeneric:!1},pwa:{enabled:!0,offlineMode:!0}},ui:{showLanding:!0,theme:"documentation"}},Ut={mode:"viewer",bundledCapsule:"/memglyph-demo.mgx.sqlite",branding:{title:"SQLAR Viewer",tagline:"Query your knowledge capsules",logoUrl:"/sqlar-logo.svg"},features:{llm:{enabled:!0,autoReason:!1,defaultModel:"qwen3-0.6b",maxTokens:256},search:{defaultMode:"hybrid",enabledModes:["fts","hybrid","graph"],showModeToggle:!0},graph:{enabled:!0,maxHops:3,defaultMaxHops:2},upload:{enabled:!0,acceptedExtensions:[".sqlite",".sqlar",".db",".mgx.sqlite"]},gcui:{enabled:!0,fallbackToGeneric:!0},pwa:{enabled:!0,offlineMode:!0}},ui:{showLanding:!1,theme:"tool"}};function Qt(){return"website"}function Bt(){return Qt()==="viewer"?Ut:Gt}function jt(){var y;const t=Bt(),[e,n]=k(null),[s,i]=k(null),[o,a]=k(!1),[d,u]=k(null),[c,m]=k(!1),l=st({defaultMode:t.features.search.defaultMode}),_=ut({autoLoad:!1}),p=yt({});V(()=>{e&&(_.loadEntities(),(async()=>{try{const h=W(),g=await Ct(h);console.log("[GCUI] Detected capabilities:",g.capabilities),g.capabilities.mode!=="generic"?(i(g),console.log("[GCUI] Rendering in",g.capabilities.mode,"mode")):(console.log("[GCUI] No GCUI tables found, using legacy mode"),i(null))}catch(h){console.warn("[GCUI] Detection failed, using legacy mode:",h),i(null)}})())},[e]);const v=async()=>{a(!0),u(null);try{const h=await W().openDemo();n(h),console.log("Capsule info:",h)}catch(f){u(String(f)),console.error("Failed to open capsule:",f)}finally{a(!1)}},w=async f=>{e&&(p.clearReasoning(),await l.search(f))};return r("div",{className:"app",children:[r("header",{className:"app-header",children:[r("h1",{children:"Glyphcapsule Explorer"}),r("p",{children:"Hybrid Retrieval Demo for MemGlyph"})]}),r("main",{className:"app-main",children:e?s&&t.features.gcui.enabled?r("div",{className:"gcui-mode",children:r(At,{context:s})}):r("div",{className:"capsule-view",children:[r("div",{className:"capsule-info",children:[r("h2",{children:["ðŸ“¦ ",e.fileName]}),r("dl",{children:[r("dt",{children:"File Size:"}),r("dd",{children:[(e.fileSize/1024).toFixed(1)," KB"]}),r("dt",{children:"Doc ID:"}),r("dd",{children:r("code",{children:[e.docId.slice(0,24),"..."]})}),r("dt",{children:"Pages:"}),r("dd",{children:e.pageCount}),r("dt",{children:"Entities:"}),r("dd",{children:e.entityCount}),r("dt",{children:"Graph Edges:"}),r("dd",{children:e.edgeCount}),e.hasVectors&&r(D,{children:[r("dt",{children:"Vectors:"}),r("dd",{children:["âœ… ",e.vectorModel," (",e.vectorDim,"-dim)"]})]})]}),r(vt,{enabled:p.enabled,loading:p.loading,modelLoaded:((y=p.modelInfo)==null?void 0:y.loaded)||!1,progress:p.progress,error:p.error,onToggle:p.toggle})]}),r("div",{className:"search-section",children:[r("div",{className:"search-header",children:[r("h3",{children:"ðŸ” Search"}),r(mt,{show:c,entityCount:_.entities.length,onToggle:()=>m(!c)})]}),r(dt,{mode:l.mode,results:l.results,lastQuery:l.lastQuery,loading:l.loading||o,onSearch:w,onModeChange:l.changeMode,showModeToggle:t.features.search.showModeToggle,placeholder:"Search the capsule...",searchHint:'Try searching: "vector search", "LEANN", "SQLite", or "hybrid retrieval"'}),r(pt,{entities:_.entities,types:_.types,selectedType:_.selectedType,totalCount:_.totalCount,onSelectType:_.selectType,getTypeCount:_.getTypeCount,show:c,maxDisplay:20}),p.reasoning&&r(bt,{reasoning:p.reasoning,searchResults:l.results,loading:p.loading}),p.loading&&!p.reasoning&&r("div",{className:"reasoning-loading",children:[r("div",{className:"spinner"}),r("p",{children:"LLM is reasoning..."})]})]})]}):r("div",{className:"welcome",children:[r("h2",{children:"Welcome!"}),r("p",{children:"This is an offline-capable PWA for exploring MemGlyph Glyphcapsules with hybrid retrieval (FTS + Vector + Entity + Graph)."}),r("p",{children:[r("strong",{children:"Demo capsule:"})," memglyph-demo.mgx.sqlite",r("br",{}),"(8 pages, 25 entities, 11 edges, 384-dim vectors)"]}),d&&r("div",{className:"error",children:[r("strong",{children:"Error:"})," ",d]}),r("button",{className:"btn-primary",onClick:v,disabled:o,children:o?"Opening...":"Open Demo Capsule"})]})}),r("footer",{className:"app-footer",children:r("p",{children:"Built with Preact + SQLite WASM + OPFS"})})]})}Ve(r(jt,{}),document.getElementById("app"));
