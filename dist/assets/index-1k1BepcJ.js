var De=Object.defineProperty;var $e=(t,e,n)=>e in t?De(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var R=(t,e,n)=>$e(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();var Q,m,be,P,le,we,ke,Ne,ne,J,X,$={},Ee=[],qe=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,z=Array.isArray;function L(t,e){for(var n in e)t[n]=e[n];return t}function re(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function Ae(t,e,n){var r,s,o,a={};for(o in e)o=="key"?r=e[o]:o=="ref"?s=e[o]:a[o]=e[o];if(arguments.length>2&&(a.children=arguments.length>3?Q.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(o in t.defaultProps)a[o]===void 0&&(a[o]=t.defaultProps[o]);return G(t,a,r,s,null)}function G(t,e,n,r,s){var o={type:t,props:e,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:s??++be,__i:-1,__u:0};return s==null&&m.vnode!=null&&m.vnode(o),o}function q(t){return t.children}function I(t,e){this.props=t,this.context=e}function H(t,e){if(e==null)return t.__?H(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?H(t):null}function Se(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return Se(t)}}function ae(t){(!t.__d&&(t.__d=!0)&&P.push(t)&&!U.__r++||le!=m.debounceRendering)&&((le=m.debounceRendering)||we)(U)}function U(){for(var t,e,n,r,s,o,a,_=1;P.length;)P.length>_&&P.sort(ke),t=P.shift(),_=P.length,t.__d&&(n=void 0,r=void 0,s=(r=(e=t).__v).__e,o=[],a=[],e.__P&&((n=L({},r)).__v=r.__v+1,m.vnode&&m.vnode(n),oe(e.__P,n,r,e.__n,e.__P.namespaceURI,32&r.__u?[s]:null,o,s??H(r),!!(32&r.__u),a),n.__v=r.__v,n.__.__k[n.__i]=n,Me(o,n,a),r.__e=r.__=null,n.__e!=s&&Se(n)));U.__r=0}function Ce(t,e,n,r,s,o,a,_,d,c,u){var i,g,p,y,w,v,h,f=r&&r.__k||Ee,b=e.length;for(d=Oe(n,e,f,d,b),i=0;i<b;i++)(p=n.__k[i])!=null&&(g=p.__i==-1?$:f[p.__i]||$,p.__i=i,v=oe(t,p,g,s,o,a,_,d,c,u),y=p.__e,p.ref&&g.ref!=p.ref&&(g.ref&&se(g.ref,null,p),u.push(p.ref,p.__c||y,p)),w==null&&y!=null&&(w=y),(h=!!(4&p.__u))||g.__k===p.__k?d=Le(p,d,t,h):typeof p.type=="function"&&v!==void 0?d=v:y&&(d=y.nextSibling),p.__u&=-7);return n.__e=w,d}function Oe(t,e,n,r,s){var o,a,_,d,c,u=n.length,i=u,g=0;for(t.__k=new Array(s),o=0;o<s;o++)(a=e[o])!=null&&typeof a!="boolean"&&typeof a!="function"?(d=o+g,(a=t.__k[o]=typeof a=="string"||typeof a=="number"||typeof a=="bigint"||a.constructor==String?G(null,a,null,null,null):z(a)?G(q,{children:a},null,null,null):a.constructor==null&&a.__b>0?G(a.type,a.props,a.key,a.ref?a.ref:null,a.__v):a).__=t,a.__b=t.__b+1,_=null,(c=a.__i=Ge(a,n,d,i))!=-1&&(i--,(_=n[c])&&(_.__u|=2)),_==null||_.__v==null?(c==-1&&(s>u?g--:s<u&&g++),typeof a.type!="function"&&(a.__u|=4)):c!=d&&(c==d-1?g--:c==d+1?g++:(c>d?g--:g++,a.__u|=4))):t.__k[o]=null;if(i)for(o=0;o<u;o++)(_=n[o])!=null&&!(2&_.__u)&&(_.__e==r&&(r=H(_)),xe(_,_));return r}function Le(t,e,n,r){var s,o;if(typeof t.type=="function"){for(s=t.__k,o=0;s&&o<s.length;o++)s[o]&&(s[o].__=t,e=Le(s[o],e,n,r));return e}t.__e!=e&&(r&&(e&&t.type&&!e.parentNode&&(e=H(t)),n.insertBefore(t.__e,e||null)),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function Ge(t,e,n,r){var s,o,a,_=t.key,d=t.type,c=e[n],u=c!=null&&(2&c.__u)==0;if(c===null&&t.key==null||u&&_==c.key&&d==c.type)return n;if(r>(u?1:0)){for(s=n-1,o=n+1;s>=0||o<e.length;)if((c=e[a=s>=0?s--:o++])!=null&&!(2&c.__u)&&_==c.key&&d==c.type)return a}return-1}function ce(t,e,n){e[0]=="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||qe.test(e)?n:n+"px"}function O(t,e,n,r,s){var o,a;e:if(e=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof r=="string"&&(t.style.cssText=r=""),r)for(e in r)n&&e in n||ce(t.style,e,"");if(n)for(e in n)r&&n[e]==r[e]||ce(t.style,e,n[e])}else if(e[0]=="o"&&e[1]=="n")o=e!=(e=e.replace(Ne,"$1")),a=e.toLowerCase(),e=a in t||e=="onFocusOut"||e=="onFocusIn"?a.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+o]=n,n?r?n.u=r.u:(n.u=ne,t.addEventListener(e,o?X:J,o)):t.removeEventListener(e,o?X:J,o);else{if(s=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function _e(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.t==null)e.t=ne++;else if(e.t<n.u)return;return n(m.event?m.event(e):e)}}}function oe(t,e,n,r,s,o,a,_,d,c){var u,i,g,p,y,w,v,h,f,b,S,M,T,x,A,D,V,C=e.type;if(e.constructor!=null)return null;128&n.__u&&(d=!!(32&n.__u),o=[_=e.__e=n.__e]),(u=m.__b)&&u(e);e:if(typeof C=="function")try{if(h=e.props,f="prototype"in C&&C.prototype.render,b=(u=C.contextType)&&r[u.__c],S=u?b?b.props.value:u.__:r,n.__c?v=(i=e.__c=n.__c).__=i.__E:(f?e.__c=i=new C(h,S):(e.__c=i=new I(h,S),i.constructor=C,i.render=We),b&&b.sub(i),i.props=h,i.state||(i.state={}),i.context=S,i.__n=r,g=i.__d=!0,i.__h=[],i._sb=[]),f&&i.__s==null&&(i.__s=i.state),f&&C.getDerivedStateFromProps!=null&&(i.__s==i.state&&(i.__s=L({},i.__s)),L(i.__s,C.getDerivedStateFromProps(h,i.__s))),p=i.props,y=i.state,i.__v=e,g)f&&C.getDerivedStateFromProps==null&&i.componentWillMount!=null&&i.componentWillMount(),f&&i.componentDidMount!=null&&i.__h.push(i.componentDidMount);else{if(f&&C.getDerivedStateFromProps==null&&h!==p&&i.componentWillReceiveProps!=null&&i.componentWillReceiveProps(h,S),!i.__e&&i.shouldComponentUpdate!=null&&i.shouldComponentUpdate(h,i.__s,S)===!1||e.__v==n.__v){for(e.__v!=n.__v&&(i.props=h,i.state=i.__s,i.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some(function(F){F&&(F.__=e)}),M=0;M<i._sb.length;M++)i.__h.push(i._sb[M]);i._sb=[],i.__h.length&&a.push(i);break e}i.componentWillUpdate!=null&&i.componentWillUpdate(h,i.__s,S),f&&i.componentDidUpdate!=null&&i.__h.push(function(){i.componentDidUpdate(p,y,w)})}if(i.context=S,i.props=h,i.__P=t,i.__e=!1,T=m.__r,x=0,f){for(i.state=i.__s,i.__d=!1,T&&T(e),u=i.render(i.props,i.state,i.context),A=0;A<i._sb.length;A++)i.__h.push(i._sb[A]);i._sb=[]}else do i.__d=!1,T&&T(e),u=i.render(i.props,i.state,i.context),i.state=i.__s;while(i.__d&&++x<25);i.state=i.__s,i.getChildContext!=null&&(r=L(L({},r),i.getChildContext())),f&&!g&&i.getSnapshotBeforeUpdate!=null&&(w=i.getSnapshotBeforeUpdate(p,y)),D=u,u!=null&&u.type===q&&u.key==null&&(D=Te(u.props.children)),_=Ce(t,z(D)?D:[D],e,n,r,s,o,a,_,d,c),i.base=e.__e,e.__u&=-161,i.__h.length&&a.push(i),v&&(i.__E=i.__=null)}catch(F){if(e.__v=null,d||o!=null)if(F.then){for(e.__u|=d?160:128;_&&_.nodeType==8&&_.nextSibling;)_=_.nextSibling;o[o.indexOf(_)]=null,e.__e=_}else{for(V=o.length;V--;)re(o[V]);Z(e)}else e.__e=n.__e,e.__k=n.__k,F.then||Z(e);m.__e(F,e,n)}else o==null&&e.__v==n.__v?(e.__k=n.__k,e.__e=n.__e):_=e.__e=Ie(n.__e,e,n,r,s,o,a,d,c);return(u=m.diffed)&&u(e),128&e.__u?void 0:_}function Z(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(Z)}function Me(t,e,n){for(var r=0;r<n.length;r++)se(n[r],n[++r],n[++r]);m.__c&&m.__c(e,t),t.some(function(s){try{t=s.__h,s.__h=[],t.some(function(o){o.call(s)})}catch(o){m.__e(o,s.__v)}})}function Te(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:z(t)?t.map(Te):L({},t)}function Ie(t,e,n,r,s,o,a,_,d){var c,u,i,g,p,y,w,v=n.props,h=e.props,f=e.type;if(f=="svg"?s="http://www.w3.org/2000/svg":f=="math"?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),o!=null){for(c=0;c<o.length;c++)if((p=o[c])&&"setAttribute"in p==!!f&&(f?p.localName==f:p.nodeType==3)){t=p,o[c]=null;break}}if(t==null){if(f==null)return document.createTextNode(h);t=document.createElementNS(s,f,h.is&&h),_&&(m.__m&&m.__m(e,o),_=!1),o=null}if(f==null)v===h||_&&t.data==h||(t.data=h);else{if(o=o&&Q.call(t.childNodes),v=n.props||$,!_&&o!=null)for(v={},c=0;c<t.attributes.length;c++)v[(p=t.attributes[c]).name]=p.value;for(c in v)if(p=v[c],c!="children"){if(c=="dangerouslySetInnerHTML")i=p;else if(!(c in h)){if(c=="value"&&"defaultValue"in h||c=="checked"&&"defaultChecked"in h)continue;O(t,c,null,p,s)}}for(c in h)p=h[c],c=="children"?g=p:c=="dangerouslySetInnerHTML"?u=p:c=="value"?y=p:c=="checked"?w=p:_&&typeof p!="function"||v[c]===p||O(t,c,p,v[c],s);if(u)_||i&&(u.__html==i.__html||u.__html==t.innerHTML)||(t.innerHTML=u.__html),e.__k=[];else if(i&&(t.innerHTML=""),Ce(e.type=="template"?t.content:t,z(g)?g:[g],e,n,r,f=="foreignObject"?"http://www.w3.org/1999/xhtml":s,o,a,o?o[0]:n.__k&&H(n,0),_,d),o!=null)for(c=o.length;c--;)re(o[c]);_||(c="value",f=="progress"&&y==null?t.removeAttribute("value"):y!=null&&(y!==t[c]||f=="progress"&&!y||f=="option"&&y!=v[c])&&O(t,c,y,v[c],s),c="checked",w!=null&&w!=t[c]&&O(t,c,w,v[c],s))}return t}function se(t,e,n){try{if(typeof t=="function"){var r=typeof t.__u=="function";r&&t.__u(),r&&e==null||(t.__u=t(e))}else t.current=e}catch(s){m.__e(s,n)}}function xe(t,e,n){var r,s;if(m.unmount&&m.unmount(t),(r=t.ref)&&(r.current&&r.current!=t.__e||se(r,null,e)),(r=t.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(o){m.__e(o,e)}r.base=r.__P=null}if(r=t.__k)for(s=0;s<r.length;s++)r[s]&&xe(r[s],e,n||typeof t.type!="function");n||re(t.__e),t.__c=t.__=t.__e=void 0}function We(t,e,n){return this.constructor(t,n)}function Ue(t,e,n){var r,s,o,a;e==document&&(e=document.documentElement),m.__&&m.__(t,e),s=(r=!1)?null:e.__k,o=[],a=[],oe(e,t=e.__k=Ae(q,null,[t]),s||$,$,e.namespaceURI,s?null:e.firstChild?Q.call(e.childNodes):null,o,s?s.__e:e.firstChild,r,a),Me(o,t,a)}Q=Ee.slice,m={__e:function(t,e,n,r){for(var s,o,a;e=e.__;)if((s=e.__c)&&!s.__)try{if((o=s.constructor)&&o.getDerivedStateFromError!=null&&(s.setState(o.getDerivedStateFromError(t)),a=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(t,r||{}),a=s.__d),a)return s.__E=s}catch(_){t=_}throw t}},be=0,I.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=L({},this.state),typeof t=="function"&&(t=t(L({},n),this.props)),t&&L(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),ae(this))},I.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),ae(this))},I.prototype.render=q,P=[],we=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,ke=function(t,e){return t.__v.__b-e.__v.__b},U.__r=0,Ne=/(PointerCapture)$|Capture$/i,ne=0,J=_e(!1),X=_e(!0);var Be=0;function l(t,e,n,r,s,o){e||(e={});var a,_,d=e;if("ref"in d)for(_ in d={},e)_=="ref"?a=e[_]:d[_]=e[_];var c={type:t,props:d,key:n,ref:a,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Be,__i:-1,__u:0,__source:s,__self:o};if(typeof t=="function"&&(a=t.defaultProps))for(_ in a)d[_]===void 0&&(d[_]=a[_]);return m.vnode&&m.vnode(c),c}var B,k,j,de,ee=0,Re=[],N=m,ue=N.__b,he=N.__r,pe=N.diffed,fe=N.__c,ge=N.unmount,me=N.__;function Pe(t,e){N.__h&&N.__h(k,t,ee||e),ee=0;var n=k.__H||(k.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function E(t){return ee=1,Qe(He,t)}function Qe(t,e,n){var r=Pe(B++,2);if(r.t=t,!r.__c&&(r.__=[He(void 0,e),function(_){var d=r.__N?r.__N[0]:r.__[0],c=r.t(d,_);d!==c&&(r.__N=[c,r.__[1]],r.__c.setState({}))}],r.__c=k,!k.__f)){var s=function(_,d,c){if(!r.__c.__H)return!0;var u=r.__c.__H.__.filter(function(g){return!!g.__c});if(u.every(function(g){return!g.__N}))return!o||o.call(this,_,d,c);var i=r.__c.props!==_;return u.forEach(function(g){if(g.__N){var p=g.__[0];g.__=g.__N,g.__N=void 0,p!==g.__[0]&&(i=!0)}}),o&&o.call(this,_,d,c)||i};k.__f=!0;var o=k.shouldComponentUpdate,a=k.componentWillUpdate;k.componentWillUpdate=function(_,d,c){if(this.__e){var u=o;o=void 0,s(_,d,c),o=u}a&&a.call(this,_,d,c)},k.shouldComponentUpdate=s}return r.__N||r.__}function Fe(t,e){var n=Pe(B++,3);!N.__s&&je(n.__H,e)&&(n.__=t,n.u=e,k.__H.__h.push(n))}function ze(){for(var t;t=Re.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(W),t.__H.__h.forEach(te),t.__H.__h=[]}catch(e){t.__H.__h=[],N.__e(e,t.__v)}}N.__b=function(t){k=null,ue&&ue(t)},N.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),me&&me(t,e)},N.__r=function(t){he&&he(t),B=0;var e=(k=t.__c).__H;e&&(j===k?(e.__h=[],k.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(e.__h.forEach(W),e.__h.forEach(te),e.__h=[],B=0)),j=k},N.diffed=function(t){pe&&pe(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(Re.push(e)!==1&&de===N.requestAnimationFrame||((de=N.requestAnimationFrame)||Ve)(ze)),e.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),j=k=null},N.__c=function(t,e){e.some(function(n){try{n.__h.forEach(W),n.__h=n.__h.filter(function(r){return!r.__||te(r)})}catch(r){e.some(function(s){s.__h&&(s.__h=[])}),e=[],N.__e(r,n.__v)}}),fe&&fe(t,e)},N.unmount=function(t){ge&&ge(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(r){try{W(r)}catch(s){e=s}}),n.__H=void 0,e&&N.__e(e,n.__v))};var ye=typeof requestAnimationFrame=="function";function Ve(t){var e,n=function(){clearTimeout(r),ye&&cancelAnimationFrame(e),setTimeout(t)},r=setTimeout(n,35);ye&&(e=requestAnimationFrame(n))}function W(t){var e=k,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),k=e}function te(t){var e=k;t.__c=t.__(),k=e}function je(t,e){return!t||t.length!==e.length||e.some(function(n,r){return n!==t[r]})}function He(t,e){return typeof e=="function"?e(t):e}class Ke{constructor(){R(this,"worker",null);R(this,"nextId",1);R(this,"pending",new Map);this.initWorker()}initWorker(){this.worker=new Worker(new URL("/assets/sqlite.worker-_OtizGaN.js",import.meta.url),{type:"module"}),this.worker.onmessage=e=>{const n=e.data;if("type"in n&&n.type==="READY"){console.log("[DbClient] Worker ready");return}const{id:r,response:s}=n,o=this.pending.get(r);o&&(this.pending.delete(r),o.resolve(s))},this.worker.onerror=e=>{console.error("[DbClient] Worker error:",e);for(const n of this.pending.values())n.reject(new Error("Worker error"));this.pending.clear()}}async sendRequest(e){if(!this.worker)throw new Error("Worker not initialized");const n=this.nextId++;return new Promise((r,s)=>{this.pending.set(n,{resolve:a=>{a.ok?r(a.data):s(new Error(a.error))},reject:s});const o={id:n,request:e};this.worker.postMessage(o)})}async openFromFile(e){return this.sendRequest({type:"OPEN_FROM_FILE",file:e})}async openDemo(){return this.sendRequest({type:"OPEN_DEMO"})}async close(){return this.sendRequest({type:"CLOSE"})}async searchFts(e,n=20){return this.sendRequest({type:"FTS_SEARCH",query:e,limit:n})}async searchHybrid(e,n=20,r){return this.sendRequest({type:"HYBRID_SEARCH",query:e,limit:n,weights:r})}async listEntities(e,n=100){return this.sendRequest({type:"LIST_ENTITIES",entityType:e,limit:n})}async getPageList(e=100,n=0){return this.sendRequest({type:"GET_PAGE_LIST",limit:e,offset:n})}async getPageBlob(e){return this.sendRequest({type:"GET_PAGE_BLOB",name:e})}async verifyPage(e){return this.sendRequest({type:"VERIFY_PAGE",gid:e})}async getCheckpoints(){return this.sendRequest({type:"GET_CHECKPOINTS"})}async graphHops(e,n,r,s){return this.sendRequest({type:"GRAPH_HOPS",seedGid:e,predicate:n,maxHops:r,limit:s})}terminate(){this.worker&&(this.worker.terminate(),this.worker=null),this.pending.clear()}}let K=null;function ie(){return K||(K=new Ke),K}function Ye(t={}){const{defaultMode:e="hybrid",maxResults:n=10,maxGraphHops:r=2}=t,[s,o]=E(e),[a,_]=E(null),[d,c]=E(""),[u,i]=E(!1),[g,p]=E(null);return{mode:s,results:a,lastQuery:d,loading:u,error:g,search:async h=>{if(h.trim()){i(!0),p(null),c(h);try{const f=ie();let b=[];switch(s){case"fts":b=await Je(f,h,n);break;case"hybrid":b=await f.searchHybrid(h,n);break;case"graph":b=await Xe(f,h,n,r);break;default:throw new Error(`Unknown search mode: ${s}`)}return _(b),console.log(`[Search] ${s} mode: ${b.length} results`),b}catch(f){const b=String(f);return p(b),console.error("[Search] Failed:",f),[]}finally{i(!1)}}},clear:()=>{_(null),c(""),p(null)},changeMode:h=>{o(h),_(null)}}}async function Je(t,e,n){return(await t.searchFts(e,n)).map(s=>({gid:s.gid,pageNo:s.pageNo,title:s.title,snippet:s.snippet,scores:{fts:s.score,vector:0,entity:0,graph:0,final:s.score}}))}async function Xe(t,e,n,r){const s=await t.searchFts(e,3);if(s.length===0)return[];const o=s[0].gid,a=await t.graphHops(o,void 0,r,n),_=a.nodes.map(d=>{const c=a.distances[d.gid]||0,u=s.find(i=>i.gid===d.gid);return{gid:d.gid,pageNo:d.pageNo,title:d.title,snippet:(u==null?void 0:u.snippet)||null,scores:{fts:(u==null?void 0:u.score)||0,vector:0,entity:0,graph:1/(c+1),final:((u==null?void 0:u.score)||0)*.3+1/(c+1)*.7}}});return _.sort((d,c)=>c.scores.final-d.scores.final),_}function Ze({mode:t,onModeChange:e,showToggle:n=!0}){return n?l("div",{className:"search-mode-toggle",children:[l("button",{className:`mode-btn ${t==="fts"?"active":""}`,onClick:()=>e("fts"),children:"ðŸ“ FTS Only"}),l("button",{className:`mode-btn ${t==="hybrid"?"active":""}`,onClick:()=>e("hybrid"),children:"âš¡ Hybrid"}),l("button",{className:`mode-btn ${t==="graph"?"active":""}`,onClick:()=>e("graph"),children:"ðŸ•¸ï¸ Graph"})]}):null}function et({onSearch:t,loading:e,placeholder:n}){return l("form",{onSubmit:r=>{r.preventDefault();const o=new FormData(r.currentTarget).get("query");o!=null&&o.trim()&&t(o.trim())},children:l("div",{className:"search-bar",children:[l("input",{type:"text",name:"query",placeholder:n||"Search the capsule...",className:"search-input",disabled:e}),l("button",{type:"submit",className:"btn-search",disabled:e,children:e?"Searching...":"Search"})]})})}function tt({results:t,query:e}){return l("div",{className:"search-results",children:[l("p",{className:"results-header",children:["Found ",t.length," results for ",l("strong",{children:['"',e,'"']})]}),t.map(n=>l("div",{className:"result-item",children:[l("div",{className:"result-header",children:[l("span",{className:"result-page",children:["Page ",n.pageNo]}),l("span",{className:"result-score",children:["Score: ",n.scores.final.toFixed(3)]})]}),l("h4",{className:"result-title",children:n.title}),n.snippet&&l("p",{className:"result-snippet",dangerouslySetInnerHTML:{__html:n.snippet}}),l("div",{className:"result-scores",children:[l("span",{children:["FTS: ",n.scores.fts.toFixed(2)]}),l("span",{children:["Entity: ",n.scores.entity.toFixed(2)]}),l("span",{children:["Graph: ",n.scores.graph.toFixed(2)]})]})]},n.gid))]})}function nt({mode:t,results:e,lastQuery:n,loading:r,onSearch:s,onModeChange:o,showModeToggle:a=!0,placeholder:_,searchHint:d}){return l("div",{className:"search-section",children:[l("div",{className:"search-header",children:l("h3",{children:"ðŸ” Search"})}),l(Ze,{mode:t,onModeChange:o,showToggle:a}),d&&l("p",{className:"search-hint",children:d}),l(et,{onSearch:s,loading:r,placeholder:_}),e&&e.length>0&&l(tt,{results:e,query:n}),e&&e.length===0&&l("div",{className:"no-results",children:[l("p",{children:["No results found for ",l("strong",{children:['"',n,'"']})]}),l("p",{className:"search-hint",children:"Try different keywords or search terms."})]})]})}function rt(t={}){const{autoLoad:e=!0,maxEntities:n=50}=t,[r,s]=E([]),[o,a]=E(null),[_,d]=E(!1),[c,u]=E(null),i=async()=>{d(!0),u(null);try{const f=await ie().listEntities(void 0,n);s(f),console.log("[Entities] Loaded:",f.length)}catch(h){const f=String(h);u(f),console.error("[Entities] Failed to load:",h)}finally{d(!1)}};Fe(()=>{e&&i()},[e]);const g=h=>{a(h)},p=()=>Array.from(new Set(r.map(h=>h.entityType))),y=()=>o?r.filter(h=>h.entityType===o):r,w=h=>r.filter(f=>f.entityType===h).reduce((f,b)=>f+b.count,0),v=()=>r.reduce((h,f)=>h+f.count,0);return{entities:r,selectedType:o,loading:_,error:c,types:p(),filteredEntities:y(),totalCount:v(),loadEntities:i,selectType:g,getTypeCount:w}}function ot({types:t,selectedType:e,totalCount:n,onSelectType:r,getTypeCount:s}){return l("div",{className:"entity-filters",children:[l("button",{className:`entity-filter ${e===null?"active":""}`,onClick:()=>r(null),children:["All (",n,")"]}),t.map(o=>{const a=s(o);return l("button",{className:`entity-filter ${e===o?"active":""}`,onClick:()=>r(o),children:[o," (",a,")"]},o)})]})}function st({entities:t,maxDisplay:e=20}){const n=t.slice(0,e);return l("div",{className:"entity-list",children:[n.map(r=>l("div",{className:"entity-item",children:[l("span",{className:"entity-type",children:r.entityType}),l("span",{className:"entity-value",children:r.normalizedValue}),l("span",{className:"entity-count",children:r.count})]},`${r.entityType}-${r.normalizedValue}`)),t.length>e&&l("div",{className:"entity-item entity-more",children:l("span",{className:"entity-value",children:["... and ",t.length-e," more"]})})]})}function it({entities:t,types:e,selectedType:n,totalCount:r,onSelectType:s,getTypeCount:o,show:a=!0,maxDisplay:_=20}){if(!a||t.length===0)return null;const d=n?t.filter(c=>c.entityType===n):t;return l("div",{className:"entity-panel",children:[l("h4",{children:"Filter by Entity Type"}),l(ot,{types:e,selectedType:n,totalCount:r,onSelectType:s,getTypeCount:o}),l(st,{entities:d,maxDisplay:_})]})}function lt({show:t,entityCount:e,onToggle:n}){return l("button",{className:"btn-secondary btn-entities",onClick:n,children:[t?"Hide":"Show"," Entities (",e,")"]})}class at{constructor(){R(this,"worker",null);R(this,"nextId",1);R(this,"pending",new Map);R(this,"progressCallback",null);this.initWorker()}initWorker(){this.worker=new Worker(new URL("/assets/llm.worker-DcSBfjIK.js",import.meta.url),{type:"module"}),this.worker.onmessage=e=>{const n=e.data;if("type"in n&&n.type==="READY"){console.log("[LlmClient] Worker ready");return}if("type"in n&&n.type==="PROGRESS"){this.progressCallback&&this.progressCallback(n.data);return}const{id:r,response:s}=n,o=this.pending.get(r);o&&(this.pending.delete(r),o.resolve(s))},this.worker.onerror=e=>{console.error("[LlmClient] Worker error:",e);for(const n of this.pending.values())n.reject(new Error("Worker error"));this.pending.clear()}}async sendRequest(e){if(!this.worker)throw new Error("Worker not initialized");const n=this.nextId++;return new Promise((r,s)=>{this.pending.set(n,{resolve:a=>{a.ok?r(a.data):s(new Error(a.error))},reject:s});const o={id:n,request:e};this.worker.postMessage(o)})}onProgress(e){this.progressCallback=e}async loadModel(e){return this.sendRequest({type:"LOAD_MODEL",modelUrl:e})}async reason(e){return this.sendRequest({type:"REASON",request:e})}async unloadModel(){return this.sendRequest({type:"UNLOAD_MODEL"})}async getStatus(){return this.sendRequest({type:"GET_STATUS"})}terminate(){this.worker&&(this.worker.terminate(),this.worker=null),this.pending.clear(),this.progressCallback=null}}let Y=null;function ve(){return Y||(Y=new at),Y}const ct={"0.6b":"https://huggingface.co/unsloth/Qwen3-0.6B-GGUF/resolve/main/Qwen3-0.6B-Q4_K_M.gguf","1.5b":"https://huggingface.co/ggml-org/Qwen2.5-1.5B-Instruct-GGUF/resolve/main/qwen2.5-1.5b-instruct-q4_k_m.gguf"};function _t(t={}){const[e,n]=E(!1),[r,s]=E(null),[o,a]=E(!1),[_,d]=E(null),[c,u]=E(null),[i,g]=E(null),p=async()=>{a(!0),g(null),d(null);try{const h=ve();h.onProgress(b=>{d(b)});const f=await h.loadModel(ct["0.6b"]);s(f),d(null),console.log("[LLM] Model loaded:",f)}catch(h){const f=String(h);g(f),console.error("[LLM] Failed to load model:",h)}finally{a(!1)}};return{enabled:e,modelInfo:r,loading:o,progress:_,reasoning:c,error:i,toggle:async()=>{e?(n(!1),u(null)):(r!=null&&r.loaded||await p(),n(!0))},loadModel:p,reason:async(h,f,b=256)=>{if(!(r!=null&&r.loaded)){console.warn("[LLM] Cannot reason: model not loaded");return}a(!0),g(null);try{const S=ve(),M=f.slice(0,5).map(x=>({gid:x.gid,pageNo:x.pageNo,title:x.title,text:x.snippet||"",score:x.scores.final})),T=await S.reason({question:h,snippets:M,maxTokens:b,temperature:.7});u(T),console.log("[LLM] Reasoning complete:",T)}catch(S){const M=String(S);g(M),console.error("[LLM] Reasoning failed:",S)}finally{a(!1)}},clearReasoning:()=>{u(null)}}}function dt({enabled:t,loading:e,modelLoaded:n,progress:r,error:s,onToggle:o}){return l("div",{className:"llm-toggle",children:[l("label",{className:"toggle-label",children:[l("input",{type:"checkbox",checked:t,onChange:o,disabled:e}),l("span",{className:"toggle-text",children:"ðŸ¤– Enable LLM Reasoning (Qwen 3 0.6B)"})]}),n&&l("span",{className:"model-status",children:"âœ… Model loaded"}),r&&l("div",{className:"llm-progress",children:[r.message," (",(r.progress*100).toFixed(0),"%)"]}),s&&l("div",{className:"llm-error",children:["âš ï¸ ",s]})]})}function ut({reasoning:t,searchResults:e,loading:n}){return n&&!t?l("div",{className:"reasoning-loading",children:[l("div",{className:"spinner"}),l("p",{children:"LLM is reasoning..."})]}):t?l("div",{className:"reasoning-output",children:[l("div",{className:"reasoning-header",children:[l("h4",{children:"ðŸ¤– LLM Reasoning"}),l("span",{className:"reasoning-meta",children:[t.inferenceTimeMs.toFixed(0),"ms Â· ",t.tokensGenerated," tokens"]})]}),l("div",{className:"reasoning-answer",children:t.answer}),t.usedSnippets.length>0&&l("div",{className:"reasoning-citations",children:[l("strong",{children:"ðŸ“‘ Cited sources:"}),t.usedSnippets.map(r=>{const s=e==null?void 0:e.find(o=>o.gid===r);return l("span",{className:"citation",children:["Page ",(s==null?void 0:s.pageNo)||"?"]},r)})]})]}):null}const ht={mode:"website",bundledCapsule:"/memglyph-demo.mgx.sqlite",branding:{title:"Memglyph",tagline:"Your knowledge, crystallized",logoUrl:"/logo.svg"},features:{llm:{enabled:!0,autoReason:!1,defaultModel:"qwen3-0.6b",maxTokens:256},search:{defaultMode:"hybrid",enabledModes:["fts","hybrid"],showModeToggle:!1},graph:{enabled:!0,maxHops:2,defaultMaxHops:1},upload:{enabled:!1,acceptedExtensions:[]},gcui:{enabled:!0,fallbackToGeneric:!1},pwa:{enabled:!0,offlineMode:!0}},ui:{showLanding:!0,theme:"documentation"}},pt={mode:"viewer",bundledCapsule:"/memglyph-demo.mgx.sqlite",branding:{title:"SQLAR Viewer",tagline:"Query your knowledge capsules",logoUrl:"/sqlar-logo.svg"},features:{llm:{enabled:!0,autoReason:!1,defaultModel:"qwen3-0.6b",maxTokens:256},search:{defaultMode:"hybrid",enabledModes:["fts","hybrid","graph"],showModeToggle:!0},graph:{enabled:!0,maxHops:3,defaultMaxHops:2},upload:{enabled:!0,acceptedExtensions:[".sqlite",".sqlar",".db",".mgx.sqlite"]},gcui:{enabled:!0,fallbackToGeneric:!0},pwa:{enabled:!0,offlineMode:!0}},ui:{showLanding:!1,theme:"tool"}};function ft(){return"website"}function gt(){return ft()==="viewer"?pt:ht}function mt(){var y;const t=gt(),[e,n]=E(null),[r,s]=E(!1),[o,a]=E(null),[_,d]=E(!1),c=Ye({defaultMode:t.features.search.defaultMode}),u=rt({autoLoad:!1}),i=_t({});Fe(()=>{e&&u.loadEntities()},[e]);const g=async()=>{s(!0),a(null);try{const v=await ie().openDemo();n(v),console.log("Capsule info:",v)}catch(w){a(String(w)),console.error("Failed to open capsule:",w)}finally{s(!1)}},p=async w=>{e&&(i.clearReasoning(),await c.search(w))};return l("div",{className:"app",children:[l("header",{className:"app-header",children:[l("h1",{children:"Glyphcapsule Explorer"}),l("p",{children:"Hybrid Retrieval Demo for MemGlyph"})]}),l("main",{className:"app-main",children:e?l("div",{className:"capsule-view",children:[l("div",{className:"capsule-info",children:[l("h2",{children:["ðŸ“¦ ",e.fileName]}),l("dl",{children:[l("dt",{children:"File Size:"}),l("dd",{children:[(e.fileSize/1024).toFixed(1)," KB"]}),l("dt",{children:"Doc ID:"}),l("dd",{children:l("code",{children:[e.docId.slice(0,24),"..."]})}),l("dt",{children:"Pages:"}),l("dd",{children:e.pageCount}),l("dt",{children:"Entities:"}),l("dd",{children:e.entityCount}),l("dt",{children:"Graph Edges:"}),l("dd",{children:e.edgeCount}),e.hasVectors&&l(q,{children:[l("dt",{children:"Vectors:"}),l("dd",{children:["âœ… ",e.vectorModel," (",e.vectorDim,"-dim)"]})]})]}),l(dt,{enabled:i.enabled,loading:i.loading,modelLoaded:((y=i.modelInfo)==null?void 0:y.loaded)||!1,progress:i.progress,error:i.error,onToggle:i.toggle})]}),l("div",{className:"search-section",children:[l("div",{className:"search-header",children:[l("h3",{children:"ðŸ” Search"}),l(lt,{show:_,entityCount:u.entities.length,onToggle:()=>d(!_)})]}),l(nt,{mode:c.mode,results:c.results,lastQuery:c.lastQuery,loading:c.loading||r,onSearch:p,onModeChange:c.changeMode,showModeToggle:t.features.search.showModeToggle,placeholder:"Search the capsule...",searchHint:'Try searching: "vector search", "LEANN", "SQLite", or "hybrid retrieval"'}),l(it,{entities:u.entities,types:u.types,selectedType:u.selectedType,totalCount:u.totalCount,onSelectType:u.selectType,getTypeCount:u.getTypeCount,show:_,maxDisplay:20}),i.reasoning&&l(ut,{reasoning:i.reasoning,searchResults:c.results,loading:i.loading}),i.loading&&!i.reasoning&&l("div",{className:"reasoning-loading",children:[l("div",{className:"spinner"}),l("p",{children:"LLM is reasoning..."})]})]})]}):l("div",{className:"welcome",children:[l("h2",{children:"Welcome!"}),l("p",{children:"This is an offline-capable PWA for exploring MemGlyph Glyphcapsules with hybrid retrieval (FTS + Vector + Entity + Graph)."}),l("p",{children:[l("strong",{children:"Demo capsule:"})," memglyph-demo.mgx.sqlite",l("br",{}),"(8 pages, 25 entities, 11 edges, 384-dim vectors)"]}),o&&l("div",{className:"error",children:[l("strong",{children:"Error:"})," ",o]}),l("button",{className:"btn-primary",onClick:g,disabled:r,children:r?"Opening...":"Open Demo Capsule"})]})}),l("footer",{className:"app-footer",children:l("p",{children:"Built with Preact + SQLite WASM + OPFS"})})]})}Ue(l(mt,{}),document.getElementById("app"));
