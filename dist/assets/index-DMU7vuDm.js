var tt=Object.defineProperty;var nt=(t,e,r)=>e in t?tt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var $=(t,e,r)=>nt(t,typeof e!="symbol"?e+"":e,r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function r(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=r(i);fetch(i.href,a)}})();var ne,S,Re,I,Ne,qe,Oe,De,fe,de,ue,z={},Ae=[],rt=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,re=Array.isArray;function W(t,e){for(var r in e)t[r]=e[r];return t}function ge(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function st(t,e,r){var s,i,a,o={};for(a in e)a=="key"?s=e[a]:a=="ref"?i=e[a]:o[a]=e[a];if(arguments.length>2&&(o.children=arguments.length>3?ne.call(arguments,2):r),typeof t=="function"&&t.defaultProps!=null)for(a in t.defaultProps)o[a]===void 0&&(o[a]=t.defaultProps[a]);return K(t,o,s,i,null)}function K(t,e,r,s,i){var a={type:t,props:e,key:r,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++Re,__i:-1,__u:0};return i==null&&S.vnode!=null&&S.vnode(a),a}function q(t){return t.children}function X(t,e){this.props=t,this.context=e}function B(t,e){if(e==null)return t.__?B(t.__,t.__i+1):null;for(var r;e<t.__k.length;e++)if((r=t.__k[e])!=null&&r.__e!=null)return r.__e;return typeof t.type=="function"?B(t):null}function He(t){var e,r;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((r=t.__k[e])!=null&&r.__e!=null){t.__e=t.__c.base=r.__e;break}return He(t)}}function we(t){(!t.__d&&(t.__d=!0)&&I.push(t)&&!Z.__r++||Ne!=S.debounceRendering)&&((Ne=S.debounceRendering)||qe)(Z)}function Z(){for(var t,e,r,s,i,a,o,h=1;I.length;)I.length>h&&I.sort(Oe),t=I.shift(),h=I.length,t.__d&&(r=void 0,s=void 0,i=(s=(e=t).__v).__e,a=[],o=[],e.__P&&((r=W({},s)).__v=s.__v+1,S.vnode&&S.vnode(r),_e(e.__P,r,s,e.__n,e.__P.namespaceURI,32&s.__u?[i]:null,a,i??B(s),!!(32&s.__u),o),r.__v=s.__v,r.__.__k[r.__i]=r,Ie(a,r,o),s.__e=s.__=null,r.__e!=i&&He(r)));Z.__r=0}function Ge(t,e,r,s,i,a,o,h,d,c,m){var l,u,f,v,N,y,g,p=s&&s.__k||Ae,_=e.length;for(d=at(r,e,p,d,_),l=0;l<_;l++)(f=r.__k[l])!=null&&(u=f.__i==-1?z:p[f.__i]||z,f.__i=l,y=_e(t,f,u,i,a,o,h,d,c,m),v=f.__e,f.ref&&u.ref!=f.ref&&(u.ref&&ye(u.ref,null,f),m.push(f.ref,f.__c||v,f)),N==null&&v!=null&&(N=v),(g=!!(4&f.__u))||u.__k===f.__k?d=We(f,d,t,g):typeof f.type=="function"&&y!==void 0?d=y:v&&(d=v.nextSibling),f.__u&=-7);return r.__e=N,d}function at(t,e,r,s,i){var a,o,h,d,c,m=r.length,l=m,u=0;for(t.__k=new Array(i),a=0;a<i;a++)(o=e[a])!=null&&typeof o!="boolean"&&typeof o!="function"?(d=a+u,(o=t.__k[a]=typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?K(null,o,null,null,null):re(o)?K(q,{children:o},null,null,null):o.constructor==null&&o.__b>0?K(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=t,o.__b=t.__b+1,h=null,(c=o.__i=it(o,r,d,l))!=-1&&(l--,(h=r[c])&&(h.__u|=2)),h==null||h.__v==null?(c==-1&&(i>m?u--:i<m&&u++),typeof o.type!="function"&&(o.__u|=4)):c!=d&&(c==d-1?u--:c==d+1?u++:(c>d?u--:u++,o.__u|=4))):t.__k[a]=null;if(l)for(a=0;a<m;a++)(h=r[a])!=null&&!(2&h.__u)&&(h.__e==s&&(s=B(h)),Ve(h,h));return s}function We(t,e,r,s){var i,a;if(typeof t.type=="function"){for(i=t.__k,a=0;i&&a<i.length;a++)i[a]&&(i[a].__=t,e=We(i[a],e,r,s));return e}t.__e!=e&&(s&&(e&&t.type&&!e.parentNode&&(e=B(t)),r.insertBefore(t.__e,e||null)),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function it(t,e,r,s){var i,a,o,h=t.key,d=t.type,c=e[r],m=c!=null&&(2&c.__u)==0;if(c===null&&t.key==null||m&&h==c.key&&d==c.type)return r;if(s>(m?1:0)){for(i=r-1,a=r+1;i>=0||a<e.length;)if((c=e[o=i>=0?i--:a++])!=null&&!(2&c.__u)&&h==c.key&&d==c.type)return o}return-1}function ke(t,e,r){e[0]=="-"?t.setProperty(e,r??""):t[e]=r==null?"":typeof r!="number"||rt.test(e)?r:r+"px"}function Y(t,e,r,s,i){var a,o;e:if(e=="style")if(typeof r=="string")t.style.cssText=r;else{if(typeof s=="string"&&(t.style.cssText=s=""),s)for(e in s)r&&e in r||ke(t.style,e,"");if(r)for(e in r)s&&r[e]==s[e]||ke(t.style,e,r[e])}else if(e[0]=="o"&&e[1]=="n")a=e!=(e=e.replace(De,"$1")),o=e.toLowerCase(),e=o in t||e=="onFocusOut"||e=="onFocusIn"?o.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+a]=r,r?s?r.u=s.u:(r.u=fe,t.addEventListener(e,a?ue:de,a)):t.removeEventListener(e,a?ue:de,a);else{if(i=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=r??"";break e}catch{}typeof r=="function"||(r==null||r===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&r==1?"":r))}}function xe(t){return function(e){if(this.l){var r=this.l[e.type+t];if(e.t==null)e.t=fe++;else if(e.t<r.u)return;return r(S.event?S.event(e):e)}}}function _e(t,e,r,s,i,a,o,h,d,c){var m,l,u,f,v,N,y,g,p,_,k,b,x,C,F,O,H,P=e.type;if(e.constructor!=null)return null;128&r.__u&&(d=!!(32&r.__u),a=[h=e.__e=r.__e]),(m=S.__b)&&m(e);e:if(typeof P=="function")try{if(g=e.props,p="prototype"in P&&P.prototype.render,_=(m=P.contextType)&&s[m.__c],k=m?_?_.props.value:m.__:s,r.__c?y=(l=e.__c=r.__c).__=l.__E:(p?e.__c=l=new P(g,k):(e.__c=l=new X(g,k),l.constructor=P,l.render=ot),_&&_.sub(l),l.props=g,l.state||(l.state={}),l.context=k,l.__n=s,u=l.__d=!0,l.__h=[],l._sb=[]),p&&l.__s==null&&(l.__s=l.state),p&&P.getDerivedStateFromProps!=null&&(l.__s==l.state&&(l.__s=W({},l.__s)),W(l.__s,P.getDerivedStateFromProps(g,l.__s))),f=l.props,v=l.state,l.__v=e,u)p&&P.getDerivedStateFromProps==null&&l.componentWillMount!=null&&l.componentWillMount(),p&&l.componentDidMount!=null&&l.__h.push(l.componentDidMount);else{if(p&&P.getDerivedStateFromProps==null&&g!==f&&l.componentWillReceiveProps!=null&&l.componentWillReceiveProps(g,k),!l.__e&&l.shouldComponentUpdate!=null&&l.shouldComponentUpdate(g,l.__s,k)===!1||e.__v==r.__v){for(e.__v!=r.__v&&(l.props=g,l.state=l.__s,l.__d=!1),e.__e=r.__e,e.__k=r.__k,e.__k.some(function(D){D&&(D.__=e)}),b=0;b<l._sb.length;b++)l.__h.push(l._sb[b]);l._sb=[],l.__h.length&&o.push(l);break e}l.componentWillUpdate!=null&&l.componentWillUpdate(g,l.__s,k),p&&l.componentDidUpdate!=null&&l.__h.push(function(){l.componentDidUpdate(f,v,N)})}if(l.context=k,l.props=g,l.__P=t,l.__e=!1,x=S.__r,C=0,p){for(l.state=l.__s,l.__d=!1,x&&x(e),m=l.render(l.props,l.state,l.context),F=0;F<l._sb.length;F++)l.__h.push(l._sb[F]);l._sb=[]}else do l.__d=!1,x&&x(e),m=l.render(l.props,l.state,l.context),l.state=l.__s;while(l.__d&&++C<25);l.state=l.__s,l.getChildContext!=null&&(s=W(W({},s),l.getChildContext())),p&&!u&&l.getSnapshotBeforeUpdate!=null&&(N=l.getSnapshotBeforeUpdate(f,v)),O=m,m!=null&&m.type===q&&m.key==null&&(O=Qe(m.props.children)),h=Ge(t,re(O)?O:[O],e,r,s,i,a,o,h,d,c),l.base=e.__e,e.__u&=-161,l.__h.length&&o.push(l),y&&(l.__E=l.__=null)}catch(D){if(e.__v=null,d||a!=null)if(D.then){for(e.__u|=d?160:128;h&&h.nodeType==8&&h.nextSibling;)h=h.nextSibling;a[a.indexOf(h)]=null,e.__e=h}else{for(H=a.length;H--;)ge(a[H]);he(e)}else e.__e=r.__e,e.__k=r.__k,D.then||he(e);S.__e(D,e,r)}else a==null&&e.__v==r.__v?(e.__k=r.__k,e.__e=r.__e):h=e.__e=lt(r.__e,e,r,s,i,a,o,d,c);return(m=S.diffed)&&m(e),128&e.__u?void 0:h}function he(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(he)}function Ie(t,e,r){for(var s=0;s<r.length;s++)ye(r[s],r[++s],r[++s]);S.__c&&S.__c(e,t),t.some(function(i){try{t=i.__h,i.__h=[],t.some(function(a){a.call(i)})}catch(a){S.__e(a,i.__v)}})}function Qe(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:re(t)?t.map(Qe):W({},t)}function lt(t,e,r,s,i,a,o,h,d){var c,m,l,u,f,v,N,y=r.props,g=e.props,p=e.type;if(p=="svg"?i="http://www.w3.org/2000/svg":p=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),a!=null){for(c=0;c<a.length;c++)if((f=a[c])&&"setAttribute"in f==!!p&&(p?f.localName==p:f.nodeType==3)){t=f,a[c]=null;break}}if(t==null){if(p==null)return document.createTextNode(g);t=document.createElementNS(i,p,g.is&&g),h&&(S.__m&&S.__m(e,a),h=!1),a=null}if(p==null)y===g||h&&t.data==g||(t.data=g);else{if(a=a&&ne.call(t.childNodes),y=r.props||z,!h&&a!=null)for(y={},c=0;c<t.attributes.length;c++)y[(f=t.attributes[c]).name]=f.value;for(c in y)if(f=y[c],c!="children"){if(c=="dangerouslySetInnerHTML")l=f;else if(!(c in g)){if(c=="value"&&"defaultValue"in g||c=="checked"&&"defaultChecked"in g)continue;Y(t,c,null,f,i)}}for(c in g)f=g[c],c=="children"?u=f:c=="dangerouslySetInnerHTML"?m=f:c=="value"?v=f:c=="checked"?N=f:h&&typeof f!="function"||y[c]===f||Y(t,c,f,y[c],i);if(m)h||l&&(m.__html==l.__html||m.__html==t.innerHTML)||(t.innerHTML=m.__html),e.__k=[];else if(l&&(t.innerHTML=""),Ge(e.type=="template"?t.content:t,re(u)?u:[u],e,r,s,p=="foreignObject"?"http://www.w3.org/1999/xhtml":i,a,o,a?a[0]:r.__k&&B(r,0),h,d),a!=null)for(c=a.length;c--;)ge(a[c]);h||(c="value",p=="progress"&&v==null?t.removeAttribute("value"):v!=null&&(v!==t[c]||p=="progress"&&!v||p=="option"&&v!=y[c])&&Y(t,c,v,y[c],i),c="checked",N!=null&&N!=t[c]&&Y(t,c,N,y[c],i))}return t}function ye(t,e,r){try{if(typeof t=="function"){var s=typeof t.__u=="function";s&&t.__u(),s&&e==null||(t.__u=t(e))}else t.current=e}catch(i){S.__e(i,r)}}function Ve(t,e,r){var s,i;if(S.unmount&&S.unmount(t),(s=t.ref)&&(s.current&&s.current!=t.__e||ye(s,null,e)),(s=t.__c)!=null){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(a){S.__e(a,e)}s.base=s.__P=null}if(s=t.__k)for(i=0;i<s.length;i++)s[i]&&Ve(s[i],e,r||typeof t.type!="function");r||ge(t.__e),t.__c=t.__=t.__e=void 0}function ot(t,e,r){return this.constructor(t,r)}function ct(t,e,r){var s,i,a,o;e==document&&(e=document.documentElement),S.__&&S.__(t,e),i=(s=!1)?null:e.__k,a=[],o=[],_e(e,t=e.__k=st(q,null,[t]),i||z,z,e.namespaceURI,i?null:e.firstChild?ne.call(e.childNodes):null,a,i?i.__e:e.firstChild,s,o),Ie(a,t,o)}ne=Ae.slice,S={__e:function(t,e,r,s){for(var i,a,o;e=e.__;)if((i=e.__c)&&!i.__)try{if((a=i.constructor)&&a.getDerivedStateFromError!=null&&(i.setState(a.getDerivedStateFromError(t)),o=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(t,s||{}),o=i.__d),o)return i.__E=i}catch(h){t=h}throw t}},Re=0,X.prototype.setState=function(t,e){var r;r=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=W({},this.state),typeof t=="function"&&(t=t(W({},r),this.props)),t&&W(r,t),t!=null&&this.__v&&(e&&this._sb.push(e),we(this))},X.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),we(this))},X.prototype.render=q,I=[],qe=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Oe=function(t,e){return t.__v.__b-e.__v.__b},Z.__r=0,De=/(PointerCapture)$|Capture$/i,fe=0,de=xe(!1),ue=xe(!0);var dt=0;function n(t,e,r,s,i,a){e||(e={});var o,h,d=e;if("ref"in d)for(h in d={},e)h=="ref"?o=e[h]:d[h]=e[h];var c={type:t,props:d,key:r,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--dt,__i:-1,__u:0,__source:i,__self:a};if(typeof t=="function"&&(o=t.defaultProps))for(h in o)d[h]===void 0&&(d[h]=o[h]);return S.vnode&&S.vnode(c),c}var j,L,ae,Se,ee=0,Be=[],T=S,Ce=T.__b,Fe=T.__r,Ee=T.diffed,Le=T.__c,Te=T.unmount,Pe=T.__;function ve(t,e){T.__h&&T.__h(L,t,ee||e),ee=0;var r=L.__H||(L.__H={__:[],__h:[]});return t>=r.__.length&&r.__.push({}),r.__[t]}function w(t){return ee=1,ut(ze,t)}function ut(t,e,r){var s=ve(j++,2);if(s.t=t,!s.__c&&(s.__=[ze(void 0,e),function(h){var d=s.__N?s.__N[0]:s.__[0],c=s.t(d,h);d!==c&&(s.__N=[c,s.__[1]],s.__c.setState({}))}],s.__c=L,!L.__f)){var i=function(h,d,c){if(!s.__c.__H)return!0;var m=s.__c.__H.__.filter(function(u){return!!u.__c});if(m.every(function(u){return!u.__N}))return!a||a.call(this,h,d,c);var l=s.__c.props!==h;return m.forEach(function(u){if(u.__N){var f=u.__[0];u.__=u.__N,u.__N=void 0,f!==u.__[0]&&(l=!0)}}),a&&a.call(this,h,d,c)||l};L.__f=!0;var a=L.shouldComponentUpdate,o=L.componentWillUpdate;L.componentWillUpdate=function(h,d,c){if(this.__e){var m=a;a=void 0,i(h,d,c),a=m}o&&o.call(this,h,d,c)},L.shouldComponentUpdate=i}return s.__N||s.__}function M(t,e){var r=ve(j++,3);!T.__s&&Ue(r.__H,e)&&(r.__=t,r.u=e,L.__H.__h.push(r))}function te(t){return ee=5,ht(function(){return{current:t}},[])}function ht(t,e){var r=ve(j++,7);return Ue(r.__H,e)&&(r.__=t(),r.__H=e,r.__h=t),r.__}function pt(){for(var t;t=Be.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(J),t.__H.__h.forEach(pe),t.__H.__h=[]}catch(e){t.__H.__h=[],T.__e(e,t.__v)}}T.__b=function(t){L=null,Ce&&Ce(t)},T.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),Pe&&Pe(t,e)},T.__r=function(t){Fe&&Fe(t),j=0;var e=(L=t.__c).__H;e&&(ae===L?(e.__h=[],L.__h=[],e.__.forEach(function(r){r.__N&&(r.__=r.__N),r.u=r.__N=void 0})):(e.__h.forEach(J),e.__h.forEach(pe),e.__h=[],j=0)),ae=L},T.diffed=function(t){Ee&&Ee(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(Be.push(e)!==1&&Se===T.requestAnimationFrame||((Se=T.requestAnimationFrame)||mt)(pt)),e.__H.__.forEach(function(r){r.u&&(r.__H=r.u),r.u=void 0})),ae=L=null},T.__c=function(t,e){e.some(function(r){try{r.__h.forEach(J),r.__h=r.__h.filter(function(s){return!s.__||pe(s)})}catch(s){e.some(function(i){i.__h&&(i.__h=[])}),e=[],T.__e(s,r.__v)}}),Le&&Le(t,e)},T.unmount=function(t){Te&&Te(t);var e,r=t.__c;r&&r.__H&&(r.__H.__.forEach(function(s){try{J(s)}catch(i){e=i}}),r.__H=void 0,e&&T.__e(e,r.__v))};var Me=typeof requestAnimationFrame=="function";function mt(t){var e,r=function(){clearTimeout(s),Me&&cancelAnimationFrame(e),setTimeout(t)},s=setTimeout(r,35);Me&&(e=requestAnimationFrame(r))}function J(t){var e=L,r=t.__c;typeof r=="function"&&(t.__c=void 0,r()),L=e}function pe(t){var e=L;t.__c=t.__(),L=e}function Ue(t,e){return!t||t.length!==e.length||e.some(function(r,s){return r!==t[s]})}function ze(t,e){return typeof e=="function"?e(t):e}const ft={maxQueueSize:50,defaultTimeout:1e4,maxTimeout:3e4};class gt{constructor(e={}){$(this,"queue",[]);$(this,"processing",!1);$(this,"nextId",1);$(this,"config");$(this,"stats",{totalProcessed:0,totalTimeouts:0,totalErrors:0});this.config={...ft,...e}}async enqueue(e,r){if(this.queue.length>=this.config.maxQueueSize)throw new Error(`Query queue full (${this.config.maxQueueSize} items). Too many pending queries.`);const s=Math.min(r||this.config.defaultTimeout,this.config.maxTimeout);return new Promise((i,a)=>{const o={id:this.nextId++,execute:e,resolve:i,reject:a,timeout:s,enqueuedAt:Date.now()};this.queue.push(o),this.processing||this.processQueue()})}async processQueue(){if(!(this.processing||this.queue.length===0)){for(this.processing=!0;this.queue.length>0;){const e=this.queue.shift();try{await this.executeWithTimeout(e)}catch{}}this.processing=!1}}async executeWithTimeout(e){const r=new Promise((s,i)=>{setTimeout(()=>{i(new Error(`Query ${e.id} timed out after ${e.timeout}ms`))},e.timeout)});try{const s=await Promise.race([e.execute(),r]);this.stats.totalProcessed++,e.resolve(s)}catch(s){s instanceof Error&&s.message.includes("timed out")?(this.stats.totalTimeouts++,console.warn(`[QueryQueue] Query ${e.id} timed out`,{timeout:e.timeout,waitTime:Date.now()-e.enqueuedAt})):this.stats.totalErrors++,e.reject(s)}}getStats(){return{queueLength:this.queue.length,busy:this.processing,totalProcessed:this.stats.totalProcessed,totalTimeouts:this.stats.totalTimeouts,totalErrors:this.stats.totalErrors}}isBusy(){return this.processing||this.queue.length>0}clear(){const e=new Error("Query queue cleared");for(const r of this.queue)r.reject(e);this.queue=[]}get length(){return this.queue.length}}let ie=null;function me(t){return ie||(ie=new gt(t)),ie}function _t(t,e){return me().enqueue(t,e)}class yt{constructor(){$(this,"worker",null);$(this,"nextId",1);$(this,"pending",new Map);this.initWorker()}initWorker(){this.worker=new Worker(new URL("/assets/sqlite.worker-B9s5gY5D.js",import.meta.url),{type:"module"}),this.worker.onmessage=e=>{const r=e.data;if("type"in r&&r.type==="READY"){console.log("[DbClient] Worker ready");return}const{id:s,response:i}=r,a=this.pending.get(s);a&&(this.pending.delete(s),a.resolve(i))},this.worker.onerror=e=>{console.error("[DbClient] Worker error:",e);for(const r of this.pending.values())r.reject(new Error("Worker error"));this.pending.clear()}}async sendRequest(e,r=1e4){if(!this.worker)throw new Error("Worker not initialized");const s=this.nextId++;return _t(async()=>new Promise((i,a)=>{const o=setTimeout(()=>{this.pending.delete(s),a(new Error(`Request ${e.type} timed out after ${r}ms`))},r);this.pending.set(s,{resolve:d=>{clearTimeout(o),d.ok?i(d.data):a(new Error(d.error))},reject:d=>{clearTimeout(o),a(d)},timeout:o});const h={id:s,request:e};this.worker.postMessage(h)}),r)}async openFromFile(e){return this.sendRequest({type:"OPEN_FROM_FILE",file:e})}async openFromOpfs(e){return this.sendRequest({type:"OPEN_FROM_OPFS",path:e})}async openDemo(){return this.sendRequest({type:"OPEN_DEMO"})}async saveToOpfs(e){return this.sendRequest({type:"SAVE_TO_OPFS",path:e})}async removeFromOpfs(e){return this.sendRequest({type:"REMOVE_FROM_OPFS",path:e})}async listOpfsFiles(){return this.sendRequest({type:"LIST_OPFS_FILES"})}async close(){return this.sendRequest({type:"CLOSE"})}async searchFts(e,r=20,s,i){return this.sendRequest({type:"FTS_SEARCH",query:e,limit:r,entityType:s,entityValue:i})}async searchHybrid(e,r=20,s){return this.sendRequest({type:"HYBRID_SEARCH",query:e,limit:r,weights:s})}async listEntities(e,r=100){return this.sendRequest({type:"LIST_ENTITIES",entityType:e,limit:r})}async getPageList(e=100,r=0){return this.sendRequest({type:"GET_PAGE_LIST",limit:e,offset:r})}async getPageBlob(e){return this.sendRequest({type:"GET_PAGE_BLOB",name:e})}async verifyPage(e){return this.sendRequest({type:"VERIFY_PAGE",gid:e})}async getCheckpoints(){return this.sendRequest({type:"GET_CHECKPOINTS"})}async graphHops(e,r,s,i){return this.sendRequest({type:"GRAPH_HOPS",seedGid:e,predicate:r,maxHops:s,limit:i})}getQueueStats(){return me().getStats()}isQueueBusy(){return me().isBusy()}terminate(){this.worker&&(this.worker.terminate(),this.worker=null);for(const e of this.pending.values())clearTimeout(e.timeout),e.reject(new Error("Worker terminated"));this.pending.clear()}}let le=null;function R(){return le||(le=new yt),le}function je(t={}){const{defaultMode:e="hybrid",maxResults:r=10,maxGraphHops:s=2,debounceMs:i=300}=t,[a,o]=w(e),[h,d]=w(null),[c,m]=w(""),[l,u]=w(!1),[f,v]=w(null),[N,y]=w({}),[g,p]=w(""),[_,k]=w(()=>{try{const E=localStorage.getItem("memglyph-search-history");return E?JSON.parse(E):[]}catch{return[]}}),b=te(null);M(()=>{if(g.trim())return b.current&&clearTimeout(b.current),b.current=window.setTimeout(()=>{F(g)},i),()=>{b.current&&clearTimeout(b.current)}},[g,a,N]);const x=E=>{if(!E.trim())return;const G=E.trim();k(A=>{const et=A.filter(se=>se!==G),be=[G,...et].slice(0,10);try{localStorage.setItem("memglyph-search-history",JSON.stringify(be))}catch(se){console.warn("[Search] Failed to save history:",se)}return be})},C=()=>{k([]);try{localStorage.removeItem("memglyph-search-history")}catch(E){console.warn("[Search] Failed to clear history:",E)}},F=async E=>{if(E.trim()){u(!0),v(null),m(E),x(E);try{const G=R();let A=[];switch(a){case"fts":A=await vt(G,E,r,N);break;case"hybrid":A=await G.searchHybrid(E,r);break;case"graph":A=await bt(G,E,r,s,N);break;default:throw new Error(`Unknown search mode: ${a}`)}return d(A),console.log(`[Search] ${a} mode: ${A.length} results`),A}catch(G){const A=String(G);return v(A),console.error("[Search] Failed:",G),[]}finally{u(!1)}}};return{mode:a,results:h,lastQuery:c,loading:l,error:f,entityFilter:N,searchHistory:_,search:E=>{p(E)},searchImmediate:E=>(b.current&&clearTimeout(b.current),p(""),F(E)),clear:()=>{d(null),m(""),v(null),p(""),b.current&&clearTimeout(b.current)},changeMode:E=>{o(E),d(null)},setFilter:E=>{y(E),d(null)},clearFilter:()=>{y({}),d(null)},clearHistory:C}}async function vt(t,e,r,s){return(await t.searchFts(e,r,s.entityType,s.entityValue)).map(a=>({gid:a.gid,pageNo:a.pageNo,title:a.title,snippet:a.snippet,scores:{fts:a.score,vector:0,entity:0,graph:0,final:a.score}}))}async function bt(t,e,r,s,i){const a=await t.searchFts(e,3,i.entityType,i.entityValue);if(a.length===0)return[];const o=a[0].gid,h=await t.graphHops(o,void 0,s,r),d=h.nodes.map(c=>{const m=h.distances[c.gid]||0,l=a.find(u=>u.gid===c.gid);return{gid:c.gid,pageNo:c.pageNo,title:c.title,snippet:(l==null?void 0:l.snippet)||null,scores:{fts:(l==null?void 0:l.score)||0,vector:0,entity:0,graph:1/(m+1),final:((l==null?void 0:l.score)||0)*.3+1/(m+1)*.7}}});return d.sort((c,m)=>m.scores.final-c.scores.final),d}function Nt({mode:t,onModeChange:e,showToggle:r=!0}){return r?n("div",{className:"search-mode-toggle",children:[n("button",{className:`mode-btn ${t==="fts"?"active":""}`,onClick:()=>e("fts"),children:"ðŸ“ FTS Only"}),n("button",{className:`mode-btn ${t==="hybrid"?"active":""}`,onClick:()=>e("hybrid"),children:"âš¡ Hybrid"}),n("button",{className:`mode-btn ${t==="graph"?"active":""}`,onClick:()=>e("graph"),children:"ðŸ•¸ï¸ Graph"})]}):null}function wt({onSearch:t,loading:e,placeholder:r,searchHistory:s,onClearHistory:i}){return n(q,{children:[n("form",{onSubmit:a=>{a.preventDefault();const h=new FormData(a.currentTarget).get("query");h!=null&&h.trim()&&t(h.trim())},children:n("div",{className:"search-bar",children:[n("input",{type:"text",name:"query",placeholder:r||"Search the capsule...",className:"search-input",disabled:e}),n("button",{type:"submit",className:"btn-search",disabled:e,children:e?"Searching...":"Search"})]})}),s&&s.length>0&&n("div",{className:"search-history",children:[n("div",{className:"search-history-header",children:[n("span",{className:"search-history-label",children:"Recent searches:"}),i&&n("button",{className:"search-history-clear",onClick:i,type:"button",children:"Clear"})]}),n("div",{className:"search-history-items",children:s.map((a,o)=>n("button",{className:"search-history-item",onClick:()=>t(a),type:"button",children:a},o))})]})]})}function kt({results:t,query:e,onResultClick:r}){return n("div",{className:"search-results",children:[n("p",{className:"results-header",children:["Found ",t.length," results for ",n("strong",{children:['"',e,'"']})]}),t.map(s=>n("div",{className:`result-item ${r?"result-item-clickable":""}`,onClick:()=>r==null?void 0:r(s.gid),style:{cursor:r?"pointer":"default"},children:[n("div",{className:"result-header",children:[n("span",{className:"result-page",children:["Page ",s.pageNo]}),n("span",{className:"result-score",children:["Score: ",s.scores.final.toFixed(3)]})]}),n("h4",{className:"result-title",children:s.title}),s.snippet&&n("p",{className:"result-snippet",dangerouslySetInnerHTML:{__html:s.snippet}}),n("div",{className:"result-scores",children:[n("span",{children:["FTS: ",s.scores.fts.toFixed(2)]}),n("span",{children:["Entity: ",s.scores.entity.toFixed(2)]}),n("span",{children:["Graph: ",s.scores.graph.toFixed(2)]})]})]},s.gid))]})}function xt({mode:t,results:e,lastQuery:r,loading:s,onSearch:i,onModeChange:a,onResultClick:o,showModeToggle:h=!0,placeholder:d,searchHint:c,searchHistory:m,onClearHistory:l}){return n("div",{className:"search-section",children:[n("div",{className:"search-header",children:n("h3",{children:"ðŸ” Search"})}),n(Nt,{mode:t,onModeChange:a,showToggle:h}),c&&n("p",{className:"search-hint",children:c}),n("div",{className:"keyboard-shortcuts-hint",children:[n("span",{className:"shortcut-item",children:[n("kbd",{children:"/"})," Focus search"]}),n("span",{className:"shortcut-item",children:[n("kbd",{children:"Ctrl+L"})," Toggle LLM"]}),n("span",{className:"shortcut-item",children:[n("kbd",{children:"Esc"})," Clear focus"]})]}),n(wt,{onSearch:i,loading:s,placeholder:d,searchHistory:m,onClearHistory:l}),e&&e.length>0&&n(kt,{results:e,query:r,onResultClick:o}),e&&e.length===0&&n("div",{className:"no-results",children:[n("p",{children:["No results found for ",n("strong",{children:['"',r,'"']})]}),n("p",{className:"search-hint",children:"Try different keywords or search terms."})]})]})}function Ye(t={}){const{autoLoad:e=!0,maxEntities:r=50}=t,[s,i]=w([]),[a,o]=w(null),[h,d]=w(!1),[c,m]=w(null),l=async()=>{d(!0),m(null);try{const p=await R().listEntities(void 0,r);i(p),console.log("[Entities] Loaded:",p.length)}catch(g){const p=String(g);m(p),console.error("[Entities] Failed to load:",g)}finally{d(!1)}};M(()=>{e&&l()},[e]);const u=g=>{o(g)},f=()=>Array.from(new Set(s.map(g=>g.entityType))),v=()=>a?s.filter(g=>g.entityType===a):s,N=g=>s.filter(p=>p.entityType===g).reduce((p,_)=>p+_.count,0),y=()=>s.reduce((g,p)=>g+p.count,0);return{entities:s,selectedType:a,loading:h,error:c,types:f(),filteredEntities:v(),totalCount:y(),loadEntities:l,selectType:u,getTypeCount:N}}function St({types:t,selectedType:e,totalCount:r,onSelectType:s,getTypeCount:i}){return n("div",{className:"entity-filters",children:[n("button",{className:`entity-filter ${e===null?"active":""}`,onClick:()=>s(null),children:["All (",r,")"]}),t.map(a=>{const o=i(a);return n("button",{className:`entity-filter ${e===a?"active":""}`,onClick:()=>s(a),children:[a," (",o,")"]},a)})]})}function Ct({entities:t,maxDisplay:e=20}){const r=t.slice(0,e);return n("div",{className:"entity-list",children:[r.map(s=>n("div",{className:"entity-item",children:[n("span",{className:"entity-type",children:s.entityType}),n("span",{className:"entity-value",children:s.normalizedValue}),n("span",{className:"entity-count",children:s.count})]},`${s.entityType}-${s.normalizedValue}`)),t.length>e&&n("div",{className:"entity-item entity-more",children:n("span",{className:"entity-value",children:["... and ",t.length-e," more"]})})]})}function Ft({entities:t,types:e,selectedType:r,totalCount:s,onSelectType:i,getTypeCount:a,show:o=!0,maxDisplay:h=20}){if(!o||t.length===0)return null;const d=r?t.filter(c=>c.entityType===r):t;return n("div",{className:"entity-panel",children:[n("h4",{children:"Filter by Entity Type"}),n(St,{types:e,selectedType:r,totalCount:s,onSelectType:i,getTypeCount:a}),n(Ct,{entities:d,maxDisplay:h})]})}class Et{constructor(){$(this,"worker",null);$(this,"nextId",1);$(this,"pending",new Map);$(this,"progressCallback",null);this.initWorker()}initWorker(){this.worker=new Worker(new URL("/assets/llm.worker-BXtIo8pX.js",import.meta.url),{type:"module"}),this.worker.onmessage=e=>{const r=e.data;if("type"in r&&r.type==="READY"){console.log("[LlmClient] Worker ready");return}if("type"in r&&r.type==="PROGRESS"){this.progressCallback&&this.progressCallback(r.data);return}const{id:s,response:i}=r,a=this.pending.get(s);a&&(this.pending.delete(s),a.resolve(i))},this.worker.onerror=e=>{console.error("[LlmClient] Worker error:",e);for(const r of this.pending.values())r.reject(new Error("Worker error"));this.pending.clear()}}async sendRequest(e){if(!this.worker)throw new Error("Worker not initialized");const r=this.nextId++;return new Promise((s,i)=>{this.pending.set(r,{resolve:o=>{o.ok?s(o.data):i(new Error(o.error))},reject:i});const a={id:r,request:e};this.worker.postMessage(a)})}onProgress(e){this.progressCallback=e}async loadModel(e){return this.sendRequest({type:"LOAD_MODEL",modelUrl:e})}async reason(e){return this.sendRequest({type:"REASON",request:e})}async unloadModel(){return this.sendRequest({type:"UNLOAD_MODEL"})}async getStatus(){return this.sendRequest({type:"GET_STATUS"})}terminate(){this.worker&&(this.worker.terminate(),this.worker=null),this.pending.clear(),this.progressCallback=null}}let oe=null;function $e(){return oe||(oe=new Et),oe}const Lt={"0.6b":"https://huggingface.co/unsloth/Qwen3-0.6B-GGUF/resolve/main/Qwen3-0.6B-Q4_K_M.gguf","1.5b":"https://huggingface.co/ggml-org/Qwen2.5-1.5B-Instruct-GGUF/resolve/main/qwen2.5-1.5b-instruct-q4_k_m.gguf"};function Ke(t={}){const[e,r]=w(!1),[s,i]=w(null),[a,o]=w(!1),[h,d]=w(null),[c,m]=w(null),[l,u]=w(null),[f,v]=w(0),[N,y]=w(.7),g=te(0),p=te(null);M(()=>{if(a&&!h)return g.current=Date.now(),v(0),p.current=window.setInterval(()=>{const C=(Date.now()-g.current)/1e3;v(C)},100),()=>{p.current&&clearInterval(p.current)};p.current&&(clearInterval(p.current),p.current=null),v(0)},[a,h]);const _=async()=>{o(!0),u(null),d(null);try{const C=$e();C.onProgress(O=>{d(O)});const F=await C.loadModel(Lt["0.6b"]);i(F),d(null),console.log("[LLM] Model loaded:",F)}catch(C){const F=String(C);u(F),console.error("[LLM] Failed to load model:",C)}finally{o(!1)}};return{enabled:e,modelInfo:s,loading:a,progress:h,reasoning:c,error:l,elapsedTime:f,temperature:N,toggle:async()=>{e?(r(!1),m(null)):(s!=null&&s.loaded||await _(),r(!0))},loadModel:_,reason:async(C,F,O=256)=>{if(!(s!=null&&s.loaded)){console.warn("[LLM] Cannot reason: model not loaded");return}o(!0),u(null);try{const H=$e(),P=F.slice(0,5).map(Q=>({gid:Q.gid,pageNo:Q.pageNo,title:Q.title,text:Q.snippet||"",score:Q.scores.final})),D=await H.reason({question:C,snippets:P,maxTokens:O,temperature:N});m(D),console.log("[LLM] Reasoning complete:",D)}catch(H){const P=String(H);u(P),console.error("[LLM] Reasoning failed:",H)}finally{o(!1)}},clearReasoning:()=>{m(null)},setTemperature:y}}function Tt({reasoning:t,searchResults:e,loading:r}){const[s,i]=w(null);return r&&!t?n("div",{className:"reasoning-loading",children:[n("div",{className:"spinner"}),n("p",{children:"LLM is reasoning..."})]}):t?n("div",{className:"reasoning-output",children:[n("div",{className:"reasoning-header",children:[n("h4",{children:"ðŸ¤– LLM Reasoning"}),n("span",{className:"reasoning-meta",children:[t.inferenceTimeMs.toFixed(0),"ms Â· ",t.tokensGenerated," tokens"]})]}),n("div",{className:"reasoning-answer",children:t.answer}),t.usedSnippets.length>0&&n("div",{className:"reasoning-citations",children:[n("strong",{children:"ðŸ“‘ Cited sources:"}),t.usedSnippets.map(a=>{const o=e==null?void 0:e.find(h=>h.gid===a);return n("span",{className:"citation",onMouseEnter:()=>i(a),onMouseLeave:()=>i(null),style:{position:"relative"},children:["Page ",(o==null?void 0:o.pageNo)||"?",s===a&&o&&n("div",{className:"citation-tooltip",children:[n("div",{className:"citation-tooltip-title",children:o.title}),o.snippet&&n("div",{className:"citation-tooltip-snippet",dangerouslySetInnerHTML:{__html:o.snippet}}),n("div",{className:"citation-tooltip-meta",children:["Score: ",o.scores.final.toFixed(3)," â€¢ GID: ",a.slice(0,8),"..."]})]})]},a)})]})]}):null}function V(){return typeof navigator<"u"&&"storage"in navigator&&"getDirectory"in navigator.storage}async function Pt(){if(!V())throw new Error("OPFS not supported in this browser");return await navigator.storage.getDirectory()}async function Mt(){return await(await Pt()).getDirectoryHandle("capsules",{create:!0})}function $t(t){const e=t.replace(/[^a-z0-9._-]/gi,"-");return e.endsWith(".mgx.sqlite")?e:`${e}.mgx.sqlite`}async function Rt(t,e){if(!V())throw new Error("OPFS not supported - cannot persist file");const r=await Mt(),s=e||$t(t.name),a=await(await r.getFileHandle(s,{create:!0})).createWritable();try{return await a.write(t),await a.close(),console.log(`[OPFS] Copied file to ${s} (${t.size} bytes)`),{path:s,size:t.size}}catch(o){throw await a.close(),o}}async function qt(){if(!navigator.storage||!navigator.storage.estimate)return null;try{const t=await navigator.storage.estimate(),e=t.usage||0,r=t.quota||0;return{usage:e,quota:r,available:r-e,percentUsed:r>0?e/r*100:0}}catch(t){return console.error("[OPFS] Failed to get storage quota:",t),null}}async function Ot(){if(!navigator.storage||!navigator.storage.persist)return!1;try{const t=await navigator.storage.persist();return console.log(`[OPFS] Persistent storage: ${t}`),t}catch(t){return console.error("[OPFS] Failed to request persistent storage:",t),!1}}function U(t){if(t===0)return"0 B";const e=1024,r=["B","KB","MB","GB"],s=Math.floor(Math.log(t)/Math.log(e));return`${(t/Math.pow(e,s)).toFixed(2)} ${r[s]}`}async function Dt(t,e=500*1024*1024){if(t.size===0)return{valid:!1,error:"File is empty"};if(t.size>e)return{valid:!1,error:`File too large (${U(t.size)} > ${U(e)})`};const r=t.name.toLowerCase();if(!r.endsWith(".mgx.sqlite")&&!r.endsWith(".sqlite"))return{valid:!1,error:"File must have .mgx.sqlite or .sqlite extension"};try{const s=await t.slice(0,16).arrayBuffer();if(!new TextDecoder().decode(s).startsWith("SQLite format 3"))return{valid:!1,error:"Not a valid SQLite file (invalid header)"}}catch(s){return{valid:!1,error:`Failed to read file header: ${s}`}}return{valid:!0}}function At({onFileSelected:t,onOpfsFileSelected:e,onError:r}){const[s,i]=w([]),[a,o]=w(null),[h,d]=w(!1),[c,m]=w(!1),l=R();M(()=>{u(),f()},[]);async function u(){try{const p=await l.listOpfsFiles();i(p)}catch(p){console.error("[FilePicker] Failed to list OPFS files:",p)}}async function f(){var p,_;try{const k=await qt();o(k);const b=await((_=(p=navigator.storage)==null?void 0:p.persisted)==null?void 0:_.call(p));m(b||!1)}catch(k){console.error("[FilePicker] Failed to get quota:",k)}}async function v(p){var b;const _=p.target,k=(b=_.files)==null?void 0:b[0];if(k){d(!0);try{const x=await Dt(k);if(!x.valid){r(x.error),d(!1);return}if(V()){const{path:C}=await Rt(k);await u(),await f(),t(k,C)}else t(k)}catch(x){r(`Failed to load file: ${x}`)}finally{d(!1),_.value=""}}}async function N(p){d(!0);try{e(p)}catch(_){r(`Failed to open from OPFS: ${_}`)}finally{d(!1)}}async function y(p,_){if(_.stopPropagation(),!!confirm(`Remove "${p}" from device storage?`))try{await l.removeFromOpfs(p),await u(),await f()}catch(k){r(`Failed to remove file: ${k}`)}}async function g(){try{await Ot()?m(!0):r("Persistent storage not granted. Files may be evicted under storage pressure.")}catch(p){r(`Failed to request persistence: ${p}`)}}return n("div",{class:"file-picker",children:[n("div",{class:"file-picker-header",children:[n("h2",{children:"Open Capsule"}),a&&n("div",{class:"storage-quota",children:[n("div",{class:"quota-bar",children:n("div",{class:"quota-used",style:`width: ${Math.min(a.percentUsed,100)}%`})}),n("p",{class:"quota-text",children:[U(a.usage)," / ",U(a.quota)," used (",a.percentUsed.toFixed(1),"%)"]}),!c&&V()&&n("button",{class:"btn-secondary btn-sm",onClick:g,children:"Request Persistent Storage"})]})]}),n("div",{class:"file-input-section",children:[n("label",{class:"file-input-label",children:[n("input",{type:"file",accept:".mgx.sqlite,.sqlite",onChange:v,disabled:h,style:"display: none"}),n("button",{class:"btn-primary",disabled:h,children:h?"Loading...":"Select File from Device"})]}),n("p",{class:"help-text",children:"Choose a .mgx.sqlite or .sqlite file from your device"})]}),V()&&s.length>0&&n("div",{class:"opfs-files-section",children:[n("h3",{children:"Stored on Device"}),n("ul",{class:"opfs-files-list",children:s.map(p=>n("li",{class:"opfs-file-item",children:[n("button",{class:"opfs-file-button",onClick:()=>N(p.path),disabled:h,children:n("div",{class:"file-info",children:[n("span",{class:"file-name",children:p.path}),n("span",{class:"file-meta",children:[U(p.size)," â€¢"," ",new Date(p.lastModified).toLocaleDateString()]})]})}),n("button",{class:"btn-remove",onClick:_=>y(p.path,_),title:"Remove from device","aria-label":"Remove from device",children:"Ã—"})]},p.path))})]}),!V()&&n("div",{class:"opfs-warning",children:n("p",{children:[n("strong",{children:"Note:"})," Your browser doesn't support persistent storage. Files will only be kept in memory and lost when you close the tab."]})})]})}function Ht(t={}){const{autoLoad:e=!1,maxHops:r=2,limit:s=50}=t,[i,a]=w(null),[o,h]=w(null),[d,c]=w(void 0),[m,l]=w(!1),[u,f]=w(null),v=async(b,x)=>{l(!0),f(null),h(b),c(x);try{const F=await R().graphHops(b,x,r,s);a(F),console.log("[Graph] Loaded:",F.nodes.length,"nodes,",F.edges.length,"edges")}catch(C){const F=String(C);f(F),console.error("[Graph] Failed to load:",C)}finally{l(!1)}},N=async b=>{await v(b,d)},y=async b=>{o&&await v(o,b)},g=()=>{a(null),h(null),c(void 0),f(null)},p=()=>i?Array.from(new Set(i.edges.map(b=>b.predicate))):[],_=b=>i==null?void 0:i.nodes.find(x=>x.gid===b),k=b=>i?i.edges.filter(x=>x.fromGid===b):[];return M(()=>{e&&o&&v(o,d)},[e]),{graphData:i,seedGid:o,predicate:d,loading:m,error:u,predicates:p(),nodeCount:(i==null?void 0:i.nodes.length)||0,edgeCount:(i==null?void 0:i.edges.length)||0,loadGraph:v,navigateToNode:N,filterByPredicate:y,clear:g,getNode:_,getNodeEdges:k}}function Gt({nodes:t,edges:e,seedGid:r,onNodeClick:s,width:i=800,height:a=600}){const[o,h]=w(new Map),d=te();return M(()=>{const c=new Map,m=i/2,l=a/2;t.forEach((u,f)=>{const v=f/t.length*2*Math.PI,N=Math.min(i,a)/3;c.set(u.gid,{gid:u.gid,x:m+N*Math.cos(v),y:l+N*Math.sin(v),vx:0,vy:0})}),h(c)},[t,i,a]),M(()=>{if(o.size===0)return;const c=()=>{const l=new Map(o),u=.3;l.forEach(f=>{l.forEach(v=>{if(f.gid===v.gid)return;const N=v.x-f.x,y=v.y-f.y,g=N*N+y*y+1,p=Math.sqrt(g),_=2e3/g;f.vx-=N/p*_*u,f.vy-=y/p*_*u})}),e.forEach(f=>{const v=l.get(f.fromGid),N=l.get(f.toGid);if(!v||!N)return;const y=N.x-v.x,g=N.y-v.y,p=Math.sqrt(y*y+g*g)+1,_=p*.01;v.vx+=y/p*_*u,v.vy+=g/p*_*u,N.vx-=y/p*_*u,N.vy-=g/p*_*u}),l.forEach(f=>{f.x+=f.vx,f.y+=f.vy,f.vx*=.8,f.vy*=.8,f.x=Math.max(30,Math.min(i-30,f.x)),f.y=Math.max(30,Math.min(a-30,f.y))}),h(l),d.current=requestAnimationFrame(c)};d.current=requestAnimationFrame(c);const m=setTimeout(()=>{d.current&&cancelAnimationFrame(d.current)},3e3);return()=>{d.current&&cancelAnimationFrame(d.current),clearTimeout(m)}},[e,i,a]),n("svg",{width:i,height:a,className:"graph-view",style:{border:"1px solid var(--color-border)",borderRadius:"8px"},children:[n("g",{className:"graph-edges",children:e.map((c,m)=>{const l=o.get(c.fromGid),u=o.get(c.toGid);return!l||!u?null:n("line",{x1:l.x,y1:l.y,x2:u.x,y2:u.y,stroke:"#94a3b8",strokeWidth:Math.max(1,c.weight*2),strokeOpacity:.6,markerEnd:"url(#arrowhead)"},`${c.fromGid}-${c.toGid}-${m}`)})}),n("defs",{children:n("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"10",refX:"9",refY:"3",orient:"auto",markerUnits:"strokeWidth",children:n("path",{d:"M0,0 L0,6 L9,3 z",fill:"#94a3b8"})})}),n("g",{className:"graph-nodes",children:t.map(c=>{const m=o.get(c.gid);if(!m)return null;const l=c.gid===r,u=l?12:8,f=l?"#3b82f6":"#64748b";return n("g",{className:"graph-node",onClick:()=>s==null?void 0:s(c.gid),style:{cursor:s?"pointer":"default"},children:[n("circle",{cx:m.x,cy:m.y,r:u,fill:f,stroke:"#ffffff",strokeWidth:2,opacity:.9}),n("text",{x:m.x,y:m.y-u-5,textAnchor:"middle",fontSize:"11",fill:"var(--color-fg)",style:{pointerEvents:"none",userSelect:"none"},children:c.title||`Page ${c.pageNo}`})]},c.gid)})})]})}function Wt({nodes:t,edges:e,seedGid:r,onNodeClick:s,loading:i,error:a}){return i?n("div",{className:"graph-panel-loading",children:[n("div",{className:"spinner"}),n("p",{children:"Loading graph..."})]}):a?n("div",{className:"graph-panel-error",children:n("p",{children:["Error: ",a]})}):t.length===0?n("div",{className:"graph-panel-empty",children:[n("p",{children:"No graph data to display"}),n("p",{className:"hint",children:"Search for a page or select a result to explore its connections"})]}):n("div",{className:"graph-panel",children:[n("div",{className:"graph-info",children:[n("span",{children:[t.length," nodes"]}),n("span",{children:[e.length," edges"]})]}),n(Gt,{nodes:t,edges:e,seedGid:r,onNodeClick:s,width:800,height:600})]})}function It({predicates:t,selectedPredicate:e,onPredicateChange:r,onReset:s}){return n("div",{className:"graph-controls",children:[n("div",{className:"graph-controls-section",children:[n("label",{className:"graph-controls-label",children:"Filter by Relationship:"}),n("select",{className:"graph-controls-select",value:e||"",onChange:i=>{const a=i.target.value;r(a||void 0)},children:[n("option",{value:"",children:"All Relationships"}),t.map(i=>n("option",{value:i,children:i},i))]})]}),s&&n("button",{className:"btn-secondary btn-sm",onClick:s,children:"Reset View"})]})}function Qt({nodeCount:t,edgeCount:e,predicateCount:r,seedNode:s}){return n("div",{className:"graph-stats",children:[n("div",{className:"graph-stat",children:[n("span",{className:"graph-stat-label",children:"Nodes:"}),n("span",{className:"graph-stat-value",children:t})]}),n("div",{className:"graph-stat",children:[n("span",{className:"graph-stat-label",children:"Edges:"}),n("span",{className:"graph-stat-value",children:e})]}),n("div",{className:"graph-stat",children:[n("span",{className:"graph-stat-label",children:"Relationships:"}),n("span",{className:"graph-stat-value",children:r})]}),s&&n("div",{className:"graph-stat",children:[n("span",{className:"graph-stat-label",children:"Seed:"}),n("span",{className:"graph-stat-value",children:s})]})]})}function Vt(t={}){const{autoLoadCheckpoints:e=!1}=t,[r,s]=w([]),[i,a]=w(null),[o,h]=w(!1),[d,c]=w(!1),[m,l]=w(null),u=async()=>{h(!0),l(null);try{const y=await R().getCheckpoints();s(y),console.log("[Provenance] Loaded",y.length,"checkpoints")}catch(N){const y=String(N);l(y),console.error("[Provenance] Failed to load checkpoints:",N)}finally{h(!1)}},f=async N=>{c(!0),l(null);try{const g=await R().verifyPage(N);a(g),console.log("[Provenance] Verification result:",g)}catch(y){const g=String(y);l(g),console.error("[Provenance] Failed to verify page:",y)}finally{c(!1)}},v=()=>{a(null)};return M(()=>{e&&u()},[e]),{checkpoints:r,verificationResult:i,loading:o,verifying:d,error:m,checkpointCount:r.length,latestCheckpoint:r[0]||null,loadCheckpoints:u,verifyPage:f,clearVerification:v}}function Bt({checkpoint:t,isLatest:e}){return n("div",{className:`checkpoint-item ${e?"checkpoint-latest":""}`,children:[n("div",{className:"checkpoint-header",children:[n("div",{className:"checkpoint-epoch",children:[e&&n("span",{className:"checkpoint-badge",children:"Latest"}),n("span",{className:"checkpoint-epoch-value",children:["Epoch ",t.epoch]})]}),n("div",{className:"checkpoint-date",children:new Date(t.createdTs).toLocaleString()})]}),n("div",{className:"checkpoint-body",children:[n("div",{className:"checkpoint-field",children:[n("span",{className:"field-label",children:"Merkle Root:"}),n("code",{className:"field-value",title:t.merkleRoot,children:[t.merkleRoot.substring(0,16),"..."]})]}),n("div",{className:"checkpoint-field",children:[n("span",{className:"field-label",children:"Pages:"}),n("span",{className:"field-value",children:t.pagesCount})]}),t.anchors&&t.anchors.length>0&&n("div",{className:"checkpoint-field",children:[n("span",{className:"field-label",children:"Anchors:"}),n("span",{className:"field-value",children:t.anchors.length})]})]})]})}function Ut({checkpoints:t,loading:e,error:r}){return e?n("div",{className:"checkpoint-timeline-loading",children:[n("div",{className:"spinner"}),n("p",{children:"Loading checkpoints..."})]}):r?n("div",{className:"checkpoint-timeline-error",children:n("p",{children:["Error: ",r]})}):t.length===0?n("div",{className:"checkpoint-timeline-empty",children:[n("p",{children:"No checkpoints found"}),n("p",{className:"hint",children:"This capsule has not been checkpointed yet"})]}):n("div",{className:"checkpoint-timeline",children:t.map((s,i)=>n(Bt,{checkpoint:s,isLatest:i===0},s.epoch))})}function zt({result:t,verifying:e,onVerify:r}){return e?n("div",{className:"verification-panel verification-loading",children:[n("div",{className:"spinner"}),n("p",{children:"Verifying page integrity..."})]}):t?n("div",{className:`verification-panel ${t.verified?"verification-success":"verification-failure"}`,children:[n("div",{className:"verification-header",children:n("div",{className:"verification-status",children:t.verified?n(q,{children:[n("span",{className:"status-icon",children:"âœ“"}),n("span",{className:"status-text",children:"Verified"})]}):n(q,{children:[n("span",{className:"status-icon",children:"âœ—"}),n("span",{className:"status-text",children:"Verification Failed"})]})})}),n("div",{className:"verification-body",children:[n("div",{className:"verification-field",children:[n("span",{className:"field-label",children:"Content SHA:"}),n("code",{className:"field-value",title:t.contentSha,children:[t.contentSha.substring(0,16),"..."]})]}),t.expectedSha&&n("div",{className:"verification-field",children:[n("span",{className:"field-label",children:"Expected SHA:"}),n("code",{className:"field-value",title:t.expectedSha,children:[t.expectedSha.substring(0,16),"..."]})]}),t.epoch&&n("div",{className:"verification-field",children:[n("span",{className:"field-label",children:"Checkpoint Epoch:"}),n("span",{className:"field-value",children:t.epoch})]}),t.merkleRoot&&n("div",{className:"verification-field",children:[n("span",{className:"field-label",children:"Merkle Root:"}),n("code",{className:"field-value",title:t.merkleRoot,children:[t.merkleRoot.substring(0,16),"..."]})]}),t.signer&&n("div",{className:"verification-field",children:[n("span",{className:"field-label",children:"Signer:"}),n("code",{className:"field-value",children:t.signer})]}),t.signature&&n("div",{className:"verification-field",children:[n("span",{className:"field-label",children:"Signature:"}),n("code",{className:"field-value",title:t.signature,children:[t.signature.substring(0,16),"..."]})]})]}),r&&n("div",{className:"verification-footer",children:n("button",{className:"btn-secondary btn-sm",onClick:r,children:"Verify Again"})})]}):n("div",{className:"verification-panel verification-empty",children:[n("p",{children:'Click "Verify Page" to check integrity'}),r&&n("button",{className:"btn-primary btn-sm",onClick:r,children:"Verify Page"})]})}function jt({checkpoints:t,verificationResult:e,loading:r,verifying:s,error:i,onVerify:a}){const[o,h]=w("checkpoints");return n("div",{className:"provenance-panel",children:[n("div",{className:"provenance-header",children:n("h3",{children:"Provenance & Trust"})}),n("div",{className:"provenance-tabs",children:[n("button",{className:`provenance-tab ${o==="checkpoints"?"active":""}`,onClick:()=>h("checkpoints"),children:["ðŸ“œ Checkpoints (",t.length,")"]}),n("button",{className:`provenance-tab ${o==="verification"?"active":""}`,onClick:()=>h("verification"),children:"ðŸ” Verification"})]}),n("div",{className:"provenance-content",children:[o==="checkpoints"&&n(Ut,{checkpoints:t,loading:r,error:i}),o==="verification"&&n(zt,{result:e,verifying:s,onVerify:a})]})]})}function Yt(t){const{onFocusSearch:e,onToggleLlm:r,onEscape:s}=t;M(()=>{function i(a){const o=a.target,h=o.tagName==="INPUT"||o.tagName==="TEXTAREA"||o.isContentEditable;if(a.key==="/"&&!h){a.preventDefault(),e==null||e();return}if((a.ctrlKey||a.metaKey)&&a.key==="l"){a.preventDefault(),r==null||r();return}if(a.key==="Escape"){s==null||s();return}}return window.addEventListener("keydown",i),()=>{window.removeEventListener("keydown",i)}},[e,r,s])}function Kt(t){return t.startsWith("asset://")?{protocol:"asset",path:t.slice(8)}:null}const ce=new Map,Xt=new Map;async function Jt(t){if(ce.has(t))return ce.get(t);const e=Kt(t);if(!e)return console.error("[Assets] Invalid asset URL:",t),null;try{const s=await R().getPageBlob(e.path);if(!s||s.size===0)return console.warn("[Assets] Asset not found or empty:",e.path),null;const i=URL.createObjectURL(s);return ce.set(t,i),Xt.set(t,s),console.log("[Assets] Loaded:",e.path,`(${s.size} bytes, ${s.type||"unknown type"})`),i}catch(r){return console.error("[Assets] Failed to load asset:",t,r),null}}function Zt(t){const[e,r]=w(null);return M(()=>{if(!t){r(null);return}if(!t.startsWith("asset://")){r(t);return}Jt(t).then(r)},[t]),e}function en({gid:t,onClose:e}){const[r,s]=w(null),[i,a]=w(!0),[o,h]=w(null);M(()=>{(async()=>{a(!0),h(null);try{const u=await R().query("SELECT gid, doc_id, page_no, title, tags, updated_ts FROM meta_index WHERE gid = ? LIMIT 1",[t]);u.length>0?s(u[0]):h("Page not found")}catch(l){h(String(l)),console.error("[PagePreview] Failed to load page:",l)}finally{a(!1)}})()},[t]);const d=r?`asset://glyphs/page_${String(r.pageNo).padStart(4,"0")}.mgx.png`:void 0,c=Zt(d);return i?n("div",{className:"page-preview",children:n("div",{className:"page-preview-loading",children:[n("div",{className:"spinner"}),n("p",{children:"Loading page..."})]})}):o||!r?n("div",{className:"page-preview",children:n("div",{className:"page-preview-error",children:[n("p",{children:["Error: ",o||"Page not found"]}),e&&n("button",{className:"btn-secondary",onClick:e,children:"Close"})]})}):n("div",{className:"page-preview",children:[n("div",{className:"page-preview-header",children:[n("div",{className:"page-preview-title",children:[n("span",{className:"page-number",children:["Page ",r.pageNo]}),n("h3",{children:r.title||"(Untitled)"})]}),e&&n("button",{className:"btn-icon",onClick:e,title:"Close preview",children:"âœ•"})]}),n("div",{className:"page-preview-content",children:c?n("img",{src:c,alt:`Page ${r.pageNo}`,className:"page-image"}):n("div",{className:"page-preview-placeholder",children:n("p",{children:"No image available for this page"})})}),n("div",{className:"page-preview-metadata",children:n("dl",{children:[n("dt",{children:"GID:"}),n("dd",{children:n("code",{title:r.gid,children:[r.gid.substring(0,16),"..."]})}),r.tags&&n(q,{children:[n("dt",{children:"Tags:"}),n("dd",{children:r.tags})]}),n("dt",{children:"Updated:"}),n("dd",{children:new Date(r.updatedTs).toLocaleString()})]})})]})}function tn({selectedGid:t,onClose:e}){return t?n(en,{gid:t,onClose:e}):n("div",{className:"page-preview-panel-empty",children:n("p",{children:"Select a search result to preview the page"})})}function nn({config:t,children:e}){return n("div",{className:"layout-landing",children:[n("section",{className:"hero",children:[n("div",{className:"hero-content",children:[t.logo_asset&&n("img",{src:t.logo_asset,alt:"Logo",className:"hero-logo"}),n("h1",{className:"hero-title",children:t.hero_title||t.site_title||"Welcome"}),t.hero_subtitle&&n("p",{className:"hero-subtitle",children:t.hero_subtitle})]}),t.hero_image&&n("div",{className:"hero-background",style:{backgroundImage:`url(${t.hero_image})`}})]}),n("main",{className:"landing-main",children:e})]})}function rn({config:t,navigation:e,currentPage:r,children:s}){const i=e.filter(a=>a.menu==="sidebar");return n("div",{className:"layout-docs",children:[n("aside",{className:"docs-sidebar",children:n("nav",{className:"docs-nav",children:[n("div",{className:"docs-nav-header",children:[t.logo_asset&&n("img",{src:t.logo_asset,alt:"Logo",className:"docs-logo"}),n("h3",{children:t.site_title||"Documentation"})]}),n("ul",{className:"docs-nav-list",children:i.map(a=>n("li",{className:"docs-nav-item",children:n("a",{href:`#${a.to_slug}`,className:(r==null?void 0:r.slug)===a.to_slug?"active":"",children:[a.icon_asset&&n("img",{src:a.icon_asset,alt:"",className:"nav-icon"}),a.label]})},a.to_slug))})]})}),n("main",{className:"docs-main",children:[r&&n("div",{className:"docs-breadcrumbs",children:[n("a",{href:"#/",children:"Home"}),r.category&&n(q,{children:[n("span",{children:" / "}),n("span",{children:r.category})]}),n("span",{children:" / "}),n("span",{children:r.title})]}),n("article",{className:"docs-content",children:[r&&n("h1",{children:r.title}),s]})]})]})}function Xe({config:t,children:e}){return n("div",{className:"layout-dashboard",children:[n("header",{className:"dashboard-header",children:n("h1",{children:t.site_title||"Dashboard"})}),n("main",{className:"dashboard-content",children:e})]})}function Je({config:t,title:e,children:r}){return n("div",{className:"layout-simple",children:[n("header",{className:"simple-header",children:[t.logo_asset&&n("img",{src:t.logo_asset,alt:"Logo",className:"simple-logo"}),e&&n("h1",{children:e})]}),n("main",{className:"simple-content",children:r}),n("footer",{className:"simple-footer",children:n("p",{children:"Powered by GlyphCapsule"})})]})}function sn({topBar:t,leftSidebar:e,centerPanel:r,rightSidebar:s,showLeftSidebar:i=!0,showRightSidebar:a=!1}){return n("div",{className:"capsule-layout",children:[n("div",{className:"capsule-topbar",children:t}),n("div",{className:"capsule-content",children:[i&&e&&n("aside",{className:"capsule-sidebar capsule-sidebar-left",children:e}),n("main",{className:"capsule-main",children:r}),a&&s&&n("aside",{className:"capsule-sidebar capsule-sidebar-right",children:s})]})]})}function an({capsuleName:t,onClose:e,actions:r}){return n("div",{className:"topbar-content",children:[n("div",{className:"topbar-left",children:n("h2",{className:"topbar-title",children:["ðŸ“¦ ",t]})}),n("div",{className:"topbar-right",children:[r,e&&n("button",{className:"btn-secondary btn-sm",onClick:e,children:"Close Capsule"})]})]})}function ln({title:t,children:e,onClear:r,hasActiveFilters:s=!1}){return n("div",{className:"filter-panel",children:[n("div",{className:"filter-panel-header",children:[n("h3",{children:t}),s&&r&&n("button",{className:"btn-link btn-sm",onClick:r,children:"Clear All"})]}),n("div",{className:"filter-panel-content",children:e})]})}function on({capsuleInfo:t,onClose:e}){var k;const[r,s]=w("search"),[i,a]=w(null),[o,h]=w(!1),d=je({defaultMode:"fts"}),c=Ye({autoLoad:!0}),m=Ht({maxHops:2,limit:50}),l=Vt({autoLoadCheckpoints:!0}),u=Ke({});Yt({onFocusSearch:()=>{const b=document.querySelector('input[name="query"]');b==null||b.focus(),b==null||b.select()},onToggleLlm:()=>{u.toggle()},onEscape:()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()}});const f=b=>{a(b)},v=b=>{m.navigateToNode(b),a(b)},N=b=>{s("graph"),m.loadGraph(b),a(b)},y=()=>{d.clearFilter(),d.lastQuery&&d.search(d.lastQuery)},g=()=>{i&&(l.verifyPage(i),h(!0))},p=async()=>{u.enabled&&d.results&&d.results.length>0&&d.lastQuery&&(u.clearReasoning(),await u.reason(d.lastQuery,d.results,1500))};M(()=>{u.enabled&&d.results&&d.results.length>0&&d.lastQuery&&(!u.reasoning||u.reasoning.usedSnippets.length===0)&&p()},[u.enabled,d.results,d.lastQuery]);const _=!!(d.entityFilter.entityType||d.entityFilter.entityValue);return n(sn,{topBar:n(an,{capsuleName:t.fileName,onClose:e,actions:n(q,{children:[n("div",{className:"capsule-stats",children:[n("span",{children:[t.pageCount," pages"]}),n("span",{children:[t.entityCount," entities"]}),n("span",{children:[t.edgeCount," edges"]})]}),n("button",{className:`btn-secondary btn-sm ${u.enabled?"active":""}`,onClick:u.toggle,disabled:u.loading,title:(k=u.modelInfo)!=null&&k.loaded?"LLM Ready":"Click to load LLM",children:["ðŸ¤– ",u.enabled?"LLM On":"LLM Off"]}),n("button",{className:`btn-secondary btn-sm ${o?"active":""}`,onClick:()=>h(!o),children:[o?"âœ“":""," Provenance"]})]})}),leftSidebar:n(ln,{title:"Entity Filters",onClear:y,hasActiveFilters:_,children:[_&&n("div",{className:"active-filters",children:[n("p",{className:"filter-label",children:"Active Filter:"}),d.entityFilter.entityType&&n("span",{className:"filter-tag",children:["Type: ",d.entityFilter.entityType]}),d.entityFilter.entityValue&&n("span",{className:"filter-tag",children:["Value: ",d.entityFilter.entityValue]})]}),n(Ft,{entities:c.entities,types:c.types,selectedType:c.selectedType,totalCount:c.totalCount,onSelectType:c.selectType,getTypeCount:c.getTypeCount,show:!0,maxDisplay:20})]}),centerPanel:n("div",{className:"capsule-center",children:[n("div",{className:"view-mode-tabs",children:[n("button",{className:`tab-btn ${r==="search"?"active":""}`,onClick:()=>s("search"),children:"ðŸ” Search"}),n("button",{className:`tab-btn ${r==="graph"?"active":""}`,onClick:()=>s("graph"),children:"ðŸ•¸ï¸ Graph"})]}),r==="search"&&n(q,{children:[n(xt,{mode:d.mode,results:d.results,lastQuery:d.lastQuery,loading:d.loading,onSearch:d.search,onModeChange:d.changeMode,onResultClick:f,showModeToggle:!0,placeholder:"Search the capsule...",searchHint:'Try: "vector search", "LEANN", "SQLite", or "hybrid retrieval"',searchHistory:d.searchHistory,onClearHistory:d.clearHistory}),u.enabled&&d.results&&d.results.length>0&&n("div",{className:"llm-section",children:[n("div",{className:"llm-temperature-control",children:[n("label",{htmlFor:"temperature-slider",className:"temperature-label",children:["Creativity:",n("input",{id:"temperature-slider",type:"range",min:"0",max:"1",step:"0.1",value:u.temperature,onChange:b=>u.setTemperature(parseFloat(b.currentTarget.value)),className:"temperature-slider"}),n("span",{className:"temperature-value",children:u.temperature.toFixed(1)})]}),n("small",{className:"temperature-hint",children:[u.temperature<.3&&"â„ï¸ Very factual",u.temperature>=.3&&u.temperature<.6&&"ðŸ“ Mostly factual",u.temperature>=.6&&u.temperature<.8&&"âš–ï¸ Balanced",u.temperature>=.8&&"ðŸŽ¨ Creative"]})]}),u.progress&&n("div",{className:"llm-progress-bar",children:[n("div",{className:"llm-progress-info",children:[n("span",{children:["ðŸ¤– ",u.progress.message]}),n("span",{children:[(u.progress.progress*100).toFixed(0),"%"]})]}),n("div",{className:"llm-progress-track",children:n("div",{className:"llm-progress-fill",style:{width:`${u.progress.progress*100}%`}})})]}),u.reasoning&&n(Tt,{reasoning:u.reasoning,searchResults:d.results,loading:u.loading}),u.loading&&!u.reasoning&&!u.progress&&n("div",{className:"reasoning-loading",children:[n("div",{className:"spinner"}),n("p",{children:"LLM is reasoning over search results..."}),u.elapsedTime>0&&n("p",{className:"inference-time",children:["Elapsed: ",u.elapsedTime.toFixed(1),"s",u.elapsedTime>3&&" â€¢ Typically takes 2-5s"]})]}),u.error&&n("div",{className:"llm-error-panel",children:[n("strong",{children:"âš ï¸ LLM Error:"})," ",u.error,n("button",{className:"btn-secondary btn-sm",onClick:p,disabled:u.loading,style:{marginLeft:"1rem"},children:u.loading?"Retrying...":"Try Again"})]})]}),u.enabled&&(!d.results||d.results.length===0)&&d.lastQuery&&n("div",{className:"llm-no-results",children:n("p",{children:"ðŸ¤– LLM needs search results to reason. Try searching first!"})})]}),r==="graph"&&n("div",{className:"graph-view-container",children:[!m.graphData&&n("div",{className:"graph-view-empty",children:[n("p",{children:"Select a search result to explore its graph connections"}),n("p",{className:"hint",children:"Or switch to Search tab to find pages"})]}),m.graphData&&n(q,{children:[n(Qt,{nodeCount:m.nodeCount,edgeCount:m.edgeCount,predicateCount:m.predicates.length,seedNode:m.seedGid||void 0}),n(It,{predicates:m.predicates,selectedPredicate:m.predicate,onPredicateChange:m.filterByPredicate,onReset:m.clear}),n(Wt,{nodes:m.graphData.nodes,edges:m.graphData.edges,seedGid:m.seedGid||void 0,onNodeClick:v,loading:m.loading,error:m.error})]})]}),i&&n("div",{className:"page-preview-section",children:[n("div",{className:"page-preview-header-actions",children:[n("h3",{children:"Page Preview"}),n("div",{className:"page-preview-actions",children:[r==="search"&&n("button",{className:"btn-secondary btn-sm",onClick:()=>N(i),children:"Explore Graph"}),n("button",{className:"btn-primary btn-sm",onClick:g,disabled:l.verifying,children:l.verifying?"Verifying...":"Verify Page"})]})]}),n(tn,{selectedGid:i,onClose:()=>a(null)})]})]}),rightSidebar:o&&n(jt,{checkpoints:l.checkpoints,verificationResult:l.verificationResult,loading:l.loading,verifying:l.verifying,error:l.error,onVerify:g}),showLeftSidebar:!0,showRightSidebar:o})}async function cn(t){const r=(await t.query("SELECT name FROM sqlite_master WHERE type='table'")).map(u=>u.name),s=r.includes("_ui_pages"),i=r.includes("_ui_dashboards"),a=r.includes("_ui_navigation"),o=r.includes("_ui_params"),h=r.includes("_meta_manifest"),d=r.includes("sqlar"),c=r.some(u=>u.startsWith("fts_"));let m="1.0";if(h)try{const u=await t.query("SELECT value FROM _meta_manifest WHERE key='gcui'");u.length>0&&(m=u[0].value)}catch(u){console.warn("Failed to read GCUI version:",u)}let l;return s&&i?l="hybrid":s?l="website":i?l="dashboard":l="generic",{version:m,hasWebsite:s,hasDashboards:i,hasNavigation:a,hasParams:o,hasFTS:c,hasAssets:d,mode:l}}async function dn(t){try{const e=await t.query("SELECT key, value FROM _meta_manifest");if(e.length===0)return null;const r={gcui:"1.0",capsule_kind:"sqlar"};return e.forEach(s=>{r[s.key]=s.value}),r}catch(e){return console.warn("Failed to load manifest:",e),null}}async function un(t){try{const e=await t.query("SELECT key, value FROM _ui_config"),r={};return e.forEach(s=>{r[s.key]=s.value}),r}catch(e){return console.warn("Failed to load config:",e),{}}}async function hn(t){try{return(await t.query("SELECT slug, title, content, layout, category, order_index FROM _ui_pages ORDER BY order_index ASC, slug ASC")).map(r=>({slug:r.slug,title:r.title,content:r.content||void 0,layout:r.layout||void 0,category:r.category||void 0,order_index:r.order_index||void 0}))}catch(e){return console.warn("Failed to load pages:",e),[]}}async function pn(t){try{return(await t.query("SELECT menu, label, to_slug, order_index, icon_asset FROM _ui_navigation ORDER BY menu, order_index ASC")).map(r=>({menu:r.menu,label:r.label,to_slug:r.to_slug,order_index:r.order_index||void 0,icon_asset:r.icon_asset||void 0}))}catch(e){return console.warn("Failed to load navigation:",e),[]}}async function mn(t){try{return(await t.query("SELECT name, query, grammar, config FROM _ui_dashboards")).map(r=>({name:r.name,query:r.query,grammar:r.grammar||void 0,config:r.config||void 0}))}catch(e){return console.warn("Failed to load dashboards:",e),[]}}async function fn(t){const e=await cn(t),r=await dn(t)||{gcui:e.version,capsule_kind:"sqlar"},s=await un(t),i=e.hasWebsite?await hn(t):[],a=e.hasNavigation?await pn(t):[],o=e.hasDashboards?await mn(t):[];return{manifest:r,capabilities:e,config:s,pages:i,navigation:a,dashboards:o}}function gn({data:t,config:e,width:r=600,height:s=400}){if(!t||t.length===0)return n("div",{className:"chart-empty",style:{width:r,height:s},children:n("p",{children:"No data to display"})});switch(e.mark){case"bar":return n(_n,{data:t,config:e,width:r,height:s});case"line":return n(yn,{data:t,config:e,width:r,height:s});case"point":return n(vn,{data:t,config:e,width:r,height:s});case"area":return n(bn,{data:t,config:e,width:r,height:s});default:return n("div",{className:"chart-unsupported",style:{width:r,height:s},children:[n("p",{children:["Unsupported chart type: ",e.mark]}),n("p",{children:"Showing data as table:"}),n(Nn,{data:t})]})}}function _n({data:t,config:e,width:r,height:s}){var c,m;const{encoding:i}=e,a=((c=i.x)==null?void 0:c.field)||Object.keys(t[0])[0],o=((m=i.y)==null?void 0:m.field)||Object.keys(t[0])[1],h=Math.max(...t.map(l=>Number(l[o])||0)),d=Math.max(20,(r-100)/t.length-10);return n("div",{className:"chart chart-bar",style:{width:r,height:s},children:[e.title&&n("h4",{className:"chart-title",children:e.title}),n("div",{className:"chart-container",style:{height:s-60},children:n("div",{className:"chart-bars",style:{display:"flex",alignItems:"flex-end",height:"100%",gap:"8px"},children:t.map((l,u)=>{const f=Number(l[o])||0,v=f/h*(s-100);return n("div",{className:"chart-bar-item",style:{textAlign:"center"},children:[n("div",{className:"bar",style:{width:d,height:v,backgroundColor:"#6366f1",borderRadius:"4px 4px 0 0"},title:`${l[a]}: ${f}`}),n("div",{className:"bar-label",style:{fontSize:"12px",marginTop:"4px",maxWidth:d,overflow:"hidden",textOverflow:"ellipsis"},children:String(l[a]).slice(0,10)})]},u)})})}),n("div",{className:"chart-legend",style:{fontSize:"12px",marginTop:"8px",textAlign:"center"},children:[n("strong",{children:o})," by ",n("strong",{children:a})]})]})}function yn({data:t,config:e,width:r,height:s}){var y,g;const{encoding:i}=e,a=((y=i.x)==null?void 0:y.field)||Object.keys(t[0])[0],o=((g=i.y)==null?void 0:g.field)||Object.keys(t[0])[1],h=t.map(p=>Number(p[o])||0),d=Math.max(...h),c=Math.min(...h),m=d-c||1,l=r-80,u=s-100,f=l/(t.length-1||1),v=t.map((p,_)=>{const k=40+_*f,b=Number(p[o])||0,x=u-(b-c)/m*u+20;return{x:k,y:x,value:b,label:p[a]}}),N=v.map((p,_)=>`${_===0?"M":"L"} ${p.x} ${p.y}`).join(" ");return n("div",{className:"chart chart-line",style:{width:r,height:s},children:[e.title&&n("h4",{className:"chart-title",children:e.title}),n("svg",{width:r,height:s-40,style:{overflow:"visible"},children:[[0,.25,.5,.75,1].map(p=>{const _=u-p*u+20,k=c+p*m;return n("g",{children:[n("line",{x1:40,y1:_,x2:r-40,y2:_,stroke:"#e5e7eb",strokeWidth:1}),n("text",{x:10,y:_+4,fontSize:10,fill:"#666",children:k.toFixed(0)})]},p)}),n("path",{d:N,fill:"none",stroke:"#6366f1",strokeWidth:2}),v.map((p,_)=>n("circle",{cx:p.x,cy:p.y,r:4,fill:"#6366f1",children:n("title",{children:`${p.label}: ${p.value}`})},_)),v.map((p,_)=>n("text",{x:p.x,y:u+40,fontSize:10,fill:"#666",textAnchor:"middle",children:String(p.label).slice(0,8)},_))]}),n("div",{className:"chart-legend",style:{fontSize:"12px",textAlign:"center"},children:[n("strong",{children:o})," over ",n("strong",{children:a})]})]})}function vn({data:t,config:e,width:r,height:s}){var g,p;const{encoding:i}=e,a=((g=i.x)==null?void 0:g.field)||Object.keys(t[0])[0],o=((p=i.y)==null?void 0:p.field)||Object.keys(t[0])[1],h=t.map(_=>Number(_[a])||0),d=t.map(_=>Number(_[o])||0),c=Math.min(...h),m=Math.max(...h),l=Math.min(...d),u=Math.max(...d),f=m-c||1,v=u-l||1,N=r-80,y=s-100;return n("div",{className:"chart chart-scatter",style:{width:r,height:s},children:[e.title&&n("h4",{className:"chart-title",children:e.title}),n("svg",{width:r,height:s-40,children:[[0,.25,.5,.75,1].map(_=>{const k=y-_*y+20;return n("line",{x1:40,y1:k,x2:r-40,y2:k,stroke:"#e5e7eb",strokeWidth:1},_)}),t.map((_,k)=>{const b=Number(_[a])||0,x=Number(_[o])||0,C=40+(b-c)/f*N,F=y-(x-l)/v*y+20;return n("circle",{cx:C,cy:F,r:5,fill:"#6366f1",opacity:.7,children:n("title",{children:`${a}: ${b}, ${o}: ${x}`})},k)})]}),n("div",{className:"chart-legend",style:{fontSize:"12px",textAlign:"center"},children:[n("strong",{children:o})," vs ",n("strong",{children:a})]})]})}function bn({data:t,config:e,width:r,height:s}){var g,p;const{encoding:i}=e,a=((g=i.x)==null?void 0:g.field)||Object.keys(t[0])[0],o=((p=i.y)==null?void 0:p.field)||Object.keys(t[0])[1],h=t.map(_=>Number(_[o])||0),d=Math.max(...h),c=Math.min(...h),m=d-c||1,l=r-80,u=s-100,f=l/(t.length-1||1),N=t.map((_,k)=>{const b=40+k*f,x=Number(_[o])||0,C=u-(x-c)/m*u+20;return{x:b,y:C}}).map((_,k)=>`${k===0?"M":"L"} ${_.x} ${_.y}`).join(" "),y=`${N} L ${r-40} ${u+20} L 40 ${u+20} Z`;return n("div",{className:"chart chart-area",style:{width:r,height:s},children:[e.title&&n("h4",{className:"chart-title",children:e.title}),n("svg",{width:r,height:s-40,children:[n("path",{d:y,fill:"#6366f1",opacity:.3}),n("path",{d:N,fill:"none",stroke:"#6366f1",strokeWidth:2})]}),n("div",{className:"chart-legend",style:{fontSize:"12px",textAlign:"center"},children:[n("strong",{children:o})," over ",n("strong",{children:a})]})]})}function Nn({data:t}){if(t.length===0)return null;const e=Object.keys(t[0]);return n("table",{className:"data-table",style:{width:"100%",borderCollapse:"collapse",fontSize:"12px"},children:[n("thead",{children:n("tr",{children:e.map(r=>n("th",{style:{borderBottom:"2px solid #ddd",padding:"8px",textAlign:"left"},children:r},r))})}),n("tbody",{children:t.slice(0,10).map((r,s)=>n("tr",{children:e.map(i=>n("td",{style:{borderBottom:"1px solid #eee",padding:"6px"},children:String(r[i])},i))},s))})]})}function Ze({dashboards:t}){return t.length===0?n("div",{className:"dashboard-empty",children:n("p",{children:"No dashboards defined"})}):n("div",{className:"dashboard-grid",children:t.map(e=>n(wn,{dashboard:e},e.name))})}function wn({dashboard:t}){const[e,r]=w(null),[s,i]=w(!1),[a,o]=w(null);M(()=>{h()},[t.query]);const h=async()=>{i(!0),o(null);try{const m=await R().query(t.query);r(m)}catch(c){o(String(c)),console.error(`[Dashboard] Failed to load ${t.name}:`,c)}finally{i(!1)}};if(s)return n("div",{className:"dashboard-panel loading",children:[n("div",{className:"spinner"}),n("p",{children:["Loading ",t.name,"..."]})]});if(a)return n("div",{className:"dashboard-panel error",children:[n("h4",{children:t.name}),n("p",{className:"error-message",children:["Error: ",a]}),n("details",{children:[n("summary",{children:"Query"}),n("pre",{children:t.query})]})]});if(!e||e.length===0)return n("div",{className:"dashboard-panel empty",children:[n("h4",{children:t.name}),n("p",{children:"No data"})]});let d=null;if(t.config)try{d=JSON.parse(t.config)}catch(c){console.error(`[Dashboard] Invalid config for ${t.name}:`,c)}return!d||t.grammar!=="vegalite-lite-v1"?n("div",{className:"dashboard-panel table",children:[n("h4",{children:t.name}),n(kn,{data:e})]}):n("div",{className:"dashboard-panel chart",children:n(gn,{data:e,config:d,width:600,height:400})})}function kn({data:t}){const e=Object.keys(t[0]||{});return n("div",{style:{overflowX:"auto"},children:n("table",{className:"dashboard-table",style:{width:"100%",borderCollapse:"collapse",fontSize:"14px"},children:[n("thead",{children:n("tr",{children:e.map(r=>n("th",{style:{borderBottom:"2px solid #ddd",padding:"12px",textAlign:"left",fontWeight:600},children:r},r))})}),n("tbody",{children:t.map((r,s)=>n("tr",{style:{borderBottom:"1px solid #eee"},children:e.map(i=>n("td",{style:{padding:"10px"},children:String(r[i])},i))},s))})]})})}function xn({content:t}){const e=Sn(t);return n("div",{className:"markdown-content",dangerouslySetInnerHTML:{__html:e}})}function Sn(t){let e=t;return e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),e=e.replace(/^### (.*$)/gim,"<h3>$1</h3>"),e=e.replace(/^## (.*$)/gim,"<h2>$1</h2>"),e=e.replace(/^# (.*$)/gim,"<h1>$1</h1>"),e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/\*(.*?)\*/g,"<em>$1</em>"),e=e.replace(/`(.*?)`/g,"<code>$1</code>"),e=e.replace(/\[(.*?)\]\((.*?)\)/g,'<a href="$2">$1</a>'),e=e.replace(/```(.*?)\n([\s\S]*?)```/g,"<pre><code>$2</code></pre>"),e=e.replace(/^\- (.*$)/gim,"<li>$1</li>"),e=e.replace(/(<li>.*<\/li>)/s,"<ul>$1</ul>"),e=e.replace(/^\d+\. (.*$)/gim,"<li>$1</li>"),e=e.split(`

`).map(s=>s.startsWith("<h")||s.startsWith("<ul>")||s.startsWith("<ol>")||s.startsWith("<pre>")||s.startsWith("<li>")?s:`<p>${s}</p>`).join(`
`),e=e.replace(/\n/g,"<br>"),e}function Cn({context:t}){const[e,r]=w("/");M(()=>{const i=()=>{const a=window.location.hash.slice(1);r(a||"/")};return window.addEventListener("hashchange",i),i(),()=>window.removeEventListener("hashchange",i)},[]);const s=t.pages.find(i=>i.slug===e)||t.pages[0];return s?n(Fn,{page:s,context:t}):t.dashboards.length>0?n(Xe,{config:t.config,children:n(Ze,{dashboards:t.dashboards})}):n(Je,{config:t.config,title:"404 Not Found",children:[n("p",{children:["Page not found: ",e]}),n("p",{children:n("a",{href:"#/",children:"Go home"})})]})}function Fn({page:t,context:e}){const r=t.layout||"simple",s=t.content?n(xn,{content:t.content}):n("p",{children:"No content"});switch(r){case"landing":return n(nn,{config:e.config,children:s});case"docs":return n(rn,{config:e.config,navigation:e.navigation,currentPage:t,children:s});case"dashboard":return n(Xe,{config:e.config,children:[s,e.dashboards.length>0&&n(Ze,{dashboards:e.dashboards})]});case"simple":default:return n(Je,{config:e.config,title:t.title,children:s})}}const En={mode:"website",bundledCapsule:"/memglyph-demo.mgx.sqlite",branding:{title:"Memglyph",tagline:"Your knowledge, crystallized",logoUrl:"/logo.svg"},features:{llm:{enabled:!0,autoReason:!1,defaultModel:"qwen3-0.6b",maxTokens:256},search:{defaultMode:"hybrid",enabledModes:["fts","hybrid"],showModeToggle:!1},graph:{enabled:!0,maxHops:2,defaultMaxHops:1},upload:{enabled:!1,acceptedExtensions:[]},gcui:{enabled:!0,fallbackToGeneric:!1},pwa:{enabled:!0,offlineMode:!0}},ui:{showLanding:!0,theme:"documentation"}},Ln={mode:"viewer",bundledCapsule:"/memglyph-demo.mgx.sqlite",branding:{title:"SQLAR Viewer",tagline:"Query your knowledge capsules",logoUrl:"/sqlar-logo.svg"},features:{llm:{enabled:!0,autoReason:!1,defaultModel:"qwen3-0.6b",maxTokens:256},search:{defaultMode:"hybrid",enabledModes:["fts","hybrid","graph"],showModeToggle:!0},graph:{enabled:!0,maxHops:3,defaultMaxHops:2},upload:{enabled:!0,acceptedExtensions:[".sqlite",".sqlar",".db",".mgx.sqlite"]},gcui:{enabled:!0,fallbackToGeneric:!0},pwa:{enabled:!0,offlineMode:!0}},ui:{showLanding:!1,theme:"tool"}};function Tn(){return"website"}function Pn(){return Tn()==="viewer"?Ln:En}function Mn(){const t=Pn(),[e,r]=w(null),[s,i]=w(null),[a,o]=w(!1),[h,d]=w(null),[c,m]=w(!1);je({defaultMode:t.features.search.defaultMode});const l=Ye({autoLoad:!1});return Ke({}),M(()=>{e&&(l.loadEntities(),(async()=>{try{const g=R(),p=await fn(g);console.log("[GCUI] Detected capabilities:",p.capabilities),p.capabilities.mode!=="generic"?(i(p),console.log("[GCUI] Rendering in",p.capabilities.mode,"mode")):(console.log("[GCUI] No GCUI tables found, using legacy mode"),i(null))}catch(g){console.warn("[GCUI] Detection failed, using legacy mode:",g),i(null)}})())},[e]),n("div",{className:"app",children:[n("header",{className:"app-header",children:[n("h1",{children:"Glyphcapsule Explorer"}),n("p",{children:"Hybrid Retrieval Demo for MemGlyph"})]}),n("main",{className:"app-main",children:e?s&&t.features.gcui.enabled?n("div",{className:"gcui-mode",children:n(Cn,{context:s})}):n(on,{capsuleInfo:e,onClose:()=>r(null)}):n("div",{className:"welcome",children:[h&&n("div",{className:"error",style:"max-width: 600px; margin: 1rem auto;",children:[n("strong",{children:"Error:"})," ",h]}),n(At,{onFileSelected:async(y,g)=>{o(!0),d(null);try{const _=await R().openFromFile(y);r(_),console.log("Capsule opened:",_)}catch(p){d(String(p)),console.error("Failed to open file:",p)}finally{o(!1)}},onOpfsFileSelected:async y=>{o(!0),d(null);try{const p=await R().openFromOpfs(y);r(p),console.log("Capsule opened from OPFS:",p)}catch(g){d(String(g)),console.error("Failed to open from OPFS:",g)}finally{o(!1)}},onError:y=>{d(y)}}),n("div",{style:"text-align: center; margin-top: 1.5rem;",children:[n("p",{style:"margin-bottom: 0.5rem; opacity: 0.7;",children:"Or try the demo:"}),n("button",{className:"btn-secondary",onClick:async()=>{o(!0),d(null);try{const g=await R().openDemo();r(g),console.log("Capsule info:",g)}catch(y){d(String(y)),console.error("Failed to open capsule:",y)}finally{o(!1)}},disabled:a,children:a?"Loading Demo...":"Load Demo Capsule"})]})]})}),n("footer",{className:"app-footer",children:n("p",{children:"Built with Preact + SQLite WASM + OPFS"})})]})}ct(n(Mn,{}),document.getElementById("app"));
