var Ge=Object.defineProperty;var Be=(t,e,n)=>e in t?Ge(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var L=(t,e,n)=>Be(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();var Y,S,Se,q,he,Fe,Ee,Ce,le,ne,re,I={},Le=[],Qe=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,K=Array.isArray;function T(t,e){for(var n in e)t[n]=e[n];return t}function ce(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function Ue(t,e,n){var s,o,i,l={};for(i in e)i=="key"?s=e[i]:i=="ref"?o=e[i]:l[i]=e[i];if(arguments.length>2&&(l.children=arguments.length>3?Y.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(i in t.defaultProps)l[i]===void 0&&(l[i]=t.defaultProps[i]);return Q(t,l,s,o,null)}function Q(t,e,n,s,o){var i={type:t,props:e,key:n,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:o??++Se,__i:-1,__u:0};return o==null&&S.vnode!=null&&S.vnode(i),i}function H(t){return t.children}function U(t,e){this.props=t,this.context=e}function D(t,e){if(e==null)return t.__?D(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?D(t):null}function Me(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return Me(t)}}function _e(t){(!t.__d&&(t.__d=!0)&&q.push(t)&&!j.__r++||he!=S.debounceRendering)&&((he=S.debounceRendering)||Fe)(j)}function j(){for(var t,e,n,s,o,i,l,d=1;q.length;)q.length>d&&q.sort(Ee),t=q.shift(),d=q.length,t.__d&&(n=void 0,s=void 0,o=(s=(e=t).__v).__e,i=[],l=[],e.__P&&((n=T({},s)).__v=s.__v+1,S.vnode&&S.vnode(n),de(e.__P,n,s,e.__n,e.__P.namespaceURI,32&s.__u?[o]:null,i,o??D(s),!!(32&s.__u),l),n.__v=s.__v,n.__.__k[n.__i]=n,qe(i,n,l),s.__e=s.__=null,n.__e!=o&&Me(n)));j.__r=0}function Te(t,e,n,s,o,i,l,d,h,c,f){var a,_,p,w,x,N,m,u=s&&s.__k||Le,g=e.length;for(h=ze(n,e,u,h,g),a=0;a<g;a++)(p=n.__k[a])!=null&&(_=p.__i==-1?I:u[p.__i]||I,p.__i=a,N=de(t,p,_,o,i,l,d,h,c,f),w=p.__e,p.ref&&_.ref!=p.ref&&(_.ref&&ue(_.ref,null,p),f.push(p.ref,p.__c||w,p)),x==null&&w!=null&&(x=w),(m=!!(4&p.__u))||_.__k===p.__k?h=$e(p,h,t,m):typeof p.type=="function"&&N!==void 0?h=N:w&&(h=w.nextSibling),p.__u&=-7);return n.__e=x,h}function ze(t,e,n,s,o){var i,l,d,h,c,f=n.length,a=f,_=0;for(t.__k=new Array(o),i=0;i<o;i++)(l=e[i])!=null&&typeof l!="boolean"&&typeof l!="function"?(h=i+_,(l=t.__k[i]=typeof l=="string"||typeof l=="number"||typeof l=="bigint"||l.constructor==String?Q(null,l,null,null,null):K(l)?Q(H,{children:l},null,null,null):l.constructor==null&&l.__b>0?Q(l.type,l.props,l.key,l.ref?l.ref:null,l.__v):l).__=t,l.__b=t.__b+1,d=null,(c=l.__i=je(l,n,h,a))!=-1&&(a--,(d=n[c])&&(d.__u|=2)),d==null||d.__v==null?(c==-1&&(o>f?_--:o<f&&_++),typeof l.type!="function"&&(l.__u|=4)):c!=h&&(c==h-1?_--:c==h+1?_++:(c>h?_--:_++,l.__u|=4))):t.__k[i]=null;if(a)for(i=0;i<f;i++)(d=n[i])!=null&&!(2&d.__u)&&(d.__e==s&&(s=D(d)),Oe(d,d));return s}function $e(t,e,n,s){var o,i;if(typeof t.type=="function"){for(o=t.__k,i=0;o&&i<o.length;i++)o[i]&&(o[i].__=t,e=$e(o[i],e,n,s));return e}t.__e!=e&&(s&&(e&&t.type&&!e.parentNode&&(e=D(t)),n.insertBefore(t.__e,e||null)),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function je(t,e,n,s){var o,i,l,d=t.key,h=t.type,c=e[n],f=c!=null&&(2&c.__u)==0;if(c===null&&t.key==null||f&&d==c.key&&h==c.type)return n;if(s>(f?1:0)){for(o=n-1,i=n+1;o>=0||i<e.length;)if((c=e[l=o>=0?o--:i++])!=null&&!(2&c.__u)&&d==c.key&&h==c.type)return l}return-1}function pe(t,e,n){e[0]=="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||Qe.test(e)?n:n+"px"}function B(t,e,n,s,o){var i,l;e:if(e=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof s=="string"&&(t.style.cssText=s=""),s)for(e in s)n&&e in n||pe(t.style,e,"");if(n)for(e in n)s&&n[e]==s[e]||pe(t.style,e,n[e])}else if(e[0]=="o"&&e[1]=="n")i=e!=(e=e.replace(Ce,"$1")),l=e.toLowerCase(),e=l in t||e=="onFocusOut"||e=="onFocusIn"?l.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+i]=n,n?s?n.u=s.u:(n.u=le,t.addEventListener(e,i?re:ne,i)):t.removeEventListener(e,i?re:ne,i);else{if(o=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function fe(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.t==null)e.t=le++;else if(e.t<n.u)return;return n(S.event?S.event(e):e)}}}function de(t,e,n,s,o,i,l,d,h,c){var f,a,_,p,w,x,N,m,u,g,y,v,b,F,P,W,X,M=e.type;if(e.constructor!=null)return null;128&n.__u&&(h=!!(32&n.__u),i=[d=e.__e=n.__e]),(f=S.__b)&&f(e);e:if(typeof M=="function")try{if(m=e.props,u="prototype"in M&&M.prototype.render,g=(f=M.contextType)&&s[f.__c],y=f?g?g.props.value:f.__:s,n.__c?N=(a=e.__c=n.__c).__=a.__E:(u?e.__c=a=new M(m,y):(e.__c=a=new U(m,y),a.constructor=M,a.render=Ye),g&&g.sub(a),a.props=m,a.state||(a.state={}),a.context=y,a.__n=s,_=a.__d=!0,a.__h=[],a._sb=[]),u&&a.__s==null&&(a.__s=a.state),u&&M.getDerivedStateFromProps!=null&&(a.__s==a.state&&(a.__s=T({},a.__s)),T(a.__s,M.getDerivedStateFromProps(m,a.__s))),p=a.props,w=a.state,a.__v=e,_)u&&M.getDerivedStateFromProps==null&&a.componentWillMount!=null&&a.componentWillMount(),u&&a.componentDidMount!=null&&a.__h.push(a.componentDidMount);else{if(u&&M.getDerivedStateFromProps==null&&m!==p&&a.componentWillReceiveProps!=null&&a.componentWillReceiveProps(m,y),!a.__e&&a.shouldComponentUpdate!=null&&a.shouldComponentUpdate(m,a.__s,y)===!1||e.__v==n.__v){for(e.__v!=n.__v&&(a.props=m,a.state=a.__s,a.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some(function(O){O&&(O.__=e)}),v=0;v<a._sb.length;v++)a.__h.push(a._sb[v]);a._sb=[],a.__h.length&&l.push(a);break e}a.componentWillUpdate!=null&&a.componentWillUpdate(m,a.__s,y),u&&a.componentDidUpdate!=null&&a.__h.push(function(){a.componentDidUpdate(p,w,x)})}if(a.context=y,a.props=m,a.__P=t,a.__e=!1,b=S.__r,F=0,u){for(a.state=a.__s,a.__d=!1,b&&b(e),f=a.render(a.props,a.state,a.context),P=0;P<a._sb.length;P++)a.__h.push(a._sb[P]);a._sb=[]}else do a.__d=!1,b&&b(e),f=a.render(a.props,a.state,a.context),a.state=a.__s;while(a.__d&&++F<25);a.state=a.__s,a.getChildContext!=null&&(s=T(T({},s),a.getChildContext())),u&&!_&&a.getSnapshotBeforeUpdate!=null&&(x=a.getSnapshotBeforeUpdate(p,w)),W=f,f!=null&&f.type===H&&f.key==null&&(W=Pe(f.props.children)),d=Te(t,K(W)?W:[W],e,n,s,o,i,l,d,h,c),a.base=e.__e,e.__u&=-161,a.__h.length&&l.push(a),N&&(a.__E=a.__=null)}catch(O){if(e.__v=null,h||i!=null)if(O.then){for(e.__u|=h?160:128;d&&d.nodeType==8&&d.nextSibling;)d=d.nextSibling;i[i.indexOf(d)]=null,e.__e=d}else{for(X=i.length;X--;)ce(i[X]);se(e)}else e.__e=n.__e,e.__k=n.__k,O.then||se(e);S.__e(O,e,n)}else i==null&&e.__v==n.__v?(e.__k=n.__k,e.__e=n.__e):d=e.__e=Ve(n.__e,e,n,s,o,i,l,h,c);return(f=S.diffed)&&f(e),128&e.__u?void 0:d}function se(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(se)}function qe(t,e,n){for(var s=0;s<n.length;s++)ue(n[s],n[++s],n[++s]);S.__c&&S.__c(e,t),t.some(function(o){try{t=o.__h,o.__h=[],t.some(function(i){i.call(o)})}catch(i){S.__e(i,o.__v)}})}function Pe(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:K(t)?t.map(Pe):T({},t)}function Ve(t,e,n,s,o,i,l,d,h){var c,f,a,_,p,w,x,N=n.props,m=e.props,u=e.type;if(u=="svg"?o="http://www.w3.org/2000/svg":u=="math"?o="http://www.w3.org/1998/Math/MathML":o||(o="http://www.w3.org/1999/xhtml"),i!=null){for(c=0;c<i.length;c++)if((p=i[c])&&"setAttribute"in p==!!u&&(u?p.localName==u:p.nodeType==3)){t=p,i[c]=null;break}}if(t==null){if(u==null)return document.createTextNode(m);t=document.createElementNS(o,u,m.is&&m),d&&(S.__m&&S.__m(e,i),d=!1),i=null}if(u==null)N===m||d&&t.data==m||(t.data=m);else{if(i=i&&Y.call(t.childNodes),N=n.props||I,!d&&i!=null)for(N={},c=0;c<t.attributes.length;c++)N[(p=t.attributes[c]).name]=p.value;for(c in N)if(p=N[c],c!="children"){if(c=="dangerouslySetInnerHTML")a=p;else if(!(c in m)){if(c=="value"&&"defaultValue"in m||c=="checked"&&"defaultChecked"in m)continue;B(t,c,null,p,o)}}for(c in m)p=m[c],c=="children"?_=p:c=="dangerouslySetInnerHTML"?f=p:c=="value"?w=p:c=="checked"?x=p:d&&typeof p!="function"||N[c]===p||B(t,c,p,N[c],o);if(f)d||a&&(f.__html==a.__html||f.__html==t.innerHTML)||(t.innerHTML=f.__html),e.__k=[];else if(a&&(t.innerHTML=""),Te(e.type=="template"?t.content:t,K(_)?_:[_],e,n,s,u=="foreignObject"?"http://www.w3.org/1999/xhtml":o,i,l,i?i[0]:n.__k&&D(n,0),d,h),i!=null)for(c=i.length;c--;)ce(i[c]);d||(c="value",u=="progress"&&w==null?t.removeAttribute("value"):w!=null&&(w!==t[c]||u=="progress"&&!w||u=="option"&&w!=N[c])&&B(t,c,w,N[c],o),c="checked",x!=null&&x!=t[c]&&B(t,c,x,N[c],o))}return t}function ue(t,e,n){try{if(typeof t=="function"){var s=typeof t.__u=="function";s&&t.__u(),s&&e==null||(t.__u=t(e))}else t.current=e}catch(o){S.__e(o,n)}}function Oe(t,e,n){var s,o;if(S.unmount&&S.unmount(t),(s=t.ref)&&(s.current&&s.current!=t.__e||ue(s,null,e)),(s=t.__c)!=null){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(i){S.__e(i,e)}s.base=s.__P=null}if(s=t.__k)for(o=0;o<s.length;o++)s[o]&&Oe(s[o],e,n||typeof t.type!="function");n||ce(t.__e),t.__c=t.__=t.__e=void 0}function Ye(t,e,n){return this.constructor(t,n)}function Ke(t,e,n){var s,o,i,l;e==document&&(e=document.documentElement),S.__&&S.__(t,e),o=(s=!1)?null:e.__k,i=[],l=[],de(e,t=e.__k=Ue(H,null,[t]),o||I,I,e.namespaceURI,o?null:e.firstChild?Y.call(e.childNodes):null,i,o?o.__e:e.firstChild,s,l),qe(i,t,l)}Y=Le.slice,S={__e:function(t,e,n,s){for(var o,i,l;e=e.__;)if((o=e.__c)&&!o.__)try{if((i=o.constructor)&&i.getDerivedStateFromError!=null&&(o.setState(i.getDerivedStateFromError(t)),l=o.__d),o.componentDidCatch!=null&&(o.componentDidCatch(t,s||{}),l=o.__d),l)return o.__E=o}catch(d){t=d}throw t}},Se=0,U.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=T({},this.state),typeof t=="function"&&(t=t(T({},n),this.props)),t&&T(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),_e(this))},U.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),_e(this))},U.prototype.render=H,q=[],Fe=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Ee=function(t,e){return t.__v.__b-e.__v.__b},j.__r=0,Ce=/(PointerCapture)$|Capture$/i,le=0,ne=fe(!1),re=fe(!0);var Xe=0;function r(t,e,n,s,o,i){e||(e={});var l,d,h=e;if("ref"in h)for(d in h={},e)d=="ref"?l=e[d]:h[d]=e[d];var c={type:t,props:h,key:n,ref:l,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Xe,__i:-1,__u:0,__source:o,__self:i};if(typeof t=="function"&&(l=t.defaultProps))for(d in l)h[d]===void 0&&(h[d]=l[d]);return S.vnode&&S.vnode(c),c}var V,E,J,me,ie=0,Re=[],C=S,ge=C.__b,ye=C.__r,ve=C.diffed,be=C.__c,we=C.unmount,Ne=C.__;function De(t,e){C.__h&&C.__h(E,t,ie||e),ie=0;var n=E.__H||(E.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function k(t){return ie=1,Je(He,t)}function Je(t,e,n){var s=De(V++,2);if(s.t=t,!s.__c&&(s.__=[He(void 0,e),function(d){var h=s.__N?s.__N[0]:s.__[0],c=s.t(h,d);h!==c&&(s.__N=[c,s.__[1]],s.__c.setState({}))}],s.__c=E,!E.__f)){var o=function(d,h,c){if(!s.__c.__H)return!0;var f=s.__c.__H.__.filter(function(_){return!!_.__c});if(f.every(function(_){return!_.__N}))return!i||i.call(this,d,h,c);var a=s.__c.props!==d;return f.forEach(function(_){if(_.__N){var p=_.__[0];_.__=_.__N,_.__N=void 0,p!==_.__[0]&&(a=!0)}}),i&&i.call(this,d,h,c)||a};E.__f=!0;var i=E.shouldComponentUpdate,l=E.componentWillUpdate;E.componentWillUpdate=function(d,h,c){if(this.__e){var f=i;i=void 0,o(d,h,c),i=f}l&&l.call(this,d,h,c)},E.shouldComponentUpdate=o}return s.__N||s.__}function G(t,e){var n=De(V++,3);!C.__s&&tt(n.__H,e)&&(n.__=t,n.u=e,E.__H.__h.push(n))}function Ze(){for(var t;t=Re.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(z),t.__H.__h.forEach(oe),t.__H.__h=[]}catch(e){t.__H.__h=[],C.__e(e,t.__v)}}C.__b=function(t){E=null,ge&&ge(t)},C.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),Ne&&Ne(t,e)},C.__r=function(t){ye&&ye(t),V=0;var e=(E=t.__c).__H;e&&(J===E?(e.__h=[],E.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(e.__h.forEach(z),e.__h.forEach(oe),e.__h=[],V=0)),J=E},C.diffed=function(t){ve&&ve(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(Re.push(e)!==1&&me===C.requestAnimationFrame||((me=C.requestAnimationFrame)||et)(Ze)),e.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),J=E=null},C.__c=function(t,e){e.some(function(n){try{n.__h.forEach(z),n.__h=n.__h.filter(function(s){return!s.__||oe(s)})}catch(s){e.some(function(o){o.__h&&(o.__h=[])}),e=[],C.__e(s,n.__v)}}),be&&be(t,e)},C.unmount=function(t){we&&we(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(s){try{z(s)}catch(o){e=o}}),n.__H=void 0,e&&C.__e(e,n.__v))};var ke=typeof requestAnimationFrame=="function";function et(t){var e,n=function(){clearTimeout(s),ke&&cancelAnimationFrame(e),setTimeout(t)},s=setTimeout(n,35);ke&&(e=requestAnimationFrame(n))}function z(t){var e=E,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),E=e}function oe(t){var e=E;t.__c=t.__(),E=e}function tt(t,e){return!t||t.length!==e.length||e.some(function(n,s){return n!==t[s]})}function He(t,e){return typeof e=="function"?e(t):e}const nt={maxQueueSize:50,defaultTimeout:1e4,maxTimeout:3e4};class rt{constructor(e={}){L(this,"queue",[]);L(this,"processing",!1);L(this,"nextId",1);L(this,"config");L(this,"stats",{totalProcessed:0,totalTimeouts:0,totalErrors:0});this.config={...nt,...e}}async enqueue(e,n){if(this.queue.length>=this.config.maxQueueSize)throw new Error(`Query queue full (${this.config.maxQueueSize} items). Too many pending queries.`);const s=Math.min(n||this.config.defaultTimeout,this.config.maxTimeout);return new Promise((o,i)=>{const l={id:this.nextId++,execute:e,resolve:o,reject:i,timeout:s,enqueuedAt:Date.now()};this.queue.push(l),this.processing||this.processQueue()})}async processQueue(){if(!(this.processing||this.queue.length===0)){for(this.processing=!0;this.queue.length>0;){const e=this.queue.shift();try{await this.executeWithTimeout(e)}catch{}}this.processing=!1}}async executeWithTimeout(e){const n=new Promise((s,o)=>{setTimeout(()=>{o(new Error(`Query ${e.id} timed out after ${e.timeout}ms`))},e.timeout)});try{const s=await Promise.race([e.execute(),n]);this.stats.totalProcessed++,e.resolve(s)}catch(s){s instanceof Error&&s.message.includes("timed out")?(this.stats.totalTimeouts++,console.warn(`[QueryQueue] Query ${e.id} timed out`,{timeout:e.timeout,waitTime:Date.now()-e.enqueuedAt})):this.stats.totalErrors++,e.reject(s)}}getStats(){return{queueLength:this.queue.length,busy:this.processing,totalProcessed:this.stats.totalProcessed,totalTimeouts:this.stats.totalTimeouts,totalErrors:this.stats.totalErrors}}isBusy(){return this.processing||this.queue.length>0}clear(){const e=new Error("Query queue cleared");for(const n of this.queue)n.reject(e);this.queue=[]}get length(){return this.queue.length}}let Z=null;function ae(t){return Z||(Z=new rt(t)),Z}function st(t,e){return ae().enqueue(t,e)}class it{constructor(){L(this,"worker",null);L(this,"nextId",1);L(this,"pending",new Map);this.initWorker()}initWorker(){this.worker=new Worker(new URL("/assets/sqlite.worker-B9s5gY5D.js",import.meta.url),{type:"module"}),this.worker.onmessage=e=>{const n=e.data;if("type"in n&&n.type==="READY"){console.log("[DbClient] Worker ready");return}const{id:s,response:o}=n,i=this.pending.get(s);i&&(this.pending.delete(s),i.resolve(o))},this.worker.onerror=e=>{console.error("[DbClient] Worker error:",e);for(const n of this.pending.values())n.reject(new Error("Worker error"));this.pending.clear()}}async sendRequest(e,n=1e4){if(!this.worker)throw new Error("Worker not initialized");const s=this.nextId++;return st(async()=>new Promise((o,i)=>{const l=setTimeout(()=>{this.pending.delete(s),i(new Error(`Request ${e.type} timed out after ${n}ms`))},n);this.pending.set(s,{resolve:h=>{clearTimeout(l),h.ok?o(h.data):i(new Error(h.error))},reject:h=>{clearTimeout(l),i(h)},timeout:l});const d={id:s,request:e};this.worker.postMessage(d)}),n)}async openFromFile(e){return this.sendRequest({type:"OPEN_FROM_FILE",file:e})}async openFromOpfs(e){return this.sendRequest({type:"OPEN_FROM_OPFS",path:e})}async openDemo(){return this.sendRequest({type:"OPEN_DEMO"})}async saveToOpfs(e){return this.sendRequest({type:"SAVE_TO_OPFS",path:e})}async removeFromOpfs(e){return this.sendRequest({type:"REMOVE_FROM_OPFS",path:e})}async listOpfsFiles(){return this.sendRequest({type:"LIST_OPFS_FILES"})}async close(){return this.sendRequest({type:"CLOSE"})}async searchFts(e,n=20,s,o){return this.sendRequest({type:"FTS_SEARCH",query:e,limit:n,entityType:s,entityValue:o})}async searchHybrid(e,n=20,s){return this.sendRequest({type:"HYBRID_SEARCH",query:e,limit:n,weights:s})}async listEntities(e,n=100){return this.sendRequest({type:"LIST_ENTITIES",entityType:e,limit:n})}async getPageList(e=100,n=0){return this.sendRequest({type:"GET_PAGE_LIST",limit:e,offset:n})}async getPageBlob(e){return this.sendRequest({type:"GET_PAGE_BLOB",name:e})}async verifyPage(e){return this.sendRequest({type:"VERIFY_PAGE",gid:e})}async getCheckpoints(){return this.sendRequest({type:"GET_CHECKPOINTS"})}async graphHops(e,n,s,o){return this.sendRequest({type:"GRAPH_HOPS",seedGid:e,predicate:n,maxHops:s,limit:o})}getQueueStats(){return ae().getStats()}isQueueBusy(){return ae().isBusy()}terminate(){this.worker&&(this.worker.terminate(),this.worker=null);for(const e of this.pending.values())clearTimeout(e.timeout),e.reject(new Error("Worker terminated"));this.pending.clear()}}let ee=null;function $(){return ee||(ee=new it),ee}function ot(t={}){const{defaultMode:e="hybrid",maxResults:n=10,maxGraphHops:s=2}=t,[o,i]=k(e),[l,d]=k(null),[h,c]=k(""),[f,a]=k(!1),[_,p]=k(null),[w,x]=k({});return{mode:o,results:l,lastQuery:h,loading:f,error:_,entityFilter:w,search:async v=>{if(v.trim()){a(!0),p(null),c(v);try{const b=$();let F=[];switch(o){case"fts":F=await at(b,v,n,w);break;case"hybrid":F=await b.searchHybrid(v,n);break;case"graph":F=await lt(b,v,n,s,w);break;default:throw new Error(`Unknown search mode: ${o}`)}return d(F),console.log(`[Search] ${o} mode: ${F.length} results`),F}catch(b){const F=String(b);return p(F),console.error("[Search] Failed:",b),[]}finally{a(!1)}}},clear:()=>{d(null),c(""),p(null)},changeMode:v=>{i(v),d(null)},setFilter:v=>{x(v),d(null)},clearFilter:()=>{x({}),d(null)}}}async function at(t,e,n,s){return(await t.searchFts(e,n,s.entityType,s.entityValue)).map(i=>({gid:i.gid,pageNo:i.pageNo,title:i.title,snippet:i.snippet,scores:{fts:i.score,vector:0,entity:0,graph:0,final:i.score}}))}async function lt(t,e,n,s,o){const i=await t.searchFts(e,3,o.entityType,o.entityValue);if(i.length===0)return[];const l=i[0].gid,d=await t.graphHops(l,void 0,s,n),h=d.nodes.map(c=>{const f=d.distances[c.gid]||0,a=i.find(_=>_.gid===c.gid);return{gid:c.gid,pageNo:c.pageNo,title:c.title,snippet:(a==null?void 0:a.snippet)||null,scores:{fts:(a==null?void 0:a.score)||0,vector:0,entity:0,graph:1/(f+1),final:((a==null?void 0:a.score)||0)*.3+1/(f+1)*.7}}});return h.sort((c,f)=>f.scores.final-c.scores.final),h}function ct({mode:t,onModeChange:e,showToggle:n=!0}){return n?r("div",{className:"search-mode-toggle",children:[r("button",{className:`mode-btn ${t==="fts"?"active":""}`,onClick:()=>e("fts"),children:"ðŸ“ FTS Only"}),r("button",{className:`mode-btn ${t==="hybrid"?"active":""}`,onClick:()=>e("hybrid"),children:"âš¡ Hybrid"}),r("button",{className:`mode-btn ${t==="graph"?"active":""}`,onClick:()=>e("graph"),children:"ðŸ•¸ï¸ Graph"})]}):null}function dt({onSearch:t,loading:e,placeholder:n}){return r("form",{onSubmit:s=>{s.preventDefault();const i=new FormData(s.currentTarget).get("query");i!=null&&i.trim()&&t(i.trim())},children:r("div",{className:"search-bar",children:[r("input",{type:"text",name:"query",placeholder:n||"Search the capsule...",className:"search-input",disabled:e}),r("button",{type:"submit",className:"btn-search",disabled:e,children:e?"Searching...":"Search"})]})})}function ut({results:t,query:e}){return r("div",{className:"search-results",children:[r("p",{className:"results-header",children:["Found ",t.length," results for ",r("strong",{children:['"',e,'"']})]}),t.map(n=>r("div",{className:"result-item",children:[r("div",{className:"result-header",children:[r("span",{className:"result-page",children:["Page ",n.pageNo]}),r("span",{className:"result-score",children:["Score: ",n.scores.final.toFixed(3)]})]}),r("h4",{className:"result-title",children:n.title}),n.snippet&&r("p",{className:"result-snippet",dangerouslySetInnerHTML:{__html:n.snippet}}),r("div",{className:"result-scores",children:[r("span",{children:["FTS: ",n.scores.fts.toFixed(2)]}),r("span",{children:["Entity: ",n.scores.entity.toFixed(2)]}),r("span",{children:["Graph: ",n.scores.graph.toFixed(2)]})]})]},n.gid))]})}function ht({mode:t,results:e,lastQuery:n,loading:s,onSearch:o,onModeChange:i,showModeToggle:l=!0,placeholder:d,searchHint:h}){return r("div",{className:"search-section",children:[r("div",{className:"search-header",children:r("h3",{children:"ðŸ” Search"})}),r(ct,{mode:t,onModeChange:i,showToggle:l}),h&&r("p",{className:"search-hint",children:h}),r(dt,{onSearch:o,loading:s,placeholder:d}),e&&e.length>0&&r(ut,{results:e,query:n}),e&&e.length===0&&r("div",{className:"no-results",children:[r("p",{children:["No results found for ",r("strong",{children:['"',n,'"']})]}),r("p",{className:"search-hint",children:"Try different keywords or search terms."})]})]})}function _t(t={}){const{autoLoad:e=!0,maxEntities:n=50}=t,[s,o]=k([]),[i,l]=k(null),[d,h]=k(!1),[c,f]=k(null),a=async()=>{h(!0),f(null);try{const u=await $().listEntities(void 0,n);o(u),console.log("[Entities] Loaded:",u.length)}catch(m){const u=String(m);f(u),console.error("[Entities] Failed to load:",m)}finally{h(!1)}};G(()=>{e&&a()},[e]);const _=m=>{l(m)},p=()=>Array.from(new Set(s.map(m=>m.entityType))),w=()=>i?s.filter(m=>m.entityType===i):s,x=m=>s.filter(u=>u.entityType===m).reduce((u,g)=>u+g.count,0),N=()=>s.reduce((m,u)=>m+u.count,0);return{entities:s,selectedType:i,loading:d,error:c,types:p(),filteredEntities:w(),totalCount:N(),loadEntities:a,selectType:_,getTypeCount:x}}function pt({types:t,selectedType:e,totalCount:n,onSelectType:s,getTypeCount:o}){return r("div",{className:"entity-filters",children:[r("button",{className:`entity-filter ${e===null?"active":""}`,onClick:()=>s(null),children:["All (",n,")"]}),t.map(i=>{const l=o(i);return r("button",{className:`entity-filter ${e===i?"active":""}`,onClick:()=>s(i),children:[i," (",l,")"]},i)})]})}function ft({entities:t,maxDisplay:e=20}){const n=t.slice(0,e);return r("div",{className:"entity-list",children:[n.map(s=>r("div",{className:"entity-item",children:[r("span",{className:"entity-type",children:s.entityType}),r("span",{className:"entity-value",children:s.normalizedValue}),r("span",{className:"entity-count",children:s.count})]},`${s.entityType}-${s.normalizedValue}`)),t.length>e&&r("div",{className:"entity-item entity-more",children:r("span",{className:"entity-value",children:["... and ",t.length-e," more"]})})]})}function mt({entities:t,types:e,selectedType:n,totalCount:s,onSelectType:o,getTypeCount:i,show:l=!0,maxDisplay:d=20}){if(!l||t.length===0)return null;const h=n?t.filter(c=>c.entityType===n):t;return r("div",{className:"entity-panel",children:[r("h4",{children:"Filter by Entity Type"}),r(pt,{types:e,selectedType:n,totalCount:s,onSelectType:o,getTypeCount:i}),r(ft,{entities:h,maxDisplay:d})]})}function gt({show:t,entityCount:e,onToggle:n}){return r("button",{className:"btn-secondary btn-entities",onClick:n,children:[t?"Hide":"Show"," Entities (",e,")"]})}class yt{constructor(){L(this,"worker",null);L(this,"nextId",1);L(this,"pending",new Map);L(this,"progressCallback",null);this.initWorker()}initWorker(){this.worker=new Worker(new URL("/assets/llm.worker-DcSBfjIK.js",import.meta.url),{type:"module"}),this.worker.onmessage=e=>{const n=e.data;if("type"in n&&n.type==="READY"){console.log("[LlmClient] Worker ready");return}if("type"in n&&n.type==="PROGRESS"){this.progressCallback&&this.progressCallback(n.data);return}const{id:s,response:o}=n,i=this.pending.get(s);i&&(this.pending.delete(s),i.resolve(o))},this.worker.onerror=e=>{console.error("[LlmClient] Worker error:",e);for(const n of this.pending.values())n.reject(new Error("Worker error"));this.pending.clear()}}async sendRequest(e){if(!this.worker)throw new Error("Worker not initialized");const n=this.nextId++;return new Promise((s,o)=>{this.pending.set(n,{resolve:l=>{l.ok?s(l.data):o(new Error(l.error))},reject:o});const i={id:n,request:e};this.worker.postMessage(i)})}onProgress(e){this.progressCallback=e}async loadModel(e){return this.sendRequest({type:"LOAD_MODEL",modelUrl:e})}async reason(e){return this.sendRequest({type:"REASON",request:e})}async unloadModel(){return this.sendRequest({type:"UNLOAD_MODEL"})}async getStatus(){return this.sendRequest({type:"GET_STATUS"})}terminate(){this.worker&&(this.worker.terminate(),this.worker=null),this.pending.clear(),this.progressCallback=null}}let te=null;function xe(){return te||(te=new yt),te}const vt={"0.6b":"https://huggingface.co/unsloth/Qwen3-0.6B-GGUF/resolve/main/Qwen3-0.6B-Q4_K_M.gguf","1.5b":"https://huggingface.co/ggml-org/Qwen2.5-1.5B-Instruct-GGUF/resolve/main/qwen2.5-1.5b-instruct-q4_k_m.gguf"};function bt(t={}){const[e,n]=k(!1),[s,o]=k(null),[i,l]=k(!1),[d,h]=k(null),[c,f]=k(null),[a,_]=k(null),p=async()=>{l(!0),_(null),h(null);try{const m=xe();m.onProgress(g=>{h(g)});const u=await m.loadModel(vt["0.6b"]);o(u),h(null),console.log("[LLM] Model loaded:",u)}catch(m){const u=String(m);_(u),console.error("[LLM] Failed to load model:",m)}finally{l(!1)}};return{enabled:e,modelInfo:s,loading:i,progress:d,reasoning:c,error:a,toggle:async()=>{e?(n(!1),f(null)):(s!=null&&s.loaded||await p(),n(!0))},loadModel:p,reason:async(m,u,g=256)=>{if(!(s!=null&&s.loaded)){console.warn("[LLM] Cannot reason: model not loaded");return}l(!0),_(null);try{const y=xe(),v=u.slice(0,5).map(F=>({gid:F.gid,pageNo:F.pageNo,title:F.title,text:F.snippet||"",score:F.scores.final})),b=await y.reason({question:m,snippets:v,maxTokens:g,temperature:.7});f(b),console.log("[LLM] Reasoning complete:",b)}catch(y){const v=String(y);_(v),console.error("[LLM] Reasoning failed:",y)}finally{l(!1)}},clearReasoning:()=>{f(null)}}}function wt({enabled:t,loading:e,modelLoaded:n,progress:s,error:o,onToggle:i}){return r("div",{className:"llm-toggle",children:[r("label",{className:"toggle-label",children:[r("input",{type:"checkbox",checked:t,onChange:i,disabled:e}),r("span",{className:"toggle-text",children:"ðŸ¤– Enable LLM Reasoning (Qwen 3 0.6B)"})]}),n&&r("span",{className:"model-status",children:"âœ… Model loaded"}),s&&r("div",{className:"llm-progress",children:[s.message," (",(s.progress*100).toFixed(0),"%)"]}),o&&r("div",{className:"llm-error",children:["âš ï¸ ",o]})]})}function Nt({reasoning:t,searchResults:e,loading:n}){return n&&!t?r("div",{className:"reasoning-loading",children:[r("div",{className:"spinner"}),r("p",{children:"LLM is reasoning..."})]}):t?r("div",{className:"reasoning-output",children:[r("div",{className:"reasoning-header",children:[r("h4",{children:"ðŸ¤– LLM Reasoning"}),r("span",{className:"reasoning-meta",children:[t.inferenceTimeMs.toFixed(0),"ms Â· ",t.tokensGenerated," tokens"]})]}),r("div",{className:"reasoning-answer",children:t.answer}),t.usedSnippets.length>0&&r("div",{className:"reasoning-citations",children:[r("strong",{children:"ðŸ“‘ Cited sources:"}),t.usedSnippets.map(s=>{const o=e==null?void 0:e.find(i=>i.gid===s);return r("span",{className:"citation",children:["Page ",(o==null?void 0:o.pageNo)||"?"]},s)})]})]}):null}function R(){return typeof navigator<"u"&&"storage"in navigator&&"getDirectory"in navigator.storage}async function kt(){if(!R())throw new Error("OPFS not supported in this browser");return await navigator.storage.getDirectory()}async function xt(){return await(await kt()).getDirectoryHandle("capsules",{create:!0})}function St(t){const e=t.replace(/[^a-z0-9._-]/gi,"-");return e.endsWith(".mgx.sqlite")?e:`${e}.mgx.sqlite`}async function Ft(t,e){if(!R())throw new Error("OPFS not supported - cannot persist file");const n=await xt(),s=e||St(t.name),i=await(await n.getFileHandle(s,{create:!0})).createWritable();try{return await i.write(t),await i.close(),console.log(`[OPFS] Copied file to ${s} (${t.size} bytes)`),{path:s,size:t.size}}catch(l){throw await i.close(),l}}async function Et(){if(!navigator.storage||!navigator.storage.estimate)return null;try{const t=await navigator.storage.estimate(),e=t.usage||0,n=t.quota||0;return{usage:e,quota:n,available:n-e,percentUsed:n>0?e/n*100:0}}catch(t){return console.error("[OPFS] Failed to get storage quota:",t),null}}async function Ct(){if(!navigator.storage||!navigator.storage.persist)return!1;try{const t=await navigator.storage.persist();return console.log(`[OPFS] Persistent storage: ${t}`),t}catch(t){return console.error("[OPFS] Failed to request persistent storage:",t),!1}}function A(t){if(t===0)return"0 B";const e=1024,n=["B","KB","MB","GB"],s=Math.floor(Math.log(t)/Math.log(e));return`${(t/Math.pow(e,s)).toFixed(2)} ${n[s]}`}async function Lt(t,e=500*1024*1024){if(t.size===0)return{valid:!1,error:"File is empty"};if(t.size>e)return{valid:!1,error:`File too large (${A(t.size)} > ${A(e)})`};const n=t.name.toLowerCase();if(!n.endsWith(".mgx.sqlite")&&!n.endsWith(".sqlite"))return{valid:!1,error:"File must have .mgx.sqlite or .sqlite extension"};try{const s=await t.slice(0,16).arrayBuffer();if(!new TextDecoder().decode(s).startsWith("SQLite format 3"))return{valid:!1,error:"Not a valid SQLite file (invalid header)"}}catch(s){return{valid:!1,error:`Failed to read file header: ${s}`}}return{valid:!0}}function Mt({onFileSelected:t,onOpfsFileSelected:e,onError:n}){const[s,o]=k([]),[i,l]=k(null),[d,h]=k(!1),[c,f]=k(!1),a=$();G(()=>{_(),p()},[]);async function _(){try{const u=await a.listOpfsFiles();o(u)}catch(u){console.error("[FilePicker] Failed to list OPFS files:",u)}}async function p(){var u,g;try{const y=await Et();l(y);const v=await((g=(u=navigator.storage)==null?void 0:u.persisted)==null?void 0:g.call(u));f(v||!1)}catch(y){console.error("[FilePicker] Failed to get quota:",y)}}async function w(u){var v;const g=u.target,y=(v=g.files)==null?void 0:v[0];if(y){h(!0);try{const b=await Lt(y);if(!b.valid){n(b.error),h(!1);return}if(R()){const{path:F}=await Ft(y);await _(),await p(),t(y,F)}else t(y)}catch(b){n(`Failed to load file: ${b}`)}finally{h(!1),g.value=""}}}async function x(u){h(!0);try{e(u)}catch(g){n(`Failed to open from OPFS: ${g}`)}finally{h(!1)}}async function N(u,g){if(g.stopPropagation(),!!confirm(`Remove "${u}" from device storage?`))try{await a.removeFromOpfs(u),await _(),await p()}catch(y){n(`Failed to remove file: ${y}`)}}async function m(){try{await Ct()?f(!0):n("Persistent storage not granted. Files may be evicted under storage pressure.")}catch(u){n(`Failed to request persistence: ${u}`)}}return r("div",{class:"file-picker",children:[r("div",{class:"file-picker-header",children:[r("h2",{children:"Open Capsule"}),i&&r("div",{class:"storage-quota",children:[r("div",{class:"quota-bar",children:r("div",{class:"quota-used",style:`width: ${Math.min(i.percentUsed,100)}%`})}),r("p",{class:"quota-text",children:[A(i.usage)," / ",A(i.quota)," used (",i.percentUsed.toFixed(1),"%)"]}),!c&&R()&&r("button",{class:"btn-secondary btn-sm",onClick:m,children:"Request Persistent Storage"})]})]}),r("div",{class:"file-input-section",children:[r("label",{class:"file-input-label",children:[r("input",{type:"file",accept:".mgx.sqlite,.sqlite",onChange:w,disabled:d,style:"display: none"}),r("button",{class:"btn-primary",disabled:d,children:d?"Loading...":"Select File from Device"})]}),r("p",{class:"help-text",children:"Choose a .mgx.sqlite or .sqlite file from your device"})]}),R()&&s.length>0&&r("div",{class:"opfs-files-section",children:[r("h3",{children:"Stored on Device"}),r("ul",{class:"opfs-files-list",children:s.map(u=>r("li",{class:"opfs-file-item",children:[r("button",{class:"opfs-file-button",onClick:()=>x(u.path),disabled:d,children:r("div",{class:"file-info",children:[r("span",{class:"file-name",children:u.path}),r("span",{class:"file-meta",children:[A(u.size)," â€¢"," ",new Date(u.lastModified).toLocaleDateString()]})]})}),r("button",{class:"btn-remove",onClick:g=>N(u.path,g),title:"Remove from device","aria-label":"Remove from device",children:"Ã—"})]},u.path))})]}),!R()&&r("div",{class:"opfs-warning",children:r("p",{children:[r("strong",{children:"Note:"})," Your browser doesn't support persistent storage. Files will only be kept in memory and lost when you close the tab."]})})]})}async function Tt(t){const n=(await t.query("SELECT name FROM sqlite_master WHERE type='table'")).map(_=>_.name),s=n.includes("_ui_pages"),o=n.includes("_ui_dashboards"),i=n.includes("_ui_navigation"),l=n.includes("_ui_params"),d=n.includes("_meta_manifest"),h=n.includes("sqlar"),c=n.some(_=>_.startsWith("fts_"));let f="1.0";if(d)try{const _=await t.query("SELECT value FROM _meta_manifest WHERE key='gcui'");_.length>0&&(f=_[0].value)}catch(_){console.warn("Failed to read GCUI version:",_)}let a;return s&&o?a="hybrid":s?a="website":o?a="dashboard":a="generic",{version:f,hasWebsite:s,hasDashboards:o,hasNavigation:i,hasParams:l,hasFTS:c,hasAssets:h,mode:a}}async function $t(t){try{const e=await t.query("SELECT key, value FROM _meta_manifest");if(e.length===0)return null;const n={gcui:"1.0",capsule_kind:"sqlar"};return e.forEach(s=>{n[s.key]=s.value}),n}catch(e){return console.warn("Failed to load manifest:",e),null}}async function qt(t){try{const e=await t.query("SELECT key, value FROM _ui_config"),n={};return e.forEach(s=>{n[s.key]=s.value}),n}catch(e){return console.warn("Failed to load config:",e),{}}}async function Pt(t){try{return(await t.query("SELECT slug, title, content, layout, category, order_index FROM _ui_pages ORDER BY order_index ASC, slug ASC")).map(n=>({slug:n.slug,title:n.title,content:n.content||void 0,layout:n.layout||void 0,category:n.category||void 0,order_index:n.order_index||void 0}))}catch(e){return console.warn("Failed to load pages:",e),[]}}async function Ot(t){try{return(await t.query("SELECT menu, label, to_slug, order_index, icon_asset FROM _ui_navigation ORDER BY menu, order_index ASC")).map(n=>({menu:n.menu,label:n.label,to_slug:n.to_slug,order_index:n.order_index||void 0,icon_asset:n.icon_asset||void 0}))}catch(e){return console.warn("Failed to load navigation:",e),[]}}async function Rt(t){try{return(await t.query("SELECT name, query, grammar, config FROM _ui_dashboards")).map(n=>({name:n.name,query:n.query,grammar:n.grammar||void 0,config:n.config||void 0}))}catch(e){return console.warn("Failed to load dashboards:",e),[]}}async function Dt(t){const e=await Tt(t),n=await $t(t)||{gcui:e.version,capsule_kind:"sqlar"},s=await qt(t),o=e.hasWebsite?await Pt(t):[],i=e.hasNavigation?await Ot(t):[],l=e.hasDashboards?await Rt(t):[];return{manifest:n,capabilities:e,config:s,pages:o,navigation:i,dashboards:l}}function Ht({config:t,children:e}){return r("div",{className:"layout-landing",children:[r("section",{className:"hero",children:[r("div",{className:"hero-content",children:[t.logo_asset&&r("img",{src:t.logo_asset,alt:"Logo",className:"hero-logo"}),r("h1",{className:"hero-title",children:t.hero_title||t.site_title||"Welcome"}),t.hero_subtitle&&r("p",{className:"hero-subtitle",children:t.hero_subtitle})]}),t.hero_image&&r("div",{className:"hero-background",style:{backgroundImage:`url(${t.hero_image})`}})]}),r("main",{className:"landing-main",children:e})]})}function Wt({config:t,navigation:e,currentPage:n,children:s}){const o=e.filter(i=>i.menu==="sidebar");return r("div",{className:"layout-docs",children:[r("aside",{className:"docs-sidebar",children:r("nav",{className:"docs-nav",children:[r("div",{className:"docs-nav-header",children:[t.logo_asset&&r("img",{src:t.logo_asset,alt:"Logo",className:"docs-logo"}),r("h3",{children:t.site_title||"Documentation"})]}),r("ul",{className:"docs-nav-list",children:o.map(i=>r("li",{className:"docs-nav-item",children:r("a",{href:`#${i.to_slug}`,className:(n==null?void 0:n.slug)===i.to_slug?"active":"",children:[i.icon_asset&&r("img",{src:i.icon_asset,alt:"",className:"nav-icon"}),i.label]})},i.to_slug))})]})}),r("main",{className:"docs-main",children:[n&&r("div",{className:"docs-breadcrumbs",children:[r("a",{href:"#/",children:"Home"}),n.category&&r(H,{children:[r("span",{children:" / "}),r("span",{children:n.category})]}),r("span",{children:" / "}),r("span",{children:n.title})]}),r("article",{className:"docs-content",children:[n&&r("h1",{children:n.title}),s]})]})]})}function We({config:t,children:e}){return r("div",{className:"layout-dashboard",children:[r("header",{className:"dashboard-header",children:r("h1",{children:t.site_title||"Dashboard"})}),r("main",{className:"dashboard-content",children:e})]})}function Ae({config:t,title:e,children:n}){return r("div",{className:"layout-simple",children:[r("header",{className:"simple-header",children:[t.logo_asset&&r("img",{src:t.logo_asset,alt:"Logo",className:"simple-logo"}),e&&r("h1",{children:e})]}),r("main",{className:"simple-content",children:n}),r("footer",{className:"simple-footer",children:r("p",{children:"Powered by GlyphCapsule"})})]})}function At({data:t,config:e,width:n=600,height:s=400}){if(!t||t.length===0)return r("div",{className:"chart-empty",style:{width:n,height:s},children:r("p",{children:"No data to display"})});switch(e.mark){case"bar":return r(It,{data:t,config:e,width:n,height:s});case"line":return r(Gt,{data:t,config:e,width:n,height:s});case"point":return r(Bt,{data:t,config:e,width:n,height:s});case"area":return r(Qt,{data:t,config:e,width:n,height:s});default:return r("div",{className:"chart-unsupported",style:{width:n,height:s},children:[r("p",{children:["Unsupported chart type: ",e.mark]}),r("p",{children:"Showing data as table:"}),r(Ut,{data:t})]})}}function It({data:t,config:e,width:n,height:s}){var c,f;const{encoding:o}=e,i=((c=o.x)==null?void 0:c.field)||Object.keys(t[0])[0],l=((f=o.y)==null?void 0:f.field)||Object.keys(t[0])[1],d=Math.max(...t.map(a=>Number(a[l])||0)),h=Math.max(20,(n-100)/t.length-10);return r("div",{className:"chart chart-bar",style:{width:n,height:s},children:[e.title&&r("h4",{className:"chart-title",children:e.title}),r("div",{className:"chart-container",style:{height:s-60},children:r("div",{className:"chart-bars",style:{display:"flex",alignItems:"flex-end",height:"100%",gap:"8px"},children:t.map((a,_)=>{const p=Number(a[l])||0,w=p/d*(s-100);return r("div",{className:"chart-bar-item",style:{textAlign:"center"},children:[r("div",{className:"bar",style:{width:h,height:w,backgroundColor:"#6366f1",borderRadius:"4px 4px 0 0"},title:`${a[i]}: ${p}`}),r("div",{className:"bar-label",style:{fontSize:"12px",marginTop:"4px",maxWidth:h,overflow:"hidden",textOverflow:"ellipsis"},children:String(a[i]).slice(0,10)})]},_)})})}),r("div",{className:"chart-legend",style:{fontSize:"12px",marginTop:"8px",textAlign:"center"},children:[r("strong",{children:l})," by ",r("strong",{children:i})]})]})}function Gt({data:t,config:e,width:n,height:s}){var N,m;const{encoding:o}=e,i=((N=o.x)==null?void 0:N.field)||Object.keys(t[0])[0],l=((m=o.y)==null?void 0:m.field)||Object.keys(t[0])[1],d=t.map(u=>Number(u[l])||0),h=Math.max(...d),c=Math.min(...d),f=h-c||1,a=n-80,_=s-100,p=a/(t.length-1||1),w=t.map((u,g)=>{const y=40+g*p,v=Number(u[l])||0,b=_-(v-c)/f*_+20;return{x:y,y:b,value:v,label:u[i]}}),x=w.map((u,g)=>`${g===0?"M":"L"} ${u.x} ${u.y}`).join(" ");return r("div",{className:"chart chart-line",style:{width:n,height:s},children:[e.title&&r("h4",{className:"chart-title",children:e.title}),r("svg",{width:n,height:s-40,style:{overflow:"visible"},children:[[0,.25,.5,.75,1].map(u=>{const g=_-u*_+20,y=c+u*f;return r("g",{children:[r("line",{x1:40,y1:g,x2:n-40,y2:g,stroke:"#e5e7eb",strokeWidth:1}),r("text",{x:10,y:g+4,fontSize:10,fill:"#666",children:y.toFixed(0)})]},u)}),r("path",{d:x,fill:"none",stroke:"#6366f1",strokeWidth:2}),w.map((u,g)=>r("circle",{cx:u.x,cy:u.y,r:4,fill:"#6366f1",children:r("title",{children:`${u.label}: ${u.value}`})},g)),w.map((u,g)=>r("text",{x:u.x,y:_+40,fontSize:10,fill:"#666",textAnchor:"middle",children:String(u.label).slice(0,8)},g))]}),r("div",{className:"chart-legend",style:{fontSize:"12px",textAlign:"center"},children:[r("strong",{children:l})," over ",r("strong",{children:i})]})]})}function Bt({data:t,config:e,width:n,height:s}){var m,u;const{encoding:o}=e,i=((m=o.x)==null?void 0:m.field)||Object.keys(t[0])[0],l=((u=o.y)==null?void 0:u.field)||Object.keys(t[0])[1],d=t.map(g=>Number(g[i])||0),h=t.map(g=>Number(g[l])||0),c=Math.min(...d),f=Math.max(...d),a=Math.min(...h),_=Math.max(...h),p=f-c||1,w=_-a||1,x=n-80,N=s-100;return r("div",{className:"chart chart-scatter",style:{width:n,height:s},children:[e.title&&r("h4",{className:"chart-title",children:e.title}),r("svg",{width:n,height:s-40,children:[[0,.25,.5,.75,1].map(g=>{const y=N-g*N+20;return r("line",{x1:40,y1:y,x2:n-40,y2:y,stroke:"#e5e7eb",strokeWidth:1},g)}),t.map((g,y)=>{const v=Number(g[i])||0,b=Number(g[l])||0,F=40+(v-c)/p*x,P=N-(b-a)/w*N+20;return r("circle",{cx:F,cy:P,r:5,fill:"#6366f1",opacity:.7,children:r("title",{children:`${i}: ${v}, ${l}: ${b}`})},y)})]}),r("div",{className:"chart-legend",style:{fontSize:"12px",textAlign:"center"},children:[r("strong",{children:l})," vs ",r("strong",{children:i})]})]})}function Qt({data:t,config:e,width:n,height:s}){var m,u;const{encoding:o}=e,i=((m=o.x)==null?void 0:m.field)||Object.keys(t[0])[0],l=((u=o.y)==null?void 0:u.field)||Object.keys(t[0])[1],d=t.map(g=>Number(g[l])||0),h=Math.max(...d),c=Math.min(...d),f=h-c||1,a=n-80,_=s-100,p=a/(t.length-1||1),x=t.map((g,y)=>{const v=40+y*p,b=Number(g[l])||0,F=_-(b-c)/f*_+20;return{x:v,y:F}}).map((g,y)=>`${y===0?"M":"L"} ${g.x} ${g.y}`).join(" "),N=`${x} L ${n-40} ${_+20} L 40 ${_+20} Z`;return r("div",{className:"chart chart-area",style:{width:n,height:s},children:[e.title&&r("h4",{className:"chart-title",children:e.title}),r("svg",{width:n,height:s-40,children:[r("path",{d:N,fill:"#6366f1",opacity:.3}),r("path",{d:x,fill:"none",stroke:"#6366f1",strokeWidth:2})]}),r("div",{className:"chart-legend",style:{fontSize:"12px",textAlign:"center"},children:[r("strong",{children:l})," over ",r("strong",{children:i})]})]})}function Ut({data:t}){if(t.length===0)return null;const e=Object.keys(t[0]);return r("table",{className:"data-table",style:{width:"100%",borderCollapse:"collapse",fontSize:"12px"},children:[r("thead",{children:r("tr",{children:e.map(n=>r("th",{style:{borderBottom:"2px solid #ddd",padding:"8px",textAlign:"left"},children:n},n))})}),r("tbody",{children:t.slice(0,10).map((n,s)=>r("tr",{children:e.map(o=>r("td",{style:{borderBottom:"1px solid #eee",padding:"6px"},children:String(n[o])},o))},s))})]})}function Ie({dashboards:t}){return t.length===0?r("div",{className:"dashboard-empty",children:r("p",{children:"No dashboards defined"})}):r("div",{className:"dashboard-grid",children:t.map(e=>r(zt,{dashboard:e},e.name))})}function zt({dashboard:t}){const[e,n]=k(null),[s,o]=k(!1),[i,l]=k(null);G(()=>{d()},[t.query]);const d=async()=>{o(!0),l(null);try{const f=await $().query(t.query);n(f)}catch(c){l(String(c)),console.error(`[Dashboard] Failed to load ${t.name}:`,c)}finally{o(!1)}};if(s)return r("div",{className:"dashboard-panel loading",children:[r("div",{className:"spinner"}),r("p",{children:["Loading ",t.name,"..."]})]});if(i)return r("div",{className:"dashboard-panel error",children:[r("h4",{children:t.name}),r("p",{className:"error-message",children:["Error: ",i]}),r("details",{children:[r("summary",{children:"Query"}),r("pre",{children:t.query})]})]});if(!e||e.length===0)return r("div",{className:"dashboard-panel empty",children:[r("h4",{children:t.name}),r("p",{children:"No data"})]});let h=null;if(t.config)try{h=JSON.parse(t.config)}catch(c){console.error(`[Dashboard] Invalid config for ${t.name}:`,c)}return!h||t.grammar!=="vegalite-lite-v1"?r("div",{className:"dashboard-panel table",children:[r("h4",{children:t.name}),r(jt,{data:e})]}):r("div",{className:"dashboard-panel chart",children:r(At,{data:e,config:h,width:600,height:400})})}function jt({data:t}){const e=Object.keys(t[0]||{});return r("div",{style:{overflowX:"auto"},children:r("table",{className:"dashboard-table",style:{width:"100%",borderCollapse:"collapse",fontSize:"14px"},children:[r("thead",{children:r("tr",{children:e.map(n=>r("th",{style:{borderBottom:"2px solid #ddd",padding:"12px",textAlign:"left",fontWeight:600},children:n},n))})}),r("tbody",{children:t.map((n,s)=>r("tr",{style:{borderBottom:"1px solid #eee"},children:e.map(o=>r("td",{style:{padding:"10px"},children:String(n[o])},o))},s))})]})})}function Vt({content:t}){const e=Yt(t);return r("div",{className:"markdown-content",dangerouslySetInnerHTML:{__html:e}})}function Yt(t){let e=t;return e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),e=e.replace(/^### (.*$)/gim,"<h3>$1</h3>"),e=e.replace(/^## (.*$)/gim,"<h2>$1</h2>"),e=e.replace(/^# (.*$)/gim,"<h1>$1</h1>"),e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/\*(.*?)\*/g,"<em>$1</em>"),e=e.replace(/`(.*?)`/g,"<code>$1</code>"),e=e.replace(/\[(.*?)\]\((.*?)\)/g,'<a href="$2">$1</a>'),e=e.replace(/```(.*?)\n([\s\S]*?)```/g,"<pre><code>$2</code></pre>"),e=e.replace(/^\- (.*$)/gim,"<li>$1</li>"),e=e.replace(/(<li>.*<\/li>)/s,"<ul>$1</ul>"),e=e.replace(/^\d+\. (.*$)/gim,"<li>$1</li>"),e=e.split(`

`).map(s=>s.startsWith("<h")||s.startsWith("<ul>")||s.startsWith("<ol>")||s.startsWith("<pre>")||s.startsWith("<li>")?s:`<p>${s}</p>`).join(`
`),e=e.replace(/\n/g,"<br>"),e}function Kt({context:t}){const[e,n]=k("/");G(()=>{const o=()=>{const i=window.location.hash.slice(1);n(i||"/")};return window.addEventListener("hashchange",o),o(),()=>window.removeEventListener("hashchange",o)},[]);const s=t.pages.find(o=>o.slug===e)||t.pages[0];return s?r(Xt,{page:s,context:t}):t.dashboards.length>0?r(We,{config:t.config,children:r(Ie,{dashboards:t.dashboards})}):r(Ae,{config:t.config,title:"404 Not Found",children:[r("p",{children:["Page not found: ",e]}),r("p",{children:r("a",{href:"#/",children:"Go home"})})]})}function Xt({page:t,context:e}){const n=t.layout||"simple",s=t.content?r(Vt,{content:t.content}):r("p",{children:"No content"});switch(n){case"landing":return r(Ht,{config:e.config,children:s});case"docs":return r(Wt,{config:e.config,navigation:e.navigation,currentPage:t,children:s});case"dashboard":return r(We,{config:e.config,children:[s,e.dashboards.length>0&&r(Ie,{dashboards:e.dashboards})]});case"simple":default:return r(Ae,{config:e.config,title:t.title,children:s})}}const Jt={mode:"website",bundledCapsule:"/memglyph-demo.mgx.sqlite",branding:{title:"Memglyph",tagline:"Your knowledge, crystallized",logoUrl:"/logo.svg"},features:{llm:{enabled:!0,autoReason:!1,defaultModel:"qwen3-0.6b",maxTokens:256},search:{defaultMode:"hybrid",enabledModes:["fts","hybrid"],showModeToggle:!1},graph:{enabled:!0,maxHops:2,defaultMaxHops:1},upload:{enabled:!1,acceptedExtensions:[]},gcui:{enabled:!0,fallbackToGeneric:!1},pwa:{enabled:!0,offlineMode:!0}},ui:{showLanding:!0,theme:"documentation"}},Zt={mode:"viewer",bundledCapsule:"/memglyph-demo.mgx.sqlite",branding:{title:"SQLAR Viewer",tagline:"Query your knowledge capsules",logoUrl:"/sqlar-logo.svg"},features:{llm:{enabled:!0,autoReason:!1,defaultModel:"qwen3-0.6b",maxTokens:256},search:{defaultMode:"hybrid",enabledModes:["fts","hybrid","graph"],showModeToggle:!0},graph:{enabled:!0,maxHops:3,defaultMaxHops:2},upload:{enabled:!0,acceptedExtensions:[".sqlite",".sqlar",".db",".mgx.sqlite"]},gcui:{enabled:!0,fallbackToGeneric:!0},pwa:{enabled:!0,offlineMode:!0}},ui:{showLanding:!1,theme:"tool"}};function en(){return"website"}function tn(){return en()==="viewer"?Zt:Jt}function nn(){var g;const t=tn(),[e,n]=k(null),[s,o]=k(null),[i,l]=k(!1),[d,h]=k(null),[c,f]=k(!1),a=ot({defaultMode:t.features.search.defaultMode}),_=_t({autoLoad:!1}),p=bt({});G(()=>{e&&(_.loadEntities(),(async()=>{try{const v=$(),b=await Dt(v);console.log("[GCUI] Detected capabilities:",b.capabilities),b.capabilities.mode!=="generic"?(o(b),console.log("[GCUI] Rendering in",b.capabilities.mode,"mode")):(console.log("[GCUI] No GCUI tables found, using legacy mode"),o(null))}catch(v){console.warn("[GCUI] Detection failed, using legacy mode:",v),o(null)}})())},[e]);const w=async()=>{l(!0),h(null);try{const v=await $().openDemo();n(v),console.log("Capsule info:",v)}catch(y){h(String(y)),console.error("Failed to open capsule:",y)}finally{l(!1)}},x=async(y,v)=>{l(!0),h(null);try{const F=await $().openFromFile(y);n(F),console.log("Capsule opened:",F)}catch(b){h(String(b)),console.error("Failed to open file:",b)}finally{l(!1)}},N=async y=>{l(!0),h(null);try{const b=await $().openFromOpfs(y);n(b),console.log("Capsule opened from OPFS:",b)}catch(v){h(String(v)),console.error("Failed to open from OPFS:",v)}finally{l(!1)}},m=y=>{h(y)},u=async y=>{e&&(p.clearReasoning(),await a.search(y))};return r("div",{className:"app",children:[r("header",{className:"app-header",children:[r("h1",{children:"Glyphcapsule Explorer"}),r("p",{children:"Hybrid Retrieval Demo for MemGlyph"})]}),r("main",{className:"app-main",children:e?s&&t.features.gcui.enabled?r("div",{className:"gcui-mode",children:r(Kt,{context:s})}):r("div",{className:"capsule-view",children:[r("div",{className:"capsule-info",children:[r("h2",{children:["ðŸ“¦ ",e.fileName]}),r("dl",{children:[r("dt",{children:"File Size:"}),r("dd",{children:[(e.fileSize/1024).toFixed(1)," KB"]}),r("dt",{children:"Doc ID:"}),r("dd",{children:r("code",{children:[e.docId.slice(0,24),"..."]})}),r("dt",{children:"Pages:"}),r("dd",{children:e.pageCount}),r("dt",{children:"Entities:"}),r("dd",{children:e.entityCount}),r("dt",{children:"Graph Edges:"}),r("dd",{children:e.edgeCount}),e.hasVectors&&r(H,{children:[r("dt",{children:"Vectors:"}),r("dd",{children:["âœ… ",e.vectorModel," (",e.vectorDim,"-dim)"]})]})]}),r(wt,{enabled:p.enabled,loading:p.loading,modelLoaded:((g=p.modelInfo)==null?void 0:g.loaded)||!1,progress:p.progress,error:p.error,onToggle:p.toggle})]}),r("div",{className:"search-section",children:[r("div",{className:"search-header",children:[r("h3",{children:"ðŸ” Search"}),r(gt,{show:c,entityCount:_.entities.length,onToggle:()=>f(!c)})]}),r(ht,{mode:a.mode,results:a.results,lastQuery:a.lastQuery,loading:a.loading||i,onSearch:u,onModeChange:a.changeMode,showModeToggle:t.features.search.showModeToggle,placeholder:"Search the capsule...",searchHint:'Try searching: "vector search", "LEANN", "SQLite", or "hybrid retrieval"'}),r(mt,{entities:_.entities,types:_.types,selectedType:_.selectedType,totalCount:_.totalCount,onSelectType:_.selectType,getTypeCount:_.getTypeCount,show:c,maxDisplay:20}),p.reasoning&&r(Nt,{reasoning:p.reasoning,searchResults:a.results,loading:p.loading}),p.loading&&!p.reasoning&&r("div",{className:"reasoning-loading",children:[r("div",{className:"spinner"}),r("p",{children:"LLM is reasoning..."})]})]})]}):r("div",{className:"welcome",children:[d&&r("div",{className:"error",style:"max-width: 600px; margin: 1rem auto;",children:[r("strong",{children:"Error:"})," ",d]}),r(Mt,{onFileSelected:x,onOpfsFileSelected:N,onError:m}),r("div",{style:"text-align: center; margin-top: 1.5rem;",children:[r("p",{style:"margin-bottom: 0.5rem; opacity: 0.7;",children:"Or try the demo:"}),r("button",{className:"btn-secondary",onClick:w,disabled:i,children:i?"Loading Demo...":"Load Demo Capsule"})]})]})}),r("footer",{className:"app-footer",children:r("p",{children:"Built with Preact + SQLite WASM + OPFS"})})]})}Ke(r(nn,{}),document.getElementById("app"));
