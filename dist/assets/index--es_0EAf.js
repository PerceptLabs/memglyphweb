var ze=Object.defineProperty;var Ve=(t,e,n)=>e in t?ze(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var P=(t,e,n)=>Ve(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();var K,F,Ee,O,_e,Ce,Pe,Me,ce,se,ae,I={},Le=[],je=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,X=Array.isArray;function q(t,e){for(var n in e)t[n]=e[n];return t}function de(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function Ye(t,e,n){var s,i,a,o={};for(a in e)a=="key"?s=e[a]:a=="ref"?i=e[a]:o[a]=e[a];if(arguments.length>2&&(o.children=arguments.length>3?K.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(a in t.defaultProps)o[a]===void 0&&(o[a]=t.defaultProps[a]);return U(t,o,s,i,null)}function U(t,e,n,s,i){var a={type:t,props:e,key:n,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++Ee,__i:-1,__u:0};return i==null&&F.vnode!=null&&F.vnode(a),a}function R(t){return t.children}function z(t,e){this.props=t,this.context=e}function G(t,e){if(e==null)return t.__?G(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?G(t):null}function Te(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return Te(t)}}function fe(t){(!t.__d&&(t.__d=!0)&&O.push(t)&&!j.__r++||_e!=F.debounceRendering)&&((_e=F.debounceRendering)||Ce)(j)}function j(){for(var t,e,n,s,i,a,o,u=1;O.length;)O.length>u&&O.sort(Pe),t=O.shift(),u=O.length,t.__d&&(n=void 0,s=void 0,i=(s=(e=t).__v).__e,a=[],o=[],e.__P&&((n=q({},s)).__v=s.__v+1,F.vnode&&F.vnode(n),ue(e.__P,n,s,e.__n,e.__P.namespaceURI,32&s.__u?[i]:null,a,i??G(s),!!(32&s.__u),o),n.__v=s.__v,n.__.__k[n.__i]=n,Re(a,n,o),s.__e=s.__=null,n.__e!=i&&Te(n)));j.__r=0}function $e(t,e,n,s,i,a,o,u,d,c,f){var l,p,_,y,N,v,m,h=s&&s.__k||Le,g=e.length;for(d=Ke(n,e,h,d,g),l=0;l<g;l++)(_=n.__k[l])!=null&&(p=_.__i==-1?I:h[_.__i]||I,_.__i=l,v=ue(t,_,p,i,a,o,u,d,c,f),y=_.__e,_.ref&&p.ref!=_.ref&&(p.ref&&he(p.ref,null,_),f.push(_.ref,_.__c||y,_)),N==null&&y!=null&&(N=y),(m=!!(4&_.__u))||p.__k===_.__k?d=qe(_,d,t,m):typeof _.type=="function"&&v!==void 0?d=v:y&&(d=y.nextSibling),_.__u&=-7);return n.__e=N,d}function Ke(t,e,n,s,i){var a,o,u,d,c,f=n.length,l=f,p=0;for(t.__k=new Array(i),a=0;a<i;a++)(o=e[a])!=null&&typeof o!="boolean"&&typeof o!="function"?(d=a+p,(o=t.__k[a]=typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?U(null,o,null,null,null):X(o)?U(R,{children:o},null,null,null):o.constructor==null&&o.__b>0?U(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=t,o.__b=t.__b+1,u=null,(c=o.__i=Xe(o,n,d,l))!=-1&&(l--,(u=n[c])&&(u.__u|=2)),u==null||u.__v==null?(c==-1&&(i>f?p--:i<f&&p++),typeof o.type!="function"&&(o.__u|=4)):c!=d&&(c==d-1?p--:c==d+1?p++:(c>d?p--:p++,o.__u|=4))):t.__k[a]=null;if(l)for(a=0;a<f;a++)(u=n[a])!=null&&!(2&u.__u)&&(u.__e==s&&(s=G(u)),De(u,u));return s}function qe(t,e,n,s){var i,a;if(typeof t.type=="function"){for(i=t.__k,a=0;i&&a<i.length;a++)i[a]&&(i[a].__=t,e=qe(i[a],e,n,s));return e}t.__e!=e&&(s&&(e&&t.type&&!e.parentNode&&(e=G(t)),n.insertBefore(t.__e,e||null)),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function Xe(t,e,n,s){var i,a,o,u=t.key,d=t.type,c=e[n],f=c!=null&&(2&c.__u)==0;if(c===null&&t.key==null||f&&u==c.key&&d==c.type)return n;if(s>(f?1:0)){for(i=n-1,a=n+1;i>=0||a<e.length;)if((c=e[o=i>=0?i--:a++])!=null&&!(2&c.__u)&&u==c.key&&d==c.type)return o}return-1}function me(t,e,n){e[0]=="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||je.test(e)?n:n+"px"}function Q(t,e,n,s,i){var a,o;e:if(e=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof s=="string"&&(t.style.cssText=s=""),s)for(e in s)n&&e in n||me(t.style,e,"");if(n)for(e in n)s&&n[e]==s[e]||me(t.style,e,n[e])}else if(e[0]=="o"&&e[1]=="n")a=e!=(e=e.replace(Me,"$1")),o=e.toLowerCase(),e=o in t||e=="onFocusOut"||e=="onFocusIn"?o.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+a]=n,n?s?n.u=s.u:(n.u=ce,t.addEventListener(e,a?ae:se,a)):t.removeEventListener(e,a?ae:se,a);else{if(i=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function ge(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.t==null)e.t=ce++;else if(e.t<n.u)return;return n(F.event?F.event(e):e)}}}function ue(t,e,n,s,i,a,o,u,d,c){var f,l,p,_,y,N,v,m,h,g,w,b,k,S,M,H,J,T=e.type;if(e.constructor!=null)return null;128&n.__u&&(d=!!(32&n.__u),a=[u=e.__e=n.__e]),(f=F.__b)&&f(e);e:if(typeof T=="function")try{if(m=e.props,h="prototype"in T&&T.prototype.render,g=(f=T.contextType)&&s[f.__c],w=f?g?g.props.value:f.__:s,n.__c?v=(l=e.__c=n.__c).__=l.__E:(h?e.__c=l=new T(m,w):(e.__c=l=new z(m,w),l.constructor=T,l.render=Ze),g&&g.sub(l),l.props=m,l.state||(l.state={}),l.context=w,l.__n=s,p=l.__d=!0,l.__h=[],l._sb=[]),h&&l.__s==null&&(l.__s=l.state),h&&T.getDerivedStateFromProps!=null&&(l.__s==l.state&&(l.__s=q({},l.__s)),q(l.__s,T.getDerivedStateFromProps(m,l.__s))),_=l.props,y=l.state,l.__v=e,p)h&&T.getDerivedStateFromProps==null&&l.componentWillMount!=null&&l.componentWillMount(),h&&l.componentDidMount!=null&&l.__h.push(l.componentDidMount);else{if(h&&T.getDerivedStateFromProps==null&&m!==_&&l.componentWillReceiveProps!=null&&l.componentWillReceiveProps(m,w),!l.__e&&l.shouldComponentUpdate!=null&&l.shouldComponentUpdate(m,l.__s,w)===!1||e.__v==n.__v){for(e.__v!=n.__v&&(l.props=m,l.state=l.__s,l.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some(function(D){D&&(D.__=e)}),b=0;b<l._sb.length;b++)l.__h.push(l._sb[b]);l._sb=[],l.__h.length&&o.push(l);break e}l.componentWillUpdate!=null&&l.componentWillUpdate(m,l.__s,w),h&&l.componentDidUpdate!=null&&l.__h.push(function(){l.componentDidUpdate(_,y,N)})}if(l.context=w,l.props=m,l.__P=t,l.__e=!1,k=F.__r,S=0,h){for(l.state=l.__s,l.__d=!1,k&&k(e),f=l.render(l.props,l.state,l.context),M=0;M<l._sb.length;M++)l.__h.push(l._sb[M]);l._sb=[]}else do l.__d=!1,k&&k(e),f=l.render(l.props,l.state,l.context),l.state=l.__s;while(l.__d&&++S<25);l.state=l.__s,l.getChildContext!=null&&(s=q(q({},s),l.getChildContext())),h&&!p&&l.getSnapshotBeforeUpdate!=null&&(N=l.getSnapshotBeforeUpdate(_,y)),H=f,f!=null&&f.type===R&&f.key==null&&(H=Oe(f.props.children)),u=$e(t,X(H)?H:[H],e,n,s,i,a,o,u,d,c),l.base=e.__e,e.__u&=-161,l.__h.length&&o.push(l),v&&(l.__E=l.__=null)}catch(D){if(e.__v=null,d||a!=null)if(D.then){for(e.__u|=d?160:128;u&&u.nodeType==8&&u.nextSibling;)u=u.nextSibling;a[a.indexOf(u)]=null,e.__e=u}else{for(J=a.length;J--;)de(a[J]);ie(e)}else e.__e=n.__e,e.__k=n.__k,D.then||ie(e);F.__e(D,e,n)}else a==null&&e.__v==n.__v?(e.__k=n.__k,e.__e=n.__e):u=e.__e=Je(n.__e,e,n,s,i,a,o,d,c);return(f=F.diffed)&&f(e),128&e.__u?void 0:u}function ie(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(ie)}function Re(t,e,n){for(var s=0;s<n.length;s++)he(n[s],n[++s],n[++s]);F.__c&&F.__c(e,t),t.some(function(i){try{t=i.__h,i.__h=[],t.some(function(a){a.call(i)})}catch(a){F.__e(a,i.__v)}})}function Oe(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:X(t)?t.map(Oe):q({},t)}function Je(t,e,n,s,i,a,o,u,d){var c,f,l,p,_,y,N,v=n.props,m=e.props,h=e.type;if(h=="svg"?i="http://www.w3.org/2000/svg":h=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),a!=null){for(c=0;c<a.length;c++)if((_=a[c])&&"setAttribute"in _==!!h&&(h?_.localName==h:_.nodeType==3)){t=_,a[c]=null;break}}if(t==null){if(h==null)return document.createTextNode(m);t=document.createElementNS(i,h,m.is&&m),u&&(F.__m&&F.__m(e,a),u=!1),a=null}if(h==null)v===m||u&&t.data==m||(t.data=m);else{if(a=a&&K.call(t.childNodes),v=n.props||I,!u&&a!=null)for(v={},c=0;c<t.attributes.length;c++)v[(_=t.attributes[c]).name]=_.value;for(c in v)if(_=v[c],c!="children"){if(c=="dangerouslySetInnerHTML")l=_;else if(!(c in m)){if(c=="value"&&"defaultValue"in m||c=="checked"&&"defaultChecked"in m)continue;Q(t,c,null,_,i)}}for(c in m)_=m[c],c=="children"?p=_:c=="dangerouslySetInnerHTML"?f=_:c=="value"?y=_:c=="checked"?N=_:u&&typeof _!="function"||v[c]===_||Q(t,c,_,v[c],i);if(f)u||l&&(f.__html==l.__html||f.__html==t.innerHTML)||(t.innerHTML=f.__html),e.__k=[];else if(l&&(t.innerHTML=""),$e(e.type=="template"?t.content:t,X(p)?p:[p],e,n,s,h=="foreignObject"?"http://www.w3.org/1999/xhtml":i,a,o,a?a[0]:n.__k&&G(n,0),u,d),a!=null)for(c=a.length;c--;)de(a[c]);u||(c="value",h=="progress"&&y==null?t.removeAttribute("value"):y!=null&&(y!==t[c]||h=="progress"&&!y||h=="option"&&y!=v[c])&&Q(t,c,y,v[c],i),c="checked",N!=null&&N!=t[c]&&Q(t,c,N,v[c],i))}return t}function he(t,e,n){try{if(typeof t=="function"){var s=typeof t.__u=="function";s&&t.__u(),s&&e==null||(t.__u=t(e))}else t.current=e}catch(i){F.__e(i,n)}}function De(t,e,n){var s,i;if(F.unmount&&F.unmount(t),(s=t.ref)&&(s.current&&s.current!=t.__e||he(s,null,e)),(s=t.__c)!=null){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(a){F.__e(a,e)}s.base=s.__P=null}if(s=t.__k)for(i=0;i<s.length;i++)s[i]&&De(s[i],e,n||typeof t.type!="function");n||de(t.__e),t.__c=t.__=t.__e=void 0}function Ze(t,e,n){return this.constructor(t,n)}function et(t,e,n){var s,i,a,o;e==document&&(e=document.documentElement),F.__&&F.__(t,e),i=(s=!1)?null:e.__k,a=[],o=[],ue(e,t=e.__k=Ye(R,null,[t]),i||I,I,e.namespaceURI,i?null:e.firstChild?K.call(e.childNodes):null,a,i?i.__e:e.firstChild,s,o),Re(a,t,o)}K=Le.slice,F={__e:function(t,e,n,s){for(var i,a,o;e=e.__;)if((i=e.__c)&&!i.__)try{if((a=i.constructor)&&a.getDerivedStateFromError!=null&&(i.setState(a.getDerivedStateFromError(t)),o=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(t,s||{}),o=i.__d),o)return i.__E=i}catch(u){t=u}throw t}},Ee=0,z.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=q({},this.state),typeof t=="function"&&(t=t(q({},n),this.props)),t&&q(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),fe(this))},z.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),fe(this))},z.prototype.render=R,O=[],Ce=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Pe=function(t,e){return t.__v.__b-e.__v.__b},j.__r=0,Me=/(PointerCapture)$|Capture$/i,ce=0,se=ge(!1),ae=ge(!0);var tt=0;function r(t,e,n,s,i,a){e||(e={});var o,u,d=e;if("ref"in d)for(u in d={},e)u=="ref"?o=e[u]:d[u]=e[u];var c={type:t,props:d,key:n,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--tt,__i:-1,__u:0,__source:i,__self:a};if(typeof t=="function"&&(o=t.defaultProps))for(u in o)d[u]===void 0&&(d[u]=o[u]);return F.vnode&&F.vnode(c),c}var B,E,Z,ye,Y=0,Ae=[],C=F,ve=C.__b,be=C.__r,Ne=C.diffed,we=C.__c,xe=C.unmount,ke=C.__;function pe(t,e){C.__h&&C.__h(E,t,Y||e),Y=0;var n=E.__H||(E.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function x(t){return Y=1,nt(He,t)}function nt(t,e,n){var s=pe(B++,2);if(s.t=t,!s.__c&&(s.__=[He(void 0,e),function(u){var d=s.__N?s.__N[0]:s.__[0],c=s.t(d,u);d!==c&&(s.__N=[c,s.__[1]],s.__c.setState({}))}],s.__c=E,!E.__f)){var i=function(u,d,c){if(!s.__c.__H)return!0;var f=s.__c.__H.__.filter(function(p){return!!p.__c});if(f.every(function(p){return!p.__N}))return!a||a.call(this,u,d,c);var l=s.__c.props!==u;return f.forEach(function(p){if(p.__N){var _=p.__[0];p.__=p.__N,p.__N=void 0,_!==p.__[0]&&(l=!0)}}),a&&a.call(this,u,d,c)||l};E.__f=!0;var a=E.shouldComponentUpdate,o=E.componentWillUpdate;E.componentWillUpdate=function(u,d,c){if(this.__e){var f=a;a=void 0,i(u,d,c),a=f}o&&o.call(this,u,d,c)},E.shouldComponentUpdate=i}return s.__N||s.__}function $(t,e){var n=pe(B++,3);!C.__s&&Ge(n.__H,e)&&(n.__=t,n.u=e,E.__H.__h.push(n))}function rt(t){return Y=5,st(function(){return{current:t}},[])}function st(t,e){var n=pe(B++,7);return Ge(n.__H,e)&&(n.__=t(),n.__H=e,n.__h=t),n.__}function at(){for(var t;t=Ae.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(V),t.__H.__h.forEach(le),t.__H.__h=[]}catch(e){t.__H.__h=[],C.__e(e,t.__v)}}C.__b=function(t){E=null,ve&&ve(t)},C.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),ke&&ke(t,e)},C.__r=function(t){be&&be(t),B=0;var e=(E=t.__c).__H;e&&(Z===E?(e.__h=[],E.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(e.__h.forEach(V),e.__h.forEach(le),e.__h=[],B=0)),Z=E},C.diffed=function(t){Ne&&Ne(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(Ae.push(e)!==1&&ye===C.requestAnimationFrame||((ye=C.requestAnimationFrame)||it)(at)),e.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),Z=E=null},C.__c=function(t,e){e.some(function(n){try{n.__h.forEach(V),n.__h=n.__h.filter(function(s){return!s.__||le(s)})}catch(s){e.some(function(i){i.__h&&(i.__h=[])}),e=[],C.__e(s,n.__v)}}),we&&we(t,e)},C.unmount=function(t){xe&&xe(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(s){try{V(s)}catch(i){e=i}}),n.__H=void 0,e&&C.__e(e,n.__v))};var Se=typeof requestAnimationFrame=="function";function it(t){var e,n=function(){clearTimeout(s),Se&&cancelAnimationFrame(e),setTimeout(t)},s=setTimeout(n,35);Se&&(e=requestAnimationFrame(n))}function V(t){var e=E,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),E=e}function le(t){var e=E;t.__c=t.__(),E=e}function Ge(t,e){return!t||t.length!==e.length||e.some(function(n,s){return n!==t[s]})}function He(t,e){return typeof e=="function"?e(t):e}const lt={maxQueueSize:50,defaultTimeout:1e4,maxTimeout:3e4};class ot{constructor(e={}){P(this,"queue",[]);P(this,"processing",!1);P(this,"nextId",1);P(this,"config");P(this,"stats",{totalProcessed:0,totalTimeouts:0,totalErrors:0});this.config={...lt,...e}}async enqueue(e,n){if(this.queue.length>=this.config.maxQueueSize)throw new Error(`Query queue full (${this.config.maxQueueSize} items). Too many pending queries.`);const s=Math.min(n||this.config.defaultTimeout,this.config.maxTimeout);return new Promise((i,a)=>{const o={id:this.nextId++,execute:e,resolve:i,reject:a,timeout:s,enqueuedAt:Date.now()};this.queue.push(o),this.processing||this.processQueue()})}async processQueue(){if(!(this.processing||this.queue.length===0)){for(this.processing=!0;this.queue.length>0;){const e=this.queue.shift();try{await this.executeWithTimeout(e)}catch{}}this.processing=!1}}async executeWithTimeout(e){const n=new Promise((s,i)=>{setTimeout(()=>{i(new Error(`Query ${e.id} timed out after ${e.timeout}ms`))},e.timeout)});try{const s=await Promise.race([e.execute(),n]);this.stats.totalProcessed++,e.resolve(s)}catch(s){s instanceof Error&&s.message.includes("timed out")?(this.stats.totalTimeouts++,console.warn(`[QueryQueue] Query ${e.id} timed out`,{timeout:e.timeout,waitTime:Date.now()-e.enqueuedAt})):this.stats.totalErrors++,e.reject(s)}}getStats(){return{queueLength:this.queue.length,busy:this.processing,totalProcessed:this.stats.totalProcessed,totalTimeouts:this.stats.totalTimeouts,totalErrors:this.stats.totalErrors}}isBusy(){return this.processing||this.queue.length>0}clear(){const e=new Error("Query queue cleared");for(const n of this.queue)n.reject(e);this.queue=[]}get length(){return this.queue.length}}let ee=null;function oe(t){return ee||(ee=new ot(t)),ee}function ct(t,e){return oe().enqueue(t,e)}class dt{constructor(){P(this,"worker",null);P(this,"nextId",1);P(this,"pending",new Map);this.initWorker()}initWorker(){this.worker=new Worker(new URL("/assets/sqlite.worker-B9s5gY5D.js",import.meta.url),{type:"module"}),this.worker.onmessage=e=>{const n=e.data;if("type"in n&&n.type==="READY"){console.log("[DbClient] Worker ready");return}const{id:s,response:i}=n,a=this.pending.get(s);a&&(this.pending.delete(s),a.resolve(i))},this.worker.onerror=e=>{console.error("[DbClient] Worker error:",e);for(const n of this.pending.values())n.reject(new Error("Worker error"));this.pending.clear()}}async sendRequest(e,n=1e4){if(!this.worker)throw new Error("Worker not initialized");const s=this.nextId++;return ct(async()=>new Promise((i,a)=>{const o=setTimeout(()=>{this.pending.delete(s),a(new Error(`Request ${e.type} timed out after ${n}ms`))},n);this.pending.set(s,{resolve:d=>{clearTimeout(o),d.ok?i(d.data):a(new Error(d.error))},reject:d=>{clearTimeout(o),a(d)},timeout:o});const u={id:s,request:e};this.worker.postMessage(u)}),n)}async openFromFile(e){return this.sendRequest({type:"OPEN_FROM_FILE",file:e})}async openFromOpfs(e){return this.sendRequest({type:"OPEN_FROM_OPFS",path:e})}async openDemo(){return this.sendRequest({type:"OPEN_DEMO"})}async saveToOpfs(e){return this.sendRequest({type:"SAVE_TO_OPFS",path:e})}async removeFromOpfs(e){return this.sendRequest({type:"REMOVE_FROM_OPFS",path:e})}async listOpfsFiles(){return this.sendRequest({type:"LIST_OPFS_FILES"})}async close(){return this.sendRequest({type:"CLOSE"})}async searchFts(e,n=20,s,i){return this.sendRequest({type:"FTS_SEARCH",query:e,limit:n,entityType:s,entityValue:i})}async searchHybrid(e,n=20,s){return this.sendRequest({type:"HYBRID_SEARCH",query:e,limit:n,weights:s})}async listEntities(e,n=100){return this.sendRequest({type:"LIST_ENTITIES",entityType:e,limit:n})}async getPageList(e=100,n=0){return this.sendRequest({type:"GET_PAGE_LIST",limit:e,offset:n})}async getPageBlob(e){return this.sendRequest({type:"GET_PAGE_BLOB",name:e})}async verifyPage(e){return this.sendRequest({type:"VERIFY_PAGE",gid:e})}async getCheckpoints(){return this.sendRequest({type:"GET_CHECKPOINTS"})}async graphHops(e,n,s,i){return this.sendRequest({type:"GRAPH_HOPS",seedGid:e,predicate:n,maxHops:s,limit:i})}getQueueStats(){return oe().getStats()}isQueueBusy(){return oe().isBusy()}terminate(){this.worker&&(this.worker.terminate(),this.worker=null);for(const e of this.pending.values())clearTimeout(e.timeout),e.reject(new Error("Worker terminated"));this.pending.clear()}}let te=null;function L(){return te||(te=new dt),te}function We(t={}){const{defaultMode:e="hybrid",maxResults:n=10,maxGraphHops:s=2}=t,[i,a]=x(e),[o,u]=x(null),[d,c]=x(""),[f,l]=x(!1),[p,_]=x(null),[y,N]=x({});return{mode:i,results:o,lastQuery:d,loading:f,error:p,entityFilter:y,search:async b=>{if(b.trim()){l(!0),_(null),c(b);try{const k=L();let S=[];switch(i){case"fts":S=await ut(k,b,n,y);break;case"hybrid":S=await k.searchHybrid(b,n);break;case"graph":S=await ht(k,b,n,s,y);break;default:throw new Error(`Unknown search mode: ${i}`)}return u(S),console.log(`[Search] ${i} mode: ${S.length} results`),S}catch(k){const S=String(k);return _(S),console.error("[Search] Failed:",k),[]}finally{l(!1)}}},clear:()=>{u(null),c(""),_(null)},changeMode:b=>{a(b),u(null)},setFilter:b=>{N(b),u(null)},clearFilter:()=>{N({}),u(null)}}}async function ut(t,e,n,s){return(await t.searchFts(e,n,s.entityType,s.entityValue)).map(a=>({gid:a.gid,pageNo:a.pageNo,title:a.title,snippet:a.snippet,scores:{fts:a.score,vector:0,entity:0,graph:0,final:a.score}}))}async function ht(t,e,n,s,i){const a=await t.searchFts(e,3,i.entityType,i.entityValue);if(a.length===0)return[];const o=a[0].gid,u=await t.graphHops(o,void 0,s,n),d=u.nodes.map(c=>{const f=u.distances[c.gid]||0,l=a.find(p=>p.gid===c.gid);return{gid:c.gid,pageNo:c.pageNo,title:c.title,snippet:(l==null?void 0:l.snippet)||null,scores:{fts:(l==null?void 0:l.score)||0,vector:0,entity:0,graph:1/(f+1),final:((l==null?void 0:l.score)||0)*.3+1/(f+1)*.7}}});return d.sort((c,f)=>f.scores.final-c.scores.final),d}function pt({mode:t,onModeChange:e,showToggle:n=!0}){return n?r("div",{className:"search-mode-toggle",children:[r("button",{className:`mode-btn ${t==="fts"?"active":""}`,onClick:()=>e("fts"),children:"ðŸ“ FTS Only"}),r("button",{className:`mode-btn ${t==="hybrid"?"active":""}`,onClick:()=>e("hybrid"),children:"âš¡ Hybrid"}),r("button",{className:`mode-btn ${t==="graph"?"active":""}`,onClick:()=>e("graph"),children:"ðŸ•¸ï¸ Graph"})]}):null}function _t({onSearch:t,loading:e,placeholder:n}){return r("form",{onSubmit:s=>{s.preventDefault();const a=new FormData(s.currentTarget).get("query");a!=null&&a.trim()&&t(a.trim())},children:r("div",{className:"search-bar",children:[r("input",{type:"text",name:"query",placeholder:n||"Search the capsule...",className:"search-input",disabled:e}),r("button",{type:"submit",className:"btn-search",disabled:e,children:e?"Searching...":"Search"})]})})}function ft({results:t,query:e,onResultClick:n}){return r("div",{className:"search-results",children:[r("p",{className:"results-header",children:["Found ",t.length," results for ",r("strong",{children:['"',e,'"']})]}),t.map(s=>r("div",{className:`result-item ${n?"result-item-clickable":""}`,onClick:()=>n==null?void 0:n(s.gid),style:{cursor:n?"pointer":"default"},children:[r("div",{className:"result-header",children:[r("span",{className:"result-page",children:["Page ",s.pageNo]}),r("span",{className:"result-score",children:["Score: ",s.scores.final.toFixed(3)]})]}),r("h4",{className:"result-title",children:s.title}),s.snippet&&r("p",{className:"result-snippet",dangerouslySetInnerHTML:{__html:s.snippet}}),r("div",{className:"result-scores",children:[r("span",{children:["FTS: ",s.scores.fts.toFixed(2)]}),r("span",{children:["Entity: ",s.scores.entity.toFixed(2)]}),r("span",{children:["Graph: ",s.scores.graph.toFixed(2)]})]})]},s.gid))]})}function mt({mode:t,results:e,lastQuery:n,loading:s,onSearch:i,onModeChange:a,onResultClick:o,showModeToggle:u=!0,placeholder:d,searchHint:c}){return r("div",{className:"search-section",children:[r("div",{className:"search-header",children:r("h3",{children:"ðŸ” Search"})}),r(pt,{mode:t,onModeChange:a,showToggle:u}),c&&r("p",{className:"search-hint",children:c}),r(_t,{onSearch:i,loading:s,placeholder:d}),e&&e.length>0&&r(ft,{results:e,query:n,onResultClick:o}),e&&e.length===0&&r("div",{className:"no-results",children:[r("p",{children:["No results found for ",r("strong",{children:['"',n,'"']})]}),r("p",{className:"search-hint",children:"Try different keywords or search terms."})]})]})}function Ie(t={}){const{autoLoad:e=!0,maxEntities:n=50}=t,[s,i]=x([]),[a,o]=x(null),[u,d]=x(!1),[c,f]=x(null),l=async()=>{d(!0),f(null);try{const h=await L().listEntities(void 0,n);i(h),console.log("[Entities] Loaded:",h.length)}catch(m){const h=String(m);f(h),console.error("[Entities] Failed to load:",m)}finally{d(!1)}};$(()=>{e&&l()},[e]);const p=m=>{o(m)},_=()=>Array.from(new Set(s.map(m=>m.entityType))),y=()=>a?s.filter(m=>m.entityType===a):s,N=m=>s.filter(h=>h.entityType===m).reduce((h,g)=>h+g.count,0),v=()=>s.reduce((m,h)=>m+h.count,0);return{entities:s,selectedType:a,loading:u,error:c,types:_(),filteredEntities:y(),totalCount:v(),loadEntities:l,selectType:p,getTypeCount:N}}function gt({types:t,selectedType:e,totalCount:n,onSelectType:s,getTypeCount:i}){return r("div",{className:"entity-filters",children:[r("button",{className:`entity-filter ${e===null?"active":""}`,onClick:()=>s(null),children:["All (",n,")"]}),t.map(a=>{const o=i(a);return r("button",{className:`entity-filter ${e===a?"active":""}`,onClick:()=>s(a),children:[a," (",o,")"]},a)})]})}function yt({entities:t,maxDisplay:e=20}){const n=t.slice(0,e);return r("div",{className:"entity-list",children:[n.map(s=>r("div",{className:"entity-item",children:[r("span",{className:"entity-type",children:s.entityType}),r("span",{className:"entity-value",children:s.normalizedValue}),r("span",{className:"entity-count",children:s.count})]},`${s.entityType}-${s.normalizedValue}`)),t.length>e&&r("div",{className:"entity-item entity-more",children:r("span",{className:"entity-value",children:["... and ",t.length-e," more"]})})]})}function vt({entities:t,types:e,selectedType:n,totalCount:s,onSelectType:i,getTypeCount:a,show:o=!0,maxDisplay:u=20}){if(!o||t.length===0)return null;const d=n?t.filter(c=>c.entityType===n):t;return r("div",{className:"entity-panel",children:[r("h4",{children:"Filter by Entity Type"}),r(gt,{types:e,selectedType:n,totalCount:s,onSelectType:i,getTypeCount:a}),r(yt,{entities:d,maxDisplay:u})]})}class bt{constructor(){P(this,"worker",null);P(this,"nextId",1);P(this,"pending",new Map);P(this,"progressCallback",null);this.initWorker()}initWorker(){this.worker=new Worker(new URL("/assets/llm.worker-DcSBfjIK.js",import.meta.url),{type:"module"}),this.worker.onmessage=e=>{const n=e.data;if("type"in n&&n.type==="READY"){console.log("[LlmClient] Worker ready");return}if("type"in n&&n.type==="PROGRESS"){this.progressCallback&&this.progressCallback(n.data);return}const{id:s,response:i}=n,a=this.pending.get(s);a&&(this.pending.delete(s),a.resolve(i))},this.worker.onerror=e=>{console.error("[LlmClient] Worker error:",e);for(const n of this.pending.values())n.reject(new Error("Worker error"));this.pending.clear()}}async sendRequest(e){if(!this.worker)throw new Error("Worker not initialized");const n=this.nextId++;return new Promise((s,i)=>{this.pending.set(n,{resolve:o=>{o.ok?s(o.data):i(new Error(o.error))},reject:i});const a={id:n,request:e};this.worker.postMessage(a)})}onProgress(e){this.progressCallback=e}async loadModel(e){return this.sendRequest({type:"LOAD_MODEL",modelUrl:e})}async reason(e){return this.sendRequest({type:"REASON",request:e})}async unloadModel(){return this.sendRequest({type:"UNLOAD_MODEL"})}async getStatus(){return this.sendRequest({type:"GET_STATUS"})}terminate(){this.worker&&(this.worker.terminate(),this.worker=null),this.pending.clear(),this.progressCallback=null}}let ne=null;function Fe(){return ne||(ne=new bt),ne}const Nt={"0.6b":"https://huggingface.co/unsloth/Qwen3-0.6B-GGUF/resolve/main/Qwen3-0.6B-Q4_K_M.gguf","1.5b":"https://huggingface.co/ggml-org/Qwen2.5-1.5B-Instruct-GGUF/resolve/main/qwen2.5-1.5b-instruct-q4_k_m.gguf"};function wt(t={}){const[e,n]=x(!1),[s,i]=x(null),[a,o]=x(!1),[u,d]=x(null),[c,f]=x(null),[l,p]=x(null),_=async()=>{o(!0),p(null),d(null);try{const m=Fe();m.onProgress(g=>{d(g)});const h=await m.loadModel(Nt["0.6b"]);i(h),d(null),console.log("[LLM] Model loaded:",h)}catch(m){const h=String(m);p(h),console.error("[LLM] Failed to load model:",m)}finally{o(!1)}};return{enabled:e,modelInfo:s,loading:a,progress:u,reasoning:c,error:l,toggle:async()=>{e?(n(!1),f(null)):(s!=null&&s.loaded||await _(),n(!0))},loadModel:_,reason:async(m,h,g=256)=>{if(!(s!=null&&s.loaded)){console.warn("[LLM] Cannot reason: model not loaded");return}o(!0),p(null);try{const w=Fe(),b=h.slice(0,5).map(S=>({gid:S.gid,pageNo:S.pageNo,title:S.title,text:S.snippet||"",score:S.scores.final})),k=await w.reason({question:m,snippets:b,maxTokens:g,temperature:.7});f(k),console.log("[LLM] Reasoning complete:",k)}catch(w){const b=String(w);p(b),console.error("[LLM] Reasoning failed:",w)}finally{o(!1)}},clearReasoning:()=>{f(null)}}}function A(){return typeof navigator<"u"&&"storage"in navigator&&"getDirectory"in navigator.storage}async function xt(){if(!A())throw new Error("OPFS not supported in this browser");return await navigator.storage.getDirectory()}async function kt(){return await(await xt()).getDirectoryHandle("capsules",{create:!0})}function St(t){const e=t.replace(/[^a-z0-9._-]/gi,"-");return e.endsWith(".mgx.sqlite")?e:`${e}.mgx.sqlite`}async function Ft(t,e){if(!A())throw new Error("OPFS not supported - cannot persist file");const n=await kt(),s=e||St(t.name),a=await(await n.getFileHandle(s,{create:!0})).createWritable();try{return await a.write(t),await a.close(),console.log(`[OPFS] Copied file to ${s} (${t.size} bytes)`),{path:s,size:t.size}}catch(o){throw await a.close(),o}}async function Et(){if(!navigator.storage||!navigator.storage.estimate)return null;try{const t=await navigator.storage.estimate(),e=t.usage||0,n=t.quota||0;return{usage:e,quota:n,available:n-e,percentUsed:n>0?e/n*100:0}}catch(t){return console.error("[OPFS] Failed to get storage quota:",t),null}}async function Ct(){if(!navigator.storage||!navigator.storage.persist)return!1;try{const t=await navigator.storage.persist();return console.log(`[OPFS] Persistent storage: ${t}`),t}catch(t){return console.error("[OPFS] Failed to request persistent storage:",t),!1}}function W(t){if(t===0)return"0 B";const e=1024,n=["B","KB","MB","GB"],s=Math.floor(Math.log(t)/Math.log(e));return`${(t/Math.pow(e,s)).toFixed(2)} ${n[s]}`}async function Pt(t,e=500*1024*1024){if(t.size===0)return{valid:!1,error:"File is empty"};if(t.size>e)return{valid:!1,error:`File too large (${W(t.size)} > ${W(e)})`};const n=t.name.toLowerCase();if(!n.endsWith(".mgx.sqlite")&&!n.endsWith(".sqlite"))return{valid:!1,error:"File must have .mgx.sqlite or .sqlite extension"};try{const s=await t.slice(0,16).arrayBuffer();if(!new TextDecoder().decode(s).startsWith("SQLite format 3"))return{valid:!1,error:"Not a valid SQLite file (invalid header)"}}catch(s){return{valid:!1,error:`Failed to read file header: ${s}`}}return{valid:!0}}function Mt({onFileSelected:t,onOpfsFileSelected:e,onError:n}){const[s,i]=x([]),[a,o]=x(null),[u,d]=x(!1),[c,f]=x(!1),l=L();$(()=>{p(),_()},[]);async function p(){try{const h=await l.listOpfsFiles();i(h)}catch(h){console.error("[FilePicker] Failed to list OPFS files:",h)}}async function _(){var h,g;try{const w=await Et();o(w);const b=await((g=(h=navigator.storage)==null?void 0:h.persisted)==null?void 0:g.call(h));f(b||!1)}catch(w){console.error("[FilePicker] Failed to get quota:",w)}}async function y(h){var b;const g=h.target,w=(b=g.files)==null?void 0:b[0];if(w){d(!0);try{const k=await Pt(w);if(!k.valid){n(k.error),d(!1);return}if(A()){const{path:S}=await Ft(w);await p(),await _(),t(w,S)}else t(w)}catch(k){n(`Failed to load file: ${k}`)}finally{d(!1),g.value=""}}}async function N(h){d(!0);try{e(h)}catch(g){n(`Failed to open from OPFS: ${g}`)}finally{d(!1)}}async function v(h,g){if(g.stopPropagation(),!!confirm(`Remove "${h}" from device storage?`))try{await l.removeFromOpfs(h),await p(),await _()}catch(w){n(`Failed to remove file: ${w}`)}}async function m(){try{await Ct()?f(!0):n("Persistent storage not granted. Files may be evicted under storage pressure.")}catch(h){n(`Failed to request persistence: ${h}`)}}return r("div",{class:"file-picker",children:[r("div",{class:"file-picker-header",children:[r("h2",{children:"Open Capsule"}),a&&r("div",{class:"storage-quota",children:[r("div",{class:"quota-bar",children:r("div",{class:"quota-used",style:`width: ${Math.min(a.percentUsed,100)}%`})}),r("p",{class:"quota-text",children:[W(a.usage)," / ",W(a.quota)," used (",a.percentUsed.toFixed(1),"%)"]}),!c&&A()&&r("button",{class:"btn-secondary btn-sm",onClick:m,children:"Request Persistent Storage"})]})]}),r("div",{class:"file-input-section",children:[r("label",{class:"file-input-label",children:[r("input",{type:"file",accept:".mgx.sqlite,.sqlite",onChange:y,disabled:u,style:"display: none"}),r("button",{class:"btn-primary",disabled:u,children:u?"Loading...":"Select File from Device"})]}),r("p",{class:"help-text",children:"Choose a .mgx.sqlite or .sqlite file from your device"})]}),A()&&s.length>0&&r("div",{class:"opfs-files-section",children:[r("h3",{children:"Stored on Device"}),r("ul",{class:"opfs-files-list",children:s.map(h=>r("li",{class:"opfs-file-item",children:[r("button",{class:"opfs-file-button",onClick:()=>N(h.path),disabled:u,children:r("div",{class:"file-info",children:[r("span",{class:"file-name",children:h.path}),r("span",{class:"file-meta",children:[W(h.size)," â€¢"," ",new Date(h.lastModified).toLocaleDateString()]})]})}),r("button",{class:"btn-remove",onClick:g=>v(h.path,g),title:"Remove from device","aria-label":"Remove from device",children:"Ã—"})]},h.path))})]}),!A()&&r("div",{class:"opfs-warning",children:r("p",{children:[r("strong",{children:"Note:"})," Your browser doesn't support persistent storage. Files will only be kept in memory and lost when you close the tab."]})})]})}function Lt(t={}){const{autoLoad:e=!1,maxHops:n=2,limit:s=50}=t,[i,a]=x(null),[o,u]=x(null),[d,c]=x(void 0),[f,l]=x(!1),[p,_]=x(null),y=async(b,k)=>{l(!0),_(null),u(b),c(k);try{const M=await L().graphHops(b,k,n,s);a(M),console.log("[Graph] Loaded:",M.nodes.length,"nodes,",M.edges.length,"edges")}catch(S){const M=String(S);_(M),console.error("[Graph] Failed to load:",S)}finally{l(!1)}},N=async b=>{await y(b,d)},v=async b=>{o&&await y(o,b)},m=()=>{a(null),u(null),c(void 0),_(null)},h=()=>i?Array.from(new Set(i.edges.map(b=>b.predicate))):[],g=b=>i==null?void 0:i.nodes.find(k=>k.gid===b),w=b=>i?i.edges.filter(k=>k.fromGid===b):[];return $(()=>{e&&o&&y(o,d)},[e]),{graphData:i,seedGid:o,predicate:d,loading:f,error:p,predicates:h(),nodeCount:(i==null?void 0:i.nodes.length)||0,edgeCount:(i==null?void 0:i.edges.length)||0,loadGraph:y,navigateToNode:N,filterByPredicate:v,clear:m,getNode:g,getNodeEdges:w}}function Tt({nodes:t,edges:e,seedGid:n,onNodeClick:s,width:i=800,height:a=600}){const[o,u]=x(new Map),d=rt();return $(()=>{const c=new Map,f=i/2,l=a/2;t.forEach((p,_)=>{const y=_/t.length*2*Math.PI,N=Math.min(i,a)/3;c.set(p.gid,{gid:p.gid,x:f+N*Math.cos(y),y:l+N*Math.sin(y),vx:0,vy:0})}),u(c)},[t,i,a]),$(()=>{if(o.size===0)return;const c=()=>{const l=new Map(o),p=.3;l.forEach(_=>{l.forEach(y=>{if(_.gid===y.gid)return;const N=y.x-_.x,v=y.y-_.y,m=N*N+v*v+1,h=Math.sqrt(m),g=2e3/m;_.vx-=N/h*g*p,_.vy-=v/h*g*p})}),e.forEach(_=>{const y=l.get(_.fromGid),N=l.get(_.toGid);if(!y||!N)return;const v=N.x-y.x,m=N.y-y.y,h=Math.sqrt(v*v+m*m)+1,g=h*.01;y.vx+=v/h*g*p,y.vy+=m/h*g*p,N.vx-=v/h*g*p,N.vy-=m/h*g*p}),l.forEach(_=>{_.x+=_.vx,_.y+=_.vy,_.vx*=.8,_.vy*=.8,_.x=Math.max(30,Math.min(i-30,_.x)),_.y=Math.max(30,Math.min(a-30,_.y))}),u(l),d.current=requestAnimationFrame(c)};d.current=requestAnimationFrame(c);const f=setTimeout(()=>{d.current&&cancelAnimationFrame(d.current)},3e3);return()=>{d.current&&cancelAnimationFrame(d.current),clearTimeout(f)}},[e,i,a]),r("svg",{width:i,height:a,className:"graph-view",style:{border:"1px solid var(--color-border)",borderRadius:"8px"},children:[r("g",{className:"graph-edges",children:e.map((c,f)=>{const l=o.get(c.fromGid),p=o.get(c.toGid);return!l||!p?null:r("line",{x1:l.x,y1:l.y,x2:p.x,y2:p.y,stroke:"#94a3b8",strokeWidth:Math.max(1,c.weight*2),strokeOpacity:.6,markerEnd:"url(#arrowhead)"},`${c.fromGid}-${c.toGid}-${f}`)})}),r("defs",{children:r("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"10",refX:"9",refY:"3",orient:"auto",markerUnits:"strokeWidth",children:r("path",{d:"M0,0 L0,6 L9,3 z",fill:"#94a3b8"})})}),r("g",{className:"graph-nodes",children:t.map(c=>{const f=o.get(c.gid);if(!f)return null;const l=c.gid===n,p=l?12:8,_=l?"#3b82f6":"#64748b";return r("g",{className:"graph-node",onClick:()=>s==null?void 0:s(c.gid),style:{cursor:s?"pointer":"default"},children:[r("circle",{cx:f.x,cy:f.y,r:p,fill:_,stroke:"#ffffff",strokeWidth:2,opacity:.9}),r("text",{x:f.x,y:f.y-p-5,textAnchor:"middle",fontSize:"11",fill:"var(--color-fg)",style:{pointerEvents:"none",userSelect:"none"},children:c.title||`Page ${c.pageNo}`})]},c.gid)})})]})}function $t({nodes:t,edges:e,seedGid:n,onNodeClick:s,loading:i,error:a}){return i?r("div",{className:"graph-panel-loading",children:[r("div",{className:"spinner"}),r("p",{children:"Loading graph..."})]}):a?r("div",{className:"graph-panel-error",children:r("p",{children:["Error: ",a]})}):t.length===0?r("div",{className:"graph-panel-empty",children:[r("p",{children:"No graph data to display"}),r("p",{className:"hint",children:"Search for a page or select a result to explore its connections"})]}):r("div",{className:"graph-panel",children:[r("div",{className:"graph-info",children:[r("span",{children:[t.length," nodes"]}),r("span",{children:[e.length," edges"]})]}),r(Tt,{nodes:t,edges:e,seedGid:n,onNodeClick:s,width:800,height:600})]})}function qt({predicates:t,selectedPredicate:e,onPredicateChange:n,onReset:s}){return r("div",{className:"graph-controls",children:[r("div",{className:"graph-controls-section",children:[r("label",{className:"graph-controls-label",children:"Filter by Relationship:"}),r("select",{className:"graph-controls-select",value:e||"",onChange:i=>{const a=i.target.value;n(a||void 0)},children:[r("option",{value:"",children:"All Relationships"}),t.map(i=>r("option",{value:i,children:i},i))]})]}),s&&r("button",{className:"btn-secondary btn-sm",onClick:s,children:"Reset View"})]})}function Rt({nodeCount:t,edgeCount:e,predicateCount:n,seedNode:s}){return r("div",{className:"graph-stats",children:[r("div",{className:"graph-stat",children:[r("span",{className:"graph-stat-label",children:"Nodes:"}),r("span",{className:"graph-stat-value",children:t})]}),r("div",{className:"graph-stat",children:[r("span",{className:"graph-stat-label",children:"Edges:"}),r("span",{className:"graph-stat-value",children:e})]}),r("div",{className:"graph-stat",children:[r("span",{className:"graph-stat-label",children:"Relationships:"}),r("span",{className:"graph-stat-value",children:n})]}),s&&r("div",{className:"graph-stat",children:[r("span",{className:"graph-stat-label",children:"Seed:"}),r("span",{className:"graph-stat-value",children:s})]})]})}function Ot(t){return t.startsWith("asset://")?{protocol:"asset",path:t.slice(8)}:null}const re=new Map,Dt=new Map;async function At(t){if(re.has(t))return re.get(t);const e=Ot(t);if(!e)return console.error("[Assets] Invalid asset URL:",t),null;try{const s=await L().getPageBlob(e.path);if(!s||s.size===0)return console.warn("[Assets] Asset not found or empty:",e.path),null;const i=URL.createObjectURL(s);return re.set(t,i),Dt.set(t,s),console.log("[Assets] Loaded:",e.path,`(${s.size} bytes, ${s.type||"unknown type"})`),i}catch(n){return console.error("[Assets] Failed to load asset:",t,n),null}}function Gt(t){const[e,n]=x(null);return $(()=>{if(!t){n(null);return}if(!t.startsWith("asset://")){n(t);return}At(t).then(n)},[t]),e}function Ht({gid:t,onClose:e}){const[n,s]=x(null),[i,a]=x(!0),[o,u]=x(null);$(()=>{(async()=>{a(!0),u(null);try{const p=await L().query("SELECT gid, doc_id, page_no, title, tags, updated_ts FROM meta_index WHERE gid = ? LIMIT 1",[t]);p.length>0?s(p[0]):u("Page not found")}catch(l){u(String(l)),console.error("[PagePreview] Failed to load page:",l)}finally{a(!1)}})()},[t]);const d=n?`asset://glyphs/page_${String(n.pageNo).padStart(4,"0")}.mgx.png`:void 0,c=Gt(d);return i?r("div",{className:"page-preview",children:r("div",{className:"page-preview-loading",children:[r("div",{className:"spinner"}),r("p",{children:"Loading page..."})]})}):o||!n?r("div",{className:"page-preview",children:r("div",{className:"page-preview-error",children:[r("p",{children:["Error: ",o||"Page not found"]}),e&&r("button",{className:"btn-secondary",onClick:e,children:"Close"})]})}):r("div",{className:"page-preview",children:[r("div",{className:"page-preview-header",children:[r("div",{className:"page-preview-title",children:[r("span",{className:"page-number",children:["Page ",n.pageNo]}),r("h3",{children:n.title||"(Untitled)"})]}),e&&r("button",{className:"btn-icon",onClick:e,title:"Close preview",children:"âœ•"})]}),r("div",{className:"page-preview-content",children:c?r("img",{src:c,alt:`Page ${n.pageNo}`,className:"page-image"}):r("div",{className:"page-preview-placeholder",children:r("p",{children:"No image available for this page"})})}),r("div",{className:"page-preview-metadata",children:r("dl",{children:[r("dt",{children:"GID:"}),r("dd",{children:r("code",{title:n.gid,children:[n.gid.substring(0,16),"..."]})}),n.tags&&r(R,{children:[r("dt",{children:"Tags:"}),r("dd",{children:n.tags})]}),r("dt",{children:"Updated:"}),r("dd",{children:new Date(n.updatedTs).toLocaleString()})]})})]})}function Wt({selectedGid:t,onClose:e}){return t?r(Ht,{gid:t,onClose:e}):r("div",{className:"page-preview-panel-empty",children:r("p",{children:"Select a search result to preview the page"})})}function It({config:t,children:e}){return r("div",{className:"layout-landing",children:[r("section",{className:"hero",children:[r("div",{className:"hero-content",children:[t.logo_asset&&r("img",{src:t.logo_asset,alt:"Logo",className:"hero-logo"}),r("h1",{className:"hero-title",children:t.hero_title||t.site_title||"Welcome"}),t.hero_subtitle&&r("p",{className:"hero-subtitle",children:t.hero_subtitle})]}),t.hero_image&&r("div",{className:"hero-background",style:{backgroundImage:`url(${t.hero_image})`}})]}),r("main",{className:"landing-main",children:e})]})}function Bt({config:t,navigation:e,currentPage:n,children:s}){const i=e.filter(a=>a.menu==="sidebar");return r("div",{className:"layout-docs",children:[r("aside",{className:"docs-sidebar",children:r("nav",{className:"docs-nav",children:[r("div",{className:"docs-nav-header",children:[t.logo_asset&&r("img",{src:t.logo_asset,alt:"Logo",className:"docs-logo"}),r("h3",{children:t.site_title||"Documentation"})]}),r("ul",{className:"docs-nav-list",children:i.map(a=>r("li",{className:"docs-nav-item",children:r("a",{href:`#${a.to_slug}`,className:(n==null?void 0:n.slug)===a.to_slug?"active":"",children:[a.icon_asset&&r("img",{src:a.icon_asset,alt:"",className:"nav-icon"}),a.label]})},a.to_slug))})]})}),r("main",{className:"docs-main",children:[n&&r("div",{className:"docs-breadcrumbs",children:[r("a",{href:"#/",children:"Home"}),n.category&&r(R,{children:[r("span",{children:" / "}),r("span",{children:n.category})]}),r("span",{children:" / "}),r("span",{children:n.title})]}),r("article",{className:"docs-content",children:[n&&r("h1",{children:n.title}),s]})]})]})}function Be({config:t,children:e}){return r("div",{className:"layout-dashboard",children:[r("header",{className:"dashboard-header",children:r("h1",{children:t.site_title||"Dashboard"})}),r("main",{className:"dashboard-content",children:e})]})}function Qe({config:t,title:e,children:n}){return r("div",{className:"layout-simple",children:[r("header",{className:"simple-header",children:[t.logo_asset&&r("img",{src:t.logo_asset,alt:"Logo",className:"simple-logo"}),e&&r("h1",{children:e})]}),r("main",{className:"simple-content",children:n}),r("footer",{className:"simple-footer",children:r("p",{children:"Powered by GlyphCapsule"})})]})}function Qt({topBar:t,leftSidebar:e,centerPanel:n,rightSidebar:s,showLeftSidebar:i=!0,showRightSidebar:a=!1}){return r("div",{className:"capsule-layout",children:[r("div",{className:"capsule-topbar",children:t}),r("div",{className:"capsule-content",children:[i&&e&&r("aside",{className:"capsule-sidebar capsule-sidebar-left",children:e}),r("main",{className:"capsule-main",children:n}),a&&s&&r("aside",{className:"capsule-sidebar capsule-sidebar-right",children:s})]})]})}function Ut({capsuleName:t,onClose:e,actions:n}){return r("div",{className:"topbar-content",children:[r("div",{className:"topbar-left",children:r("h2",{className:"topbar-title",children:["ðŸ“¦ ",t]})}),r("div",{className:"topbar-right",children:[n,e&&r("button",{className:"btn-secondary btn-sm",onClick:e,children:"Close Capsule"})]})]})}function zt({title:t,children:e,onClear:n,hasActiveFilters:s=!1}){return r("div",{className:"filter-panel",children:[r("div",{className:"filter-panel-header",children:[r("h3",{children:t}),s&&n&&r("button",{className:"btn-link btn-sm",onClick:n,children:"Clear All"})]}),r("div",{className:"filter-panel-content",children:e})]})}function Vt({capsuleInfo:t,onClose:e}){const[n,s]=x("search"),[i,a]=x(null),o=We({defaultMode:"fts"}),u=Ie({autoLoad:!0}),d=Lt({maxHops:2,limit:50}),c=y=>{a(y)},f=y=>{d.navigateToNode(y),a(y)},l=y=>{s("graph"),d.loadGraph(y),a(y)},p=()=>{o.clearFilter(),o.lastQuery&&o.search(o.lastQuery)},_=!!(o.entityFilter.entityType||o.entityFilter.entityValue);return r(Qt,{topBar:r(Ut,{capsuleName:t.fileName,onClose:e,actions:r("div",{className:"capsule-stats",children:[r("span",{children:[t.pageCount," pages"]}),r("span",{children:[t.entityCount," entities"]}),r("span",{children:[t.edgeCount," edges"]})]})}),leftSidebar:r(zt,{title:"Entity Filters",onClear:p,hasActiveFilters:_,children:[_&&r("div",{className:"active-filters",children:[r("p",{className:"filter-label",children:"Active Filter:"}),o.entityFilter.entityType&&r("span",{className:"filter-tag",children:["Type: ",o.entityFilter.entityType]}),o.entityFilter.entityValue&&r("span",{className:"filter-tag",children:["Value: ",o.entityFilter.entityValue]})]}),r(vt,{entities:u.entities,types:u.types,selectedType:u.selectedType,totalCount:u.totalCount,onSelectType:u.selectType,getTypeCount:u.getTypeCount,show:!0,maxDisplay:20})]}),centerPanel:r("div",{className:"capsule-center",children:[r("div",{className:"view-mode-tabs",children:[r("button",{className:`tab-btn ${n==="search"?"active":""}`,onClick:()=>s("search"),children:"ðŸ” Search"}),r("button",{className:`tab-btn ${n==="graph"?"active":""}`,onClick:()=>s("graph"),children:"ðŸ•¸ï¸ Graph"})]}),n==="search"&&r(R,{children:r(mt,{mode:o.mode,results:o.results,lastQuery:o.lastQuery,loading:o.loading,onSearch:o.search,onModeChange:o.changeMode,onResultClick:c,showModeToggle:!0,placeholder:"Search the capsule...",searchHint:'Try: "vector search", "LEANN", "SQLite", or "hybrid retrieval"'})}),n==="graph"&&r("div",{className:"graph-view-container",children:[!d.graphData&&r("div",{className:"graph-view-empty",children:[r("p",{children:"Select a search result to explore its graph connections"}),r("p",{className:"hint",children:"Or switch to Search tab to find pages"})]}),d.graphData&&r(R,{children:[r(Rt,{nodeCount:d.nodeCount,edgeCount:d.edgeCount,predicateCount:d.predicates.length,seedNode:d.seedGid||void 0}),r(qt,{predicates:d.predicates,selectedPredicate:d.predicate,onPredicateChange:d.filterByPredicate,onReset:d.clear}),r($t,{nodes:d.graphData.nodes,edges:d.graphData.edges,seedGid:d.seedGid||void 0,onNodeClick:f,loading:d.loading,error:d.error})]})]}),i&&r("div",{className:"page-preview-section",children:[r("div",{className:"page-preview-header-actions",children:[r("h3",{children:"Page Preview"}),n==="search"&&r("button",{className:"btn-secondary btn-sm",onClick:()=>l(i),children:"Explore Graph"})]}),r(Wt,{selectedGid:i,onClose:()=>a(null)})]})]}),showLeftSidebar:!0,showRightSidebar:!1})}async function jt(t){const n=(await t.query("SELECT name FROM sqlite_master WHERE type='table'")).map(p=>p.name),s=n.includes("_ui_pages"),i=n.includes("_ui_dashboards"),a=n.includes("_ui_navigation"),o=n.includes("_ui_params"),u=n.includes("_meta_manifest"),d=n.includes("sqlar"),c=n.some(p=>p.startsWith("fts_"));let f="1.0";if(u)try{const p=await t.query("SELECT value FROM _meta_manifest WHERE key='gcui'");p.length>0&&(f=p[0].value)}catch(p){console.warn("Failed to read GCUI version:",p)}let l;return s&&i?l="hybrid":s?l="website":i?l="dashboard":l="generic",{version:f,hasWebsite:s,hasDashboards:i,hasNavigation:a,hasParams:o,hasFTS:c,hasAssets:d,mode:l}}async function Yt(t){try{const e=await t.query("SELECT key, value FROM _meta_manifest");if(e.length===0)return null;const n={gcui:"1.0",capsule_kind:"sqlar"};return e.forEach(s=>{n[s.key]=s.value}),n}catch(e){return console.warn("Failed to load manifest:",e),null}}async function Kt(t){try{const e=await t.query("SELECT key, value FROM _ui_config"),n={};return e.forEach(s=>{n[s.key]=s.value}),n}catch(e){return console.warn("Failed to load config:",e),{}}}async function Xt(t){try{return(await t.query("SELECT slug, title, content, layout, category, order_index FROM _ui_pages ORDER BY order_index ASC, slug ASC")).map(n=>({slug:n.slug,title:n.title,content:n.content||void 0,layout:n.layout||void 0,category:n.category||void 0,order_index:n.order_index||void 0}))}catch(e){return console.warn("Failed to load pages:",e),[]}}async function Jt(t){try{return(await t.query("SELECT menu, label, to_slug, order_index, icon_asset FROM _ui_navigation ORDER BY menu, order_index ASC")).map(n=>({menu:n.menu,label:n.label,to_slug:n.to_slug,order_index:n.order_index||void 0,icon_asset:n.icon_asset||void 0}))}catch(e){return console.warn("Failed to load navigation:",e),[]}}async function Zt(t){try{return(await t.query("SELECT name, query, grammar, config FROM _ui_dashboards")).map(n=>({name:n.name,query:n.query,grammar:n.grammar||void 0,config:n.config||void 0}))}catch(e){return console.warn("Failed to load dashboards:",e),[]}}async function en(t){const e=await jt(t),n=await Yt(t)||{gcui:e.version,capsule_kind:"sqlar"},s=await Kt(t),i=e.hasWebsite?await Xt(t):[],a=e.hasNavigation?await Jt(t):[],o=e.hasDashboards?await Zt(t):[];return{manifest:n,capabilities:e,config:s,pages:i,navigation:a,dashboards:o}}function tn({data:t,config:e,width:n=600,height:s=400}){if(!t||t.length===0)return r("div",{className:"chart-empty",style:{width:n,height:s},children:r("p",{children:"No data to display"})});switch(e.mark){case"bar":return r(nn,{data:t,config:e,width:n,height:s});case"line":return r(rn,{data:t,config:e,width:n,height:s});case"point":return r(sn,{data:t,config:e,width:n,height:s});case"area":return r(an,{data:t,config:e,width:n,height:s});default:return r("div",{className:"chart-unsupported",style:{width:n,height:s},children:[r("p",{children:["Unsupported chart type: ",e.mark]}),r("p",{children:"Showing data as table:"}),r(ln,{data:t})]})}}function nn({data:t,config:e,width:n,height:s}){var c,f;const{encoding:i}=e,a=((c=i.x)==null?void 0:c.field)||Object.keys(t[0])[0],o=((f=i.y)==null?void 0:f.field)||Object.keys(t[0])[1],u=Math.max(...t.map(l=>Number(l[o])||0)),d=Math.max(20,(n-100)/t.length-10);return r("div",{className:"chart chart-bar",style:{width:n,height:s},children:[e.title&&r("h4",{className:"chart-title",children:e.title}),r("div",{className:"chart-container",style:{height:s-60},children:r("div",{className:"chart-bars",style:{display:"flex",alignItems:"flex-end",height:"100%",gap:"8px"},children:t.map((l,p)=>{const _=Number(l[o])||0,y=_/u*(s-100);return r("div",{className:"chart-bar-item",style:{textAlign:"center"},children:[r("div",{className:"bar",style:{width:d,height:y,backgroundColor:"#6366f1",borderRadius:"4px 4px 0 0"},title:`${l[a]}: ${_}`}),r("div",{className:"bar-label",style:{fontSize:"12px",marginTop:"4px",maxWidth:d,overflow:"hidden",textOverflow:"ellipsis"},children:String(l[a]).slice(0,10)})]},p)})})}),r("div",{className:"chart-legend",style:{fontSize:"12px",marginTop:"8px",textAlign:"center"},children:[r("strong",{children:o})," by ",r("strong",{children:a})]})]})}function rn({data:t,config:e,width:n,height:s}){var v,m;const{encoding:i}=e,a=((v=i.x)==null?void 0:v.field)||Object.keys(t[0])[0],o=((m=i.y)==null?void 0:m.field)||Object.keys(t[0])[1],u=t.map(h=>Number(h[o])||0),d=Math.max(...u),c=Math.min(...u),f=d-c||1,l=n-80,p=s-100,_=l/(t.length-1||1),y=t.map((h,g)=>{const w=40+g*_,b=Number(h[o])||0,k=p-(b-c)/f*p+20;return{x:w,y:k,value:b,label:h[a]}}),N=y.map((h,g)=>`${g===0?"M":"L"} ${h.x} ${h.y}`).join(" ");return r("div",{className:"chart chart-line",style:{width:n,height:s},children:[e.title&&r("h4",{className:"chart-title",children:e.title}),r("svg",{width:n,height:s-40,style:{overflow:"visible"},children:[[0,.25,.5,.75,1].map(h=>{const g=p-h*p+20,w=c+h*f;return r("g",{children:[r("line",{x1:40,y1:g,x2:n-40,y2:g,stroke:"#e5e7eb",strokeWidth:1}),r("text",{x:10,y:g+4,fontSize:10,fill:"#666",children:w.toFixed(0)})]},h)}),r("path",{d:N,fill:"none",stroke:"#6366f1",strokeWidth:2}),y.map((h,g)=>r("circle",{cx:h.x,cy:h.y,r:4,fill:"#6366f1",children:r("title",{children:`${h.label}: ${h.value}`})},g)),y.map((h,g)=>r("text",{x:h.x,y:p+40,fontSize:10,fill:"#666",textAnchor:"middle",children:String(h.label).slice(0,8)},g))]}),r("div",{className:"chart-legend",style:{fontSize:"12px",textAlign:"center"},children:[r("strong",{children:o})," over ",r("strong",{children:a})]})]})}function sn({data:t,config:e,width:n,height:s}){var m,h;const{encoding:i}=e,a=((m=i.x)==null?void 0:m.field)||Object.keys(t[0])[0],o=((h=i.y)==null?void 0:h.field)||Object.keys(t[0])[1],u=t.map(g=>Number(g[a])||0),d=t.map(g=>Number(g[o])||0),c=Math.min(...u),f=Math.max(...u),l=Math.min(...d),p=Math.max(...d),_=f-c||1,y=p-l||1,N=n-80,v=s-100;return r("div",{className:"chart chart-scatter",style:{width:n,height:s},children:[e.title&&r("h4",{className:"chart-title",children:e.title}),r("svg",{width:n,height:s-40,children:[[0,.25,.5,.75,1].map(g=>{const w=v-g*v+20;return r("line",{x1:40,y1:w,x2:n-40,y2:w,stroke:"#e5e7eb",strokeWidth:1},g)}),t.map((g,w)=>{const b=Number(g[a])||0,k=Number(g[o])||0,S=40+(b-c)/_*N,M=v-(k-l)/y*v+20;return r("circle",{cx:S,cy:M,r:5,fill:"#6366f1",opacity:.7,children:r("title",{children:`${a}: ${b}, ${o}: ${k}`})},w)})]}),r("div",{className:"chart-legend",style:{fontSize:"12px",textAlign:"center"},children:[r("strong",{children:o})," vs ",r("strong",{children:a})]})]})}function an({data:t,config:e,width:n,height:s}){var m,h;const{encoding:i}=e,a=((m=i.x)==null?void 0:m.field)||Object.keys(t[0])[0],o=((h=i.y)==null?void 0:h.field)||Object.keys(t[0])[1],u=t.map(g=>Number(g[o])||0),d=Math.max(...u),c=Math.min(...u),f=d-c||1,l=n-80,p=s-100,_=l/(t.length-1||1),N=t.map((g,w)=>{const b=40+w*_,k=Number(g[o])||0,S=p-(k-c)/f*p+20;return{x:b,y:S}}).map((g,w)=>`${w===0?"M":"L"} ${g.x} ${g.y}`).join(" "),v=`${N} L ${n-40} ${p+20} L 40 ${p+20} Z`;return r("div",{className:"chart chart-area",style:{width:n,height:s},children:[e.title&&r("h4",{className:"chart-title",children:e.title}),r("svg",{width:n,height:s-40,children:[r("path",{d:v,fill:"#6366f1",opacity:.3}),r("path",{d:N,fill:"none",stroke:"#6366f1",strokeWidth:2})]}),r("div",{className:"chart-legend",style:{fontSize:"12px",textAlign:"center"},children:[r("strong",{children:o})," over ",r("strong",{children:a})]})]})}function ln({data:t}){if(t.length===0)return null;const e=Object.keys(t[0]);return r("table",{className:"data-table",style:{width:"100%",borderCollapse:"collapse",fontSize:"12px"},children:[r("thead",{children:r("tr",{children:e.map(n=>r("th",{style:{borderBottom:"2px solid #ddd",padding:"8px",textAlign:"left"},children:n},n))})}),r("tbody",{children:t.slice(0,10).map((n,s)=>r("tr",{children:e.map(i=>r("td",{style:{borderBottom:"1px solid #eee",padding:"6px"},children:String(n[i])},i))},s))})]})}function Ue({dashboards:t}){return t.length===0?r("div",{className:"dashboard-empty",children:r("p",{children:"No dashboards defined"})}):r("div",{className:"dashboard-grid",children:t.map(e=>r(on,{dashboard:e},e.name))})}function on({dashboard:t}){const[e,n]=x(null),[s,i]=x(!1),[a,o]=x(null);$(()=>{u()},[t.query]);const u=async()=>{i(!0),o(null);try{const f=await L().query(t.query);n(f)}catch(c){o(String(c)),console.error(`[Dashboard] Failed to load ${t.name}:`,c)}finally{i(!1)}};if(s)return r("div",{className:"dashboard-panel loading",children:[r("div",{className:"spinner"}),r("p",{children:["Loading ",t.name,"..."]})]});if(a)return r("div",{className:"dashboard-panel error",children:[r("h4",{children:t.name}),r("p",{className:"error-message",children:["Error: ",a]}),r("details",{children:[r("summary",{children:"Query"}),r("pre",{children:t.query})]})]});if(!e||e.length===0)return r("div",{className:"dashboard-panel empty",children:[r("h4",{children:t.name}),r("p",{children:"No data"})]});let d=null;if(t.config)try{d=JSON.parse(t.config)}catch(c){console.error(`[Dashboard] Invalid config for ${t.name}:`,c)}return!d||t.grammar!=="vegalite-lite-v1"?r("div",{className:"dashboard-panel table",children:[r("h4",{children:t.name}),r(cn,{data:e})]}):r("div",{className:"dashboard-panel chart",children:r(tn,{data:e,config:d,width:600,height:400})})}function cn({data:t}){const e=Object.keys(t[0]||{});return r("div",{style:{overflowX:"auto"},children:r("table",{className:"dashboard-table",style:{width:"100%",borderCollapse:"collapse",fontSize:"14px"},children:[r("thead",{children:r("tr",{children:e.map(n=>r("th",{style:{borderBottom:"2px solid #ddd",padding:"12px",textAlign:"left",fontWeight:600},children:n},n))})}),r("tbody",{children:t.map((n,s)=>r("tr",{style:{borderBottom:"1px solid #eee"},children:e.map(i=>r("td",{style:{padding:"10px"},children:String(n[i])},i))},s))})]})})}function dn({content:t}){const e=un(t);return r("div",{className:"markdown-content",dangerouslySetInnerHTML:{__html:e}})}function un(t){let e=t;return e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),e=e.replace(/^### (.*$)/gim,"<h3>$1</h3>"),e=e.replace(/^## (.*$)/gim,"<h2>$1</h2>"),e=e.replace(/^# (.*$)/gim,"<h1>$1</h1>"),e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/\*(.*?)\*/g,"<em>$1</em>"),e=e.replace(/`(.*?)`/g,"<code>$1</code>"),e=e.replace(/\[(.*?)\]\((.*?)\)/g,'<a href="$2">$1</a>'),e=e.replace(/```(.*?)\n([\s\S]*?)```/g,"<pre><code>$2</code></pre>"),e=e.replace(/^\- (.*$)/gim,"<li>$1</li>"),e=e.replace(/(<li>.*<\/li>)/s,"<ul>$1</ul>"),e=e.replace(/^\d+\. (.*$)/gim,"<li>$1</li>"),e=e.split(`

`).map(s=>s.startsWith("<h")||s.startsWith("<ul>")||s.startsWith("<ol>")||s.startsWith("<pre>")||s.startsWith("<li>")?s:`<p>${s}</p>`).join(`
`),e=e.replace(/\n/g,"<br>"),e}function hn({context:t}){const[e,n]=x("/");$(()=>{const i=()=>{const a=window.location.hash.slice(1);n(a||"/")};return window.addEventListener("hashchange",i),i(),()=>window.removeEventListener("hashchange",i)},[]);const s=t.pages.find(i=>i.slug===e)||t.pages[0];return s?r(pn,{page:s,context:t}):t.dashboards.length>0?r(Be,{config:t.config,children:r(Ue,{dashboards:t.dashboards})}):r(Qe,{config:t.config,title:"404 Not Found",children:[r("p",{children:["Page not found: ",e]}),r("p",{children:r("a",{href:"#/",children:"Go home"})})]})}function pn({page:t,context:e}){const n=t.layout||"simple",s=t.content?r(dn,{content:t.content}):r("p",{children:"No content"});switch(n){case"landing":return r(It,{config:e.config,children:s});case"docs":return r(Bt,{config:e.config,navigation:e.navigation,currentPage:t,children:s});case"dashboard":return r(Be,{config:e.config,children:[s,e.dashboards.length>0&&r(Ue,{dashboards:e.dashboards})]});case"simple":default:return r(Qe,{config:e.config,title:t.title,children:s})}}const _n={mode:"website",bundledCapsule:"/memglyph-demo.mgx.sqlite",branding:{title:"Memglyph",tagline:"Your knowledge, crystallized",logoUrl:"/logo.svg"},features:{llm:{enabled:!0,autoReason:!1,defaultModel:"qwen3-0.6b",maxTokens:256},search:{defaultMode:"hybrid",enabledModes:["fts","hybrid"],showModeToggle:!1},graph:{enabled:!0,maxHops:2,defaultMaxHops:1},upload:{enabled:!1,acceptedExtensions:[]},gcui:{enabled:!0,fallbackToGeneric:!1},pwa:{enabled:!0,offlineMode:!0}},ui:{showLanding:!0,theme:"documentation"}},fn={mode:"viewer",bundledCapsule:"/memglyph-demo.mgx.sqlite",branding:{title:"SQLAR Viewer",tagline:"Query your knowledge capsules",logoUrl:"/sqlar-logo.svg"},features:{llm:{enabled:!0,autoReason:!1,defaultModel:"qwen3-0.6b",maxTokens:256},search:{defaultMode:"hybrid",enabledModes:["fts","hybrid","graph"],showModeToggle:!0},graph:{enabled:!0,maxHops:3,defaultMaxHops:2},upload:{enabled:!0,acceptedExtensions:[".sqlite",".sqlar",".db",".mgx.sqlite"]},gcui:{enabled:!0,fallbackToGeneric:!0},pwa:{enabled:!0,offlineMode:!0}},ui:{showLanding:!1,theme:"tool"}};function mn(){return"website"}function gn(){return mn()==="viewer"?fn:_n}function yn(){const t=gn(),[e,n]=x(null),[s,i]=x(null),[a,o]=x(!1),[u,d]=x(null),[c,f]=x(!1);We({defaultMode:t.features.search.defaultMode});const l=Ie({autoLoad:!1});return wt({}),$(()=>{e&&(l.loadEntities(),(async()=>{try{const m=L(),h=await en(m);console.log("[GCUI] Detected capabilities:",h.capabilities),h.capabilities.mode!=="generic"?(i(h),console.log("[GCUI] Rendering in",h.capabilities.mode,"mode")):(console.log("[GCUI] No GCUI tables found, using legacy mode"),i(null))}catch(m){console.warn("[GCUI] Detection failed, using legacy mode:",m),i(null)}})())},[e]),r("div",{className:"app",children:[r("header",{className:"app-header",children:[r("h1",{children:"Glyphcapsule Explorer"}),r("p",{children:"Hybrid Retrieval Demo for MemGlyph"})]}),r("main",{className:"app-main",children:e?s&&t.features.gcui.enabled?r("div",{className:"gcui-mode",children:r(hn,{context:s})}):r(Vt,{capsuleInfo:e,onClose:()=>n(null)}):r("div",{className:"welcome",children:[u&&r("div",{className:"error",style:"max-width: 600px; margin: 1rem auto;",children:[r("strong",{children:"Error:"})," ",u]}),r(Mt,{onFileSelected:async(v,m)=>{o(!0),d(null);try{const g=await L().openFromFile(v);n(g),console.log("Capsule opened:",g)}catch(h){d(String(h)),console.error("Failed to open file:",h)}finally{o(!1)}},onOpfsFileSelected:async v=>{o(!0),d(null);try{const h=await L().openFromOpfs(v);n(h),console.log("Capsule opened from OPFS:",h)}catch(m){d(String(m)),console.error("Failed to open from OPFS:",m)}finally{o(!1)}},onError:v=>{d(v)}}),r("div",{style:"text-align: center; margin-top: 1.5rem;",children:[r("p",{style:"margin-bottom: 0.5rem; opacity: 0.7;",children:"Or try the demo:"}),r("button",{className:"btn-secondary",onClick:async()=>{o(!0),d(null);try{const m=await L().openDemo();n(m),console.log("Capsule info:",m)}catch(v){d(String(v)),console.error("Failed to open capsule:",v)}finally{o(!1)}},disabled:a,children:a?"Loading Demo...":"Load Demo Capsule"})]})]})}),r("footer",{className:"app-footer",children:r("p",{children:"Built with Preact + SQLite WASM + OPFS"})})]})}et(r(yn,{}),document.getElementById("app"));
