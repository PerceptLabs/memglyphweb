var gs=Object.defineProperty;var Yn=e=>{throw TypeError(e)};var bs=(e,t,r)=>t in e?gs(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var Ye=(e,t,r)=>bs(e,typeof t!="symbol"?t+"":t,r),pn=(e,t,r)=>t.has(e)||Yn("Cannot "+r);var de=(e,t,r)=>(pn(e,t,"read from private field"),r?r.call(e):t.get(e)),lt=(e,t,r)=>t.has(e)?Yn("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),ft=(e,t,r,l)=>(pn(e,t,"write to private field"),l?l.call(e,r):t.set(e,r),r),Wt=(e,t,r)=>(pn(e,t,"access private method"),r);function G(e,t,r){function l(T,z){var ee;Object.defineProperty(T,"_zod",{value:T._zod??{},enumerable:!1}),(ee=T._zod).traits??(ee.traits=new Set),T._zod.traits.add(e),t(T,z);for(const ne in q.prototype)ne in T||Object.defineProperty(T,ne,{value:q.prototype[ne].bind(T)});T._zod.constr=q,T._zod.def=z}const f=(r==null?void 0:r.Parent)??Object;class g extends f{}Object.defineProperty(g,"name",{value:e});function q(T){var z;const ee=r!=null&&r.Parent?new g:this;l(ee,T),(z=ee._zod).deferred??(z.deferred=[]);for(const ne of ee._zod.deferred)ne();return ee}return Object.defineProperty(q,"init",{value:l}),Object.defineProperty(q,Symbol.hasInstance,{value:T=>{var z,ee;return r!=null&&r.Parent&&T instanceof r.Parent?!0:(ee=(z=T==null?void 0:T._zod)==null?void 0:z.traits)==null?void 0:ee.has(e)}}),Object.defineProperty(q,"name",{value:e}),q}class xt extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class yr extends Error{constructor(t){super(`Encountered unidirectional transform during encode: ${t}`),this.name="ZodEncodeError"}}const vr={};function qt(e){return vr}function ys(e){const t=Object.values(e).filter(l=>typeof l=="number");return Object.entries(e).filter(([l,f])=>t.indexOf(+l)===-1).map(([l,f])=>f)}function gn(e,t){return typeof t=="bigint"?t.toString():t}function en(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function wn(e){return e==null}function qn(e){const t=e.startsWith("^")?1:0,r=e.endsWith("$")?e.length-1:e.length;return e.slice(t,r)}function vs(e,t){const r=(e.toString().split(".")[1]||"").length,l=t.toString();let f=(l.split(".")[1]||"").length;if(f===0&&/\d?e-\d?/.test(l)){const z=l.match(/\d?e-(\d?)/);z!=null&&z[1]&&(f=Number.parseInt(z[1]))}const g=r>f?r:f,q=Number.parseInt(e.toFixed(g).replace(".","")),T=Number.parseInt(t.toFixed(g).replace(".",""));return q%T/10**g}const Xn=Symbol("evaluating");function je(e,t,r){let l;Object.defineProperty(e,t,{get(){if(l!==Xn)return l===void 0&&(l=Xn,l=r()),l},set(f){Object.defineProperty(e,t,{value:f})},configurable:!0})}function St(e,t,r){Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0})}function At(...e){const t={};for(const r of e){const l=Object.getOwnPropertyDescriptors(r);Object.assign(t,l)}return Object.defineProperties({},t)}function er(e){return JSON.stringify(e)}const wr="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function Ct(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}const ws=en(()=>{var e;if(typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)!=null&&e.includes("Cloudflare")))return!1;try{const t=Function;return new t(""),!0}catch{return!1}});function zt(e){if(Ct(e)===!1)return!1;const t=e.constructor;if(t===void 0)return!0;const r=t.prototype;return!(Ct(r)===!1||Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")===!1)}function qr(e){return zt(e)?{...e}:Array.isArray(e)?[...e]:e}const qs=new Set(["string","number","symbol"]);function Ft(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function gt(e,t,r){const l=new e._zod.constr(t??e._zod.def);return(!t||r!=null&&r.parent)&&(l._zod.parent=e),l}function qe(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if((t==null?void 0:t.message)!==void 0){if((t==null?void 0:t.error)!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function Es(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}const Ss={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function As(e,t){const r=e._zod.def,l=At(e._zod.def,{get shape(){const f={};for(const g in t){if(!(g in r.shape))throw new Error(`Unrecognized key: "${g}"`);t[g]&&(f[g]=r.shape[g])}return St(this,"shape",f),f},checks:[]});return gt(e,l)}function Is(e,t){const r=e._zod.def,l=At(e._zod.def,{get shape(){const f={...e._zod.def.shape};for(const g in t){if(!(g in r.shape))throw new Error(`Unrecognized key: "${g}"`);t[g]&&delete f[g]}return St(this,"shape",f),f},checks:[]});return gt(e,l)}function ks(e,t){if(!zt(t))throw new Error("Invalid input to extend: expected a plain object");const r=e._zod.def.checks;if(r&&r.length>0)throw new Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");const f=At(e._zod.def,{get shape(){const g={...e._zod.def.shape,...t};return St(this,"shape",g),g},checks:[]});return gt(e,f)}function Ts(e,t){if(!zt(t))throw new Error("Invalid input to safeExtend: expected a plain object");const r={...e._zod.def,get shape(){const l={...e._zod.def.shape,...t};return St(this,"shape",l),l},checks:e._zod.def.checks};return gt(e,r)}function Os(e,t){const r=At(e._zod.def,{get shape(){const l={...e._zod.def.shape,...t._zod.def.shape};return St(this,"shape",l),l},get catchall(){return t._zod.def.catchall},checks:[]});return gt(e,r)}function xs(e,t,r){const l=At(t._zod.def,{get shape(){const f=t._zod.def.shape,g={...f};if(r)for(const q in r){if(!(q in f))throw new Error(`Unrecognized key: "${q}"`);r[q]&&(g[q]=e?new e({type:"optional",innerType:f[q]}):f[q])}else for(const q in f)g[q]=e?new e({type:"optional",innerType:f[q]}):f[q];return St(this,"shape",g),g},checks:[]});return gt(t,l)}function Fs(e,t,r){const l=At(t._zod.def,{get shape(){const f=t._zod.def.shape,g={...f};if(r)for(const q in r){if(!(q in g))throw new Error(`Unrecognized key: "${q}"`);r[q]&&(g[q]=new e({type:"nonoptional",innerType:f[q]}))}else for(const q in f)g[q]=new e({type:"nonoptional",innerType:f[q]});return St(this,"shape",g),g},checks:[]});return gt(t,l)}function Ot(e,t=0){var r;if(e.aborted===!0)return!0;for(let l=t;l<e.issues.length;l++)if(((r=e.issues[l])==null?void 0:r.continue)!==!0)return!0;return!1}function Er(e,t){return t.map(r=>{var l;return(l=r).path??(l.path=[]),r.path.unshift(e),r})}function Zt(e){return typeof e=="string"?e:e==null?void 0:e.message}function Et(e,t,r){var f,g,q,T,z,ee;const l={...e,path:e.path??[]};if(!e.message){const ne=Zt((q=(g=(f=e.inst)==null?void 0:f._zod.def)==null?void 0:g.error)==null?void 0:q.call(g,e))??Zt((T=t==null?void 0:t.error)==null?void 0:T.call(t,e))??Zt((z=r.customError)==null?void 0:z.call(r,e))??Zt((ee=r.localeError)==null?void 0:ee.call(r,e))??"Invalid input";l.message=ne}return delete l.inst,delete l.continue,t!=null&&t.reportInput||delete l.input,l}function En(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function Dt(...e){const[t,r,l]=e;return typeof t=="string"?{message:t,code:"custom",input:r,inst:l}:{...t}}const Sr=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,gn,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},Ar=G("$ZodError",Sr),Ir=G("$ZodError",Sr,{Parent:Error});function Ps(e,t=r=>r.message){const r={},l=[];for(const f of e.issues)f.path.length>0?(r[f.path[0]]=r[f.path[0]]||[],r[f.path[0]].push(t(f))):l.push(t(f));return{formErrors:l,fieldErrors:r}}function Ls(e,t=r=>r.message){const r={_errors:[]},l=f=>{for(const g of f.issues)if(g.code==="invalid_union"&&g.errors.length)g.errors.map(q=>l({issues:q}));else if(g.code==="invalid_key")l({issues:g.issues});else if(g.code==="invalid_element")l({issues:g.issues});else if(g.path.length===0)r._errors.push(t(g));else{let q=r,T=0;for(;T<g.path.length;){const z=g.path[T];T===g.path.length-1?(q[z]=q[z]||{_errors:[]},q[z]._errors.push(t(g))):q[z]=q[z]||{_errors:[]},q=q[z],T++}}};return l(e),r}const Sn=e=>(t,r,l,f)=>{const g=l?Object.assign(l,{async:!1}):{async:!1},q=t._zod.run({value:r,issues:[]},g);if(q instanceof Promise)throw new xt;if(q.issues.length){const T=new((f==null?void 0:f.Err)??e)(q.issues.map(z=>Et(z,g,qt())));throw wr(T,f==null?void 0:f.callee),T}return q.value},An=e=>async(t,r,l,f)=>{const g=l?Object.assign(l,{async:!0}):{async:!0};let q=t._zod.run({value:r,issues:[]},g);if(q instanceof Promise&&(q=await q),q.issues.length){const T=new((f==null?void 0:f.Err)??e)(q.issues.map(z=>Et(z,g,qt())));throw wr(T,f==null?void 0:f.callee),T}return q.value},tn=e=>(t,r,l)=>{const f=l?{...l,async:!1}:{async:!1},g=t._zod.run({value:r,issues:[]},f);if(g instanceof Promise)throw new xt;return g.issues.length?{success:!1,error:new(e??Ar)(g.issues.map(q=>Et(q,f,qt())))}:{success:!0,data:g.value}},Ns=tn(Ir),nn=e=>async(t,r,l)=>{const f=l?Object.assign(l,{async:!0}):{async:!0};let g=t._zod.run({value:r,issues:[]},f);return g instanceof Promise&&(g=await g),g.issues.length?{success:!1,error:new e(g.issues.map(q=>Et(q,f,qt())))}:{success:!0,data:g.value}},Rs=nn(Ir),Cs=e=>(t,r,l)=>{const f=l?Object.assign(l,{direction:"backward"}):{direction:"backward"};return Sn(e)(t,r,f)},zs=e=>(t,r,l)=>Sn(e)(t,r,l),Ds=e=>async(t,r,l)=>{const f=l?Object.assign(l,{direction:"backward"}):{direction:"backward"};return An(e)(t,r,f)},Ms=e=>async(t,r,l)=>An(e)(t,r,l),js=e=>(t,r,l)=>{const f=l?Object.assign(l,{direction:"backward"}):{direction:"backward"};return tn(e)(t,r,f)},$s=e=>(t,r,l)=>tn(e)(t,r,l),Bs=e=>async(t,r,l)=>{const f=l?Object.assign(l,{direction:"backward"}):{direction:"backward"};return nn(e)(t,r,f)},Us=e=>async(t,r,l)=>nn(e)(t,r,l),Ws=/^[cC][^\s-]{8,}$/,Zs=/^[0-9a-z]+$/,Hs=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,Qs=/^[0-9a-vA-V]{20}$/,Vs=/^[A-Za-z0-9]{27}$/,Gs=/^[a-zA-Z0-9_-]{21}$/,Ks=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,Js=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,tr=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,Ys=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,Xs="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function eo(){return new RegExp(Xs,"u")}const to=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,no=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,ro=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,io=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,so=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,kr=/^[A-Za-z0-9_-]*$/,oo=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,ao=/^\+(?:[0-9]){6,14}[0-9]$/,Tr="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",lo=new RegExp(`^${Tr}$`);function Or(e){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof e.precision=="number"?e.precision===-1?`${t}`:e.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function co(e){return new RegExp(`^${Or(e)}$`)}function uo(e){const t=Or({precision:e.precision}),r=["Z"];e.local&&r.push(""),e.offset&&r.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const l=`${t}(?:${r.join("|")})`;return new RegExp(`^${Tr}T(?:${l})$`)}const fo=e=>{const t=e?`[\\s\\S]{${(e==null?void 0:e.minimum)??0},${(e==null?void 0:e.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},_o=/^-?\d+$/,po=/^-?\d+(?:\.\d+)?/,ho=/^(?:true|false)$/i,mo=/^null$/i,go=/^[^A-Z]*$/,bo=/^[^a-z]*$/,ct=G("$ZodCheck",(e,t)=>{var r;e._zod??(e._zod={}),e._zod.def=t,(r=e._zod).onattach??(r.onattach=[])}),xr={number:"number",bigint:"bigint",object:"date"},Fr=G("$ZodCheckLessThan",(e,t)=>{ct.init(e,t);const r=xr[typeof t.value];e._zod.onattach.push(l=>{const f=l._zod.bag,g=(t.inclusive?f.maximum:f.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<g&&(t.inclusive?f.maximum=t.value:f.exclusiveMaximum=t.value)}),e._zod.check=l=>{(t.inclusive?l.value<=t.value:l.value<t.value)||l.issues.push({origin:r,code:"too_big",maximum:t.value,input:l.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Pr=G("$ZodCheckGreaterThan",(e,t)=>{ct.init(e,t);const r=xr[typeof t.value];e._zod.onattach.push(l=>{const f=l._zod.bag,g=(t.inclusive?f.minimum:f.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>g&&(t.inclusive?f.minimum=t.value:f.exclusiveMinimum=t.value)}),e._zod.check=l=>{(t.inclusive?l.value>=t.value:l.value>t.value)||l.issues.push({origin:r,code:"too_small",minimum:t.value,input:l.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),yo=G("$ZodCheckMultipleOf",(e,t)=>{ct.init(e,t),e._zod.onattach.push(r=>{var l;(l=r._zod.bag).multipleOf??(l.multipleOf=t.value)}),e._zod.check=r=>{if(typeof r.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof r.value=="bigint"?r.value%t.value===BigInt(0):vs(r.value,t.value)===0)||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:t.value,input:r.value,inst:e,continue:!t.abort})}}),vo=G("$ZodCheckNumberFormat",(e,t)=>{var q;ct.init(e,t),t.format=t.format||"float64";const r=(q=t.format)==null?void 0:q.includes("int"),l=r?"int":"number",[f,g]=Ss[t.format];e._zod.onattach.push(T=>{const z=T._zod.bag;z.format=t.format,z.minimum=f,z.maximum=g,r&&(z.pattern=_o)}),e._zod.check=T=>{const z=T.value;if(r){if(!Number.isInteger(z)){T.issues.push({expected:l,format:t.format,code:"invalid_type",continue:!1,input:z,inst:e});return}if(!Number.isSafeInteger(z)){z>0?T.issues.push({input:z,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:l,continue:!t.abort}):T.issues.push({input:z,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:l,continue:!t.abort});return}}z<f&&T.issues.push({origin:"number",input:z,code:"too_small",minimum:f,inclusive:!0,inst:e,continue:!t.abort}),z>g&&T.issues.push({origin:"number",input:z,code:"too_big",maximum:g,inst:e})}}),wo=G("$ZodCheckMaxLength",(e,t)=>{var r;ct.init(e,t),(r=e._zod.def).when??(r.when=l=>{const f=l.value;return!wn(f)&&f.length!==void 0}),e._zod.onattach.push(l=>{const f=l._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<f&&(l._zod.bag.maximum=t.maximum)}),e._zod.check=l=>{const f=l.value;if(f.length<=t.maximum)return;const q=En(f);l.issues.push({origin:q,code:"too_big",maximum:t.maximum,inclusive:!0,input:f,inst:e,continue:!t.abort})}}),qo=G("$ZodCheckMinLength",(e,t)=>{var r;ct.init(e,t),(r=e._zod.def).when??(r.when=l=>{const f=l.value;return!wn(f)&&f.length!==void 0}),e._zod.onattach.push(l=>{const f=l._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>f&&(l._zod.bag.minimum=t.minimum)}),e._zod.check=l=>{const f=l.value;if(f.length>=t.minimum)return;const q=En(f);l.issues.push({origin:q,code:"too_small",minimum:t.minimum,inclusive:!0,input:f,inst:e,continue:!t.abort})}}),Eo=G("$ZodCheckLengthEquals",(e,t)=>{var r;ct.init(e,t),(r=e._zod.def).when??(r.when=l=>{const f=l.value;return!wn(f)&&f.length!==void 0}),e._zod.onattach.push(l=>{const f=l._zod.bag;f.minimum=t.length,f.maximum=t.length,f.length=t.length}),e._zod.check=l=>{const f=l.value,g=f.length;if(g===t.length)return;const q=En(f),T=g>t.length;l.issues.push({origin:q,...T?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:l.value,inst:e,continue:!t.abort})}}),rn=G("$ZodCheckStringFormat",(e,t)=>{var r,l;ct.init(e,t),e._zod.onattach.push(f=>{const g=f._zod.bag;g.format=t.format,t.pattern&&(g.patterns??(g.patterns=new Set),g.patterns.add(t.pattern))}),t.pattern?(r=e._zod).check??(r.check=f=>{t.pattern.lastIndex=0,!t.pattern.test(f.value)&&f.issues.push({origin:"string",code:"invalid_format",format:t.format,input:f.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(l=e._zod).check??(l.check=()=>{})}),So=G("$ZodCheckRegex",(e,t)=>{rn.init(e,t),e._zod.check=r=>{t.pattern.lastIndex=0,!t.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),Ao=G("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=go),rn.init(e,t)}),Io=G("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=bo),rn.init(e,t)}),ko=G("$ZodCheckIncludes",(e,t)=>{ct.init(e,t);const r=Ft(t.includes),l=new RegExp(typeof t.position=="number"?`^.{${t.position}}${r}`:r);t.pattern=l,e._zod.onattach.push(f=>{const g=f._zod.bag;g.patterns??(g.patterns=new Set),g.patterns.add(l)}),e._zod.check=f=>{f.value.includes(t.includes,t.position)||f.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:f.value,inst:e,continue:!t.abort})}}),To=G("$ZodCheckStartsWith",(e,t)=>{ct.init(e,t);const r=new RegExp(`^${Ft(t.prefix)}.*`);t.pattern??(t.pattern=r),e._zod.onattach.push(l=>{const f=l._zod.bag;f.patterns??(f.patterns=new Set),f.patterns.add(r)}),e._zod.check=l=>{l.value.startsWith(t.prefix)||l.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:l.value,inst:e,continue:!t.abort})}}),Oo=G("$ZodCheckEndsWith",(e,t)=>{ct.init(e,t);const r=new RegExp(`.*${Ft(t.suffix)}$`);t.pattern??(t.pattern=r),e._zod.onattach.push(l=>{const f=l._zod.bag;f.patterns??(f.patterns=new Set),f.patterns.add(r)}),e._zod.check=l=>{l.value.endsWith(t.suffix)||l.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:l.value,inst:e,continue:!t.abort})}}),xo=G("$ZodCheckOverwrite",(e,t)=>{ct.init(e,t),e._zod.check=r=>{r.value=t.tx(r.value)}});class Fo{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const l=t.split(`
`).filter(q=>q),f=Math.min(...l.map(q=>q.length-q.trimStart().length)),g=l.map(q=>q.slice(f)).map(q=>" ".repeat(this.indent*2)+q);for(const q of g)this.content.push(q)}compile(){const t=Function,r=this==null?void 0:this.args,f=[...((this==null?void 0:this.content)??[""]).map(g=>`  ${g}`)];return new t(...r,f.join(`
`))}}const Po={major:4,minor:1,patch:12},Ze=G("$ZodType",(e,t)=>{var f;var r;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=Po;const l=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&l.unshift(e);for(const g of l)for(const q of g._zod.onattach)q(e);if(l.length===0)(r=e._zod).deferred??(r.deferred=[]),(f=e._zod.deferred)==null||f.push(()=>{e._zod.run=e._zod.parse});else{const g=(T,z,ee)=>{let ne=Ot(T),Q;for(const ae of z){if(ae._zod.def.when){if(!ae._zod.def.when(T))continue}else if(ne)continue;const ge=T.issues.length,Ce=ae._zod.check(T);if(Ce instanceof Promise&&(ee==null?void 0:ee.async)===!1)throw new xt;if(Q||Ce instanceof Promise)Q=(Q??Promise.resolve()).then(async()=>{await Ce,T.issues.length!==ge&&(ne||(ne=Ot(T,ge)))});else{if(T.issues.length===ge)continue;ne||(ne=Ot(T,ge))}}return Q?Q.then(()=>T):T},q=(T,z,ee)=>{if(Ot(T))return T.aborted=!0,T;const ne=g(z,l,ee);if(ne instanceof Promise){if(ee.async===!1)throw new xt;return ne.then(Q=>e._zod.parse(Q,ee))}return e._zod.parse(ne,ee)};e._zod.run=(T,z)=>{if(z.skipChecks)return e._zod.parse(T,z);if(z.direction==="backward"){const ne=e._zod.parse({value:T.value,issues:[]},{...z,skipChecks:!0});return ne instanceof Promise?ne.then(Q=>q(Q,T,z)):q(ne,T,z)}const ee=e._zod.parse(T,z);if(ee instanceof Promise){if(z.async===!1)throw new xt;return ee.then(ne=>g(ne,l,z))}return g(ee,l,z)}}e["~standard"]={validate:g=>{var q;try{const T=Ns(e,g);return T.success?{value:T.data}:{issues:(q=T.error)==null?void 0:q.issues}}catch{return Rs(e,g).then(z=>{var ee;return z.success?{value:z.data}:{issues:(ee=z.error)==null?void 0:ee.issues}})}},vendor:"zod",version:1}}),In=G("$ZodString",(e,t)=>{var r;Ze.init(e,t),e._zod.pattern=[...((r=e==null?void 0:e._zod.bag)==null?void 0:r.patterns)??[]].pop()??fo(e._zod.bag),e._zod.parse=(l,f)=>{if(t.coerce)try{l.value=String(l.value)}catch{}return typeof l.value=="string"||l.issues.push({expected:"string",code:"invalid_type",input:l.value,inst:e}),l}}),Ue=G("$ZodStringFormat",(e,t)=>{rn.init(e,t),In.init(e,t)}),Lo=G("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=Js),Ue.init(e,t)}),No=G("$ZodUUID",(e,t)=>{if(t.version){const l={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(l===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=tr(l))}else t.pattern??(t.pattern=tr());Ue.init(e,t)}),Ro=G("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=Ys),Ue.init(e,t)}),Co=G("$ZodURL",(e,t)=>{Ue.init(e,t),e._zod.check=r=>{try{const l=r.value.trim(),f=new URL(l);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(f.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:oo.source,input:r.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(f.protocol.endsWith(":")?f.protocol.slice(0,-1):f.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:r.value,inst:e,continue:!t.abort})),t.normalize?r.value=f.href:r.value=l;return}catch{r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:e,continue:!t.abort})}}}),zo=G("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=eo()),Ue.init(e,t)}),Do=G("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=Gs),Ue.init(e,t)}),Mo=G("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=Ws),Ue.init(e,t)}),jo=G("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=Zs),Ue.init(e,t)}),$o=G("$ZodULID",(e,t)=>{t.pattern??(t.pattern=Hs),Ue.init(e,t)}),Bo=G("$ZodXID",(e,t)=>{t.pattern??(t.pattern=Qs),Ue.init(e,t)}),Uo=G("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=Vs),Ue.init(e,t)}),Wo=G("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=uo(t)),Ue.init(e,t)}),Zo=G("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=lo),Ue.init(e,t)}),Ho=G("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=co(t)),Ue.init(e,t)}),Qo=G("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=Ks),Ue.init(e,t)}),Vo=G("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=to),Ue.init(e,t),e._zod.onattach.push(r=>{const l=r._zod.bag;l.format="ipv4"})}),Go=G("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=no),Ue.init(e,t),e._zod.onattach.push(r=>{const l=r._zod.bag;l.format="ipv6"}),e._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:e,continue:!t.abort})}}}),Ko=G("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=ro),Ue.init(e,t)}),Jo=G("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=io),Ue.init(e,t),e._zod.check=r=>{const l=r.value.split("/");try{if(l.length!==2)throw new Error;const[f,g]=l;if(!g)throw new Error;const q=Number(g);if(`${q}`!==g)throw new Error;if(q<0||q>128)throw new Error;new URL(`http://[${f}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:e,continue:!t.abort})}}});function Lr(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const Yo=G("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=so),Ue.init(e,t),e._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64"}),e._zod.check=r=>{Lr(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:e,continue:!t.abort})}});function Xo(e){if(!kr.test(e))return!1;const t=e.replace(/[-_]/g,l=>l==="-"?"+":"/"),r=t.padEnd(Math.ceil(t.length/4)*4,"=");return Lr(r)}const ea=G("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=kr),Ue.init(e,t),e._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64url"}),e._zod.check=r=>{Xo(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:e,continue:!t.abort})}}),ta=G("$ZodE164",(e,t)=>{t.pattern??(t.pattern=ao),Ue.init(e,t)});function na(e,t=null){try{const r=e.split(".");if(r.length!==3)return!1;const[l]=r;if(!l)return!1;const f=JSON.parse(atob(l));return!("typ"in f&&(f==null?void 0:f.typ)!=="JWT"||!f.alg||t&&(!("alg"in f)||f.alg!==t))}catch{return!1}}const ra=G("$ZodJWT",(e,t)=>{Ue.init(e,t),e._zod.check=r=>{na(r.value,t.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:e,continue:!t.abort})}}),Nr=G("$ZodNumber",(e,t)=>{Ze.init(e,t),e._zod.pattern=e._zod.bag.pattern??po,e._zod.parse=(r,l)=>{if(t.coerce)try{r.value=Number(r.value)}catch{}const f=r.value;if(typeof f=="number"&&!Number.isNaN(f)&&Number.isFinite(f))return r;const g=typeof f=="number"?Number.isNaN(f)?"NaN":Number.isFinite(f)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:f,inst:e,...g?{received:g}:{}}),r}}),ia=G("$ZodNumber",(e,t)=>{vo.init(e,t),Nr.init(e,t)}),sa=G("$ZodBoolean",(e,t)=>{Ze.init(e,t),e._zod.pattern=ho,e._zod.parse=(r,l)=>{if(t.coerce)try{r.value=!!r.value}catch{}const f=r.value;return typeof f=="boolean"||r.issues.push({expected:"boolean",code:"invalid_type",input:f,inst:e}),r}}),oa=G("$ZodNull",(e,t)=>{Ze.init(e,t),e._zod.pattern=mo,e._zod.values=new Set([null]),e._zod.parse=(r,l)=>{const f=r.value;return f===null||r.issues.push({expected:"null",code:"invalid_type",input:f,inst:e}),r}}),aa=G("$ZodUnknown",(e,t)=>{Ze.init(e,t),e._zod.parse=r=>r}),la=G("$ZodNever",(e,t)=>{Ze.init(e,t),e._zod.parse=(r,l)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:e}),r)});function nr(e,t,r){e.issues.length&&t.issues.push(...Er(r,e.issues)),t.value[r]=e.value}const ca=G("$ZodArray",(e,t)=>{Ze.init(e,t),e._zod.parse=(r,l)=>{const f=r.value;if(!Array.isArray(f))return r.issues.push({expected:"array",code:"invalid_type",input:f,inst:e}),r;r.value=Array(f.length);const g=[];for(let q=0;q<f.length;q++){const T=f[q],z=t.element._zod.run({value:T,issues:[]},l);z instanceof Promise?g.push(z.then(ee=>nr(ee,r,q))):nr(z,r,q)}return g.length?Promise.all(g).then(()=>r):r}});function Jt(e,t,r,l){e.issues.length&&t.issues.push(...Er(r,e.issues)),e.value===void 0?r in l&&(t.value[r]=void 0):t.value[r]=e.value}function Rr(e){var l,f,g,q;const t=Object.keys(e.shape);for(const T of t)if(!((q=(g=(f=(l=e.shape)==null?void 0:l[T])==null?void 0:f._zod)==null?void 0:g.traits)!=null&&q.has("$ZodType")))throw new Error(`Invalid element at key "${T}": expected a Zod schema`);const r=Es(e.shape);return{...e,keys:t,keySet:new Set(t),numKeys:t.length,optionalKeys:new Set(r)}}function Cr(e,t,r,l,f,g){const q=[],T=f.keySet,z=f.catchall._zod,ee=z.def.type;for(const ne of Object.keys(t)){if(T.has(ne))continue;if(ee==="never"){q.push(ne);continue}const Q=z.run({value:t[ne],issues:[]},l);Q instanceof Promise?e.push(Q.then(ae=>Jt(ae,r,ne,t))):Jt(Q,r,ne,t)}return q.length&&r.issues.push({code:"unrecognized_keys",keys:q,input:t,inst:g}),e.length?Promise.all(e).then(()=>r):r}const ua=G("$ZodObject",(e,t)=>{Ze.init(e,t);const r=Object.getOwnPropertyDescriptor(t,"shape");if(!(r!=null&&r.get)){const T=t.shape;Object.defineProperty(t,"shape",{get:()=>{const z={...T};return Object.defineProperty(t,"shape",{value:z}),z}})}const l=en(()=>Rr(t));je(e._zod,"propValues",()=>{const T=t.shape,z={};for(const ee in T){const ne=T[ee]._zod;if(ne.values){z[ee]??(z[ee]=new Set);for(const Q of ne.values)z[ee].add(Q)}}return z});const f=Ct,g=t.catchall;let q;e._zod.parse=(T,z)=>{q??(q=l.value);const ee=T.value;if(!f(ee))return T.issues.push({expected:"object",code:"invalid_type",input:ee,inst:e}),T;T.value={};const ne=[],Q=q.shape;for(const ae of q.keys){const Ce=Q[ae]._zod.run({value:ee[ae],issues:[]},z);Ce instanceof Promise?ne.push(Ce.then(Qe=>Jt(Qe,T,ae,ee))):Jt(Ce,T,ae,ee)}return g?Cr(ne,ee,T,z,l.value,e):ne.length?Promise.all(ne).then(()=>T):T}}),fa=G("$ZodObjectJIT",(e,t)=>{ua.init(e,t);const r=e._zod.parse,l=en(()=>Rr(t)),f=ae=>{const ge=new Fo(["shape","payload","ctx"]),Ce=l.value,Qe=Ke=>{const Xe=er(Ke);return`shape[${Xe}]._zod.run({ value: input[${Xe}], issues: [] }, ctx)`};ge.write("const input = payload.value;");const rt=Object.create(null);let it=0;for(const Ke of Ce.keys)rt[Ke]=`key_${it++}`;ge.write("const newResult = {};");for(const Ke of Ce.keys){const Xe=rt[Ke],Oe=er(Ke);ge.write(`const ${Xe} = ${Qe(Ke)};`),ge.write(`
        if (${Xe}.issues.length) {
          payload.issues = payload.issues.concat(${Xe}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${Oe}, ...iss.path] : [${Oe}]
          })));
        }
        
        
        if (${Xe}.value === undefined) {
          if (${Oe} in input) {
            newResult[${Oe}] = undefined;
          }
        } else {
          newResult[${Oe}] = ${Xe}.value;
        }
        
      `)}ge.write("payload.value = newResult;"),ge.write("return payload;");const at=ge.compile();return(Ke,Xe)=>at(ae,Ke,Xe)};let g;const q=Ct,T=!vr.jitless,ee=T&&ws.value,ne=t.catchall;let Q;e._zod.parse=(ae,ge)=>{Q??(Q=l.value);const Ce=ae.value;return q(Ce)?T&&ee&&(ge==null?void 0:ge.async)===!1&&ge.jitless!==!0?(g||(g=f(t.shape)),ae=g(ae,ge),ne?Cr([],Ce,ae,ge,Q,e):ae):r(ae,ge):(ae.issues.push({expected:"object",code:"invalid_type",input:Ce,inst:e}),ae)}});function rr(e,t,r,l){for(const g of e)if(g.issues.length===0)return t.value=g.value,t;const f=e.filter(g=>!Ot(g));return f.length===1?(t.value=f[0].value,f[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:r,errors:e.map(g=>g.issues.map(q=>Et(q,l,qt())))}),t)}const zr=G("$ZodUnion",(e,t)=>{Ze.init(e,t),je(e._zod,"optin",()=>t.options.some(f=>f._zod.optin==="optional")?"optional":void 0),je(e._zod,"optout",()=>t.options.some(f=>f._zod.optout==="optional")?"optional":void 0),je(e._zod,"values",()=>{if(t.options.every(f=>f._zod.values))return new Set(t.options.flatMap(f=>Array.from(f._zod.values)))}),je(e._zod,"pattern",()=>{if(t.options.every(f=>f._zod.pattern)){const f=t.options.map(g=>g._zod.pattern);return new RegExp(`^(${f.map(g=>qn(g.source)).join("|")})$`)}});const r=t.options.length===1,l=t.options[0]._zod.run;e._zod.parse=(f,g)=>{if(r)return l(f,g);let q=!1;const T=[];for(const z of t.options){const ee=z._zod.run({value:f.value,issues:[]},g);if(ee instanceof Promise)T.push(ee),q=!0;else{if(ee.issues.length===0)return ee;T.push(ee)}}return q?Promise.all(T).then(z=>rr(z,f,e,g)):rr(T,f,e,g)}}),_a=G("$ZodDiscriminatedUnion",(e,t)=>{zr.init(e,t);const r=e._zod.parse;je(e._zod,"propValues",()=>{const f={};for(const g of t.options){const q=g._zod.propValues;if(!q||Object.keys(q).length===0)throw new Error(`Invalid discriminated union option at index "${t.options.indexOf(g)}"`);for(const[T,z]of Object.entries(q)){f[T]||(f[T]=new Set);for(const ee of z)f[T].add(ee)}}return f});const l=en(()=>{var q;const f=t.options,g=new Map;for(const T of f){const z=(q=T._zod.propValues)==null?void 0:q[t.discriminator];if(!z||z.size===0)throw new Error(`Invalid discriminated union option at index "${t.options.indexOf(T)}"`);for(const ee of z){if(g.has(ee))throw new Error(`Duplicate discriminator value "${String(ee)}"`);g.set(ee,T)}}return g});e._zod.parse=(f,g)=>{const q=f.value;if(!Ct(q))return f.issues.push({code:"invalid_type",expected:"object",input:q,inst:e}),f;const T=l.value.get(q==null?void 0:q[t.discriminator]);return T?T._zod.run(f,g):t.unionFallback?r(f,g):(f.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",discriminator:t.discriminator,input:q,path:[t.discriminator],inst:e}),f)}}),da=G("$ZodIntersection",(e,t)=>{Ze.init(e,t),e._zod.parse=(r,l)=>{const f=r.value,g=t.left._zod.run({value:f,issues:[]},l),q=t.right._zod.run({value:f,issues:[]},l);return g instanceof Promise||q instanceof Promise?Promise.all([g,q]).then(([z,ee])=>ir(r,z,ee)):ir(r,g,q)}});function bn(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(zt(e)&&zt(t)){const r=Object.keys(t),l=Object.keys(e).filter(g=>r.indexOf(g)!==-1),f={...e,...t};for(const g of l){const q=bn(e[g],t[g]);if(!q.valid)return{valid:!1,mergeErrorPath:[g,...q.mergeErrorPath]};f[g]=q.data}return{valid:!0,data:f}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const r=[];for(let l=0;l<e.length;l++){const f=e[l],g=t[l],q=bn(f,g);if(!q.valid)return{valid:!1,mergeErrorPath:[l,...q.mergeErrorPath]};r.push(q.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function ir(e,t,r){if(t.issues.length&&e.issues.push(...t.issues),r.issues.length&&e.issues.push(...r.issues),Ot(e))return e;const l=bn(t.value,r.value);if(!l.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(l.mergeErrorPath)}`);return e.value=l.data,e}const pa=G("$ZodEnum",(e,t)=>{Ze.init(e,t);const r=ys(t.entries),l=new Set(r);e._zod.values=l,e._zod.pattern=new RegExp(`^(${r.filter(f=>qs.has(typeof f)).map(f=>typeof f=="string"?Ft(f):f.toString()).join("|")})$`),e._zod.parse=(f,g)=>{const q=f.value;return l.has(q)||f.issues.push({code:"invalid_value",values:r,input:q,inst:e}),f}}),ha=G("$ZodLiteral",(e,t)=>{if(Ze.init(e,t),t.values.length===0)throw new Error("Cannot create literal schema with no valid values");e._zod.values=new Set(t.values),e._zod.pattern=new RegExp(`^(${t.values.map(r=>typeof r=="string"?Ft(r):r?Ft(r.toString()):String(r)).join("|")})$`),e._zod.parse=(r,l)=>{const f=r.value;return e._zod.values.has(f)||r.issues.push({code:"invalid_value",values:t.values,input:f,inst:e}),r}}),ma=G("$ZodTransform",(e,t)=>{Ze.init(e,t),e._zod.parse=(r,l)=>{if(l.direction==="backward")throw new yr(e.constructor.name);const f=t.transform(r.value,r);if(l.async)return(f instanceof Promise?f:Promise.resolve(f)).then(q=>(r.value=q,r));if(f instanceof Promise)throw new xt;return r.value=f,r}});function sr(e,t){return e.issues.length&&t===void 0?{issues:[],value:void 0}:e}const ga=G("$ZodOptional",(e,t)=>{Ze.init(e,t),e._zod.optin="optional",e._zod.optout="optional",je(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),je(e._zod,"pattern",()=>{const r=t.innerType._zod.pattern;return r?new RegExp(`^(${qn(r.source)})?$`):void 0}),e._zod.parse=(r,l)=>{if(t.innerType._zod.optin==="optional"){const f=t.innerType._zod.run(r,l);return f instanceof Promise?f.then(g=>sr(g,r.value)):sr(f,r.value)}return r.value===void 0?r:t.innerType._zod.run(r,l)}}),ba=G("$ZodNullable",(e,t)=>{Ze.init(e,t),je(e._zod,"optin",()=>t.innerType._zod.optin),je(e._zod,"optout",()=>t.innerType._zod.optout),je(e._zod,"pattern",()=>{const r=t.innerType._zod.pattern;return r?new RegExp(`^(${qn(r.source)}|null)$`):void 0}),je(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(r,l)=>r.value===null?r:t.innerType._zod.run(r,l)}),ya=G("$ZodDefault",(e,t)=>{Ze.init(e,t),e._zod.optin="optional",je(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,l)=>{if(l.direction==="backward")return t.innerType._zod.run(r,l);if(r.value===void 0)return r.value=t.defaultValue,r;const f=t.innerType._zod.run(r,l);return f instanceof Promise?f.then(g=>or(g,t)):or(f,t)}});function or(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const va=G("$ZodPrefault",(e,t)=>{Ze.init(e,t),e._zod.optin="optional",je(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,l)=>(l.direction==="backward"||r.value===void 0&&(r.value=t.defaultValue),t.innerType._zod.run(r,l))}),wa=G("$ZodNonOptional",(e,t)=>{Ze.init(e,t),je(e._zod,"values",()=>{const r=t.innerType._zod.values;return r?new Set([...r].filter(l=>l!==void 0)):void 0}),e._zod.parse=(r,l)=>{const f=t.innerType._zod.run(r,l);return f instanceof Promise?f.then(g=>ar(g,e)):ar(f,e)}});function ar(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const qa=G("$ZodCatch",(e,t)=>{Ze.init(e,t),je(e._zod,"optin",()=>t.innerType._zod.optin),je(e._zod,"optout",()=>t.innerType._zod.optout),je(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,l)=>{if(l.direction==="backward")return t.innerType._zod.run(r,l);const f=t.innerType._zod.run(r,l);return f instanceof Promise?f.then(g=>(r.value=g.value,g.issues.length&&(r.value=t.catchValue({...r,error:{issues:g.issues.map(q=>Et(q,l,qt()))},input:r.value}),r.issues=[]),r)):(r.value=f.value,f.issues.length&&(r.value=t.catchValue({...r,error:{issues:f.issues.map(g=>Et(g,l,qt()))},input:r.value}),r.issues=[]),r)}}),Ea=G("$ZodPipe",(e,t)=>{Ze.init(e,t),je(e._zod,"values",()=>t.in._zod.values),je(e._zod,"optin",()=>t.in._zod.optin),je(e._zod,"optout",()=>t.out._zod.optout),je(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(r,l)=>{if(l.direction==="backward"){const g=t.out._zod.run(r,l);return g instanceof Promise?g.then(q=>Ht(q,t.in,l)):Ht(g,t.in,l)}const f=t.in._zod.run(r,l);return f instanceof Promise?f.then(g=>Ht(g,t.out,l)):Ht(f,t.out,l)}});function Ht(e,t,r){return e.issues.length?(e.aborted=!0,e):t._zod.run({value:e.value,issues:e.issues},r)}const Sa=G("$ZodReadonly",(e,t)=>{Ze.init(e,t),je(e._zod,"propValues",()=>t.innerType._zod.propValues),je(e._zod,"values",()=>t.innerType._zod.values),je(e._zod,"optin",()=>t.innerType._zod.optin),je(e._zod,"optout",()=>t.innerType._zod.optout),e._zod.parse=(r,l)=>{if(l.direction==="backward")return t.innerType._zod.run(r,l);const f=t.innerType._zod.run(r,l);return f instanceof Promise?f.then(lr):lr(f)}});function lr(e){return e.value=Object.freeze(e.value),e}const Aa=G("$ZodCustom",(e,t)=>{ct.init(e,t),Ze.init(e,t),e._zod.parse=(r,l)=>r,e._zod.check=r=>{const l=r.value,f=t.fn(l);if(f instanceof Promise)return f.then(g=>cr(g,r,l,e));cr(f,r,l,e)}});function cr(e,t,r,l){if(!e){const f={code:"custom",input:r,inst:l,path:[...l._zod.def.path??[]],continue:!l._zod.def.abort};l._zod.def.params&&(f.params=l._zod.def.params),t.issues.push(Dt(f))}}class Ia{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...r){const l=r[0];if(this._map.set(t,l),l&&typeof l=="object"&&"id"in l){if(this._idmap.has(l.id))throw new Error(`ID ${l.id} already exists in the registry`);this._idmap.set(l.id,t)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(t){const r=this._map.get(t);return r&&typeof r=="object"&&"id"in r&&this._idmap.delete(r.id),this._map.delete(t),this}get(t){const r=t._zod.parent;if(r){const l={...this.get(r)??{}};delete l.id;const f={...l,...this._map.get(t)};return Object.keys(f).length?f:void 0}return this._map.get(t)}has(t){return this._map.has(t)}}function ka(){return new Ia}const Qt=ka();function Ta(e,t){return new e({type:"string",...qe(t)})}function Oa(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...qe(t)})}function ur(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...qe(t)})}function xa(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...qe(t)})}function Fa(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...qe(t)})}function Pa(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...qe(t)})}function La(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...qe(t)})}function Na(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...qe(t)})}function Ra(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...qe(t)})}function Ca(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...qe(t)})}function za(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...qe(t)})}function Da(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...qe(t)})}function Ma(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...qe(t)})}function ja(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...qe(t)})}function $a(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...qe(t)})}function Ba(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...qe(t)})}function Ua(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...qe(t)})}function Wa(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...qe(t)})}function Za(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...qe(t)})}function Ha(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...qe(t)})}function Qa(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...qe(t)})}function Va(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...qe(t)})}function Ga(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...qe(t)})}function Ka(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...qe(t)})}function Ja(e,t){return new e({type:"string",format:"date",check:"string_format",...qe(t)})}function Ya(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...qe(t)})}function Xa(e,t){return new e({type:"string",format:"duration",check:"string_format",...qe(t)})}function el(e,t){return new e({type:"number",checks:[],...qe(t)})}function tl(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...qe(t)})}function nl(e,t){return new e({type:"boolean",...qe(t)})}function rl(e,t){return new e({type:"null",...qe(t)})}function il(e){return new e({type:"unknown"})}function sl(e,t){return new e({type:"never",...qe(t)})}function fr(e,t){return new Fr({check:"less_than",...qe(t),value:e,inclusive:!1})}function hn(e,t){return new Fr({check:"less_than",...qe(t),value:e,inclusive:!0})}function _r(e,t){return new Pr({check:"greater_than",...qe(t),value:e,inclusive:!1})}function mn(e,t){return new Pr({check:"greater_than",...qe(t),value:e,inclusive:!0})}function dr(e,t){return new yo({check:"multiple_of",...qe(t),value:e})}function Dr(e,t){return new wo({check:"max_length",...qe(t),maximum:e})}function Yt(e,t){return new qo({check:"min_length",...qe(t),minimum:e})}function Mr(e,t){return new Eo({check:"length_equals",...qe(t),length:e})}function ol(e,t){return new So({check:"string_format",format:"regex",...qe(t),pattern:e})}function al(e){return new Ao({check:"string_format",format:"lowercase",...qe(e)})}function ll(e){return new Io({check:"string_format",format:"uppercase",...qe(e)})}function cl(e,t){return new ko({check:"string_format",format:"includes",...qe(t),includes:e})}function ul(e,t){return new To({check:"string_format",format:"starts_with",...qe(t),prefix:e})}function fl(e,t){return new Oo({check:"string_format",format:"ends_with",...qe(t),suffix:e})}function Mt(e){return new xo({check:"overwrite",tx:e})}function _l(e){return Mt(t=>t.normalize(e))}function dl(){return Mt(e=>e.trim())}function pl(){return Mt(e=>e.toLowerCase())}function hl(){return Mt(e=>e.toUpperCase())}function ml(e,t,r){return new e({type:"array",element:t,...qe(r)})}function gl(e,t,r){return new e({type:"custom",check:"custom",fn:t,...qe(r)})}function bl(e){const t=yl(r=>(r.addIssue=l=>{if(typeof l=="string")r.issues.push(Dt(l,r.value,t._zod.def));else{const f=l;f.fatal&&(f.continue=!1),f.code??(f.code="custom"),f.input??(f.input=r.value),f.inst??(f.inst=t),f.continue??(f.continue=!t._zod.def.abort),r.issues.push(Dt(f))}},e(r.value,r)));return t}function yl(e,t){const r=new ct({check:"custom",...qe(t)});return r._zod.check=e,r}const vl=G("ZodISODateTime",(e,t)=>{Wo.init(e,t),He.init(e,t)});function wl(e){return Ka(vl,e)}const ql=G("ZodISODate",(e,t)=>{Zo.init(e,t),He.init(e,t)});function El(e){return Ja(ql,e)}const Sl=G("ZodISOTime",(e,t)=>{Ho.init(e,t),He.init(e,t)});function Al(e){return Ya(Sl,e)}const Il=G("ZodISODuration",(e,t)=>{Qo.init(e,t),He.init(e,t)});function kl(e){return Xa(Il,e)}const Tl=(e,t)=>{Ar.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:r=>Ls(e,r)},flatten:{value:r=>Ps(e,r)},addIssue:{value:r=>{e.issues.push(r),e.message=JSON.stringify(e.issues,gn,2)}},addIssues:{value:r=>{e.issues.push(...r),e.message=JSON.stringify(e.issues,gn,2)}},isEmpty:{get(){return e.issues.length===0}}})},ut=G("ZodError",Tl,{Parent:Error}),Ol=Sn(ut),xl=An(ut),Fl=tn(ut),Pl=nn(ut),Ll=Cs(ut),Nl=zs(ut),Rl=Ds(ut),Cl=Ms(ut),zl=js(ut),Dl=$s(ut),Ml=Bs(ut),jl=Us(ut),Ve=G("ZodType",(e,t)=>(Ze.init(e,t),e.def=t,e.type=t.type,Object.defineProperty(e,"_def",{value:t}),e.check=(...r)=>e.clone(At(t,{checks:[...t.checks??[],...r.map(l=>typeof l=="function"?{_zod:{check:l,def:{check:"custom"},onattach:[]}}:l)]})),e.clone=(r,l)=>gt(e,r,l),e.brand=()=>e,e.register=(r,l)=>(r.add(e,l),e),e.parse=(r,l)=>Ol(e,r,l,{callee:e.parse}),e.safeParse=(r,l)=>Fl(e,r,l),e.parseAsync=async(r,l)=>xl(e,r,l,{callee:e.parseAsync}),e.safeParseAsync=async(r,l)=>Pl(e,r,l),e.spa=e.safeParseAsync,e.encode=(r,l)=>Ll(e,r,l),e.decode=(r,l)=>Nl(e,r,l),e.encodeAsync=async(r,l)=>Rl(e,r,l),e.decodeAsync=async(r,l)=>Cl(e,r,l),e.safeEncode=(r,l)=>zl(e,r,l),e.safeDecode=(r,l)=>Dl(e,r,l),e.safeEncodeAsync=async(r,l)=>Ml(e,r,l),e.safeDecodeAsync=async(r,l)=>jl(e,r,l),e.refine=(r,l)=>e.check(Lc(r,l)),e.superRefine=r=>e.check(Nc(r)),e.overwrite=r=>e.check(Mt(r)),e.optional=()=>mr(e),e.nullable=()=>gr(e),e.nullish=()=>mr(gr(e)),e.nonoptional=r=>kc(e,r),e.array=()=>kn(e),e.or=r=>Tn([e,r]),e.and=r=>gc(e,r),e.transform=r=>br(e,wc(r)),e.default=r=>Sc(e,r),e.prefault=r=>Ic(e,r),e.catch=r=>Oc(e,r),e.pipe=r=>br(e,r),e.readonly=()=>Pc(e),e.describe=r=>{const l=e.clone();return Qt.add(l,{description:r}),l},Object.defineProperty(e,"description",{get(){var r;return(r=Qt.get(e))==null?void 0:r.description},configurable:!0}),e.meta=(...r)=>{if(r.length===0)return Qt.get(e);const l=e.clone();return Qt.add(l,r[0]),l},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),jr=G("_ZodString",(e,t)=>{In.init(e,t),Ve.init(e,t);const r=e._zod.bag;e.format=r.format??null,e.minLength=r.minimum??null,e.maxLength=r.maximum??null,e.regex=(...l)=>e.check(ol(...l)),e.includes=(...l)=>e.check(cl(...l)),e.startsWith=(...l)=>e.check(ul(...l)),e.endsWith=(...l)=>e.check(fl(...l)),e.min=(...l)=>e.check(Yt(...l)),e.max=(...l)=>e.check(Dr(...l)),e.length=(...l)=>e.check(Mr(...l)),e.nonempty=(...l)=>e.check(Yt(1,...l)),e.lowercase=l=>e.check(al(l)),e.uppercase=l=>e.check(ll(l)),e.trim=()=>e.check(dl()),e.normalize=(...l)=>e.check(_l(...l)),e.toLowerCase=()=>e.check(pl()),e.toUpperCase=()=>e.check(hl())}),$l=G("ZodString",(e,t)=>{In.init(e,t),jr.init(e,t),e.email=r=>e.check(Oa(Bl,r)),e.url=r=>e.check(Na(Ul,r)),e.jwt=r=>e.check(Ga(ic,r)),e.emoji=r=>e.check(Ra(Wl,r)),e.guid=r=>e.check(ur(pr,r)),e.uuid=r=>e.check(xa(Vt,r)),e.uuidv4=r=>e.check(Fa(Vt,r)),e.uuidv6=r=>e.check(Pa(Vt,r)),e.uuidv7=r=>e.check(La(Vt,r)),e.nanoid=r=>e.check(Ca(Zl,r)),e.guid=r=>e.check(ur(pr,r)),e.cuid=r=>e.check(za(Hl,r)),e.cuid2=r=>e.check(Da(Ql,r)),e.ulid=r=>e.check(Ma(Vl,r)),e.base64=r=>e.check(Ha(tc,r)),e.base64url=r=>e.check(Qa(nc,r)),e.xid=r=>e.check(ja(Gl,r)),e.ksuid=r=>e.check($a(Kl,r)),e.ipv4=r=>e.check(Ba(Jl,r)),e.ipv6=r=>e.check(Ua(Yl,r)),e.cidrv4=r=>e.check(Wa(Xl,r)),e.cidrv6=r=>e.check(Za(ec,r)),e.e164=r=>e.check(Va(rc,r)),e.datetime=r=>e.check(wl(r)),e.date=r=>e.check(El(r)),e.time=r=>e.check(Al(r)),e.duration=r=>e.check(kl(r))});function ke(e){return Ta($l,e)}const He=G("ZodStringFormat",(e,t)=>{Ue.init(e,t),jr.init(e,t)}),Bl=G("ZodEmail",(e,t)=>{Ro.init(e,t),He.init(e,t)}),pr=G("ZodGUID",(e,t)=>{Lo.init(e,t),He.init(e,t)}),Vt=G("ZodUUID",(e,t)=>{No.init(e,t),He.init(e,t)}),Ul=G("ZodURL",(e,t)=>{Co.init(e,t),He.init(e,t)}),Wl=G("ZodEmoji",(e,t)=>{zo.init(e,t),He.init(e,t)}),Zl=G("ZodNanoID",(e,t)=>{Do.init(e,t),He.init(e,t)}),Hl=G("ZodCUID",(e,t)=>{Mo.init(e,t),He.init(e,t)}),Ql=G("ZodCUID2",(e,t)=>{jo.init(e,t),He.init(e,t)}),Vl=G("ZodULID",(e,t)=>{$o.init(e,t),He.init(e,t)}),Gl=G("ZodXID",(e,t)=>{Bo.init(e,t),He.init(e,t)}),Kl=G("ZodKSUID",(e,t)=>{Uo.init(e,t),He.init(e,t)}),Jl=G("ZodIPv4",(e,t)=>{Vo.init(e,t),He.init(e,t)}),Yl=G("ZodIPv6",(e,t)=>{Go.init(e,t),He.init(e,t)}),Xl=G("ZodCIDRv4",(e,t)=>{Ko.init(e,t),He.init(e,t)}),ec=G("ZodCIDRv6",(e,t)=>{Jo.init(e,t),He.init(e,t)}),tc=G("ZodBase64",(e,t)=>{Yo.init(e,t),He.init(e,t)}),nc=G("ZodBase64URL",(e,t)=>{ea.init(e,t),He.init(e,t)}),rc=G("ZodE164",(e,t)=>{ta.init(e,t),He.init(e,t)}),ic=G("ZodJWT",(e,t)=>{ra.init(e,t),He.init(e,t)}),$r=G("ZodNumber",(e,t)=>{Nr.init(e,t),Ve.init(e,t),e.gt=(l,f)=>e.check(_r(l,f)),e.gte=(l,f)=>e.check(mn(l,f)),e.min=(l,f)=>e.check(mn(l,f)),e.lt=(l,f)=>e.check(fr(l,f)),e.lte=(l,f)=>e.check(hn(l,f)),e.max=(l,f)=>e.check(hn(l,f)),e.int=l=>e.check(hr(l)),e.safe=l=>e.check(hr(l)),e.positive=l=>e.check(_r(0,l)),e.nonnegative=l=>e.check(mn(0,l)),e.negative=l=>e.check(fr(0,l)),e.nonpositive=l=>e.check(hn(0,l)),e.multipleOf=(l,f)=>e.check(dr(l,f)),e.step=(l,f)=>e.check(dr(l,f)),e.finite=()=>e;const r=e._zod.bag;e.minValue=Math.max(r.minimum??Number.NEGATIVE_INFINITY,r.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(r.maximum??Number.POSITIVE_INFINITY,r.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),e.isFinite=!0,e.format=r.format??null});function Le(e){return el($r,e)}const sc=G("ZodNumberFormat",(e,t)=>{ia.init(e,t),$r.init(e,t)});function hr(e){return tl(sc,e)}const oc=G("ZodBoolean",(e,t)=>{sa.init(e,t),Ve.init(e,t)});function Br(e){return nl(oc,e)}const ac=G("ZodNull",(e,t)=>{oa.init(e,t),Ve.init(e,t)});function lc(e){return rl(ac,e)}const cc=G("ZodUnknown",(e,t)=>{aa.init(e,t),Ve.init(e,t)});function yn(){return il(cc)}const uc=G("ZodNever",(e,t)=>{la.init(e,t),Ve.init(e,t)});function fc(e){return sl(uc,e)}const _c=G("ZodArray",(e,t)=>{ca.init(e,t),Ve.init(e,t),e.element=t.element,e.min=(r,l)=>e.check(Yt(r,l)),e.nonempty=r=>e.check(Yt(1,r)),e.max=(r,l)=>e.check(Dr(r,l)),e.length=(r,l)=>e.check(Mr(r,l)),e.unwrap=()=>e.element});function kn(e,t){return ml(_c,e,t)}const dc=G("ZodObject",(e,t)=>{fa.init(e,t),Ve.init(e,t),je(e,"shape",()=>t.shape),e.keyof=()=>bc(Object.keys(e._zod.def.shape)),e.catchall=r=>e.clone({...e._zod.def,catchall:r}),e.passthrough=()=>e.clone({...e._zod.def,catchall:yn()}),e.loose=()=>e.clone({...e._zod.def,catchall:yn()}),e.strict=()=>e.clone({...e._zod.def,catchall:fc()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=r=>ks(e,r),e.safeExtend=r=>Ts(e,r),e.merge=r=>Os(e,r),e.pick=r=>As(e,r),e.omit=r=>Is(e,r),e.partial=(...r)=>xs(Wr,e,r[0]),e.required=(...r)=>Fs(Zr,e,r[0])});function Ne(e,t){const r={type:"object",shape:e??{},...qe(t)};return new dc(r)}const Ur=G("ZodUnion",(e,t)=>{zr.init(e,t),Ve.init(e,t),e.options=t.options});function Tn(e,t){return new Ur({type:"union",options:e,...qe(t)})}const pc=G("ZodDiscriminatedUnion",(e,t)=>{Ur.init(e,t),_a.init(e,t)});function hc(e,t,r){return new pc({type:"union",options:t,discriminator:e,...qe(r)})}const mc=G("ZodIntersection",(e,t)=>{da.init(e,t),Ve.init(e,t)});function gc(e,t){return new mc({type:"intersection",left:e,right:t})}const vn=G("ZodEnum",(e,t)=>{pa.init(e,t),Ve.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);const r=new Set(Object.keys(t.entries));e.extract=(l,f)=>{const g={};for(const q of l)if(r.has(q))g[q]=t.entries[q];else throw new Error(`Key ${q} not found in enum`);return new vn({...t,checks:[],...qe(f),entries:g})},e.exclude=(l,f)=>{const g={...t.entries};for(const q of l)if(r.has(q))delete g[q];else throw new Error(`Key ${q} not found in enum`);return new vn({...t,checks:[],...qe(f),entries:g})}});function bc(e,t){const r=Array.isArray(e)?Object.fromEntries(e.map(l=>[l,l])):e;return new vn({type:"enum",entries:r,...qe(t)})}const yc=G("ZodLiteral",(e,t)=>{ha.init(e,t),Ve.init(e,t),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function We(e,t){return new yc({type:"literal",values:Array.isArray(e)?e:[e],...qe(t)})}const vc=G("ZodTransform",(e,t)=>{ma.init(e,t),Ve.init(e,t),e._zod.parse=(r,l)=>{if(l.direction==="backward")throw new yr(e.constructor.name);r.addIssue=g=>{if(typeof g=="string")r.issues.push(Dt(g,r.value,t));else{const q=g;q.fatal&&(q.continue=!1),q.code??(q.code="custom"),q.input??(q.input=r.value),q.inst??(q.inst=e),r.issues.push(Dt(q))}};const f=t.transform(r.value,r);return f instanceof Promise?f.then(g=>(r.value=g,r)):(r.value=f,r)}});function wc(e){return new vc({type:"transform",transform:e})}const Wr=G("ZodOptional",(e,t)=>{ga.init(e,t),Ve.init(e,t),e.unwrap=()=>e._zod.def.innerType});function mr(e){return new Wr({type:"optional",innerType:e})}const qc=G("ZodNullable",(e,t)=>{ba.init(e,t),Ve.init(e,t),e.unwrap=()=>e._zod.def.innerType});function gr(e){return new qc({type:"nullable",innerType:e})}const Ec=G("ZodDefault",(e,t)=>{ya.init(e,t),Ve.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function Sc(e,t){return new Ec({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():qr(t)}})}const Ac=G("ZodPrefault",(e,t)=>{va.init(e,t),Ve.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Ic(e,t){return new Ac({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():qr(t)}})}const Zr=G("ZodNonOptional",(e,t)=>{wa.init(e,t),Ve.init(e,t),e.unwrap=()=>e._zod.def.innerType});function kc(e,t){return new Zr({type:"nonoptional",innerType:e,...qe(t)})}const Tc=G("ZodCatch",(e,t)=>{qa.init(e,t),Ve.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function Oc(e,t){return new Tc({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const xc=G("ZodPipe",(e,t)=>{Ea.init(e,t),Ve.init(e,t),e.in=t.in,e.out=t.out});function br(e,t){return new xc({type:"pipe",in:e,out:t})}const Fc=G("ZodReadonly",(e,t)=>{Sa.init(e,t),Ve.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Pc(e){return new Fc({type:"readonly",innerType:e})}const Hr=G("ZodCustom",(e,t)=>{Aa.init(e,t),Ve.init(e,t)});function Lc(e,t={}){return gl(Hr,e,t)}function Nc(e){return bl(e)}function jt(e,t={error:`Input not instance of ${e.name}`}){const r=new Hr({type:"custom",check:"custom",fn:l=>l instanceof e,abort:!0,...qe(t)});return r._zod.bag.Class=e,r}const Rc=Ne({type:We("OPEN_FROM_FILE"),file:jt(File)}),Cc=Ne({type:We("OPEN_FROM_OPFS"),path:ke()}),zc=Ne({type:We("OPEN_DEMO")}),Dc=Ne({type:We("SAVE_TO_OPFS"),path:ke()}),Mc=Ne({type:We("REMOVE_FROM_OPFS"),path:ke()}),jc=Ne({type:We("LIST_OPFS_FILES")}),$c=Ne({type:We("CLOSE")}),Bc=Ne({type:We("FTS_SEARCH"),query:ke(),limit:Le().int().positive().max(200).optional().default(20),entityType:ke().optional(),entityValue:ke().optional()}),Uc=Ne({type:We("VECTOR_SEARCH"),queryVector:jt(Float32Array),limit:Le().int().positive().max(200).optional().default(20)}),Wc=Ne({fts:Le().min(0).max(1),vector:Le().min(0).max(1),entity:Le().min(0).max(1),graph:Le().min(0).max(1)}).partial(),Zc=Ne({type:We("HYBRID_SEARCH"),query:ke(),limit:Le().int().positive().max(200).optional().default(20),weights:Wc.optional()}),Hc=Ne({type:We("LIST_ENTITIES"),entityType:ke().optional(),limit:Le().int().positive().max(500).optional().default(100)}),Qc=Ne({type:We("GRAPH_HOPS"),seedGid:ke(),predicate:ke().optional(),maxHops:Le().int().positive().max(5).optional().default(3),limit:Le().int().positive().max(200).optional().default(50)}),Vc=Ne({type:We("GET_PAGE_BLOB"),name:ke()}),Gc=Ne({type:We("GET_PAGE_LIST"),limit:Le().int().positive().max(500).optional().default(100),offset:Le().int().nonnegative().optional().default(0)}),Kc=Ne({type:We("VERIFY_PAGE"),gid:ke()}),Jc=Ne({type:We("GET_CHECKPOINTS")}),Yc=Ne({type:We("QUERY"),sql:ke(),params:kn(Tn([ke(),Le(),lc()])).optional().default([])}),Xc=Ne({type:We("EXPORT_DATABASE")}),eu=Ne({type:We("HAS_ENVELOPE_TABLES"),fileBytes:jt(Uint8Array)}),tu=Ne({type:We("EXTRACT_ENVELOPE"),file:jt(File)}),nu=Ne({type:We("MERGE_ENVELOPE"),file:jt(File)}),ru=hc("type",[Rc,Cc,zc,Dc,Mc,jc,$c,Bc,Uc,Zc,Hc,Qc,Vc,Gc,Kc,Jc,Yc,Xc,eu,tu,nu]);Ne({fileName:ke(),fileSize:Le(),docId:ke(),pageCount:Le(),entityCount:Le(),edgeCount:Le(),hasVectors:Br(),vectorModel:ke().optional(),vectorDim:Le().optional(),opfsPath:ke().optional()});Ne({gid:ke(),pageNo:Le(),title:ke().nullable(),snippet:ke(),rank:Le(),score:Le()});Ne({gid:ke(),pageNo:Le(),title:ke().nullable(),similarity:Le()});Ne({gid:ke(),pageNo:Le(),title:ke().nullable(),snippet:ke().nullable(),scores:Ne({fts:Le(),vector:Le(),entity:Le(),graph:Le(),final:Le()})});Ne({entityType:ke(),normalizedValue:ke().nullable(),count:Le()});Ne({gid:ke(),pageNo:Le(),title:ke().nullable()});Ne({fromGid:ke(),toGid:ke(),predicate:ke(),weight:Le()});Ne({gid:ke(),docId:ke(),pageNo:Le(),title:ke().nullable(),tags:ke().nullable(),updatedTs:ke()});Ne({epoch:ke(),merkleRoot:ke(),pagesCount:Le(),createdTs:ke(),anchors:kn(ke()).nullable()});Ne({gid:ke(),contentSha:ke(),expectedSha:ke().nullable(),verified:Br(),signer:ke().nullable(),signature:ke().nullable(),epoch:ke().nullable(),merkleRoot:ke().nullable()});Ne({path:ke(),size:Le(),lastModified:Le()});Ne({id:Le(),request:ru});Ne({id:Le(),response:Tn([Ne({ok:We(!0),data:yn()}),Ne({ok:We(!1),error:ke()})])});function Xt(e){return{ok:!0,data:e}}function sn(e){return{ok:!1,error:e instanceof Error?e.message:e}}async function On(e={}){var Kn;var t,r=e,l=typeof window=="object",f=typeof WorkerGlobalScope<"u";typeof process=="object"&&((Kn=process.versions)!=null&&Kn.node)&&process.type!="renderer",function(n){const s=globalThis.sqlite3InitModuleState||Object.assign(Object.create(null),{debugModule:()=>{console.warn("globalThis.sqlite3InitModuleState is missing")}});delete globalThis.sqlite3InitModuleState,s.debugModule("pre-js.js sqlite3InitModuleState =",s),n.locateFile=(function(c,i){return new URL(c,import.meta.url).href}).bind(s),n.instantiateWasm=(function(i,p){const a=this,o=n.locateFile(a.wasmFilename,typeof T>"u"?"":T);a.debugModule("instantiateWasm() uri =",o,"sIMS =",this);const h=()=>fetch(o,{credentials:"same-origin"}),R=ce=>{ce.imports=i,a.instantiateWasm=ce,p(ce.instance,ce.module)};return(WebAssembly.instantiateStreaming?async()=>WebAssembly.instantiateStreaming(h(),i).then(R):async()=>h().then(ce=>ce.arrayBuffer()).then(ce=>WebAssembly.instantiate(ce,i)).then(R))()}).bind(s)}(r);var g="./this.program",q=import.meta.url,T="";function z(n){return r.locateFile?r.locateFile(n,T):T+n}var ee,ne;if(l||f){try{T=new URL(".",q).href}catch{}f&&(ne=n=>{var s=new XMLHttpRequest;return s.open("GET",n,!1),s.responseType="arraybuffer",s.send(null),new Uint8Array(s.response)}),ee=async n=>{var s=await fetch(n,{credentials:"same-origin"});if(s.ok)return s.arrayBuffer();throw new Error(s.status+" : "+s.url)}}var Q=console.log.bind(console),ae=console.error.bind(console),ge,Ce=!1,Qe,rt,it,at,Ke,Xe,Oe,Je,st,Fn=!1;function Pn(){var n=it.buffer;at=new Int8Array(n),Xe=new Int16Array(n),Ke=new Uint8Array(n),Oe=new Int32Array(n),Je=new Uint32Array(n),st=new BigInt64Array(n),new BigUint64Array(n)}function Xr(){if(r.wasmMemory)it=r.wasmMemory;else{var n=r.INITIAL_MEMORY||8388608;it=new WebAssembly.Memory({initial:n/65536,maximum:32768})}Pn()}function ei(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)_i(r.preRun.shift());Nn(Cn)}function ti(){Fn=!0,!r.noFSInit&&!d.initialized&&d.init(),Tt.__wasm_call_ctors(),d.ignorePermissions=!1}function ni(){if(r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)fi(r.postRun.shift());Nn(Rn)}var yt=0,Pt=null;function Ln(n){var s;yt++,(s=r.monitorRunDependencies)==null||s.call(r,yt)}function on(n){var c;if(yt--,(c=r.monitorRunDependencies)==null||c.call(r,yt),yt==0&&Pt){var s=Pt;Pt=null,s()}}function ri(n){var c;(c=r.onAbort)==null||c.call(r,n),n="Aborted("+n+")",ae(n),Ce=!0,n+=". Build with -sASSERTIONS for more info.";var s=new WebAssembly.RuntimeError(n);throw rt==null||rt(s),s}var an;function ii(){return r.locateFile?z("sqlite3.wasm"):new URL("/assets/sqlite3-1f8bVu-G.wasm",import.meta.url).href}function si(n){if(n==an&&ge)return new Uint8Array(ge);if(ne)return ne(n);throw"both async and sync fetching of the wasm failed"}async function oi(n){if(!ge)try{var s=await ee(n);return new Uint8Array(s)}catch{}return si(n)}async function ai(n,s){try{var c=await oi(n),i=await WebAssembly.instantiate(c,s);return i}catch(p){ae(`failed to asynchronously prepare wasm: ${p}`),ri(p)}}async function li(n,s,c){if(!n)try{var i=fetch(s,{credentials:"same-origin"}),p=await WebAssembly.instantiateStreaming(i,c);return p}catch(a){ae(`wasm streaming compile failed: ${a}`),ae("falling back to ArrayBuffer instantiation")}return ai(s,c)}function ci(){return{env:Gn,wasi_snapshot_preview1:Gn}}async function ui(){function n(a,o){return Tt=a.exports,_s(Tt),on(),Tt}Ln();function s(a){return n(a.instance)}var c=ci();if(r.instantiateWasm)return new Promise((a,o)=>{r.instantiateWasm(c,(h,R)=>{a(n(h))})});an??(an=ii());var i=await li(ge,an,c),p=s(i);return p}var Nn=n=>{for(;n.length>0;)n.shift()(r)},Rn=[],fi=n=>Rn.push(n),Cn=[],_i=n=>Cn.push(n),Me={isAbs:n=>n.charAt(0)==="/",splitPath:n=>{var s=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return s.exec(n).slice(1)},normalizeArray:(n,s)=>{for(var c=0,i=n.length-1;i>=0;i--){var p=n[i];p==="."?n.splice(i,1):p===".."?(n.splice(i,1),c++):c&&(n.splice(i,1),c--)}if(s)for(;c;c--)n.unshift("..");return n},normalize:n=>{var s=Me.isAbs(n),c=n.slice(-1)==="/";return n=Me.normalizeArray(n.split("/").filter(i=>!!i),!s).join("/"),!n&&!s&&(n="."),n&&c&&(n+="/"),(s?"/":"")+n},dirname:n=>{var s=Me.splitPath(n),c=s[0],i=s[1];return!c&&!i?".":(i&&(i=i.slice(0,-1)),c+i)},basename:n=>n&&n.match(/([^\/]+|\/)\/*$/)[1],join:(...n)=>Me.normalize(n.join("/")),join2:(n,s)=>Me.normalize(n+"/"+s)},di=()=>n=>crypto.getRandomValues(n),zn=n=>{(zn=di())(n)},It={resolve:(...n)=>{for(var s="",c=!1,i=n.length-1;i>=-1&&!c;i--){var p=i>=0?n[i]:d.cwd();if(typeof p!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!p)return"";s=p+"/"+s,c=Me.isAbs(p)}return s=Me.normalizeArray(s.split("/").filter(a=>!!a),!c).join("/"),(c?"/":"")+s||"."},relative:(n,s)=>{n=It.resolve(n).slice(1),s=It.resolve(s).slice(1);function c(j){for(var ce=0;ce<j.length&&j[ce]==="";ce++);for(var V=j.length-1;V>=0&&j[V]==="";V--);return ce>V?[]:j.slice(ce,V-ce+1)}for(var i=c(n.split("/")),p=c(s.split("/")),a=Math.min(i.length,p.length),o=a,h=0;h<a;h++)if(i[h]!==p[h]){o=h;break}for(var R=[],h=o;h<i.length;h++)R.push("..");return R=R.concat(p.slice(o)),R.join("/")}},Dn=new TextDecoder,Mn=(n,s,c,i)=>{for(var p=s+c;n[s]&&!(s>=p);)++s;return s},Lt=(n,s=0,c,i)=>{var p=Mn(n,s,c);return Dn.decode(n.buffer?n.subarray(s,p):new Uint8Array(n.slice(s,p)))},ln=[],Bt=n=>{for(var s=0,c=0;c<n.length;++c){var i=n.charCodeAt(c);i<=127?s++:i<=2047?s+=2:i>=55296&&i<=57343?(s+=4,++c):s+=3}return s},jn=(n,s,c,i)=>{if(!(i>0))return 0;for(var p=c,a=c+i-1,o=0;o<n.length;++o){var h=n.codePointAt(o);if(h<=127){if(c>=a)break;s[c++]=h}else if(h<=2047){if(c+1>=a)break;s[c++]=192|h>>6,s[c++]=128|h&63}else if(h<=65535){if(c+2>=a)break;s[c++]=224|h>>12,s[c++]=128|h>>6&63,s[c++]=128|h&63}else{if(c+3>=a)break;s[c++]=240|h>>18,s[c++]=128|h>>12&63,s[c++]=128|h>>6&63,s[c++]=128|h&63,o++}}return s[c]=0,c-p},cn=(n,s,c)=>{var i=Bt(n)+1,p=new Array(i),a=jn(n,p,0,p.length);return p.length=a,p},pi=()=>{if(!ln.length){var n=null;if(typeof window<"u"&&typeof window.prompt=="function"&&(n=window.prompt("Input: "),n!==null&&(n+=`
`)),!n)return null;ln=cn(n)}return ln.shift()},vt={ttys:[],init(){},shutdown(){},register(n,s){vt.ttys[n]={input:[],output:[],ops:s},d.registerDevice(n,vt.stream_ops)},stream_ops:{open(n){var s=vt.ttys[n.node.rdev];if(!s)throw new d.ErrnoError(43);n.tty=s,n.seekable=!1},close(n){n.tty.ops.fsync(n.tty)},fsync(n){n.tty.ops.fsync(n.tty)},read(n,s,c,i,p){if(!n.tty||!n.tty.ops.get_char)throw new d.ErrnoError(60);for(var a=0,o=0;o<i;o++){var h;try{h=n.tty.ops.get_char(n.tty)}catch{throw new d.ErrnoError(29)}if(h===void 0&&a===0)throw new d.ErrnoError(6);if(h==null)break;a++,s[c+o]=h}return a&&(n.node.atime=Date.now()),a},write(n,s,c,i,p){if(!n.tty||!n.tty.ops.put_char)throw new d.ErrnoError(60);try{for(var a=0;a<i;a++)n.tty.ops.put_char(n.tty,s[c+a])}catch{throw new d.ErrnoError(29)}return i&&(n.node.mtime=n.node.ctime=Date.now()),a}},default_tty_ops:{get_char(n){return pi()},put_char(n,s){s===null||s===10?(Q(Lt(n.output)),n.output=[]):s!=0&&n.output.push(s)},fsync(n){var s;((s=n.output)==null?void 0:s.length)>0&&(Q(Lt(n.output)),n.output=[])},ioctl_tcgets(n){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(n,s,c){return 0},ioctl_tiocgwinsz(n){return[24,80]}},default_tty1_ops:{put_char(n,s){s===null||s===10?(ae(Lt(n.output)),n.output=[]):s!=0&&n.output.push(s)},fsync(n){var s;((s=n.output)==null?void 0:s.length)>0&&(ae(Lt(n.output)),n.output=[])}}},hi=(n,s)=>Ke.fill(0,n,n+s),$n=(n,s)=>Math.ceil(n/s)*s,Bn=n=>{n=$n(n,65536);var s=Vn(65536,n);return s&&hi(s,n),s},Te={ops_table:null,mount(n){return Te.createNode(null,"/",16895,0)},createNode(n,s,c,i){if(d.isBlkdev(c)||d.isFIFO(c))throw new d.ErrnoError(63);Te.ops_table||(Te.ops_table={dir:{node:{getattr:Te.node_ops.getattr,setattr:Te.node_ops.setattr,lookup:Te.node_ops.lookup,mknod:Te.node_ops.mknod,rename:Te.node_ops.rename,unlink:Te.node_ops.unlink,rmdir:Te.node_ops.rmdir,readdir:Te.node_ops.readdir,symlink:Te.node_ops.symlink},stream:{llseek:Te.stream_ops.llseek}},file:{node:{getattr:Te.node_ops.getattr,setattr:Te.node_ops.setattr},stream:{llseek:Te.stream_ops.llseek,read:Te.stream_ops.read,write:Te.stream_ops.write,mmap:Te.stream_ops.mmap,msync:Te.stream_ops.msync}},link:{node:{getattr:Te.node_ops.getattr,setattr:Te.node_ops.setattr,readlink:Te.node_ops.readlink},stream:{}},chrdev:{node:{getattr:Te.node_ops.getattr,setattr:Te.node_ops.setattr},stream:d.chrdev_stream_ops}});var p=d.createNode(n,s,c,i);return d.isDir(p.mode)?(p.node_ops=Te.ops_table.dir.node,p.stream_ops=Te.ops_table.dir.stream,p.contents={}):d.isFile(p.mode)?(p.node_ops=Te.ops_table.file.node,p.stream_ops=Te.ops_table.file.stream,p.usedBytes=0,p.contents=null):d.isLink(p.mode)?(p.node_ops=Te.ops_table.link.node,p.stream_ops=Te.ops_table.link.stream):d.isChrdev(p.mode)&&(p.node_ops=Te.ops_table.chrdev.node,p.stream_ops=Te.ops_table.chrdev.stream),p.atime=p.mtime=p.ctime=Date.now(),n&&(n.contents[s]=p,n.atime=n.mtime=n.ctime=p.atime),p},getFileDataAsTypedArray(n){return n.contents?n.contents.subarray?n.contents.subarray(0,n.usedBytes):new Uint8Array(n.contents):new Uint8Array(0)},expandFileStorage(n,s){var c=n.contents?n.contents.length:0;if(!(c>=s)){var i=1024*1024;s=Math.max(s,c*(c<i?2:1.125)>>>0),c!=0&&(s=Math.max(s,256));var p=n.contents;n.contents=new Uint8Array(s),n.usedBytes>0&&n.contents.set(p.subarray(0,n.usedBytes),0)}},resizeFileStorage(n,s){if(n.usedBytes!=s)if(s==0)n.contents=null,n.usedBytes=0;else{var c=n.contents;n.contents=new Uint8Array(s),c&&n.contents.set(c.subarray(0,Math.min(s,n.usedBytes))),n.usedBytes=s}},node_ops:{getattr(n){var s={};return s.dev=d.isChrdev(n.mode)?n.id:1,s.ino=n.id,s.mode=n.mode,s.nlink=1,s.uid=0,s.gid=0,s.rdev=n.rdev,d.isDir(n.mode)?s.size=4096:d.isFile(n.mode)?s.size=n.usedBytes:d.isLink(n.mode)?s.size=n.link.length:s.size=0,s.atime=new Date(n.atime),s.mtime=new Date(n.mtime),s.ctime=new Date(n.ctime),s.blksize=4096,s.blocks=Math.ceil(s.size/s.blksize),s},setattr(n,s){for(const c of["mode","atime","mtime","ctime"])s[c]!=null&&(n[c]=s[c]);s.size!==void 0&&Te.resizeFileStorage(n,s.size)},lookup(n,s){throw Te.doesNotExistError||(Te.doesNotExistError=new d.ErrnoError(44),Te.doesNotExistError.stack="<generic error, no stack>"),Te.doesNotExistError},mknod(n,s,c,i){return Te.createNode(n,s,c,i)},rename(n,s,c){var i;try{i=d.lookupNode(s,c)}catch{}if(i){if(d.isDir(n.mode))for(var p in i.contents)throw new d.ErrnoError(55);d.hashRemoveNode(i)}delete n.parent.contents[n.name],s.contents[c]=n,n.name=c,s.ctime=s.mtime=n.parent.ctime=n.parent.mtime=Date.now()},unlink(n,s){delete n.contents[s],n.ctime=n.mtime=Date.now()},rmdir(n,s){var c=d.lookupNode(n,s);for(var i in c.contents)throw new d.ErrnoError(55);delete n.contents[s],n.ctime=n.mtime=Date.now()},readdir(n){return[".","..",...Object.keys(n.contents)]},symlink(n,s,c){var i=Te.createNode(n,s,41471,0);return i.link=c,i},readlink(n){if(!d.isLink(n.mode))throw new d.ErrnoError(28);return n.link}},stream_ops:{read(n,s,c,i,p){var a=n.node.contents;if(p>=n.node.usedBytes)return 0;var o=Math.min(n.node.usedBytes-p,i);if(o>8&&a.subarray)s.set(a.subarray(p,p+o),c);else for(var h=0;h<o;h++)s[c+h]=a[p+h];return o},write(n,s,c,i,p,a){if(s.buffer===at.buffer&&(a=!1),!i)return 0;var o=n.node;if(o.mtime=o.ctime=Date.now(),s.subarray&&(!o.contents||o.contents.subarray)){if(a)return o.contents=s.subarray(c,c+i),o.usedBytes=i,i;if(o.usedBytes===0&&p===0)return o.contents=s.slice(c,c+i),o.usedBytes=i,i;if(p+i<=o.usedBytes)return o.contents.set(s.subarray(c,c+i),p),i}if(Te.expandFileStorage(o,p+i),o.contents.subarray&&s.subarray)o.contents.set(s.subarray(c,c+i),p);else for(var h=0;h<i;h++)o.contents[p+h]=s[c+h];return o.usedBytes=Math.max(o.usedBytes,p+i),i},llseek(n,s,c){var i=s;if(c===1?i+=n.position:c===2&&d.isFile(n.node.mode)&&(i+=n.node.usedBytes),i<0)throw new d.ErrnoError(28);return i},mmap(n,s,c,i,p){if(!d.isFile(n.node.mode))throw new d.ErrnoError(43);var a,o,h=n.node.contents;if(!(p&2)&&h&&h.buffer===at.buffer)o=!1,a=h.byteOffset;else{if(o=!0,a=Bn(s),!a)throw new d.ErrnoError(48);h&&((c>0||c+s<h.length)&&(h.subarray?h=h.subarray(c,c+s):h=Array.prototype.slice.call(h,c,c+s)),at.set(h,a))}return{ptr:a,allocated:o}},msync(n,s,c,i,p){return Te.stream_ops.write(n,s,0,i,c,!1),0}}},mi=async n=>{var s=await ee(n);return new Uint8Array(s)},gi=(...n)=>d.createDataFile(...n),Un=[],bi=(n,s,c,i)=>{typeof Browser<"u"&&Browser.init();var p=!1;return Un.forEach(a=>{p||a.canHandle(s)&&(a.handle(n,s,c,i),p=!0)}),p},yi=(n,s,c,i,p,a,o,h,R,j)=>{var ce=s?It.resolve(Me.join2(n,s)):n;function V(L){function D(C){j==null||j(),h||gi(n,s,C,i,p,R),a==null||a(),on()}bi(L,ce,D,()=>{o==null||o(),on()})||D(L)}Ln(),typeof c=="string"?mi(c).then(V,o):V(c)},vi=n=>{var s={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},c=s[n];if(typeof c>"u")throw new Error(`Unknown file open mode: ${n}`);return c},un=(n,s)=>{var c=0;return n&&(c|=365),s&&(c|=146),c},d={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,filesystems:null,syncFSRequests:0,readFiles:{},ErrnoError:class{constructor(n){Ye(this,"name","ErrnoError");this.errno=n}},FSStream:class{constructor(){Ye(this,"shared",{})}get object(){return this.node}set object(n){this.node=n}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(n){this.shared.flags=n}get position(){return this.shared.position}set position(n){this.shared.position=n}},FSNode:class{constructor(n,s,c,i){Ye(this,"node_ops",{});Ye(this,"stream_ops",{});Ye(this,"readMode",365);Ye(this,"writeMode",146);Ye(this,"mounted",null);n||(n=this),this.parent=n,this.mount=n.mount,this.id=d.nextInode++,this.name=s,this.mode=c,this.rdev=i,this.atime=this.mtime=this.ctime=Date.now()}get read(){return(this.mode&this.readMode)===this.readMode}set read(n){n?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(n){n?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return d.isDir(this.mode)}get isDevice(){return d.isChrdev(this.mode)}},lookupPath(n,s={}){if(!n)throw new d.ErrnoError(44);s.follow_mount??(s.follow_mount=!0),Me.isAbs(n)||(n=d.cwd()+"/"+n);e:for(var c=0;c<40;c++){for(var i=n.split("/").filter(j=>!!j),p=d.root,a="/",o=0;o<i.length;o++){var h=o===i.length-1;if(h&&s.parent)break;if(i[o]!=="."){if(i[o]===".."){if(a=Me.dirname(a),d.isRoot(p)){n=a+"/"+i.slice(o+1).join("/"),c--;continue e}else p=p.parent;continue}a=Me.join2(a,i[o]);try{p=d.lookupNode(p,i[o])}catch(j){if((j==null?void 0:j.errno)===44&&h&&s.noent_okay)return{path:a};throw j}if(d.isMountpoint(p)&&(!h||s.follow_mount)&&(p=p.mounted.root),d.isLink(p.mode)&&(!h||s.follow)){if(!p.node_ops.readlink)throw new d.ErrnoError(52);var R=p.node_ops.readlink(p);Me.isAbs(R)||(R=Me.dirname(a)+"/"+R),n=R+"/"+i.slice(o+1).join("/");continue e}}}return{path:a,node:p}}throw new d.ErrnoError(32)},getPath(n){for(var s;;){if(d.isRoot(n)){var c=n.mount.mountpoint;return s?c[c.length-1]!=="/"?`${c}/${s}`:c+s:c}s=s?`${n.name}/${s}`:n.name,n=n.parent}},hashName(n,s){for(var c=0,i=0;i<s.length;i++)c=(c<<5)-c+s.charCodeAt(i)|0;return(n+c>>>0)%d.nameTable.length},hashAddNode(n){var s=d.hashName(n.parent.id,n.name);n.name_next=d.nameTable[s],d.nameTable[s]=n},hashRemoveNode(n){var s=d.hashName(n.parent.id,n.name);if(d.nameTable[s]===n)d.nameTable[s]=n.name_next;else for(var c=d.nameTable[s];c;){if(c.name_next===n){c.name_next=n.name_next;break}c=c.name_next}},lookupNode(n,s){var c=d.mayLookup(n);if(c)throw new d.ErrnoError(c);for(var i=d.hashName(n.id,s),p=d.nameTable[i];p;p=p.name_next){var a=p.name;if(p.parent.id===n.id&&a===s)return p}return d.lookup(n,s)},createNode(n,s,c,i){var p=new d.FSNode(n,s,c,i);return d.hashAddNode(p),p},destroyNode(n){d.hashRemoveNode(n)},isRoot(n){return n===n.parent},isMountpoint(n){return!!n.mounted},isFile(n){return(n&61440)===32768},isDir(n){return(n&61440)===16384},isLink(n){return(n&61440)===40960},isChrdev(n){return(n&61440)===8192},isBlkdev(n){return(n&61440)===24576},isFIFO(n){return(n&61440)===4096},isSocket(n){return(n&49152)===49152},flagsToPermissionString(n){var s=["r","w","rw"][n&3];return n&512&&(s+="w"),s},nodePermissions(n,s){return d.ignorePermissions?0:s.includes("r")&&!(n.mode&292)||s.includes("w")&&!(n.mode&146)||s.includes("x")&&!(n.mode&73)?2:0},mayLookup(n){if(!d.isDir(n.mode))return 54;var s=d.nodePermissions(n,"x");return s||(n.node_ops.lookup?0:2)},mayCreate(n,s){if(!d.isDir(n.mode))return 54;try{var c=d.lookupNode(n,s);return 20}catch{}return d.nodePermissions(n,"wx")},mayDelete(n,s,c){var i;try{i=d.lookupNode(n,s)}catch(a){return a.errno}var p=d.nodePermissions(n,"wx");if(p)return p;if(c){if(!d.isDir(i.mode))return 54;if(d.isRoot(i)||d.getPath(i)===d.cwd())return 10}else if(d.isDir(i.mode))return 31;return 0},mayOpen(n,s){return n?d.isLink(n.mode)?32:d.isDir(n.mode)&&(d.flagsToPermissionString(s)!=="r"||s&576)?31:d.nodePermissions(n,d.flagsToPermissionString(s)):44},checkOpExists(n,s){if(!n)throw new d.ErrnoError(s);return n},MAX_OPEN_FDS:4096,nextfd(){for(var n=0;n<=d.MAX_OPEN_FDS;n++)if(!d.streams[n])return n;throw new d.ErrnoError(33)},getStreamChecked(n){var s=d.getStream(n);if(!s)throw new d.ErrnoError(8);return s},getStream:n=>d.streams[n],createStream(n,s=-1){return n=Object.assign(new d.FSStream,n),s==-1&&(s=d.nextfd()),n.fd=s,d.streams[s]=n,n},closeStream(n){d.streams[n]=null},dupStream(n,s=-1){var i,p;var c=d.createStream(n,s);return(p=(i=c.stream_ops)==null?void 0:i.dup)==null||p.call(i,c),c},doSetAttr(n,s,c){var i=n==null?void 0:n.stream_ops.setattr,p=i?n:s;i??(i=s.node_ops.setattr),d.checkOpExists(i,63),i(p,c)},chrdev_stream_ops:{open(n){var c,i;var s=d.getDevice(n.node.rdev);n.stream_ops=s.stream_ops,(i=(c=n.stream_ops).open)==null||i.call(c,n)},llseek(){throw new d.ErrnoError(70)}},major:n=>n>>8,minor:n=>n&255,makedev:(n,s)=>n<<8|s,registerDevice(n,s){d.devices[n]={stream_ops:s}},getDevice:n=>d.devices[n],getMounts(n){for(var s=[],c=[n];c.length;){var i=c.pop();s.push(i),c.push(...i.mounts)}return s},syncfs(n,s){typeof n=="function"&&(s=n,n=!1),d.syncFSRequests++,d.syncFSRequests>1&&ae(`warning: ${d.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var c=d.getMounts(d.root.mount),i=0;function p(o){return d.syncFSRequests--,s(o)}function a(o){if(o)return a.errored?void 0:(a.errored=!0,p(o));++i>=c.length&&p(null)}c.forEach(o=>{if(!o.type.syncfs)return a(null);o.type.syncfs(o,n,a)})},mount(n,s,c){var i=c==="/",p=!c,a;if(i&&d.root)throw new d.ErrnoError(10);if(!i&&!p){var o=d.lookupPath(c,{follow_mount:!1});if(c=o.path,a=o.node,d.isMountpoint(a))throw new d.ErrnoError(10);if(!d.isDir(a.mode))throw new d.ErrnoError(54)}var h={type:n,opts:s,mountpoint:c,mounts:[]},R=n.mount(h);return R.mount=h,h.root=R,i?d.root=R:a&&(a.mounted=h,a.mount&&a.mount.mounts.push(h)),R},unmount(n){var s=d.lookupPath(n,{follow_mount:!1});if(!d.isMountpoint(s.node))throw new d.ErrnoError(28);var c=s.node,i=c.mounted,p=d.getMounts(i);Object.keys(d.nameTable).forEach(o=>{for(var h=d.nameTable[o];h;){var R=h.name_next;p.includes(h.mount)&&d.destroyNode(h),h=R}}),c.mounted=null;var a=c.mount.mounts.indexOf(i);c.mount.mounts.splice(a,1)},lookup(n,s){return n.node_ops.lookup(n,s)},mknod(n,s,c){var i=d.lookupPath(n,{parent:!0}),p=i.node,a=Me.basename(n);if(!a)throw new d.ErrnoError(28);if(a==="."||a==="..")throw new d.ErrnoError(20);var o=d.mayCreate(p,a);if(o)throw new d.ErrnoError(o);if(!p.node_ops.mknod)throw new d.ErrnoError(63);return p.node_ops.mknod(p,a,s,c)},statfs(n){return d.statfsNode(d.lookupPath(n,{follow:!0}).node)},statfsStream(n){return d.statfsNode(n.node)},statfsNode(n){var s={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:d.nextInode,ffree:d.nextInode-1,fsid:42,flags:2,namelen:255};return n.node_ops.statfs&&Object.assign(s,n.node_ops.statfs(n.mount.opts.root)),s},create(n,s=438){return s&=4095,s|=32768,d.mknod(n,s,0)},mkdir(n,s=511){return s&=1023,s|=16384,d.mknod(n,s,0)},mkdirTree(n,s){var c=n.split("/"),i="";for(var p of c)if(p){(i||Me.isAbs(n))&&(i+="/"),i+=p;try{d.mkdir(i,s)}catch(a){if(a.errno!=20)throw a}}},mkdev(n,s,c){return typeof c>"u"&&(c=s,s=438),s|=8192,d.mknod(n,s,c)},symlink(n,s){if(!It.resolve(n))throw new d.ErrnoError(44);var c=d.lookupPath(s,{parent:!0}),i=c.node;if(!i)throw new d.ErrnoError(44);var p=Me.basename(s),a=d.mayCreate(i,p);if(a)throw new d.ErrnoError(a);if(!i.node_ops.symlink)throw new d.ErrnoError(63);return i.node_ops.symlink(i,p,n)},rename(n,s){var c=Me.dirname(n),i=Me.dirname(s),p=Me.basename(n),a=Me.basename(s),o,h,R;if(o=d.lookupPath(n,{parent:!0}),h=o.node,o=d.lookupPath(s,{parent:!0}),R=o.node,!h||!R)throw new d.ErrnoError(44);if(h.mount!==R.mount)throw new d.ErrnoError(75);var j=d.lookupNode(h,p),ce=It.relative(n,i);if(ce.charAt(0)!==".")throw new d.ErrnoError(28);if(ce=It.relative(s,c),ce.charAt(0)!==".")throw new d.ErrnoError(55);var V;try{V=d.lookupNode(R,a)}catch{}if(j!==V){var L=d.isDir(j.mode),D=d.mayDelete(h,p,L);if(D)throw new d.ErrnoError(D);if(D=V?d.mayDelete(R,a,L):d.mayCreate(R,a),D)throw new d.ErrnoError(D);if(!h.node_ops.rename)throw new d.ErrnoError(63);if(d.isMountpoint(j)||V&&d.isMountpoint(V))throw new d.ErrnoError(10);if(R!==h&&(D=d.nodePermissions(h,"w"),D))throw new d.ErrnoError(D);d.hashRemoveNode(j);try{h.node_ops.rename(j,R,a),j.parent=R}catch(C){throw C}finally{d.hashAddNode(j)}}},rmdir(n){var s=d.lookupPath(n,{parent:!0}),c=s.node,i=Me.basename(n),p=d.lookupNode(c,i),a=d.mayDelete(c,i,!0);if(a)throw new d.ErrnoError(a);if(!c.node_ops.rmdir)throw new d.ErrnoError(63);if(d.isMountpoint(p))throw new d.ErrnoError(10);c.node_ops.rmdir(c,i),d.destroyNode(p)},readdir(n){var s=d.lookupPath(n,{follow:!0}),c=s.node,i=d.checkOpExists(c.node_ops.readdir,54);return i(c)},unlink(n){var s=d.lookupPath(n,{parent:!0}),c=s.node;if(!c)throw new d.ErrnoError(44);var i=Me.basename(n),p=d.lookupNode(c,i),a=d.mayDelete(c,i,!1);if(a)throw new d.ErrnoError(a);if(!c.node_ops.unlink)throw new d.ErrnoError(63);if(d.isMountpoint(p))throw new d.ErrnoError(10);c.node_ops.unlink(c,i),d.destroyNode(p)},readlink(n){var s=d.lookupPath(n),c=s.node;if(!c)throw new d.ErrnoError(44);if(!c.node_ops.readlink)throw new d.ErrnoError(28);return c.node_ops.readlink(c)},stat(n,s){var c=d.lookupPath(n,{follow:!s}),i=c.node,p=d.checkOpExists(i.node_ops.getattr,63);return p(i)},fstat(n){var s=d.getStreamChecked(n),c=s.node,i=s.stream_ops.getattr,p=i?s:c;return i??(i=c.node_ops.getattr),d.checkOpExists(i,63),i(p)},lstat(n){return d.stat(n,!0)},doChmod(n,s,c,i){d.doSetAttr(n,s,{mode:c&4095|s.mode&-4096,ctime:Date.now(),dontFollow:i})},chmod(n,s,c){var i;if(typeof n=="string"){var p=d.lookupPath(n,{follow:!c});i=p.node}else i=n;d.doChmod(null,i,s,c)},lchmod(n,s){d.chmod(n,s,!0)},fchmod(n,s){var c=d.getStreamChecked(n);d.doChmod(c,c.node,s,!1)},doChown(n,s,c){d.doSetAttr(n,s,{timestamp:Date.now(),dontFollow:c})},chown(n,s,c,i){var p;if(typeof n=="string"){var a=d.lookupPath(n,{follow:!i});p=a.node}else p=n;d.doChown(null,p,i)},lchown(n,s,c){d.chown(n,s,c,!0)},fchown(n,s,c){var i=d.getStreamChecked(n);d.doChown(i,i.node,!1)},doTruncate(n,s,c){if(d.isDir(s.mode))throw new d.ErrnoError(31);if(!d.isFile(s.mode))throw new d.ErrnoError(28);var i=d.nodePermissions(s,"w");if(i)throw new d.ErrnoError(i);d.doSetAttr(n,s,{size:c,timestamp:Date.now()})},truncate(n,s){if(s<0)throw new d.ErrnoError(28);var c;if(typeof n=="string"){var i=d.lookupPath(n,{follow:!0});c=i.node}else c=n;d.doTruncate(null,c,s)},ftruncate(n,s){var c=d.getStreamChecked(n);if(s<0||!(c.flags&2097155))throw new d.ErrnoError(28);d.doTruncate(c,c.node,s)},utime(n,s,c){var i=d.lookupPath(n,{follow:!0}),p=i.node,a=d.checkOpExists(p.node_ops.setattr,63);a(p,{atime:s,mtime:c})},open(n,s,c=438){if(n==="")throw new d.ErrnoError(44);s=typeof s=="string"?vi(s):s,s&64?c=c&4095|32768:c=0;var i,p;if(typeof n=="object")i=n;else{p=n.endsWith("/");var a=d.lookupPath(n,{follow:!(s&131072),noent_okay:!0});i=a.node,n=a.path}var o=!1;if(s&64)if(i){if(s&128)throw new d.ErrnoError(20)}else{if(p)throw new d.ErrnoError(31);i=d.mknod(n,c|511,0),o=!0}if(!i)throw new d.ErrnoError(44);if(d.isChrdev(i.mode)&&(s&=-513),s&65536&&!d.isDir(i.mode))throw new d.ErrnoError(54);if(!o){var h=d.mayOpen(i,s);if(h)throw new d.ErrnoError(h)}s&512&&!o&&d.truncate(i,0),s&=-131713;var R=d.createStream({node:i,path:d.getPath(i),flags:s,seekable:!0,position:0,stream_ops:i.stream_ops,ungotten:[],error:!1});return R.stream_ops.open&&R.stream_ops.open(R),o&&d.chmod(i,c&511),r.logReadFiles&&!(s&1)&&(n in d.readFiles||(d.readFiles[n]=1)),R},close(n){if(d.isClosed(n))throw new d.ErrnoError(8);n.getdents&&(n.getdents=null);try{n.stream_ops.close&&n.stream_ops.close(n)}catch(s){throw s}finally{d.closeStream(n.fd)}n.fd=null},isClosed(n){return n.fd===null},llseek(n,s,c){if(d.isClosed(n))throw new d.ErrnoError(8);if(!n.seekable||!n.stream_ops.llseek)throw new d.ErrnoError(70);if(c!=0&&c!=1&&c!=2)throw new d.ErrnoError(28);return n.position=n.stream_ops.llseek(n,s,c),n.ungotten=[],n.position},read(n,s,c,i,p){if(i<0||p<0)throw new d.ErrnoError(28);if(d.isClosed(n))throw new d.ErrnoError(8);if((n.flags&2097155)===1)throw new d.ErrnoError(8);if(d.isDir(n.node.mode))throw new d.ErrnoError(31);if(!n.stream_ops.read)throw new d.ErrnoError(28);var a=typeof p<"u";if(!a)p=n.position;else if(!n.seekable)throw new d.ErrnoError(70);var o=n.stream_ops.read(n,s,c,i,p);return a||(n.position+=o),o},write(n,s,c,i,p,a){if(i<0||p<0)throw new d.ErrnoError(28);if(d.isClosed(n))throw new d.ErrnoError(8);if(!(n.flags&2097155))throw new d.ErrnoError(8);if(d.isDir(n.node.mode))throw new d.ErrnoError(31);if(!n.stream_ops.write)throw new d.ErrnoError(28);n.seekable&&n.flags&1024&&d.llseek(n,0,2);var o=typeof p<"u";if(!o)p=n.position;else if(!n.seekable)throw new d.ErrnoError(70);var h=n.stream_ops.write(n,s,c,i,p,a);return o||(n.position+=h),h},mmap(n,s,c,i,p){if(i&2&&!(p&2)&&(n.flags&2097155)!==2)throw new d.ErrnoError(2);if((n.flags&2097155)===1)throw new d.ErrnoError(2);if(!n.stream_ops.mmap)throw new d.ErrnoError(43);if(!s)throw new d.ErrnoError(28);return n.stream_ops.mmap(n,s,c,i,p)},msync(n,s,c,i,p){return n.stream_ops.msync?n.stream_ops.msync(n,s,c,i,p):0},ioctl(n,s,c){if(!n.stream_ops.ioctl)throw new d.ErrnoError(59);return n.stream_ops.ioctl(n,s,c)},readFile(n,s={}){if(s.flags=s.flags||0,s.encoding=s.encoding||"binary",s.encoding!=="utf8"&&s.encoding!=="binary")throw new Error(`Invalid encoding type "${s.encoding}"`);var c=d.open(n,s.flags),i=d.stat(n),p=i.size,a=new Uint8Array(p);return d.read(c,a,0,p,0),s.encoding==="utf8"&&(a=Lt(a)),d.close(c),a},writeFile(n,s,c={}){c.flags=c.flags||577;var i=d.open(n,c.flags,c.mode);if(typeof s=="string"&&(s=new Uint8Array(cn(s))),ArrayBuffer.isView(s))d.write(i,s,0,s.byteLength,void 0,c.canOwn);else throw new Error("Unsupported data type");d.close(i)},cwd:()=>d.currentPath,chdir(n){var s=d.lookupPath(n,{follow:!0});if(s.node===null)throw new d.ErrnoError(44);if(!d.isDir(s.node.mode))throw new d.ErrnoError(54);var c=d.nodePermissions(s.node,"x");if(c)throw new d.ErrnoError(c);d.currentPath=s.path},createDefaultDirectories(){d.mkdir("/tmp"),d.mkdir("/home"),d.mkdir("/home/web_user")},createDefaultDevices(){d.mkdir("/dev"),d.registerDevice(d.makedev(1,3),{read:()=>0,write:(i,p,a,o,h)=>o,llseek:()=>0}),d.mkdev("/dev/null",d.makedev(1,3)),vt.register(d.makedev(5,0),vt.default_tty_ops),vt.register(d.makedev(6,0),vt.default_tty1_ops),d.mkdev("/dev/tty",d.makedev(5,0)),d.mkdev("/dev/tty1",d.makedev(6,0));var n=new Uint8Array(1024),s=0,c=()=>(s===0&&(zn(n),s=n.byteLength),n[--s]);d.createDevice("/dev","random",c),d.createDevice("/dev","urandom",c),d.mkdir("/dev/shm"),d.mkdir("/dev/shm/tmp")},createSpecialDirectories(){d.mkdir("/proc");var n=d.mkdir("/proc/self");d.mkdir("/proc/self/fd"),d.mount({mount(){var s=d.createNode(n,"fd",16895,73);return s.stream_ops={llseek:Te.stream_ops.llseek},s.node_ops={lookup(c,i){var p=+i,a=d.getStreamChecked(p),o={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>a.path},id:p+1};return o.parent=o,o},readdir(){return Array.from(d.streams.entries()).filter(([c,i])=>i).map(([c,i])=>c.toString())}},s}},{},"/proc/self/fd")},createStandardStreams(n,s,c){n?d.createDevice("/dev","stdin",n):d.symlink("/dev/tty","/dev/stdin"),s?d.createDevice("/dev","stdout",null,s):d.symlink("/dev/tty","/dev/stdout"),c?d.createDevice("/dev","stderr",null,c):d.symlink("/dev/tty1","/dev/stderr"),d.open("/dev/stdin",0),d.open("/dev/stdout",1),d.open("/dev/stderr",1)},staticInit(){d.nameTable=new Array(4096),d.mount(Te,{},"/"),d.createDefaultDirectories(),d.createDefaultDevices(),d.createSpecialDirectories(),d.filesystems={MEMFS:Te}},init(n,s,c){d.initialized=!0,n??(n=r.stdin),s??(s=r.stdout),c??(c=r.stderr),d.createStandardStreams(n,s,c)},quit(){d.initialized=!1;for(var n of d.streams)n&&d.close(n)},findObject(n,s){var c=d.analyzePath(n,s);return c.exists?c.object:null},analyzePath(n,s){try{var c=d.lookupPath(n,{follow:!s});n=c.path}catch{}var i={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var c=d.lookupPath(n,{parent:!0});i.parentExists=!0,i.parentPath=c.path,i.parentObject=c.node,i.name=Me.basename(n),c=d.lookupPath(n,{follow:!s}),i.exists=!0,i.path=c.path,i.object=c.node,i.name=c.node.name,i.isRoot=c.path==="/"}catch(p){i.error=p.errno}return i},createPath(n,s,c,i){n=typeof n=="string"?n:d.getPath(n);for(var p=s.split("/").reverse();p.length;){var a=p.pop();if(a){var o=Me.join2(n,a);try{d.mkdir(o)}catch(h){if(h.errno!=20)throw h}n=o}}return o},createFile(n,s,c,i,p){var a=Me.join2(typeof n=="string"?n:d.getPath(n),s),o=un(i,p);return d.create(a,o)},createDataFile(n,s,c,i,p,a){var o=s;n&&(n=typeof n=="string"?n:d.getPath(n),o=s?Me.join2(n,s):n);var h=un(i,p),R=d.create(o,h);if(c){if(typeof c=="string"){for(var j=new Array(c.length),ce=0,V=c.length;ce<V;++ce)j[ce]=c.charCodeAt(ce);c=j}d.chmod(R,h|146);var L=d.open(R,577);d.write(L,c,0,c.length,0,a),d.close(L),d.chmod(R,h)}},createDevice(n,s,c,i){var h;var p=Me.join2(typeof n=="string"?n:d.getPath(n),s),a=un(!!c,!!i);(h=d.createDevice).major??(h.major=64);var o=d.makedev(d.createDevice.major++,0);return d.registerDevice(o,{open(R){R.seekable=!1},close(R){var j;(j=i==null?void 0:i.buffer)!=null&&j.length&&i(10)},read(R,j,ce,V,L){for(var D=0,C=0;C<V;C++){var $;try{$=c()}catch{throw new d.ErrnoError(29)}if($===void 0&&D===0)throw new d.ErrnoError(6);if($==null)break;D++,j[ce+C]=$}return D&&(R.node.atime=Date.now()),D},write(R,j,ce,V,L){for(var D=0;D<V;D++)try{i(j[ce+D])}catch{throw new d.ErrnoError(29)}return V&&(R.node.mtime=R.node.ctime=Date.now()),D}}),d.mkdev(p,a,o)},forceLoadFile(n){if(n.isDevice||n.isFolder||n.link||n.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");try{n.contents=ne(n.url),n.usedBytes=n.contents.length}catch{throw new d.ErrnoError(29)}},createLazyFile(n,s,c,i,p){class a{constructor(){Ye(this,"lengthKnown",!1);Ye(this,"chunks",[])}get(D){if(!(D>this.length-1||D<0)){var C=D%this.chunkSize,$=D/this.chunkSize|0;return this.getter($)[C]}}setDataGetter(D){this.getter=D}cacheLength(){var D=new XMLHttpRequest;if(D.open("HEAD",c,!1),D.send(null),!(D.status>=200&&D.status<300||D.status===304))throw new Error("Couldn't load "+c+". Status: "+D.status);var C=Number(D.getResponseHeader("Content-length")),$,le=($=D.getResponseHeader("Accept-Ranges"))&&$==="bytes",J=($=D.getResponseHeader("Content-Encoding"))&&$==="gzip",S=1024*1024;le||(S=C);var k=(M,F)=>{if(M>F)throw new Error("invalid range ("+M+", "+F+") or no bytes requested!");if(F>C-1)throw new Error("only "+C+" bytes available! programmer error!");var P=new XMLHttpRequest;if(P.open("GET",c,!1),C!==S&&P.setRequestHeader("Range","bytes="+M+"-"+F),P.responseType="arraybuffer",P.overrideMimeType&&P.overrideMimeType("text/plain; charset=x-user-defined"),P.send(null),!(P.status>=200&&P.status<300||P.status===304))throw new Error("Couldn't load "+c+". Status: "+P.status);return P.response!==void 0?new Uint8Array(P.response||[]):cn(P.responseText||"")},O=this;O.setDataGetter(M=>{var F=M*S,P=(M+1)*S-1;if(P=Math.min(P,C-1),typeof O.chunks[M]>"u"&&(O.chunks[M]=k(F,P)),typeof O.chunks[M]>"u")throw new Error("doXHR failed!");return O.chunks[M]}),(J||!C)&&(S=C=1,C=this.getter(0).length,S=C,Q("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=C,this._chunkSize=S,this.lengthKnown=!0}get length(){return this.lengthKnown||this.cacheLength(),this._length}get chunkSize(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}if(typeof XMLHttpRequest<"u"){if(!f)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var o=new a,h={isDevice:!1,contents:o}}else var h={isDevice:!1,url:c};var R=d.createFile(n,s,h,i,p);h.contents?R.contents=h.contents:h.url&&(R.contents=null,R.url=h.url),Object.defineProperties(R,{usedBytes:{get:function(){return this.contents.length}}});var j={},ce=Object.keys(R.stream_ops);ce.forEach(L=>{var D=R.stream_ops[L];j[L]=(...C)=>(d.forceLoadFile(R),D(...C))});function V(L,D,C,$,le){var J=L.node.contents;if(le>=J.length)return 0;var S=Math.min(J.length-le,$);if(J.slice)for(var k=0;k<S;k++)D[C+k]=J[le+k];else for(var k=0;k<S;k++)D[C+k]=J.get(le+k);return S}return j.read=(L,D,C,$,le)=>(d.forceLoadFile(R),V(L,D,C,$,le)),j.mmap=(L,D,C,$,le)=>{d.forceLoadFile(R);var J=Bn(D);if(!J)throw new d.ErrnoError(48);return V(L,at,J,D,C),{ptr:J,allocated:!0}},R.stream_ops=j,R}},wi=(n,s,c)=>{if(!n)return"";var i=Mn(Ke,n,s);return Dn.decode(Ke.subarray(n,i))},Fe={DEFAULT_POLLMASK:5,calculateAt(n,s,c){if(Me.isAbs(s))return s;var i;if(n===-100)i=d.cwd();else{var p=Fe.getStreamFromFD(n);i=p.path}if(s.length==0){if(!c)throw new d.ErrnoError(44);return i}return i+"/"+s},writeStat(n,s){Oe[n>>2]=s.dev,Oe[n+4>>2]=s.mode,Je[n+8>>2]=s.nlink,Oe[n+12>>2]=s.uid,Oe[n+16>>2]=s.gid,Oe[n+20>>2]=s.rdev,st[n+24>>3]=BigInt(s.size),Oe[n+32>>2]=4096,Oe[n+36>>2]=s.blocks;var c=s.atime.getTime(),i=s.mtime.getTime(),p=s.ctime.getTime();return st[n+40>>3]=BigInt(Math.floor(c/1e3)),Je[n+48>>2]=c%1e3*1e3*1e3,st[n+56>>3]=BigInt(Math.floor(i/1e3)),Je[n+64>>2]=i%1e3*1e3*1e3,st[n+72>>3]=BigInt(Math.floor(p/1e3)),Je[n+80>>2]=p%1e3*1e3*1e3,st[n+88>>3]=BigInt(s.ino),0},writeStatFs(n,s){Oe[n+4>>2]=s.bsize,Oe[n+60>>2]=s.bsize,st[n+8>>3]=BigInt(s.blocks),st[n+16>>3]=BigInt(s.bfree),st[n+24>>3]=BigInt(s.bavail),st[n+32>>3]=BigInt(s.files),st[n+40>>3]=BigInt(s.ffree),Oe[n+48>>2]=s.fsid,Oe[n+64>>2]=s.flags,Oe[n+56>>2]=s.namelen},doMsync(n,s,c,i,p){if(!d.isFile(s.node.mode))throw new d.ErrnoError(43);if(i&2)return 0;var a=Ke.slice(n,n+c);d.msync(s,a,p,c,i)},getStreamFromFD(n){var s=d.getStreamChecked(n);return s},varargs:void 0,getStr(n){var s=wi(n);return s}};function qi(n,s){try{return n=Fe.getStr(n),d.chmod(n,s),0}catch(c){if(typeof d>"u"||c.name!=="ErrnoError")throw c;return-c.errno}}function Ei(n,s,c,i){try{if(s=Fe.getStr(s),s=Fe.calculateAt(n,s),c&-8)return-28;var p=d.lookupPath(s,{follow:!0}),a=p.node;if(!a)return-44;var o="";return c&4&&(o+="r"),c&2&&(o+="w"),c&1&&(o+="x"),o&&d.nodePermissions(a,o)?-2:0}catch(h){if(typeof d>"u"||h.name!=="ErrnoError")throw h;return-h.errno}}function Si(n,s){try{return d.fchmod(n,s),0}catch(c){if(typeof d>"u"||c.name!=="ErrnoError")throw c;return-c.errno}}function Ai(n,s,c){try{return d.fchown(n,s,c),0}catch(i){if(typeof d>"u"||i.name!=="ErrnoError")throw i;return-i.errno}}var Ut=()=>{var n=Oe[+Fe.varargs>>2];return Fe.varargs+=4,n},kt=Ut;function Ii(n,s,c){Fe.varargs=c;try{var i=Fe.getStreamFromFD(n);switch(s){case 0:{var p=Ut();if(p<0)return-28;for(;d.streams[p];)p++;var a;return a=d.dupStream(i,p),a.fd}case 1:case 2:return 0;case 3:return i.flags;case 4:{var p=Ut();return i.flags|=p,0}case 12:{var p=kt(),o=0;return Xe[p+o>>1]=2,0}case 13:case 14:return 0}return-28}catch(h){if(typeof d>"u"||h.name!=="ErrnoError")throw h;return-h.errno}}function ki(n,s){try{return Fe.writeStat(s,d.fstat(n))}catch(c){if(typeof d>"u"||c.name!=="ErrnoError")throw c;return-c.errno}}var Ti=9007199254740992,Oi=-9007199254740992,Nt=n=>n<Oi||n>Ti?NaN:Number(n);function xi(n,s){s=Nt(s);try{return isNaN(s)?-61:(d.ftruncate(n,s),0)}catch(c){if(typeof d>"u"||c.name!=="ErrnoError")throw c;return-c.errno}}var wt=(n,s,c)=>jn(n,Ke,s,c);function Fi(n,s){try{if(s===0)return-28;var c=d.cwd(),i=Bt(c)+1;return s<i?-68:(wt(c,n,s),i)}catch(p){if(typeof d>"u"||p.name!=="ErrnoError")throw p;return-p.errno}}function Pi(n,s,c){Fe.varargs=c;try{var i=Fe.getStreamFromFD(n);switch(s){case 21509:return i.tty?0:-59;case 21505:{if(!i.tty)return-59;if(i.tty.ops.ioctl_tcgets){var p=i.tty.ops.ioctl_tcgets(i),a=kt();Oe[a>>2]=p.c_iflag||0,Oe[a+4>>2]=p.c_oflag||0,Oe[a+8>>2]=p.c_cflag||0,Oe[a+12>>2]=p.c_lflag||0;for(var o=0;o<32;o++)at[a+o+17]=p.c_cc[o]||0;return 0}return 0}case 21510:case 21511:case 21512:return i.tty?0:-59;case 21506:case 21507:case 21508:{if(!i.tty)return-59;if(i.tty.ops.ioctl_tcsets){for(var a=kt(),h=Oe[a>>2],R=Oe[a+4>>2],j=Oe[a+8>>2],ce=Oe[a+12>>2],V=[],o=0;o<32;o++)V.push(at[a+o+17]);return i.tty.ops.ioctl_tcsets(i.tty,s,{c_iflag:h,c_oflag:R,c_cflag:j,c_lflag:ce,c_cc:V})}return 0}case 21519:{if(!i.tty)return-59;var a=kt();return Oe[a>>2]=0,0}case 21520:return i.tty?-28:-59;case 21537:case 21531:{var a=kt();return d.ioctl(i,s,a)}case 21523:{if(!i.tty)return-59;if(i.tty.ops.ioctl_tiocgwinsz){var L=i.tty.ops.ioctl_tiocgwinsz(i.tty),a=kt();Xe[a>>1]=L[0],Xe[a+2>>1]=L[1]}return 0}case 21524:return i.tty?0:-59;case 21515:return i.tty?0:-59;default:return-28}}catch(D){if(typeof d>"u"||D.name!=="ErrnoError")throw D;return-D.errno}}function Li(n,s){try{return n=Fe.getStr(n),Fe.writeStat(s,d.lstat(n))}catch(c){if(typeof d>"u"||c.name!=="ErrnoError")throw c;return-c.errno}}function Ni(n,s,c){try{return s=Fe.getStr(s),s=Fe.calculateAt(n,s),d.mkdir(s,c,0),0}catch(i){if(typeof d>"u"||i.name!=="ErrnoError")throw i;return-i.errno}}function Ri(n,s,c,i){try{s=Fe.getStr(s);var p=i&256,a=i&4096;return i=i&-6401,s=Fe.calculateAt(n,s,a),Fe.writeStat(c,p?d.lstat(s):d.stat(s))}catch(o){if(typeof d>"u"||o.name!=="ErrnoError")throw o;return-o.errno}}function Ci(n,s,c,i){Fe.varargs=i;try{s=Fe.getStr(s),s=Fe.calculateAt(n,s);var p=i?Ut():0;return d.open(s,c,p).fd}catch(a){if(typeof d>"u"||a.name!=="ErrnoError")throw a;return-a.errno}}function zi(n,s,c,i){try{if(s=Fe.getStr(s),s=Fe.calculateAt(n,s),i<=0)return-28;var p=d.readlink(s),a=Math.min(i,Bt(p)),o=at[c+a];return wt(p,c,i+1),at[c+a]=o,a}catch(h){if(typeof d>"u"||h.name!=="ErrnoError")throw h;return-h.errno}}function Di(n){try{return n=Fe.getStr(n),d.rmdir(n),0}catch(s){if(typeof d>"u"||s.name!=="ErrnoError")throw s;return-s.errno}}function Mi(n,s){try{return n=Fe.getStr(n),Fe.writeStat(s,d.stat(n))}catch(c){if(typeof d>"u"||c.name!=="ErrnoError")throw c;return-c.errno}}function ji(n,s,c){try{if(s=Fe.getStr(s),s=Fe.calculateAt(n,s),!c)d.unlink(s);else if(c===512)d.rmdir(s);else return-28;return 0}catch(i){if(typeof d>"u"||i.name!=="ErrnoError")throw i;return-i.errno}}var Wn=n=>Je[n>>2]+Oe[n+4>>2]*4294967296;function $i(n,s,c,i){try{s=Fe.getStr(s),s=Fe.calculateAt(n,s,!0);var p=Date.now(),a,o;if(!c)a=p,o=p;else{var h=Wn(c),R=Oe[c+8>>2];R==1073741823?a=p:R==1073741822?a=null:a=h*1e3+R/(1e3*1e3),c+=16,h=Wn(c),R=Oe[c+8>>2],R==1073741823?o=p:R==1073741822?o=null:o=h*1e3+R/(1e3*1e3)}return(o??a)!==null&&d.utime(s,a,o),0}catch(j){if(typeof d>"u"||j.name!=="ErrnoError")throw j;return-j.errno}}var Bi=n=>n%4===0&&(n%100!==0||n%400===0),Ui=[0,31,60,91,121,152,182,213,244,274,305,335],Wi=[0,31,59,90,120,151,181,212,243,273,304,334],Zi=n=>{var s=Bi(n.getFullYear()),c=s?Ui:Wi,i=c[n.getMonth()]+n.getDate()-1;return i};function Hi(n,s){n=Nt(n);var c=new Date(n*1e3);Oe[s>>2]=c.getSeconds(),Oe[s+4>>2]=c.getMinutes(),Oe[s+8>>2]=c.getHours(),Oe[s+12>>2]=c.getDate(),Oe[s+16>>2]=c.getMonth(),Oe[s+20>>2]=c.getFullYear()-1900,Oe[s+24>>2]=c.getDay();var i=Zi(c)|0;Oe[s+28>>2]=i,Oe[s+36>>2]=-(c.getTimezoneOffset()*60);var p=new Date(c.getFullYear(),0,1),a=new Date(c.getFullYear(),6,1).getTimezoneOffset(),o=p.getTimezoneOffset(),h=(a!=o&&c.getTimezoneOffset()==Math.min(o,a))|0;Oe[s+32>>2]=h}function Qi(n,s,c,i,p,a,o){p=Nt(p);try{var h=Fe.getStreamFromFD(i),R=d.mmap(h,n,p,s,c),j=R.ptr;return Oe[a>>2]=R.allocated,Je[o>>2]=j,0}catch(ce){if(typeof d>"u"||ce.name!=="ErrnoError")throw ce;return-ce.errno}}function Vi(n,s,c,i,p,a){a=Nt(a);try{var o=Fe.getStreamFromFD(p);c&2&&Fe.doMsync(n,o,s,i,a)}catch(h){if(typeof d>"u"||h.name!=="ErrnoError")throw h;return-h.errno}}var Gi=(n,s,c,i)=>{var p=new Date().getFullYear(),a=new Date(p,0,1),o=new Date(p,6,1),h=a.getTimezoneOffset(),R=o.getTimezoneOffset(),j=Math.max(h,R);Je[n>>2]=j*60,Oe[s>>2]=+(h!=R);var ce=D=>{var C=D>=0?"-":"+",$=Math.abs(D),le=String(Math.floor($/60)).padStart(2,"0"),J=String($%60).padStart(2,"0");return`UTC${C}${le}${J}`},V=ce(h),L=ce(R);R<h?(wt(V,c,17),wt(L,i,17)):(wt(V,i,17),wt(L,c,17))},Zn=()=>performance.now(),Hn=()=>Date.now(),Ki=n=>n>=0&&n<=3;function Ji(n,s,c){if(!Ki(n))return 28;var i;n===0?i=Hn():i=Zn();var p=Math.round(i*1e3*1e3);return st[c>>3]=BigInt(p),0}var Qn=()=>2147483648,Yi=()=>Qn(),Xi=n=>{var s=it.buffer.byteLength,c=(n-s+65535)/65536|0;try{return it.grow(c),Pn(),1}catch{}},es=n=>{var s=Ke.length;n>>>=0;var c=Qn();if(n>c)return!1;for(var i=1;i<=4;i*=2){var p=s*(1+.2/i);p=Math.min(p,n+100663296);var a=Math.min(c,$n(Math.max(n,p),65536)),o=Xi(a);if(o)return!0}return!1},fn={},ts=()=>g||"./this.program",Rt=()=>{if(!Rt.strings){var n=(typeof navigator=="object"&&navigator.language||"C").replace("-","_")+".UTF-8",s={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:n,_:ts()};for(var c in fn)fn[c]===void 0?delete s[c]:s[c]=fn[c];var i=[];for(var c in s)i.push(`${c}=${s[c]}`);Rt.strings=i}return Rt.strings},ns=(n,s)=>{var c=0,i=0;for(var p of Rt()){var a=s+c;Je[n+i>>2]=a,c+=wt(p,a,1/0)+1,i+=4}return 0},rs=(n,s)=>{var c=Rt();Je[n>>2]=c.length;var i=0;for(var p of c)i+=Bt(p)+1;return Je[s>>2]=i,0};function is(n){try{var s=Fe.getStreamFromFD(n);return d.close(s),0}catch(c){if(typeof d>"u"||c.name!=="ErrnoError")throw c;return c.errno}}function ss(n,s){try{var c=0,i=0,p=0,a=Fe.getStreamFromFD(n),o=a.tty?2:d.isDir(a.mode)?3:d.isLink(a.mode)?7:4;return at[s]=o,Xe[s+2>>1]=p,st[s+8>>3]=BigInt(c),st[s+16>>3]=BigInt(i),0}catch(h){if(typeof d>"u"||h.name!=="ErrnoError")throw h;return h.errno}}var os=(n,s,c,i)=>{for(var p=0,a=0;a<c;a++){var o=Je[s>>2],h=Je[s+4>>2];s+=8;var R=d.read(n,at,o,h,i);if(R<0)return-1;if(p+=R,R<h)break}return p};function as(n,s,c,i){try{var p=Fe.getStreamFromFD(n),a=os(p,s,c);return Je[i>>2]=a,0}catch(o){if(typeof d>"u"||o.name!=="ErrnoError")throw o;return o.errno}}function ls(n,s,c,i){s=Nt(s);try{if(isNaN(s))return 61;var p=Fe.getStreamFromFD(n);return d.llseek(p,s,c),st[i>>3]=BigInt(p.position),p.getdents&&s===0&&c===0&&(p.getdents=null),0}catch(a){if(typeof d>"u"||a.name!=="ErrnoError")throw a;return a.errno}}function cs(n){var c;try{var s=Fe.getStreamFromFD(n);return(c=s.stream_ops)!=null&&c.fsync?s.stream_ops.fsync(s):0}catch(i){if(typeof d>"u"||i.name!=="ErrnoError")throw i;return i.errno}}var us=(n,s,c,i)=>{for(var p=0,a=0;a<c;a++){var o=Je[s>>2],h=Je[s+4>>2];s+=8;var R=d.write(n,at,o,h,i);if(R<0)return-1;if(p+=R,R<h)break}return p};function fs(n,s,c,i){try{var p=Fe.getStreamFromFD(n),a=us(p,s,c);return Je[i>>2]=a,0}catch(o){if(typeof d>"u"||o.name!=="ErrnoError")throw o;return o.errno}}d.createPreloadedFile=yi,d.staticInit(),Xr(),r.noExitRuntime&&r.noExitRuntime,r.preloadPlugins&&(Un=r.preloadPlugins),r.print&&(Q=r.print),r.printErr&&(ae=r.printErr),r.wasmBinary&&(ge=r.wasmBinary),r.arguments&&r.arguments,r.thisProgram&&(g=r.thisProgram),r.wasmMemory=it;var Vn;function _s(n){r._sqlite3_status64=n.sqlite3_status64,r._sqlite3_status=n.sqlite3_status,r._sqlite3_db_status64=n.sqlite3_db_status64,r._sqlite3_msize=n.sqlite3_msize,r._sqlite3_db_status=n.sqlite3_db_status,r._sqlite3_vfs_find=n.sqlite3_vfs_find,r._sqlite3_initialize=n.sqlite3_initialize,r._sqlite3_malloc=n.sqlite3_malloc,r._sqlite3_free=n.sqlite3_free,r._sqlite3_vfs_register=n.sqlite3_vfs_register,r._sqlite3_vfs_unregister=n.sqlite3_vfs_unregister,r._sqlite3_malloc64=n.sqlite3_malloc64,r._sqlite3_realloc=n.sqlite3_realloc,r._sqlite3_realloc64=n.sqlite3_realloc64,r._sqlite3_value_text=n.sqlite3_value_text,r._sqlite3_randomness=n.sqlite3_randomness,r._sqlite3_stricmp=n.sqlite3_stricmp,r._sqlite3_strnicmp=n.sqlite3_strnicmp,r._sqlite3_uri_parameter=n.sqlite3_uri_parameter,r._sqlite3_uri_boolean=n.sqlite3_uri_boolean,r._sqlite3_serialize=n.sqlite3_serialize,r._sqlite3_prepare_v2=n.sqlite3_prepare_v2,r._sqlite3_step=n.sqlite3_step,r._sqlite3_column_int64=n.sqlite3_column_int64,r._sqlite3_reset=n.sqlite3_reset,r._sqlite3_exec=n.sqlite3_exec,r._sqlite3_column_int=n.sqlite3_column_int,r._sqlite3_finalize=n.sqlite3_finalize,r._sqlite3_file_control=n.sqlite3_file_control,r._sqlite3_column_name=n.sqlite3_column_name,r._sqlite3_column_text=n.sqlite3_column_text,r._sqlite3_column_type=n.sqlite3_column_type,r._sqlite3_errmsg=n.sqlite3_errmsg,r._sqlite3_deserialize=n.sqlite3_deserialize,r._sqlite3_clear_bindings=n.sqlite3_clear_bindings,r._sqlite3_value_blob=n.sqlite3_value_blob,r._sqlite3_value_bytes=n.sqlite3_value_bytes,r._sqlite3_value_double=n.sqlite3_value_double,r._sqlite3_value_int=n.sqlite3_value_int,r._sqlite3_value_int64=n.sqlite3_value_int64,r._sqlite3_value_subtype=n.sqlite3_value_subtype,r._sqlite3_value_pointer=n.sqlite3_value_pointer,r._sqlite3_value_type=n.sqlite3_value_type,r._sqlite3_value_nochange=n.sqlite3_value_nochange,r._sqlite3_value_frombind=n.sqlite3_value_frombind,r._sqlite3_value_dup=n.sqlite3_value_dup,r._sqlite3_value_free=n.sqlite3_value_free,r._sqlite3_result_blob=n.sqlite3_result_blob,r._sqlite3_result_error_toobig=n.sqlite3_result_error_toobig,r._sqlite3_result_error_nomem=n.sqlite3_result_error_nomem,r._sqlite3_result_double=n.sqlite3_result_double,r._sqlite3_result_error=n.sqlite3_result_error,r._sqlite3_result_int=n.sqlite3_result_int,r._sqlite3_result_int64=n.sqlite3_result_int64,r._sqlite3_result_null=n.sqlite3_result_null,r._sqlite3_result_pointer=n.sqlite3_result_pointer,r._sqlite3_result_subtype=n.sqlite3_result_subtype,r._sqlite3_result_text=n.sqlite3_result_text,r._sqlite3_result_zeroblob=n.sqlite3_result_zeroblob,r._sqlite3_result_zeroblob64=n.sqlite3_result_zeroblob64,r._sqlite3_result_error_code=n.sqlite3_result_error_code,r._sqlite3_user_data=n.sqlite3_user_data,r._sqlite3_context_db_handle=n.sqlite3_context_db_handle,r._sqlite3_vtab_nochange=n.sqlite3_vtab_nochange,r._sqlite3_vtab_in_first=n.sqlite3_vtab_in_first,r._sqlite3_vtab_in_next=n.sqlite3_vtab_in_next,r._sqlite3_aggregate_context=n.sqlite3_aggregate_context,r._sqlite3_get_auxdata=n.sqlite3_get_auxdata,r._sqlite3_set_auxdata=n.sqlite3_set_auxdata,r._sqlite3_column_count=n.sqlite3_column_count,r._sqlite3_data_count=n.sqlite3_data_count,r._sqlite3_column_blob=n.sqlite3_column_blob,r._sqlite3_column_bytes=n.sqlite3_column_bytes,r._sqlite3_column_double=n.sqlite3_column_double,r._sqlite3_column_value=n.sqlite3_column_value,r._sqlite3_column_decltype=n.sqlite3_column_decltype,r._sqlite3_column_database_name=n.sqlite3_column_database_name,r._sqlite3_column_table_name=n.sqlite3_column_table_name,r._sqlite3_column_origin_name=n.sqlite3_column_origin_name,r._sqlite3_bind_blob=n.sqlite3_bind_blob,r._sqlite3_bind_double=n.sqlite3_bind_double,r._sqlite3_bind_int=n.sqlite3_bind_int,r._sqlite3_bind_int64=n.sqlite3_bind_int64,r._sqlite3_bind_null=n.sqlite3_bind_null,r._sqlite3_bind_pointer=n.sqlite3_bind_pointer,r._sqlite3_bind_text=n.sqlite3_bind_text,r._sqlite3_bind_parameter_count=n.sqlite3_bind_parameter_count,r._sqlite3_bind_parameter_name=n.sqlite3_bind_parameter_name,r._sqlite3_bind_parameter_index=n.sqlite3_bind_parameter_index,r._sqlite3_db_handle=n.sqlite3_db_handle,r._sqlite3_stmt_readonly=n.sqlite3_stmt_readonly,r._sqlite3_stmt_isexplain=n.sqlite3_stmt_isexplain,r._sqlite3_stmt_explain=n.sqlite3_stmt_explain,r._sqlite3_stmt_busy=n.sqlite3_stmt_busy,r._sqlite3_stmt_status=n.sqlite3_stmt_status,r._sqlite3_sql=n.sqlite3_sql,r._sqlite3_expanded_sql=n.sqlite3_expanded_sql,r._sqlite3_preupdate_old=n.sqlite3_preupdate_old,r._sqlite3_preupdate_count=n.sqlite3_preupdate_count,r._sqlite3_preupdate_depth=n.sqlite3_preupdate_depth,r._sqlite3_preupdate_blobwrite=n.sqlite3_preupdate_blobwrite,r._sqlite3_preupdate_new=n.sqlite3_preupdate_new,r._sqlite3_value_numeric_type=n.sqlite3_value_numeric_type,r._sqlite3_set_authorizer=n.sqlite3_set_authorizer,r._sqlite3_strglob=n.sqlite3_strglob,r._sqlite3_strlike=n.sqlite3_strlike,r._sqlite3_auto_extension=n.sqlite3_auto_extension,r._sqlite3_cancel_auto_extension=n.sqlite3_cancel_auto_extension,r._sqlite3_reset_auto_extension=n.sqlite3_reset_auto_extension,r._sqlite3_prepare_v3=n.sqlite3_prepare_v3,r._sqlite3_create_module=n.sqlite3_create_module,r._sqlite3_create_module_v2=n.sqlite3_create_module_v2,r._sqlite3_drop_modules=n.sqlite3_drop_modules,r._sqlite3_declare_vtab=n.sqlite3_declare_vtab,r._sqlite3_vtab_on_conflict=n.sqlite3_vtab_on_conflict,r._sqlite3_vtab_collation=n.sqlite3_vtab_collation,r._sqlite3_vtab_in=n.sqlite3_vtab_in,r._sqlite3_vtab_rhs_value=n.sqlite3_vtab_rhs_value,r._sqlite3_vtab_distinct=n.sqlite3_vtab_distinct,r._sqlite3_keyword_name=n.sqlite3_keyword_name,r._sqlite3_keyword_count=n.sqlite3_keyword_count,r._sqlite3_keyword_check=n.sqlite3_keyword_check,r._sqlite3_complete=n.sqlite3_complete,r._sqlite3_libversion=n.sqlite3_libversion,r._sqlite3_libversion_number=n.sqlite3_libversion_number,r._sqlite3_shutdown=n.sqlite3_shutdown,r._sqlite3_last_insert_rowid=n.sqlite3_last_insert_rowid,r._sqlite3_set_last_insert_rowid=n.sqlite3_set_last_insert_rowid,r._sqlite3_changes64=n.sqlite3_changes64,r._sqlite3_changes=n.sqlite3_changes,r._sqlite3_total_changes64=n.sqlite3_total_changes64,r._sqlite3_total_changes=n.sqlite3_total_changes,r._sqlite3_txn_state=n.sqlite3_txn_state,r._sqlite3_close_v2=n.sqlite3_close_v2,r._sqlite3_busy_handler=n.sqlite3_busy_handler,r._sqlite3_progress_handler=n.sqlite3_progress_handler,r._sqlite3_busy_timeout=n.sqlite3_busy_timeout,r._sqlite3_interrupt=n.sqlite3_interrupt,r._sqlite3_is_interrupted=n.sqlite3_is_interrupted,r._sqlite3_create_function=n.sqlite3_create_function,r._sqlite3_create_function_v2=n.sqlite3_create_function_v2,r._sqlite3_create_window_function=n.sqlite3_create_window_function,r._sqlite3_overload_function=n.sqlite3_overload_function,r._sqlite3_trace_v2=n.sqlite3_trace_v2,r._sqlite3_commit_hook=n.sqlite3_commit_hook,r._sqlite3_update_hook=n.sqlite3_update_hook,r._sqlite3_rollback_hook=n.sqlite3_rollback_hook,r._sqlite3_preupdate_hook=n.sqlite3_preupdate_hook,r._sqlite3_set_errmsg=n.sqlite3_set_errmsg,r._sqlite3_error_offset=n.sqlite3_error_offset,r._sqlite3_errcode=n.sqlite3_errcode,r._sqlite3_extended_errcode=n.sqlite3_extended_errcode,r._sqlite3_errstr=n.sqlite3_errstr,r._sqlite3_limit=n.sqlite3_limit,r._sqlite3_open=n.sqlite3_open,r._sqlite3_open_v2=n.sqlite3_open_v2,r._sqlite3_create_collation=n.sqlite3_create_collation,r._sqlite3_create_collation_v2=n.sqlite3_create_collation_v2,r._sqlite3_collation_needed=n.sqlite3_collation_needed,r._sqlite3_get_autocommit=n.sqlite3_get_autocommit,r._sqlite3_table_column_metadata=n.sqlite3_table_column_metadata,r._sqlite3_extended_result_codes=n.sqlite3_extended_result_codes,r._sqlite3_uri_key=n.sqlite3_uri_key,r._sqlite3_uri_int64=n.sqlite3_uri_int64,r._sqlite3_db_name=n.sqlite3_db_name,r._sqlite3_db_filename=n.sqlite3_db_filename,r._sqlite3_db_readonly=n.sqlite3_db_readonly,r._sqlite3_compileoption_used=n.sqlite3_compileoption_used,r._sqlite3_compileoption_get=n.sqlite3_compileoption_get,r._sqlite3session_diff=n.sqlite3session_diff,r._sqlite3session_attach=n.sqlite3session_attach,r._sqlite3session_create=n.sqlite3session_create,r._sqlite3session_delete=n.sqlite3session_delete,r._sqlite3session_table_filter=n.sqlite3session_table_filter,r._sqlite3session_changeset=n.sqlite3session_changeset,r._sqlite3session_changeset_strm=n.sqlite3session_changeset_strm,r._sqlite3session_patchset_strm=n.sqlite3session_patchset_strm,r._sqlite3session_patchset=n.sqlite3session_patchset,r._sqlite3session_enable=n.sqlite3session_enable,r._sqlite3session_indirect=n.sqlite3session_indirect,r._sqlite3session_isempty=n.sqlite3session_isempty,r._sqlite3session_memory_used=n.sqlite3session_memory_used,r._sqlite3session_object_config=n.sqlite3session_object_config,r._sqlite3session_changeset_size=n.sqlite3session_changeset_size,r._sqlite3changeset_start=n.sqlite3changeset_start,r._sqlite3changeset_start_v2=n.sqlite3changeset_start_v2,r._sqlite3changeset_start_strm=n.sqlite3changeset_start_strm,r._sqlite3changeset_start_v2_strm=n.sqlite3changeset_start_v2_strm,r._sqlite3changeset_next=n.sqlite3changeset_next,r._sqlite3changeset_op=n.sqlite3changeset_op,r._sqlite3changeset_pk=n.sqlite3changeset_pk,r._sqlite3changeset_old=n.sqlite3changeset_old,r._sqlite3changeset_new=n.sqlite3changeset_new,r._sqlite3changeset_conflict=n.sqlite3changeset_conflict,r._sqlite3changeset_fk_conflicts=n.sqlite3changeset_fk_conflicts,r._sqlite3changeset_finalize=n.sqlite3changeset_finalize,r._sqlite3changeset_invert=n.sqlite3changeset_invert,r._sqlite3changeset_invert_strm=n.sqlite3changeset_invert_strm,r._sqlite3changeset_apply_v2=n.sqlite3changeset_apply_v2,r._sqlite3changeset_apply_v3=n.sqlite3changeset_apply_v3,r._sqlite3changeset_apply=n.sqlite3changeset_apply,r._sqlite3changeset_apply_v3_strm=n.sqlite3changeset_apply_v3_strm,r._sqlite3changeset_apply_v2_strm=n.sqlite3changeset_apply_v2_strm,r._sqlite3changeset_apply_strm=n.sqlite3changeset_apply_strm,r._sqlite3changegroup_new=n.sqlite3changegroup_new,r._sqlite3changegroup_add=n.sqlite3changegroup_add,r._sqlite3changegroup_output=n.sqlite3changegroup_output,r._sqlite3changegroup_add_strm=n.sqlite3changegroup_add_strm,r._sqlite3changegroup_output_strm=n.sqlite3changegroup_output_strm,r._sqlite3changegroup_delete=n.sqlite3changegroup_delete,r._sqlite3changeset_concat=n.sqlite3changeset_concat,r._sqlite3changeset_concat_strm=n.sqlite3changeset_concat_strm,r._sqlite3session_config=n.sqlite3session_config,r._sqlite3_sourceid=n.sqlite3_sourceid,r._sqlite3__wasm_pstack_ptr=n.sqlite3__wasm_pstack_ptr,r._sqlite3__wasm_pstack_restore=n.sqlite3__wasm_pstack_restore,r._sqlite3__wasm_pstack_alloc=n.sqlite3__wasm_pstack_alloc,r._sqlite3__wasm_pstack_remaining=n.sqlite3__wasm_pstack_remaining,r._sqlite3__wasm_pstack_quota=n.sqlite3__wasm_pstack_quota,r._sqlite3__wasm_test_struct=n.sqlite3__wasm_test_struct,r._sqlite3__wasm_enum_json=n.sqlite3__wasm_enum_json,r._sqlite3__wasm_vfs_unlink=n.sqlite3__wasm_vfs_unlink,r._sqlite3__wasm_db_vfs=n.sqlite3__wasm_db_vfs,r._sqlite3__wasm_db_reset=n.sqlite3__wasm_db_reset,r._sqlite3__wasm_db_export_chunked=n.sqlite3__wasm_db_export_chunked,r._sqlite3__wasm_db_serialize=n.sqlite3__wasm_db_serialize,r._sqlite3__wasm_vfs_create_file=n.sqlite3__wasm_vfs_create_file,r._sqlite3__wasm_posix_create_file=n.sqlite3__wasm_posix_create_file,r._sqlite3__wasm_kvvfsMakeKeyOnPstack=n.sqlite3__wasm_kvvfsMakeKeyOnPstack,r._sqlite3__wasm_kvvfs_methods=n.sqlite3__wasm_kvvfs_methods,r._sqlite3__wasm_vtab_config=n.sqlite3__wasm_vtab_config,r._sqlite3__wasm_db_config_ip=n.sqlite3__wasm_db_config_ip,r._sqlite3__wasm_db_config_pii=n.sqlite3__wasm_db_config_pii,r._sqlite3__wasm_db_config_s=n.sqlite3__wasm_db_config_s,r._sqlite3__wasm_config_i=n.sqlite3__wasm_config_i,r._sqlite3__wasm_config_ii=n.sqlite3__wasm_config_ii,r._sqlite3__wasm_config_j=n.sqlite3__wasm_config_j,r._sqlite3__wasm_qfmt_token=n.sqlite3__wasm_qfmt_token,r._sqlite3__wasm_init_wasmfs=n.sqlite3__wasm_init_wasmfs,r._sqlite3__wasm_test_intptr=n.sqlite3__wasm_test_intptr,r._sqlite3__wasm_test_voidptr=n.sqlite3__wasm_test_voidptr,r._sqlite3__wasm_test_int64_max=n.sqlite3__wasm_test_int64_max,r._sqlite3__wasm_test_int64_min=n.sqlite3__wasm_test_int64_min,r._sqlite3__wasm_test_int64_times2=n.sqlite3__wasm_test_int64_times2,r._sqlite3__wasm_test_int64_minmax=n.sqlite3__wasm_test_int64_minmax,r._sqlite3__wasm_test_int64ptr=n.sqlite3__wasm_test_int64ptr,r._sqlite3__wasm_test_stack_overflow=n.sqlite3__wasm_test_stack_overflow,r._sqlite3__wasm_test_str_hello=n.sqlite3__wasm_test_str_hello,r._sqlite3__wasm_SQLTester_strglob=n.sqlite3__wasm_SQLTester_strglob,r._malloc=n.malloc,r._free=n.free,r._realloc=n.realloc,Vn=n.emscripten_builtin_memalign,n._emscripten_stack_restore,n._emscripten_stack_alloc,n.emscripten_stack_get_current}var Gn={__syscall_chmod:qi,__syscall_faccessat:Ei,__syscall_fchmod:Si,__syscall_fchown32:Ai,__syscall_fcntl64:Ii,__syscall_fstat64:ki,__syscall_ftruncate64:xi,__syscall_getcwd:Fi,__syscall_ioctl:Pi,__syscall_lstat64:Li,__syscall_mkdirat:Ni,__syscall_newfstatat:Ri,__syscall_openat:Ci,__syscall_readlinkat:zi,__syscall_rmdir:Di,__syscall_stat64:Mi,__syscall_unlinkat:ji,__syscall_utimensat:$i,_localtime_js:Hi,_mmap_js:Qi,_munmap_js:Vi,_tzset_js:Gi,clock_time_get:Ji,emscripten_date_now:Hn,emscripten_get_heap_max:Yi,emscripten_get_now:Zn,emscripten_resize_heap:es,environ_get:ns,environ_sizes_get:rs,fd_close:is,fd_fdstat_get:ss,fd_read:as,fd_seek:ls,fd_sync:cs,fd_write:fs,memory:it},Tt=await ui();function _n(){if(yt>0){Pt=_n;return}if(ei(),yt>0){Pt=_n;return}function n(){var s;r.calledRun=!0,!Ce&&(ti(),Qe==null||Qe(r),(s=r.onRuntimeInitialized)==null||s.call(r),ni())}r.setStatus?(r.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>r.setStatus(""),1),n()},1)):n()}function ds(){if(r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.shift()()}return ds(),_n(),r.runSQLite3PostLoadInit=function(n,s,c){if(delete s.runSQLite3PostLoadInit,globalThis.sqlite3ApiBootstrap=async function i(p=globalThis.sqlite3ApiConfig||i.defaultConfig){if(i.sqlite3)return(i.sqlite3.config||console).warn("sqlite3ApiBootstrap() called multiple times.","Config and external initializers are ignored on calls after the first."),i.sqlite3;const a=Object.assign(Object.create(null),{exports:void 0,memory:void 0,bigIntEnabled:!!globalThis.BigInt64Array,debug:console.debug.bind(console),warn:console.warn.bind(console),error:console.error.bind(console),log:console.log.bind(console),wasmfsOpfsDir:"/opfs",useStdAlloc:!1},p||{});Object.assign(a,{allocExportName:a.useStdAlloc?"malloc":"sqlite3_malloc",deallocExportName:a.useStdAlloc?"free":"sqlite3_free",reallocExportName:a.useStdAlloc?"realloc":"sqlite3_realloc"}),["exports","memory","functionTable","wasmfsOpfsDir"].forEach(m=>{typeof a[m]=="function"&&(a[m]=a[m]())}),delete globalThis.sqlite3ApiConfig,delete i.defaultConfig;const o=Object.create(null),h=Object.create(null),R=m=>o.sqlite3_js_rc_str&&o.sqlite3_js_rc_str(m)||"Unknown result code #"+m,j=m=>typeof m=="number"&&m===(m|0)&&m<=2147483647&&m>=-2147483648;class ce extends Error{constructor(...y){let I;if(y.length)if(j(y[0]))if(I=y[0],y.length===1)super(R(y[0]));else{const Z=R(I);typeof y[1]=="object"?super(Z,y[1]):(y[0]=Z+":",super(y.join(" ")))}else y.length===2&&typeof y[1]=="object"?super(...y):super(y.join(" "));this.resultCode=I||o.SQLITE_ERROR,this.name="SQLite3Error"}}ce.toss=(...m)=>{throw new ce(...m)};const V=ce.toss;a.wasmfsOpfsDir&&!/^\/[^/]+$/.test(a.wasmfsOpfsDir)&&V("config.wasmfsOpfsDir must be falsy or in the form '/dir-name'.");const L=function m(y){return m._max||(m._max=BigInt("0x7fffffffffffffff"),m._min=~m._max),y>=m._min&&y<=m._max},D=m=>m>=-0x7fffffffn-1n&&m<=0x7fffffffn,C=function m(y){return m._min||(m._min=Number.MIN_SAFE_INTEGER,m._max=Number.MAX_SAFE_INTEGER),y>=m._min&&y<=m._max},$=m=>m&&m.constructor&&j(m.constructor.BYTES_PER_ELEMENT)?m:!1,le=m=>m&&(m instanceof Uint8Array||m instanceof Int8Array||m instanceof ArrayBuffer),J=m=>m&&(m instanceof Uint8Array||m instanceof Int8Array||m instanceof ArrayBuffer),S=m=>le(m)||V("Value is not of a supported TypedArray type."),k=function(m){return J(m)?h.typedArrayToString(m instanceof ArrayBuffer?new Uint8Array(m):m,0,m.length):Array.isArray(m)?m.join(""):(h.isPtr(m)&&(m=h.cstrToJs(m)),m)};class O extends Error{constructor(...y){y.length===2&&typeof y[1]=="object"?super(...y):y.length?super(y.join(" ")):super("Allocation failed."),this.resultCode=o.SQLITE_NOMEM,this.name="WasmAllocError"}}O.toss=(...m)=>{throw new O(...m)},Object.assign(o,{sqlite3_bind_blob:void 0,sqlite3_bind_text:void 0,sqlite3_create_function_v2:(m,y,I,Z,re,me,be,w,u)=>{},sqlite3_create_function:(m,y,I,Z,re,me,be,w)=>{},sqlite3_create_window_function:(m,y,I,Z,re,me,be,w,u,_)=>{},sqlite3_prepare_v3:(m,y,I,Z,re,me)=>{},sqlite3_prepare_v2:(m,y,I,Z,re)=>{},sqlite3_exec:(m,y,I,Z,re)=>{},sqlite3_randomness:(m,y)=>{}});const M={affirmBindableTypedArray:S,flexibleString:k,bigIntFits32:D,bigIntFits64:L,bigIntFitsDouble:C,isBindableTypedArray:le,isInt32:j,isSQLableTypedArray:J,isTypedArray:$,isUIThread:()=>globalThis.window===globalThis&&!!globalThis.document,toss:function(...m){throw new Error(m.join(" "))},toss3:V,typedArrayPart:h.typedArrayPart,affirmDbHeader:function(m){m instanceof ArrayBuffer&&(m=new Uint8Array(m));const y="SQLite format 3";y.length>m.byteLength&&V("Input does not contain an SQLite3 database header.");for(let I=0;I<y.length;++I)y.charCodeAt(I)!==m[I]&&V("Input does not contain an SQLite3 database header.")},affirmIsDb:function(m){m instanceof ArrayBuffer&&(m=new Uint8Array(m));const y=m.byteLength;(y<512||y%512!==0)&&V("Byte array size",y,"is invalid for an SQLite3 db."),M.affirmDbHeader(m)}};Object.assign(h,{pointerIR:a.wasmPtrIR,bigIntEnabled:!!a.bigIntEnabled,exports:a.exports||V("Missing API config.exports (WASM module exports)."),memory:a.memory||a.exports.memory||V("API config object requires a WebAssembly.Memory object","in either config.exports.memory (exported)","or config.memory (imported)."),functionTable:a.functionTable,alloc:void 0,realloc:void 0,dealloc:void 0}),h.allocFromTypedArray=function(m){m instanceof ArrayBuffer&&(m=new Uint8Array(m)),S(m);const y=h.heapForSize(m.constructor),I=h.alloc(m.byteLength||1);return y.set(m.byteLength?m:[0],Number(I)),I};{const m=a.allocExportName,y=a.deallocExportName,I=a.reallocExportName;for(const Z of[m,y,I])h.exports[Z]instanceof Function||V("Missing required exports[",Z,"] function.");h.alloc=function Z(re){return Z.impl(re)||O.toss("Failed to allocate",re," bytes.")},h.alloc.impl=h.exports[m],h.realloc=function Z(re,me){const be=Z.impl(h.ptr.coerce(re),me);return me?be||O.toss("Failed to reallocate",me," bytes."):h.ptr.null},h.realloc.impl=h.exports[I],h.dealloc=function Z(re){Z.impl(h.ptr.coerce(re))},h.dealloc.impl=h.exports[y]}h.compileOptionUsed=function m(y){if(arguments.length){if(Array.isArray(y)){const I=Object.create(null);return y.forEach(Z=>{I[Z]=o.sqlite3_compileoption_used(Z)}),I}else if(typeof y=="object")return Object.keys(y).forEach(I=>{y[I]=o.sqlite3_compileoption_used(I)}),y}else{if(m._result)return m._result;m._opt||(m._rx=/^([^=]+)=(.+)/,m._rxInt=/^-?\d+$/,m._opt=function(be,w){const u=m._rx.exec(be);w[0]=u?u[1]:be,w[1]=u?m._rxInt.test(u[2])?+u[2]:u[2]:!0});const I=Object.create(null),Z=[0,0];let re=0,me;for(;me=o.sqlite3_compileoption_get(re++);)m._opt(me,Z),I[Z[0]]=Z[1];return m._result=I}return typeof y=="string"?!!o.sqlite3_compileoption_used(y):!1},h.pstack=Object.assign(Object.create(null),{restore:h.exports.sqlite3__wasm_pstack_restore,alloc:function(m){return typeof m=="string"&&!(m=h.sizeofIR(m))&&O.toss("Invalid value for pstack.alloc(",arguments[0],")"),h.exports.sqlite3__wasm_pstack_alloc(m)||O.toss("Could not allocate",m,"bytes from the pstack.")},allocChunks:function(m,y){typeof y=="string"&&!(y=h.sizeofIR(y))&&O.toss("Invalid size value for allocChunks(",arguments[1],")");const I=h.pstack.alloc(m*y),Z=[I];let re=1,me=y;for(;re<m;++re,me+=y)Z.push(h.ptr.add(I,me));return Z},allocPtr:(m=1,y=!0)=>m===1?h.pstack.alloc(y?8:h.ptr.size):h.pstack.allocChunks(m,y?8:h.ptr.size),call:function(m){const y=h.pstack.pointer;try{return m(B)}finally{h.pstack.restore(y)}}}),Object.defineProperties(h.pstack,{pointer:{configurable:!1,iterable:!0,writeable:!1,get:h.exports.sqlite3__wasm_pstack_ptr},quota:{configurable:!1,iterable:!0,writeable:!1,get:h.exports.sqlite3__wasm_pstack_quota},remaining:{configurable:!1,iterable:!0,writeable:!1,get:h.exports.sqlite3__wasm_pstack_remaining}}),o.sqlite3_randomness=(...m)=>{if(m.length===1&&M.isTypedArray(m[0])&&m[0].BYTES_PER_ELEMENT===1){const y=m[0];if(y.byteLength===0)return h.exports.sqlite3_randomness(0,h.ptr.null),y;const I=h.pstack.pointer;try{let Z=y.byteLength,re=0;const me=h.exports.sqlite3_randomness,be=h.heap8u(),w=Z<512?Z:512,u=h.pstack.alloc(w);do{const _=Z>w?w:Z;me(_,u),y.set(h.typedArrayPart(be,u,h.ptr.add(u,_)),re),Z-=_,re+=_}while(Z>0)}catch(Z){a.error("Highly unexpected (and ignored!) exception in sqlite3_randomness():",Z)}finally{h.pstack.restore(I)}return y}h.exports.sqlite3_randomness(...m)};let F;if(o.sqlite3_wasmfs_opfs_dir=function(){if(F!==void 0)return F;const m=a.wasmfsOpfsDir;if(!m||!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle||!h.exports.sqlite3__wasm_init_wasmfs)return F="";try{return m&&h.xCallWrapped("sqlite3__wasm_init_wasmfs","i32",["string"],m)===0?F=m:F=""}catch{return F=""}},o.sqlite3_wasmfs_filename_is_persistent=function(m){const y=o.sqlite3_wasmfs_opfs_dir();return y&&m?m.startsWith(y+"/"):!1},o.sqlite3_js_db_uses_vfs=function(m,y,I=0){try{const Z=o.sqlite3_vfs_find(y);return Z?m?Z===o.sqlite3_js_db_vfs(m,I)?Z:!1:Z===o.sqlite3_vfs_find(0)?Z:!1:!1}catch{return!1}},o.sqlite3_js_vfs_list=function(){const m=[];let y=o.sqlite3_vfs_find(h.ptr.coerce(0));for(;y;){const I=new o.sqlite3_vfs(y);m.push(h.cstrToJs(I.$zName)),y=I.$pNext,I.dispose()}return m},o.sqlite3_js_db_export=function(m,y=0){m=h.xWrap.testConvertArg("sqlite3*",m),m||V("Invalid sqlite3* argument."),h.bigIntEnabled||V("BigInt support is not enabled.");const I=h.scopedAllocPush();let Z;try{const re=h.scopedAlloc(8+h.ptr.size),me=h.ptr.add(re,8),be=y?h.isPtr(y)?y:h.scopedAllocCString(""+y):h.ptr.null;let w=h.exports.sqlite3__wasm_db_serialize(m,be,me,re,0);w&&V("Database serialization failed with code",B.capi.sqlite3_js_rc_str(w)),Z=h.peekPtr(me);const u=h.peek(re,"i64");return w=u?h.heap8u().slice(Number(Z),Number(Z)+Number(u)):new Uint8Array,w}finally{Z&&h.exports.sqlite3_free(Z),h.scopedAllocPop(I)}},o.sqlite3_js_db_vfs=(m,y=0)=>M.sqlite3__wasm_db_vfs(m,y),o.sqlite3_js_aggregate_context=(m,y)=>o.sqlite3_aggregate_context(m,y)||(y?O.toss("Cannot allocate",y,"bytes for sqlite3_aggregate_context()"):0),o.sqlite3_js_posix_create_file=function(m,y,I){let Z;y&&h.isPtr(y)?Z=y:y instanceof ArrayBuffer||y instanceof Uint8Array?(Z=h.allocFromTypedArray(y),(arguments.length<3||!M.isInt32(I)||I<0)&&(I=y.byteLength)):ce.toss("Invalid 2nd argument for sqlite3_js_posix_create_file().");try{(!M.isInt32(I)||I<0)&&ce.toss("Invalid 3rd argument for sqlite3_js_posix_create_file().");const re=M.sqlite3__wasm_posix_create_file(m,Z,I);re&&ce.toss("Creation of file failed with sqlite3 result code",o.sqlite3_js_rc_str(re))}finally{Z&&Z!==y&&h.dealloc(Z)}},o.sqlite3_js_vfs_create_file=function(m,y,I,Z){a.warn("sqlite3_js_vfs_create_file() is deprecated and","should be avoided because it can lead to C-level crashes.","See its documentation for alternatives.");let re;I?h.isPtr(I)?re=I:(I instanceof ArrayBuffer&&(I=new Uint8Array(I)),I instanceof Uint8Array?(re=h.allocFromTypedArray(I),(arguments.length<4||!M.isInt32(Z)||Z<0)&&(Z=I.byteLength)):ce.toss("Invalid 3rd argument type for sqlite3_js_vfs_create_file().")):re=0,(!M.isInt32(Z)||Z<0)&&(re&&re!==I&&h.dealloc(re),ce.toss("Invalid 4th argument for sqlite3_js_vfs_create_file()."));try{const me=M.sqlite3__wasm_vfs_create_file(m,y,re,Z);me&&ce.toss("Creation of file failed with sqlite3 result code",o.sqlite3_js_rc_str(me))}finally{re&&re!==I&&h.dealloc(re)}},o.sqlite3_js_sql_to_string=m=>{if(typeof m=="string")return m;const y=k(v);return y===v?void 0:y},M.isUIThread()){const m=function(y){const I=Object.create(null);return I.prefix="kvvfs-"+y,I.stores=[],(y==="session"||y==="")&&I.stores.push(globalThis.sessionStorage),(y==="local"||y==="")&&I.stores.push(globalThis.localStorage),I};o.sqlite3_js_kvvfs_clear=function(y=""){let I=0;const Z=m(y);return Z.stores.forEach(re=>{const me=[];let be;for(be=0;be<re.length;++be){const w=re.key(be);w.startsWith(Z.prefix)&&me.push(w)}me.forEach(w=>re.removeItem(w)),I+=me.length}),I},o.sqlite3_js_kvvfs_size=function(y=""){let I=0;const Z=m(y);return Z.stores.forEach(re=>{let me;for(me=0;me<re.length;++me){const be=re.key(me);be.startsWith(Z.prefix)&&(I+=be.length,I+=re.getItem(be).length)}}),I*2}}o.sqlite3_db_config=(function(m,y,...I){switch(y){case o.SQLITE_DBCONFIG_ENABLE_FKEY:case o.SQLITE_DBCONFIG_ENABLE_TRIGGER:case o.SQLITE_DBCONFIG_ENABLE_FTS3_TOKENIZER:case o.SQLITE_DBCONFIG_ENABLE_LOAD_EXTENSION:case o.SQLITE_DBCONFIG_NO_CKPT_ON_CLOSE:case o.SQLITE_DBCONFIG_ENABLE_QPSG:case o.SQLITE_DBCONFIG_TRIGGER_EQP:case o.SQLITE_DBCONFIG_RESET_DATABASE:case o.SQLITE_DBCONFIG_DEFENSIVE:case o.SQLITE_DBCONFIG_WRITABLE_SCHEMA:case o.SQLITE_DBCONFIG_LEGACY_ALTER_TABLE:case o.SQLITE_DBCONFIG_DQS_DML:case o.SQLITE_DBCONFIG_DQS_DDL:case o.SQLITE_DBCONFIG_ENABLE_VIEW:case o.SQLITE_DBCONFIG_LEGACY_FILE_FORMAT:case o.SQLITE_DBCONFIG_TRUSTED_SCHEMA:case o.SQLITE_DBCONFIG_STMT_SCANSTATUS:case o.SQLITE_DBCONFIG_REVERSE_SCANORDER:case o.SQLITE_DBCONFIG_ENABLE_ATTACH_CREATE:case o.SQLITE_DBCONFIG_ENABLE_ATTACH_WRITE:case o.SQLITE_DBCONFIG_ENABLE_COMMENTS:return this.ip||(this.ip=h.xWrap("sqlite3__wasm_db_config_ip","int",["sqlite3*","int","int","*"])),this.ip(m,y,I[0],I[1]||0);case o.SQLITE_DBCONFIG_LOOKASIDE:return this.pii||(this.pii=h.xWrap("sqlite3__wasm_db_config_pii","int",["sqlite3*","int","*","int","int"])),this.pii(m,y,I[0],I[1],I[2]);case o.SQLITE_DBCONFIG_MAINDBNAME:return this.s||(this.s=h.xWrap("sqlite3__wasm_db_config_s","int",["sqlite3*","int","string:static"])),this.s(m,y,I[0]);default:return o.SQLITE_MISUSE}}).bind(Object.create(null)),o.sqlite3_value_to_js=function(m,y=!0){let I;const Z=o.sqlite3_value_type(m);switch(Z){case o.SQLITE_INTEGER:h.bigIntEnabled?(I=o.sqlite3_value_int64(m),M.bigIntFitsDouble(I)&&(I=Number(I))):I=o.sqlite3_value_double(m);break;case o.SQLITE_FLOAT:I=o.sqlite3_value_double(m);break;case o.SQLITE_TEXT:I=o.sqlite3_value_text(m);break;case o.SQLITE_BLOB:{const re=o.sqlite3_value_bytes(m),me=o.sqlite3_value_blob(m);re&&!me&&B.WasmAllocError.toss("Cannot allocate memory for blob argument of",re,"byte(s)"),I=re?h.heap8u().slice(Number(me),Number(me)+Number(re)):null;break}case o.SQLITE_NULL:I=null;break;default:y&&V(o.SQLITE_MISMATCH,"Unhandled sqlite3_value_type():",Z),I=void 0}return I},o.sqlite3_values_to_js=function(m,y,I=!0){let Z;const re=[];for(Z=0;Z<m;++Z)re.push(o.sqlite3_value_to_js(h.peekPtr(h.ptr.add(y,h.ptr.size*Z)),I));return re},o.sqlite3_result_error_js=function(m,y){y instanceof O?o.sqlite3_result_error_nomem(m):o.sqlite3_result_error(m,""+y,-1)},o.sqlite3_result_js=function(m,y){if(y instanceof Error){o.sqlite3_result_error_js(m,y);return}try{switch(typeof y){case"undefined":break;case"boolean":o.sqlite3_result_int(m,y?1:0);break;case"bigint":M.bigIntFits32(y)?o.sqlite3_result_int(m,Number(y)):M.bigIntFitsDouble(y)?o.sqlite3_result_double(m,Number(y)):h.bigIntEnabled?M.bigIntFits64(y)?o.sqlite3_result_int64(m,y):V("BigInt value",y.toString(),"is too BigInt for int64."):V("BigInt value",y.toString(),"is too BigInt.");break;case"number":{let I;M.isInt32(y)?I=o.sqlite3_result_int:h.bigIntEnabled&&Number.isInteger(y)&&M.bigIntFits64(BigInt(y))?I=o.sqlite3_result_int64:I=o.sqlite3_result_double,I(m,y);break}case"string":{const[I,Z]=h.allocCString(y,!0);o.sqlite3_result_text(m,I,Z,o.SQLITE_WASM_DEALLOC);break}case"object":if(y===null){o.sqlite3_result_null(m);break}else if(M.isBindableTypedArray(y)){const I=h.allocFromTypedArray(y);o.sqlite3_result_blob(m,I,y.byteLength,o.SQLITE_WASM_DEALLOC);break}default:V("Don't not how to handle this UDF result value:",typeof y,y)}}catch(I){o.sqlite3_result_error_js(m,I)}},o.sqlite3_column_js=function(m,y,I=!0){const Z=o.sqlite3_column_value(m,y);return Z===0?void 0:o.sqlite3_value_to_js(Z,I)};const P=(function(m,y,I){I=o[I],this.ptr?h.pokePtr(this.ptr,0):this.ptr=h.allocPtr();const Z=I(m,y,this.ptr);if(Z)return ce.toss(Z,arguments[2]+"() failed with code "+Z);const re=h.peekPtr(this.ptr);return re?o.sqlite3_value_to_js(re,!0):void 0}).bind(Object.create(null));o.sqlite3_preupdate_new_js=(m,y)=>P(m,y,"sqlite3_preupdate_new"),o.sqlite3_preupdate_old_js=(m,y)=>P(m,y,"sqlite3_preupdate_old"),o.sqlite3changeset_new_js=(m,y)=>P(m,y,"sqlite3changeset_new"),o.sqlite3changeset_old_js=(m,y)=>P(m,y,"sqlite3changeset_old");const B={WasmAllocError:O,SQLite3Error:ce,capi:o,util:M,wasm:h,config:a,version:Object.create(null),client:void 0,asyncPostInit:async function m(){if(m.isReady instanceof Promise)return m.isReady;let y=i.initializersAsync;delete i.initializersAsync;const I=async()=>(B.__isUnderTest||(delete B.util,delete B.StructBinder),B),Z=me=>{throw a.error("an async sqlite3 initializer failed:",me),me};if(!y||!y.length)return m.isReady=I().catch(Z);y=y.map(me=>me instanceof Function?async be=>me(B):me),y.push(I);let re=Promise.resolve(B);for(;y.length;)re=re.then(y.shift());return m.isReady=re.catch(Z)},scriptInfo:void 0};try{i.initializers.forEach(m=>{m(B)})}catch(m){throw console.error("sqlite3 bootstrap initializer threw:",m),m}if(delete i.initializers,i.sqlite3=B,delete globalThis.sqlite3ApiBootstrap,delete globalThis.sqlite3ApiConfig,n.debugModule("sqlite3ApiBootstrap() complete",B),B.scriptInfo=n,B.__isUnderTest=c){B.config.emscripten=s;const m=n.instantiateWasm;m&&(B.wasm.module=m.module,B.wasm.instance=m.instance,B.wasm.imports=m.imports)}return B.asyncPostInit().then(m=>(n.debugModule("sqlite3.asyncPostInit() complete",B),delete m.asyncPostInit,delete m.scriptInfo,delete m.emscripten,m))},globalThis.sqlite3ApiBootstrap.initializers=[],globalThis.sqlite3ApiBootstrap.initializersAsync=[],globalThis.sqlite3ApiBootstrap.defaultConfig=Object.create(null),globalThis.sqlite3ApiBootstrap.sqlite3=void 0,globalThis.WhWasmUtilInstaller=function(i){i.bigIntEnabled===void 0&&(i.bigIntEnabled=!!globalThis.BigInt64Array);const p=(...u)=>{throw new Error(u.join(" "))};i.pointerSize&&!i.pointerIR&&(i.pointerIR=i.pointerSize===4?"i32":"i64");const a=i.pointerIR??(i.pointerIR="i32"),o=i.pointerSize??(i.pointerSize=a==="i32"?4:a==="i64"?8:0);delete i.pointerSize,delete i.pointerIR,a!=="i32"&&a!=="i64"?p("Invalid pointerIR:",a):o!==8&&o!==4&&p("Invalid pointerSize:",o);const h=i.bigIntEnabled?u=>BigInt(u||0):u=>p("BigInt support is disabled in this build."),j=o===4?u=>Number(u||0):h,ce=j(0),V=function(...u){let _=j(0);for(const b of u)_+=j(b);return _};{const u=Object.create(null);Object.defineProperty(i,"ptr",{enumerable:!0,get:()=>u,set:()=>p("The ptr property is read-only.")}),function _(b,E){return Object.defineProperty(u,b,{enumerable:!0,get:()=>E,set:()=>p("ptr["+b+"] is read-only.")}),_}("null",ce)("size",o)("ir",a)("coerce",j)("add",V)("addn",a===4?V:(..._)=>Number(V(..._)))}i.exports||Object.defineProperty(i,"exports",{enumerable:!0,configurable:!0,get:()=>{var u;return(u=i.instance)==null?void 0:u.exports}});const L=Object.create(null);L.heapSize=0,L.memory=null,L.freeFuncIndexes=[],L.scopedAlloc=[],L.scopedAlloc.pushPtr=u=>(L.scopedAlloc[L.scopedAlloc.length-1].push(u),u),L.utf8Decoder=new TextDecoder,L.utf8Encoder=new TextEncoder("utf-8"),i.sizeofIR=u=>{switch(u){case"i8":return 1;case"i16":return 2;case"i32":case"f32":case"float":return 4;case"i64":case"f64":case"double":return 8;case"*":return o;default:return(""+u).endsWith("*")?o:void 0}};const D=function(){if(!L.memory)L.memory=i.memory instanceof WebAssembly.Memory?i.memory:i.exports.memory;else if(L.heapSize===L.memory.buffer.byteLength)return L;const u=L.memory.buffer;return L.HEAP8=new Int8Array(u),L.HEAP8U=new Uint8Array(u),L.HEAP16=new Int16Array(u),L.HEAP16U=new Uint16Array(u),L.HEAP32=new Int32Array(u),L.HEAP32U=new Uint32Array(u),L.HEAP32F=new Float32Array(u),L.HEAP64F=new Float64Array(u),i.bigIntEnabled&&(typeof BigInt64Array<"u"?(L.HEAP64=new BigInt64Array(u),L.HEAP64U=new BigUint64Array(u)):p("BigInt support is enabled, but the BigInt64Array type is missing.")),L.heapSize=u.byteLength,L};i.heap8=()=>D().HEAP8,i.heap8u=()=>D().HEAP8U,i.heap16=()=>D().HEAP16,i.heap16u=()=>D().HEAP16U,i.heap32=()=>D().HEAP32,i.heap32u=()=>D().HEAP32U,i.heapForSize=function(u,_=!0){const b=L.memory&&L.heapSize===L.memory.buffer.byteLength?L:D();switch(u){case Int8Array:return b.HEAP8;case Uint8Array:return b.HEAP8U;case Int16Array:return b.HEAP16;case Uint16Array:return b.HEAP16U;case Int32Array:return b.HEAP32;case Uint32Array:return b.HEAP32U;case 8:return _?b.HEAP8U:b.HEAP8;case 16:return _?b.HEAP16U:b.HEAP16;case 32:return _?b.HEAP32U:b.HEAP32;case 64:if(b.HEAP64)return _?b.HEAP64U:b.HEAP64;break;default:if(i.bigIntEnabled){if(u===globalThis.BigUint64Array)return b.HEAP64U;if(u===globalThis.BigInt64Array)return b.HEAP64;break}}p("Invalid heapForSize() size: expecting 8, 16, 32,","or (if BigInt is enabled) 64.")};const C=i.functionTable;delete i.functionTable,i.functionTable=C?()=>C:()=>i.exports.__indirect_function_table,i.functionEntry=function(u){const _=i.functionTable();return u<_.length?_.get(j(u)):void 0},i.jsFuncToWasm=function u(_,b){if(u._||(u._={sigTypes:Object.assign(Object.create(null),{i:"i32",p:a,P:a,s:a,j:"i64",f:"f32",d:"f64"}),typeCodes:Object.assign(Object.create(null),{f64:124,f32:125,i64:126,i32:127}),uleb128Encode:(he,se,Ee)=>{Ee<128?he[se](Ee):he[se](Ee%128|128,Ee>>7)},rxJSig:/^(\w)\((\w*)\)$/,sigParams:he=>{const se=u._.rxJSig.exec(he);return se?se[2]:he.substr(1)},letterType:he=>u._.sigTypes[he]||p("Invalid signature letter:",he),pushSigType:(he,se)=>he.push(u._.typeCodes[u._.letterType(se)])}),typeof _=="string"){const he=b;b=_,_=he}const E=u._,H=E.sigParams(b),te=[1,96];E.uleb128Encode(te,"push",H.length);for(const he of H)E.pushSigType(te,he);return b[0]==="v"?te.push(0):(te.push(1),E.pushSigType(te,b[0])),E.uleb128Encode(te,"unshift",te.length),te.unshift(0,97,115,109,1,0,0,0,1),te.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array(te)),{e:{f:_}}).exports.f};const $=function(_,b,E){if(E&&!L.scopedAlloc.length&&p("No scopedAllocPush() scope is active."),typeof _=="string"){const se=b;b=_,_=se}(typeof b!="string"||!(_ instanceof Function))&&p("Invalid arguments: expecting (function,signature) or (signature,function).");const H=i.functionTable(),te=j(H.length);let he;for(;L.freeFuncIndexes.length&&(he=L.freeFuncIndexes.pop(),H.get(he));){he=null;continue}he||(he=j(te),H.grow(j(1)));try{return H.set(he,_),E&&L.scopedAlloc.pushPtr(he),he}catch(se){if(!(se instanceof TypeError))throw he===te&&L.freeFuncIndexes.push(te),se}try{const se=i.jsFuncToWasm(_,b);H.set(he,se),E&&L.scopedAlloc.pushPtr(he)}catch(se){throw he===te&&L.freeFuncIndexes.push(te),se}return he};i.installFunction=(u,_)=>$(u,_,!1),i.scopedInstallFunction=(u,_)=>$(u,_,!0),i.uninstallFunction=function(u){if(!u&&u!==0)return;const _=L.freeFuncIndexes,b=i.functionTable();_.push(u);const E=b.get(u);return b.set(u,null),E},i.peek=function(_,b="i8"){b.endsWith("*")&&(b=a);const E=L.memory&&L.heapSize===L.memory.buffer.byteLength?L:D(),H=Array.isArray(_)?[]:void 0;let te;do{switch(H&&(_=arguments[0].shift()),b){case"i1":case"i8":te=E.HEAP8[Number(_)>>0];break;case"i16":te=E.HEAP16[Number(_)>>1];break;case"i32":te=E.HEAP32[Number(_)>>2];break;case"float":case"f32":te=E.HEAP32F[Number(_)>>2];break;case"double":case"f64":te=Number(E.HEAP64F[Number(_)>>3]);break;case"i64":if(E.HEAP64){te=h(E.HEAP64[Number(_)>>3]);break}default:p("Invalid type for peek():",b)}H&&H.push(te)}while(H&&arguments[0].length);return H||te},i.poke=function(u,_,b="i8"){b.endsWith("*")&&(b=a);const E=L.memory&&L.heapSize===L.memory.buffer.byteLength?L:D();for(const H of Array.isArray(u)?u:[u])switch(b){case"i1":case"i8":E.HEAP8[Number(H)>>0]=_;continue;case"i16":E.HEAP16[Number(H)>>1]=_;continue;case"i32":E.HEAP32[Number(H)>>2]=_;continue;case"float":case"f32":E.HEAP32F[Number(H)>>2]=_;continue;case"double":case"f64":E.HEAP64F[Number(H)>>3]=_;continue;case"i64":if(E.HEAP64){E.HEAP64[Number(H)>>3]=h(_);continue}default:p("Invalid type for poke(): "+b)}return this},i.peekPtr=(...u)=>i.peek(u.length===1?u[0]:u,a),i.pokePtr=(u,_=0)=>i.poke(u,_,a),i.peek8=(...u)=>i.peek(u.length===1?u[0]:u,"i8"),i.poke8=(u,_)=>i.poke(u,_,"i8"),i.peek16=(...u)=>i.peek(u.length===1?u[0]:u,"i16"),i.poke16=(u,_)=>i.poke(u,_,"i16"),i.peek32=(...u)=>i.peek(u.length===1?u[0]:u,"i32"),i.poke32=(u,_)=>i.poke(u,_,"i32"),i.peek64=(...u)=>i.peek(u.length===1?u[0]:u,"i64"),i.poke64=(u,_)=>i.poke(u,_,"i64"),i.peek32f=(...u)=>i.peek(u.length===1?u[0]:u,"f32"),i.poke32f=(u,_)=>i.poke(u,_,"f32"),i.peek64f=(...u)=>i.peek(u.length===1?u[0]:u,"f64"),i.poke64f=(u,_)=>i.poke(u,_,"f64"),i.getMemValue=i.peek,i.getPtrValue=i.peekPtr,i.setMemValue=i.poke,i.setPtrValue=i.pokePtr,i.isPtr32=u=>typeof u=="number"&&u>=0&&u===(u|0),i.isPtr64=u=>typeof u=="bigint"?u>=0:i.isPtr32(u),i.isPtr=o===4?i.isPtr32:i.isPtr64,i.cstrlen=function(u){if(!u||!i.isPtr(u))return null;u=Number(u);const _=D().HEAP8U;let b=u;for(;_[b]!==0;++b);return Number(b-u)};const le=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,J=u=>u.buffer instanceof le;i.isSharedTypedArray=J;const S=(u,_,b)=>(o===8&&(typeof _=="bigint"&&(_=Number(_)),typeof b=="bigint"&&(b=Number(b))),J(u)?u.slice(_,b):u.subarray(_,b));i.typedArrayPart=S;const k=(u,_,b)=>L.utf8Decoder.decode(S(u,_,b));i.typedArrayToString=k,i.cstrToJs=function(u){const _=i.cstrlen(u);return _?k(D().HEAP8U,Number(u),Number(u)+_):_===null?_:""},i.jstrlen=function(u){if(typeof u!="string")return null;const _=u.length;let b=0;for(let E=0;E<_;++E){let H=u.charCodeAt(E);H>=55296&&H<=57343&&(H=65536+((H&1023)<<10)|u.charCodeAt(++E)&1023),H<=127?++b:H<=2047?b+=2:H<=65535?b+=3:b+=4}return b},i.jstrcpy=function(u,_,b=0,E=-1,H=!0){if((!_||!(_ instanceof Int8Array)&&!(_ instanceof Uint8Array))&&p("jstrcpy() target must be an Int8Array or Uint8Array."),E=Number(E),b=Number(b),E<0&&(E=_.length-b),!(E>0)||!(b>=0))return 0;let te=0,he=u.length;const se=b,Ee=b+E-(H?1:0);for(;te<he&&b<Ee;++te){let ye=u.charCodeAt(te);if(ye>=55296&&ye<=57343&&(ye=65536+((ye&1023)<<10)|u.charCodeAt(++te)&1023),ye<=127){if(b>=Ee)break;_[b++]=ye}else if(ye<=2047){if(b+1>=Ee)break;_[b++]=192|ye>>6,_[b++]=128|ye&63}else if(ye<=65535){if(b+2>=Ee)break;_[b++]=224|ye>>12,_[b++]=128|ye>>6&63,_[b++]=128|ye&63}else{if(b+3>=Ee)break;_[b++]=240|ye>>18,_[b++]=128|ye>>12&63,_[b++]=128|ye>>6&63,_[b++]=128|ye&63}}return H&&(_[b++]=0),b-se},i.cstrncpy=function(u,_,b){if((!u||!_)&&p("cstrncpy() does not accept NULL strings."),b<0)b=i.cstrlen(strPtr)+1;else if(!(b>0))return 0;const E=i.heap8u();let H=0,te;const he=Number(u),se=Number(_);for(;H<b&&(te=E[se+H]);++H)E[he+H]=te;return H<b&&(E[he+H++]=0),H},i.jstrToUintArray=(u,_=!1)=>L.utf8Encoder.encode(_?u+"\0":u);const O=(u,_)=>{(!(u.alloc instanceof Function)||!(u.dealloc instanceof Function))&&p("Object is missing alloc() and/or dealloc() function(s)","required by",_+"().")},M=function(u,_,b,E){if(O(i,E),typeof u!="string")return null;const H=L.utf8Encoder.encode(u),te=b(H.length+1);let he=te;try{const se=D().HEAP8U;return se.set(H,Number(te)),se[V(te,H.length)]=0,he=ce,_?[te,H.length]:te}finally{he&&i.dealloc(he)}};i.allocCString=(u,_=!1)=>M(u,_,i.alloc,"allocCString()"),i.scopedAllocPush=function(){O(i,"scopedAllocPush");const u=[];return L.scopedAlloc.push(u),u},i.scopedAllocPop=function(u){O(i,"scopedAllocPop");const _=arguments.length?L.scopedAlloc.indexOf(u):L.scopedAlloc.length-1;_<0&&p("Invalid state object for scopedAllocPop()."),arguments.length===0&&(u=L.scopedAlloc[_]),L.scopedAlloc.splice(_,1);for(let b;b=u.pop();)i.functionEntry(b)?i.uninstallFunction(b):i.dealloc(b)},i.scopedAlloc=function(u){L.scopedAlloc.length||p("No scopedAllocPush() scope is active.");const _=j(i.alloc(u));return L.scopedAlloc.pushPtr(_)},Object.defineProperty(i.scopedAlloc,"level",{configurable:!1,enumerable:!1,get:()=>L.scopedAlloc.length,set:()=>p("The 'active' property is read-only.")}),i.scopedAllocCString=(u,_=!1)=>M(u,_,i.scopedAlloc,"scopedAllocCString()");const F=function(u,_){const b=i[u?"scopedAlloc":"alloc"]((_.length+1)*i.ptr.size);let E=0;return _.forEach(H=>{i.pokePtr(V(b,i.ptr.size*E++),i[u?"scopedAllocCString":"allocCString"](""+H))}),i.pokePtr(V(b,i.ptr.size*E),0),b};i.scopedAllocMainArgv=u=>F(!0,u),i.allocMainArgv=u=>F(!1,u),i.cArgvToJs=(u,_)=>{const b=[];for(let E=0;E<u;++E){const H=i.peekPtr(V(_,i.ptr.size*E));b.push(H?i.cstrToJs(H):null)}return b},i.scopedAllocCall=function(u){i.scopedAllocPush();try{return u()}finally{i.scopedAllocPop()}};const P=function(u,_,b){O(i,b);const E=_?"i64":a;let H=i[b](u*(_?8:o));if(i.poke(H,0,E),u===1)return H;const te=[H];for(let he=1;he<u;++he)H=V(H,_?8:o),te[he]=H,i.poke(H,0,E);return te};i.allocPtr=(u=1,_=!0)=>P(u,_,"alloc"),i.scopedAllocPtr=(u=1,_=!0)=>P(u,_,"scopedAlloc"),i.xGet=function(u){return i.exports[u]||p("Cannot find exported symbol:",u)};const B=(u,_)=>p(u+"() requires",_,"argument(s).");i.xCall=function(u,..._){const b=u instanceof Function?u:i.xGet(u);return b instanceof Function||p("Exported symbol",u,"is not a function."),b.length!==_.length&&B(b===u?b.name:u,b.length),arguments.length===2&&Array.isArray(arguments[1])?b.apply(null,arguments[1]):b.apply(null,_)},L.xWrap=Object.create(null),L.xWrap.convert=Object.create(null),L.xWrap.convert.arg=new Map,L.xWrap.convert.result=new Map;const m=L.xWrap.convert.arg,y=L.xWrap.convert.result,I=j;m.set("i64",h).set("i32",u=>u|0).set("i16",u=>(u|0)&65535).set("i8",u=>(u|0)&255).set("f32",u=>Number(u).valueOf()).set("float",m.get("f32")).set("f64",m.get("f32")).set("double",m.get("f64")).set("int",m.get("i32")).set("null",u=>u).set(null,m.get("null")).set("**",I).set("*",I),y.set("*",I).set("pointer",I).set("number",u=>Number(u)).set("void",u=>{}).set(void 0,y.get("void")).set("null",u=>u).set(null,y.get("null"));for(const u of["i8","i16","i32","i64","int","f32","float","f64","double"])m.set(u+"*",I),y.set(u+"*",I),y.set(u,m.get(u)||p("Maintenance required: missing arg converter for",u));const Z=u=>typeof u=="string"?i.scopedAllocCString(u):j(u);m.set("string",Z).set("utf8",Z),y.set("string",u=>i.cstrToJs(u)).set("utf8",y.get("string")).set("string:dealloc",u=>{try{return u?i.cstrToJs(u):null}finally{i.dealloc(u)}}).set("utf8:dealloc",y.get("string:dealloc")).set("json",u=>JSON.parse(i.cstrToJs(u))).set("json:dealloc",u=>{try{return u?JSON.parse(i.cstrToJs(u)):null}finally{i.dealloc(u)}});const re=class{constructor(u){this.name=u.name||"unnamed adapter"}convertArg(u,_,b){p("AbstractArgAdapter must be subclassed.")}};m.FuncPtrAdapter=class mt extends re{constructor(_){super(_),m.FuncPtrAdapter.warnOnUse&&console.warn("xArg.FuncPtrAdapter is an internal-only API","and is not intended to be invoked from","client-level code. Invoked with:",_),this.name=_.name||"unnamed",this.signature=_.signature,_.contextKey instanceof Function&&(this.contextKey=_.contextKey,_.bindScope||(_.bindScope="context")),this.bindScope=_.bindScope||p("FuncPtrAdapter options requires a bindScope (explicit or implied)."),mt.bindScopes.indexOf(_.bindScope)<0&&p("Invalid options.bindScope ("+_.bindMod+") for FuncPtrAdapter. Expecting one of: ("+mt.bindScopes.join(", ")+")"),this.isTransient=this.bindScope==="transient",this.isContext=this.bindScope==="context",this.isPermanent=this.bindScope==="permanent",this.singleton=this.bindScope==="singleton"?[]:void 0,this.callProxy=_.callProxy instanceof Function?_.callProxy:void 0}contextKey(_,b){return this}contextMap(_){const b=this.__cmap||(this.__cmap=new Map);let E=b.get(_);return E===void 0&&b.set(_,E=[]),E}convertArg(_,b,E){let H=this.singleton;if(!H&&this.isContext&&(H=this.contextMap(this.contextKey(b,E))),H&&H.length===2&&H[0]===_)return H[1];if(_ instanceof Function){this.callProxy&&(_=this.callProxy(_));const te=$(_,this.signature,this.isTransient);if(mt.debugFuncInstall&&mt.debugOut("FuncPtrAdapter installed",this,this.contextKey(b,E),"@"+te,_),H){if(H[1]){mt.debugFuncInstall&&mt.debugOut("FuncPtrAdapter uninstalling",this,this.contextKey(b,E),"@"+H[1],_);try{L.scopedAlloc.pushPtr(H[1])}catch{}}H[0]=arguments[0]||ce,H[1]=te}return te}else if(i.isPtr(_)||_===null||_===void 0){if(H&&H[1]&&H[1]!==_){mt.debugFuncInstall&&mt.debugOut("FuncPtrAdapter uninstalling",this,this.contextKey(b,E),"@"+H[1],_);try{L.scopedAlloc.pushPtr(H[1])}catch{}H[0]=H[1]=_||ce}return _||ce}else throw new TypeError("Invalid FuncPtrAdapter argument type. Expecting a function pointer or a "+(this.name?this.name+" ":"")+"function matching signature "+this.signature+".")}},m.FuncPtrAdapter.warnOnUse=!1,m.FuncPtrAdapter.debugFuncInstall=!1,m.FuncPtrAdapter.debugOut=console.debug.bind(console),m.FuncPtrAdapter.bindScopes=["transient","context","singleton","permanent"];const me=u=>m.get(u)||p("Argument adapter not found:",u),be=u=>y.get(u)||p("Result adapter not found:",u);L.xWrap.convertArg=(u,..._)=>me(u)(..._),L.xWrap.convertArgNoCheck=(u,..._)=>m.get(u)(..._),L.xWrap.convertResult=(u,_)=>u===null?_:u?be(u)(_):void 0,L.xWrap.convertResultNoCheck=(u,_)=>u===null?_:u?y.get(u)(_):void 0,i.xWrap=function u(_,b,...E){arguments.length===3&&Array.isArray(arguments[2])&&(E=arguments[2]),i.isPtr(_)&&(_=i.functionEntry(_)||p("Function pointer not found in WASM function table."));const H=_ instanceof Function,te=H?_:i.xGet(_);if(H&&(_=te.name||"unnamed function"),E.length!==te.length&&B(_,te.length),te.length===0&&(b===null||b==="null"))return te;be(b);for(const se of E)se instanceof re?m.set(se,(...Ee)=>se.convertArg(...Ee)):me(se);const he=L.xWrap;return te.length===0?(...se)=>se.length?B(_,te.length):he.convertResult(b,te.call(null)):function(...se){se.length!==te.length&&B(_,te.length);const Ee=i.scopedAllocPush();try{let ye=0;for(u.debug&&console.debug("xWrap() preparing: resultType ",b,"xf",te,"argTypes",E,"args",se);ye<se.length;++ye)se[ye]=he.convertArgNoCheck(E[ye],se[ye],se,ye);return u.debug&&console.debug("xWrap() calling: resultType ",b,"xf",te,"argTypes",E,"args",se),he.convertResultNoCheck(b,te.apply(null,se))}finally{i.scopedAllocPop(Ee)}}};const w=function(u,_,b,E,H,te){if(typeof b=="string"){if(_===1)return te.get(b);if(_===2){if(E)E instanceof Function||p(H,"requires a function argument.");else return te.delete(b),u;return te.set(b,E),u}}p("Invalid arguments to",H)};return i.xWrap.resultAdapter=function u(_,b){return w(u,arguments.length,_,b,"resultAdapter()",y)},i.xWrap.argAdapter=function u(_,b){return w(u,arguments.length,_,b,"argAdapter()",m)},i.xWrap.FuncPtrAdapter=m.FuncPtrAdapter,i.xCallWrapped=function(u,_,b,...E){return Array.isArray(arguments[3])&&(E=arguments[3]),i.xWrap(u,_,b||[]).apply(null,E||[])},i.xWrap.testConvertArg=L.xWrap.convertArg,i.xWrap.testConvertResult=L.xWrap.convertResult,i},globalThis.WhWasmUtilInstaller.yawl=(function(i){const p=()=>fetch(i.uri,{credentials:"same-origin"}),a=this,o=function(R){var j,ce;if(i.wasmUtilTarget){const V=(...D)=>{throw new Error(D.join(" "))},L=i.wasmUtilTarget;if(L.module=R.module,L.instance=R.instance,L.instance.exports.memory||(L.memory=((ce=(j=i==null?void 0:i.imports)==null?void 0:j.env)==null?void 0:ce.memory)||V("Missing 'memory' object!")),!L.alloc&&R.instance.exports.malloc){const D=R.instance.exports;L.alloc=function(C){return D.malloc(C)||V("Allocation of",C,"bytes failed.")},L.dealloc=function(C){D.free(C)}}a(L)}return R.config=i,i.onload&&i.onload(R),R};return WebAssembly.instantiateStreaming?()=>WebAssembly.instantiateStreaming(p(),i.imports||{}).then(o):()=>p().then(R=>R.arrayBuffer()).then(R=>WebAssembly.instantiate(R,i.imports||{})).then(o)}).bind(globalThis.WhWasmUtilInstaller),globalThis.Jaccwabyt=function i(p){const a=(...N)=>{throw new Error(N.join(" "))};!(p.heap instanceof WebAssembly.Memory)&&!(p.heap instanceof Function)&&a("config.heap must be WebAssembly.Memory instance or a function."),["alloc","dealloc"].forEach(function(N){p[N]instanceof Function||a("Config option '"+N+"' must be a function.")});const o=p.heap,h=i,R=o||(()=>new Uint8Array(o.buffer)),j=p.alloc,ce=p.dealloc,V=p.log||console.debug.bind(console),L=p.memberPrefix||"",D=p.memberSuffix||"",C=globalThis.BigInt,$=globalThis.BigInt64Array,le=p.bigIntEnabled??!!$,J=p.pointerIR||p.ptrIR||"i32",S=p.ptrSize||(J==="i32"?4:8);J!=="i32"&&J!=="i64"&&a("Invalid pointer representation:",J),S!==4&&S!==8&&a("Invalid pointer size:",S);const k=le&&C?N=>C(N||0):N=>a("BigInt support is disabled in this build."),O=J=="i32"?Number:k,M=O(0),F=function(...N){let oe=M;for(let pe=0;pe<N.length;++pe)oe+=O(N[pe]);return oe};h.debugFlags||(h.__makeDebugFlags=function(N=null){N&&N.__flags&&(N=N.__flags);const oe=function pe(we){return arguments.length===0?pe.__flags:(we<0?(delete pe.__flags.getter,delete pe.__flags.setter,delete pe.__flags.alloc,delete pe.__flags.dealloc):(pe.__flags.getter=(1&we)!==0,pe.__flags.setter=(2&we)!==0,pe.__flags.alloc=(4&we)!==0,pe.__flags.dealloc=(8&we)!==0),pe._flags)};return Object.defineProperty(oe,"__flags",{iterable:!1,writable:!1,value:Object.create(N)}),N||oe(0),oe},h.debugFlags=h.__makeDebugFlags());const P=function(){const N=new ArrayBuffer(2);return new DataView(N).setInt16(0,256,!0),new Int16Array(N)[0]===256}(),B=N=>N[1]==="(",m=N=>N==="P",y=N=>B(N)?"p":N[0],I=function(N){switch(y(N)){case"c":case"C":return"i8";case"i":return"i32";case"p":case"P":case"s":return J;case"j":return"i64";case"f":return"float";case"d":return"double"}a("Unhandled signature IR:",N)},Z=$?()=>!0:()=>a("BigInt64Array is not available."),re=function(N){switch(y(N)){case"p":case"P":case"s":{switch(S){case 4:return"getInt32";case 8:return Z()&&"getBigInt64"}break}case"i":return"getInt32";case"c":return"getInt8";case"C":return"getUint8";case"j":return Z()&&"getBigInt64";case"f":return"getFloat32";case"d":return"getFloat64"}a("Unhandled DataView getter for signature:",N)},me=function(N){switch(y(N)){case"p":case"P":case"s":{switch(S){case 4:return"setInt32";case 8:return Z()&&"setBigInt64"}break}case"i":return"setInt32";case"c":return"setInt8";case"C":return"setUint8";case"j":return Z()&&"setBigInt64";case"f":return"setFloat32";case"d":return"setFloat64"}a("Unhandled DataView setter for signature:",N)},be=function(N){switch(y(N)){case"i":case"f":case"c":case"C":case"d":return Number;case"j":return k;case"p":case"P":case"s":switch(S){case 4:return Number;case 8:return k}break}a("Unhandled DataView set wrapper for signature:",N)},w=(N,oe)=>N+"::"+oe,u=function(N,oe){return()=>a(w(N,oe),"is read-only.")},_=new WeakMap,b="(pointer-is-external)",E=N=>typeof N=="number"&&N===(N|0)&&N>=0,te=S===4?E:N=>typeof N=="bigint"&&N>=0||E(N),he=function(N,oe,pe){if(pe||(pe=_.get(oe)),pe){if(_.delete(oe),Array.isArray(oe.ondispose)){let we;for(;we=oe.ondispose.shift();)try{we instanceof Function?we.call(oe):we instanceof fe?we.dispose():te(we)&&ce(we)}catch($e){console.warn("ondispose() for",N.structName,"@",pe,"threw. NOT propagating it.",$e)}}else if(oe.ondispose instanceof Function)try{oe.ondispose()}catch(we){console.warn("ondispose() for",N.structName,"@",pe,"threw. NOT propagating it.",we)}delete oe.ondispose,N.debugFlags.__flags.dealloc&&V("debug.dealloc:",oe[b]?"EXTERNAL":"",N.structName,"instance:",N.structInfo.sizeof,"bytes @"+pe),oe[b]||ce(pe)}},se=N=>({configurable:!1,writable:!1,iterable:!1,value:N}),Ee=function(N,oe,pe){let we=!pe;pe?Object.defineProperty(oe,b,se(pe)):(pe=j(N.structInfo.sizeof),pe||a("Allocation of",N.structName,"structure failed."));try{N.debugFlags.__flags.alloc&&V("debug.alloc:",we?"":"EXTERNAL",N.structName,"instance:",N.structInfo.sizeof,"bytes @"+pe),we&&R().fill(0,Number(pe),Number(pe)+N.structInfo.sizeof),_.set(oe,pe)}catch($e){throw he(N,oe,pe),$e}},ye=function(){const N=this.pointer;return N?new Uint8Array(R().slice(Number(N),Number(N)+this.structInfo.sizeof)):null},xe=se(N=>L+N+D),ze=function(N,oe,pe=!0){let we=N.members[oe];if(!we&&(L||D)){for(const $e of Object.values(N.members))if($e.key===oe){we=$e;break}!we&&pe&&a(w(N.name,oe),"is not a mapped struct member.")}return we},et=function N(oe,pe,we=!1){N._||(N._=tt=>tt.replace(/[^vipPsjrdcC]/g,"").replace(/[pPscC]/g,"i"));const $e=ze(oe.structInfo,pe,!0);return we?N._($e.signature):$e.signature},x={configurable:!1,enumerable:!1,get:function(){return _.get(this)},set:()=>a("Cannot assign the 'pointer' property of a struct.")},K=se(function(){const N=[];for(const oe of Object.keys(this.structInfo.members))N.push(this.memberKey(oe));return N}),Y=new TextDecoder("utf-8"),_e=new TextEncoder,ue=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,Se=function(N,oe,pe){return S===8&&(oe=Number(oe),pe=Number(pe)),Y.decode(N.buffer instanceof ue?N.slice(oe,pe):N.subarray(oe,pe))},ve=function(N,oe,pe=!1){const we=ze(N.structInfo,oe,pe);return we&&we.signature.length===1&&we.signature[0]==="s"?we:!1},W=function(N){N.signature!=="s"&&a("Invalid member type signature for C-string value:",JSON.stringify(N))},A=function(oe,pe){const we=ze(oe.structInfo,pe,!0);W(we);const $e=oe[we.key];if(!$e)return null;let tt=$e;const nt=R();for(;nt[tt]!==0;++tt);return $e===tt?"":Se(nt,$e,tt)},U=function(N,...oe){N.ondispose?Array.isArray(N.ondispose)||(N.ondispose=[N.ondispose]):N.ondispose=[],N.ondispose.push(...oe)},X=function(N){const oe=_e.encode(N),pe=j(oe.length+1);pe||a("Allocation error while duplicating string:",N);const we=R();return we.set(oe,Number(pe)),we[F(pe,oe.length)]=0,pe},ie=function(N,oe,pe){const we=ze(N.structInfo,oe,!0);W(we);const $e=X(pe);return N[we.key]=$e,U(N,$e),N},fe=function(oe,pe){arguments[2]!==se&&a("Do not call the StructType constructor","from client-level code."),Object.defineProperties(this,{structName:se(oe),structInfo:se(pe)})};fe.prototype=Object.create(null,{dispose:se(function(){he(this.constructor,this)}),lookupMember:se(function(N,oe=!0){return ze(this.structInfo,N,oe)}),memberToJsString:se(function(N){return A(this,N)}),memberIsString:se(function(N,oe=!0){return ve(this,N,oe)}),memberKey:xe,memberKeys:K,memberSignature:se(function(N,oe=!1){return et(this,N,oe)}),memoryDump:se(ye),pointer:x,setMemberCString:se(function(N,oe){return ie(this,N,oe)})}),Object.assign(fe.prototype,{addOnDispose:function(...N){return U(this,...N),this}}),Object.defineProperties(fe,{allocCString:se(X),isA:se(N=>N instanceof fe),hasExternalPointer:se(N=>N instanceof fe&&!!N[b]),memberKey:xe});const Ae=function N(oe,pe,we){if(!N._){N._={getters:{},setters:{},sw:{}};const ot=["i","c","C","p","P","s","f","d","v()"];le&&ot.push("j"),ot.forEach(function(pt){N._.getters[pt]=re(pt),N._.setters[pt]=me(pt),N._.sw[pt]=be(pt)});const ps=/^[ipPsjfdcC]$/,hs=/^[vipPsjfdcC]\([ipPsjfdcC]*\)$/;N.sigCheck=function(pt,ms,Jn,dn){Object.prototype.hasOwnProperty.call(pt,Jn)&&a(pt.structName,"already has a property named",Jn+"."),ps.test(dn)||hs.test(dn)||a("Malformed signature for",w(pt.structName,ms)+":",dn)}}const $e=oe.memberKey(pe);N.sigCheck(oe.prototype,pe,$e,we.signature),we.key=$e,we.name=pe;const tt=y(we.signature),nt=w(oe.prototype.structName,$e),Ge=oe.prototype.debugFlags.__flags,Be=Object.create(null);Be.configurable=!1,Be.enumerable=!1,Be.get=function(){Ge.getter&&V("debug.getter:",N._.getters[tt],"for",I(tt),nt,"@",this.pointer,"+",we.offset,"sz",we.sizeof);let ot=new DataView(R().buffer,Number(this.pointer)+we.offset,we.sizeof)[N._.getters[tt]](0,P);return Ge.getter&&V("debug.getter:",nt,"result =",ot),ot},we.readOnly?Be.set=u(oe.prototype.structName,$e):Be.set=function(ot){if(Ge.setter&&V("debug.setter:",N._.setters[tt],"for",I(tt),nt,"@",this.pointer,"+",we.offset,"sz",we.sizeof,ot),this.pointer||a("Cannot set struct property on disposed instance."),ot===null)ot=M;else for(;!te(ot);){if(m(we.signature)&&ot instanceof fe){ot=ot.pointer||M,Ge.setter&&V("debug.setter:",nt,"resolved to",ot);break}a("Invalid value for pointer-type",nt+".")}new DataView(R().buffer,Number(this.pointer)+we.offset,we.sizeof)[N._.setters[tt]](0,N._.sw[tt](ot),P)},Object.defineProperty(oe.prototype,$e,Be)},Re=function N(oe,pe){arguments.length===1?(pe=oe,oe=pe.name):pe.name||(pe.name=oe),oe||a("Struct name is required.");let we=!1;Object.keys(pe.members).forEach(Ge=>{const Be=pe.members[Ge];Be.sizeof?Be.sizeof===1?Be.signature==="c"||Be.signature==="C"||a("Unexpected sizeof==1 member",w(pe.name,Ge),"with signature",Be.signature):(Be.sizeof%4!==0&&(console.warn("Invalid struct member description =",Be,"from",pe),a(oe,"member",Ge,"sizeof is not aligned. sizeof="+Be.sizeof)),Be.offset%4!==0&&(console.warn("Invalid struct member description =",Be,"from",pe),a(oe,"member",Ge,"offset is not aligned. offset="+Be.offset))):a(oe,"member",Ge,"is missing sizeof."),(!we||we.offset<Be.offset)&&(we=Be)}),we?pe.sizeof<we.offset+we.sizeof&&a("Invalid struct config:",oe,"max member offset ("+we.offset+") ","extends past end of struct (sizeof="+pe.sizeof+")."):a("No member property descriptions found.");const $e=se(h.__makeDebugFlags(N.debugFlags)),tt=O(0),nt=function Ge(Be){Be=O(Be),this instanceof Ge?arguments.length?((Number.isNaN(Be)||Be<=tt)&&a("Invalid pointer value",arguments[0],"for",oe,"constructor."),Ee(Ge,this,Be)):Ee(Ge,this):a("The",oe,"constructor may only be called via 'new'.")};return Object.defineProperties(nt,{debugFlags:$e,isA:se(Ge=>Ge instanceof nt),memberKey:xe,memberKeys:K,methodInfoForKey:se(function(Ge){}),structInfo:se(pe),structName:se(oe)}),nt.prototype=new fe(oe,pe,se),Object.defineProperties(nt.prototype,{debugFlags:$e,constructor:se(nt)}),Object.keys(pe.members).forEach(Ge=>Ae(nt,Ge,pe.members[Ge])),nt};return Re.StructType=fe,Re.config=p,Re.allocCString=X,Re.debugFlags||(Re.debugFlags=h.__makeDebugFlags(h.debugFlags)),Re},globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const p=(...S)=>{throw new Error(S.join(" "))},a=i.capi,o=i.wasm,h=i.util;globalThis.WhWasmUtilInstaller(o),delete globalThis.WhWasmUtilInstaller;const R={core:[["sqlite3_aggregate_context","void*","sqlite3_context*","int"],["sqlite3_bind_double","int","sqlite3_stmt*","int","f64"],["sqlite3_bind_int","int","sqlite3_stmt*","int","int"],["sqlite3_bind_null",void 0,"sqlite3_stmt*","int"],["sqlite3_bind_parameter_count","int","sqlite3_stmt*"],["sqlite3_bind_parameter_index","int","sqlite3_stmt*","string"],["sqlite3_bind_parameter_name","string","sqlite3_stmt*","int"],["sqlite3_bind_pointer","int","sqlite3_stmt*","int","*","string:static","*"],["sqlite3_busy_handler","int",["sqlite3*",new o.xWrap.FuncPtrAdapter({signature:"i(pi)",contextKey:(S,k)=>S[0]}),"*"]],["sqlite3_busy_timeout","int","sqlite3*","int"],["sqlite3_changes","int","sqlite3*"],["sqlite3_clear_bindings","int","sqlite3_stmt*"],["sqlite3_collation_needed","int","sqlite3*","*","*"],["sqlite3_column_blob","*","sqlite3_stmt*","int"],["sqlite3_column_bytes","int","sqlite3_stmt*","int"],["sqlite3_column_count","int","sqlite3_stmt*"],["sqlite3_column_decltype","string","sqlite3_stmt*","int"],["sqlite3_column_double","f64","sqlite3_stmt*","int"],["sqlite3_column_int","int","sqlite3_stmt*","int"],["sqlite3_column_name","string","sqlite3_stmt*","int"],["sqlite3_column_text","string","sqlite3_stmt*","int"],["sqlite3_column_type","int","sqlite3_stmt*","int"],["sqlite3_column_value","sqlite3_value*","sqlite3_stmt*","int"],["sqlite3_commit_hook","void*",["sqlite3*",new o.xWrap.FuncPtrAdapter({name:"sqlite3_commit_hook",signature:"i(p)",contextKey:S=>S[0]}),"*"]],["sqlite3_compileoption_get","string","int"],["sqlite3_compileoption_used","int","string"],["sqlite3_complete","int","string:flexible"],["sqlite3_context_db_handle","sqlite3*","sqlite3_context*"],["sqlite3_data_count","int","sqlite3_stmt*"],["sqlite3_db_filename","string","sqlite3*","string"],["sqlite3_db_handle","sqlite3*","sqlite3_stmt*"],["sqlite3_db_name","string","sqlite3*","int"],["sqlite3_db_readonly","int","sqlite3*","string"],["sqlite3_db_status","int","sqlite3*","int","*","*","int"],["sqlite3_errcode","int","sqlite3*"],["sqlite3_errmsg","string","sqlite3*"],["sqlite3_error_offset","int","sqlite3*"],["sqlite3_errstr","string","int"],["sqlite3_exec","int",["sqlite3*","string:flexible",new o.xWrap.FuncPtrAdapter({signature:"i(pipp)",bindScope:"transient",callProxy:S=>{let k;return(O,M,F,P)=>{try{const B=o.cArgvToJs(M,F);return k||(k=o.cArgvToJs(M,P)),S(B,k)|0}catch(B){return B.resultCode||a.SQLITE_ERROR}}}}),"*","**"]],["sqlite3_expanded_sql","string","sqlite3_stmt*"],["sqlite3_extended_errcode","int","sqlite3*"],["sqlite3_extended_result_codes","int","sqlite3*","int"],["sqlite3_file_control","int","sqlite3*","string","int","*"],["sqlite3_finalize","int","sqlite3_stmt*"],["sqlite3_free",void 0,"*"],["sqlite3_get_autocommit","int","sqlite3*"],["sqlite3_get_auxdata","*","sqlite3_context*","int"],["sqlite3_initialize",void 0],["sqlite3_interrupt",void 0,"sqlite3*"],["sqlite3_is_interrupted","int","sqlite3*"],["sqlite3_keyword_count","int"],["sqlite3_keyword_name","int",["int","**","*"]],["sqlite3_keyword_check","int",["string","int"]],["sqlite3_libversion","string"],["sqlite3_libversion_number","int"],["sqlite3_limit","int",["sqlite3*","int","int"]],["sqlite3_malloc","*","int"],["sqlite3_open","int","string","*"],["sqlite3_open_v2","int","string","*","int","string"],["sqlite3_realloc","*","*","int"],["sqlite3_reset","int","sqlite3_stmt*"],["sqlite3_result_blob",void 0,"sqlite3_context*","*","int","*"],["sqlite3_result_double",void 0,"sqlite3_context*","f64"],["sqlite3_result_error",void 0,"sqlite3_context*","string","int"],["sqlite3_result_error_code",void 0,"sqlite3_context*","int"],["sqlite3_result_error_nomem",void 0,"sqlite3_context*"],["sqlite3_result_error_toobig",void 0,"sqlite3_context*"],["sqlite3_result_int",void 0,"sqlite3_context*","int"],["sqlite3_result_null",void 0,"sqlite3_context*"],["sqlite3_result_pointer",void 0,"sqlite3_context*","*","string:static","*"],["sqlite3_result_subtype",void 0,"sqlite3_value*","int"],["sqlite3_result_text",void 0,"sqlite3_context*","string","int","*"],["sqlite3_result_zeroblob",void 0,"sqlite3_context*","int"],["sqlite3_rollback_hook","void*",["sqlite3*",new o.xWrap.FuncPtrAdapter({name:"sqlite3_rollback_hook",signature:"v(p)",contextKey:S=>S[0]}),"*"]],["sqlite3_set_auxdata",void 0,["sqlite3_context*","int","*","*"]],["sqlite3_set_errmsg","int","sqlite3*","int","string"],["sqlite3_shutdown",void 0],["sqlite3_sourceid","string"],["sqlite3_sql","string","sqlite3_stmt*"],["sqlite3_status","int","int","*","*","int"],["sqlite3_step","int","sqlite3_stmt*"],["sqlite3_stmt_busy","int","sqlite3_stmt*"],["sqlite3_stmt_readonly","int","sqlite3_stmt*"],["sqlite3_stmt_status","int","sqlite3_stmt*","int","int"],["sqlite3_strglob","int","string","string"],["sqlite3_stricmp","int","string","string"],["sqlite3_strlike","int","string","string","int"],["sqlite3_strnicmp","int","string","string","int"],["sqlite3_table_column_metadata","int","sqlite3*","string","string","string","**","**","*","*","*"],["sqlite3_total_changes","int","sqlite3*"],["sqlite3_trace_v2","int",["sqlite3*","int",new o.xWrap.FuncPtrAdapter({name:"sqlite3_trace_v2::callback",signature:"i(ippp)",contextKey:(S,k)=>S[0]}),"*"]],["sqlite3_txn_state","int",["sqlite3*","string"]],["sqlite3_uri_boolean","int","sqlite3_filename","string","int"],["sqlite3_uri_key","string","sqlite3_filename","int"],["sqlite3_uri_parameter","string","sqlite3_filename","string"],["sqlite3_user_data","void*","sqlite3_context*"],["sqlite3_value_blob","*","sqlite3_value*"],["sqlite3_value_bytes","int","sqlite3_value*"],["sqlite3_value_double","f64","sqlite3_value*"],["sqlite3_value_dup","sqlite3_value*","sqlite3_value*"],["sqlite3_value_free",void 0,"sqlite3_value*"],["sqlite3_value_frombind","int","sqlite3_value*"],["sqlite3_value_int","int","sqlite3_value*"],["sqlite3_value_nochange","int","sqlite3_value*"],["sqlite3_value_numeric_type","int","sqlite3_value*"],["sqlite3_value_pointer","*","sqlite3_value*","string:static"],["sqlite3_value_subtype","int","sqlite3_value*"],["sqlite3_value_text","string","sqlite3_value*"],["sqlite3_value_type","int","sqlite3_value*"],["sqlite3_vfs_find","*","string"],["sqlite3_vfs_register","int","sqlite3_vfs*","int"],["sqlite3_vfs_unregister","int","sqlite3_vfs*"]],int64:[["sqlite3_bind_int64","int",["sqlite3_stmt*","int","i64"]],["sqlite3_changes64","i64",["sqlite3*"]],["sqlite3_column_int64","i64",["sqlite3_stmt*","int"]],["sqlite3_deserialize","int","sqlite3*","string","*","i64","i64","int"],["sqlite3_last_insert_rowid","i64",["sqlite3*"]],["sqlite3_malloc64","*","i64"],["sqlite3_msize","i64","*"],["sqlite3_overload_function","int",["sqlite3*","string","int"]],["sqlite3_realloc64","*","*","i64"],["sqlite3_result_int64",void 0,"*","i64"],["sqlite3_result_zeroblob64","int","*","i64"],["sqlite3_serialize","*","sqlite3*","string","*","int"],["sqlite3_set_last_insert_rowid",void 0,["sqlite3*","i64"]],["sqlite3_status64","int","int","*","*","int"],["sqlite3_db_status64","int","sqlite3*","int","*","*","int"],["sqlite3_total_changes64","i64",["sqlite3*"]],["sqlite3_update_hook","*",["sqlite3*",new o.xWrap.FuncPtrAdapter({name:"sqlite3_update_hook::callback",signature:"v(pippj)",contextKey:S=>S[0],callProxy:S=>(k,O,M,F,P)=>{S(k,O,o.cstrToJs(M),o.cstrToJs(F),P)}}),"*"]],["sqlite3_uri_int64","i64",["sqlite3_filename","string","i64"]],["sqlite3_value_int64","i64","sqlite3_value*"]],wasmInternal:[["sqlite3__wasm_db_reset","int","sqlite3*"],["sqlite3__wasm_db_vfs","sqlite3_vfs*","sqlite3*","string"],["sqlite3__wasm_vfs_create_file","int","sqlite3_vfs*","string","*","int"],["sqlite3__wasm_posix_create_file","int","string","*","int"],["sqlite3__wasm_vfs_unlink","int","sqlite3_vfs*","string"],["sqlite3__wasm_qfmt_token","string:dealloc","string","int"]]};if(o.exports.sqlite3_progress_handler&&R.core.push(["sqlite3_progress_handler",void 0,["sqlite3*","int",new o.xWrap.FuncPtrAdapter({name:"xProgressHandler",signature:"i(p)",bindScope:"context",contextKey:(S,k)=>S[0]}),"*"]]),o.exports.sqlite3_stmt_explain&&R.core.push(["sqlite3_stmt_explain","int","sqlite3_stmt*","int"],["sqlite3_stmt_isexplain","int","sqlite3_stmt*"]),o.exports.sqlite3_set_authorizer&&R.core.push(["sqlite3_set_authorizer","int",["sqlite3*",new o.xWrap.FuncPtrAdapter({name:"sqlite3_set_authorizer::xAuth",signature:"i(pissss)",contextKey:(S,k)=>S[0],callProxy:S=>(k,O,M,F,P,B)=>{try{return M=M&&o.cstrToJs(M),F=F&&o.cstrToJs(F),P=P&&o.cstrToJs(P),B=B&&o.cstrToJs(B),S(k,O,M,F,P,B)|0}catch(m){return m.resultCode||a.SQLITE_ERROR}}}),"*"]]),o.exports.sqlite3_column_origin_name&&R.core.push(["sqlite3_column_database_name","string","sqlite3_stmt*","int"],["sqlite3_column_origin_name","string","sqlite3_stmt*","int"],["sqlite3_column_table_name","string","sqlite3_stmt*","int"]),o.bigIntEnabled&&o.exports.sqlite3_declare_vtab&&R.int64.push(["sqlite3_create_module","int",["sqlite3*","string","sqlite3_module*","*"]],["sqlite3_create_module_v2","int",["sqlite3*","string","sqlite3_module*","*","*"]],["sqlite3_declare_vtab","int",["sqlite3*","string:flexible"]],["sqlite3_drop_modules","int",["sqlite3*","**"]],["sqlite3_vtab_collation","string","sqlite3_index_info*","int"],["sqlite3_vtab_distinct","int","sqlite3_index_info*"],["sqlite3_vtab_in","int","sqlite3_index_info*","int","int"],["sqlite3_vtab_in_first","int","sqlite3_value*","**"],["sqlite3_vtab_in_next","int","sqlite3_value*","**"],["sqlite3_vtab_nochange","int","sqlite3_context*"],["sqlite3_vtab_on_conflict","int","sqlite3*"],["sqlite3_vtab_rhs_value","int","sqlite3_index_info*","int","**"]),o.bigIntEnabled&&o.exports.sqlite3_preupdate_hook&&R.int64.push(["sqlite3_preupdate_blobwrite","int","sqlite3*"],["sqlite3_preupdate_count","int","sqlite3*"],["sqlite3_preupdate_depth","int","sqlite3*"],["sqlite3_preupdate_hook","*",["sqlite3*",new o.xWrap.FuncPtrAdapter({name:"sqlite3_preupdate_hook",signature:"v(ppippjj)",contextKey:S=>S[0],callProxy:S=>(k,O,M,F,P,B,m)=>{S(k,O,M,o.cstrToJs(F),o.cstrToJs(P),B,m)}}),"*"]],["sqlite3_preupdate_new","int",["sqlite3*","int","**"]],["sqlite3_preupdate_old","int",["sqlite3*","int","**"]]),o.bigIntEnabled&&o.exports.sqlite3changegroup_add&&o.exports.sqlite3session_create&&o.exports.sqlite3_preupdate_hook){const S={signature:"i(ps)",callProxy:k=>(O,M)=>{try{return k(O,o.cstrToJs(M))|0}catch(F){return F.resultCode||a.SQLITE_ERROR}}};R.int64.push(["sqlite3changegroup_add","int",["sqlite3_changegroup*","int","void*"]],["sqlite3changegroup_add_strm","int",["sqlite3_changegroup*",new o.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3changegroup_delete",void 0,["sqlite3_changegroup*"]],["sqlite3changegroup_new","int",["**"]],["sqlite3changegroup_output","int",["sqlite3_changegroup*","int*","**"]],["sqlite3changegroup_output_strm","int",["sqlite3_changegroup*",new o.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply","int",["sqlite3*","int","void*",new o.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...S}),new o.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply_strm","int",["sqlite3*",new o.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new o.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...S}),new o.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply_v2","int",["sqlite3*","int","void*",new o.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...S}),new o.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_apply_v2_strm","int",["sqlite3*",new o.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new o.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...S}),new o.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_apply_v3","int",["sqlite3*","int","void*",new o.xWrap.FuncPtrAdapter({name:"xFilter",signature:"i(pp)",bindScope:"transient"}),new o.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_apply_v3_strm","int",["sqlite3*",new o.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new o.xWrap.FuncPtrAdapter({name:"xFilter",signature:"i(pp)",bindScope:"transient"}),new o.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_concat","int",["int","void*","int","void*","int*","**"]],["sqlite3changeset_concat_strm","int",[new o.xWrap.FuncPtrAdapter({name:"xInputA",signature:"i(ppp)",bindScope:"transient"}),"void*",new o.xWrap.FuncPtrAdapter({name:"xInputB",signature:"i(ppp)",bindScope:"transient"}),"void*",new o.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_conflict","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_finalize","int",["sqlite3_changeset_iter*"]],["sqlite3changeset_fk_conflicts","int",["sqlite3_changeset_iter*","int*"]],["sqlite3changeset_invert","int",["int","void*","int*","**"]],["sqlite3changeset_invert_strm","int",[new o.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new o.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_new","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_next","int",["sqlite3_changeset_iter*"]],["sqlite3changeset_old","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_op","int",["sqlite3_changeset_iter*","**","int*","int*","int*"]],["sqlite3changeset_pk","int",["sqlite3_changeset_iter*","**","int*"]],["sqlite3changeset_start","int",["**","int","*"]],["sqlite3changeset_start_strm","int",["**",new o.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3changeset_start_v2","int",["**","int","*","int"]],["sqlite3changeset_start_v2_strm","int",["**",new o.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*","int"]],["sqlite3session_attach","int",["sqlite3_session*","string"]],["sqlite3session_changeset","int",["sqlite3_session*","int*","**"]],["sqlite3session_changeset_size","i64",["sqlite3_session*"]],["sqlite3session_changeset_strm","int",["sqlite3_session*",new o.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3session_config","int",["int","void*"]],["sqlite3session_create","int",["sqlite3*","string","**"]],["sqlite3session_diff","int",["sqlite3_session*","string","string","**"]],["sqlite3session_enable","int",["sqlite3_session*","int"]],["sqlite3session_indirect","int",["sqlite3_session*","int"]],["sqlite3session_isempty","int",["sqlite3_session*"]],["sqlite3session_memory_used","i64",["sqlite3_session*"]],["sqlite3session_object_config","int",["sqlite3_session*","int","void*"]],["sqlite3session_patchset","int",["sqlite3_session*","*","**"]],["sqlite3session_patchset_strm","int",["sqlite3_session*",new o.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3session_table_filter",void 0,["sqlite3_session*",new o.xWrap.FuncPtrAdapter({name:"xFilter",...S,contextKey:(k,O)=>k[0]}),"*"]])}i.StructBinder=globalThis.Jaccwabyt({heap:o.heap8u,alloc:o.alloc,dealloc:o.dealloc,bigIntEnabled:o.bigIntEnabled,pointerIR:o.ptr.ir,memberPrefix:"$"}),delete globalThis.Jaccwabyt;{const S=o.xWrap.argAdapter("string");o.xWrap.argAdapter("string:flexible",F=>S(h.flexibleString(F))),o.xWrap.argAdapter("string:static",(function(F){return o.isPtr(F)?F:(F=""+F,this[F]||(this[F]=o.allocCString(F)))}).bind(Object.create(null)));const k=o.xWrap.argAdapter("*"),O=function(){};o.xWrap.argAdapter("sqlite3_filename",k)("sqlite3_context*",k)("sqlite3_value*",k)("void*",k)("sqlite3_changegroup*",k)("sqlite3_changeset_iter*",k)("sqlite3_session*",k)("sqlite3_stmt*",F=>{var P;return k(F instanceof(((P=i==null?void 0:i.oo1)==null?void 0:P.Stmt)||O)?F.pointer:F)})("sqlite3*",F=>{var P;return k(F instanceof(((P=i==null?void 0:i.oo1)==null?void 0:P.DB)||O)?F.pointer:F)})("sqlite3_vfs*",F=>typeof F=="string"?a.sqlite3_vfs_find(F)||i.SQLite3Error.toss(a.SQLITE_NOTFOUND,"Unknown sqlite3_vfs name:",F):k(F instanceof(a.sqlite3_vfs||O)?F.pointer:F)),o.exports.sqlite3_declare_vtab&&o.xWrap.argAdapter("sqlite3_index_info*",F=>k(F instanceof(a.sqlite3_index_info||O)?F.pointer:F))("sqlite3_module*",F=>k(F instanceof(a.sqlite3_module||O)?F.pointer:F));const M=o.xWrap.resultAdapter("*");o.xWrap.resultAdapter("sqlite3*",M)("sqlite3_context*",M)("sqlite3_stmt*",M)("sqlite3_value*",M)("sqlite3_vfs*",M)("void*",M);for(const F of R.core)a[F[0]]=o.xWrap.apply(null,F);for(const F of R.wasmInternal)h[F[0]]=o.xWrap.apply(null,F);for(const F of R.int64)a[F[0]]=o.bigIntEnabled?o.xWrap.apply(null,F):()=>p(F[0]+"() is unavailable due to lack","of BigInt support in this build.");delete R.core,delete R.int64,delete R.wasmInternal,h.sqlite3__wasm_db_error=function(F,P,B){return F?(P instanceof i.WasmAllocError?(P=a.SQLITE_NOMEM,B=0):P instanceof Error&&(B=B||""+P,P=P.resultCode||a.SQLITE_ERROR),a.sqlite3_set_errmsg(F,P,B)||P):a.SQLITE_MISUSE}}{const S=o.xCall("sqlite3__wasm_enum_json");S||p("Maintenance required: increase sqlite3__wasm_enum_json()'s","static buffer size!"),o.ctype=JSON.parse(o.cstrToJs(S));const k=["access","authorizer","blobFinalizers","changeset","config","dataTypes","dbConfig","dbStatus","encodings","fcntl","flock","ioCap","limits","openFlags","prepareFlags","resultCodes","sqlite3Status","stmtStatus","syncFlags","trace","txnState","udfFlags","version"];o.bigIntEnabled&&k.push("serialize","session","vtab");for(const F of k)for(const P of Object.entries(o.ctype[F]))a[P[0]]=P[1];o.functionEntry(a.SQLITE_WASM_DEALLOC)||p("Internal error: cannot resolve exported function","entry SQLITE_WASM_DEALLOC (=="+a.SQLITE_WASM_DEALLOC+").");const O=Object.create(null);for(const F of["resultCodes"])for(const P of Object.entries(o.ctype[F]))O[P[1]]=P[0];a.sqlite3_js_rc_str=F=>O[F];const M=Object.assign(Object.create(null),{WasmTestStruct:!0,sqlite3_kvvfs_methods:!h.isUIThread(),sqlite3_index_info:!o.bigIntEnabled,sqlite3_index_constraint:!o.bigIntEnabled,sqlite3_index_orderby:!o.bigIntEnabled,sqlite3_index_constraint_usage:!o.bigIntEnabled});for(const F of o.ctype.structs)M[F.name]||(a[F.name]=i.StructBinder(F));if(a.sqlite3_index_info){for(const F of["sqlite3_index_constraint","sqlite3_index_orderby","sqlite3_index_constraint_usage"])a.sqlite3_index_info[F]=a[F],delete a[F];a.sqlite3_vtab_config=o.xWrap("sqlite3__wasm_vtab_config","int",["sqlite3*","int","int"])}}const j=(S,k,O)=>h.sqlite3__wasm_db_error(S,a.SQLITE_MISUSE,k+"() requires "+O+" argument"+(O===1?"":"s")+"."),ce=S=>h.sqlite3__wasm_db_error(S,a.SQLITE_FORMAT,"SQLITE_UTF8 is the only supported encoding."),V=S=>o.xWrap.argAdapter("sqlite3*")(S),L=S=>o.isPtr(S)?o.cstrToJs(S):S,D=(function(S,k){S=V(S);let O=this.dbMap.get(S);if(k)!O&&k>0&&this.dbMap.set(S,O=Object.create(null));else return this.dbMap.delete(S),O;return O}).bind(Object.assign(Object.create(null),{dbMap:new Map}));D.addCollation=function(S,k){const O=D(S,1);O.collation||(O.collation=new Set),O.collation.add(L(k).toLowerCase())},D._addUDF=function(S,k,O,M){k=L(k).toLowerCase();let F=M.get(k);F||M.set(k,F=new Set),F.add(O<0?-1:O)},D.addFunction=function(S,k,O){const M=D(S,1);M.udf||(M.udf=new Map),this._addUDF(S,k,O,M.udf)},o.exports.sqlite3_create_window_function&&(D.addWindowFunc=function(S,k,O){const M=D(S,1);M.wudf||(M.wudf=new Map),this._addUDF(S,k,O,M.wudf)}),D.cleanup=function(S){S=V(S);for(const M of[["sqlite3_busy_handler",3],["sqlite3_commit_hook",3],["sqlite3_preupdate_hook",3],["sqlite3_progress_handler",4],["sqlite3_rollback_hook",3],["sqlite3_set_authorizer",3],["sqlite3_trace_v2",4],["sqlite3_update_hook",3]]){const[F,P]=M;if(!o.exports[F])continue;const m=[S];m.length=P;try{a[F](...m)}catch(y){i.config.warn("close-time call of",F+"(",m,") threw:",y)}}const k=D(S,0);if(!k)return;if(k.collation){for(const M of k.collation)try{a.sqlite3_create_collation_v2(S,M,a.SQLITE_UTF8,0,0,0)}catch{}delete k.collation}let O;for(O=0;O<2;++O){const M=O?k.wudf:k.udf;if(!M)continue;const F=O?a.sqlite3_create_window_function:a.sqlite3_create_function_v2;for(const P of M){const B=P[0],m=P[1],y=[S,B,0,a.SQLITE_UTF8,0,0,0,0,0];O&&y.push(0);for(const I of m)try{y[2]=I,F.apply(null,y)}catch{}m.clear()}M.clear()}delete k.udf,delete k.wudf};{const S=o.xWrap("sqlite3_close_v2","int","sqlite3*");a.sqlite3_close_v2=function(k){if(arguments.length!==1)return j(k,"sqlite3_close_v2",1);if(k)try{D.cleanup(k)}catch{}return S(k)}}if(a.sqlite3session_create){const S=o.xWrap("sqlite3session_delete",void 0,["sqlite3_session*"]);a.sqlite3session_delete=function(k){if(arguments.length!==1)return j(pDb,"sqlite3session_delete",1);k&&a.sqlite3session_table_filter(k,0,0),S(k)}}{const S=(O,M)=>"argv["+M+"]:"+O[0]+":"+o.cstrToJs(O[1]).toLowerCase(),k=o.xWrap("sqlite3_create_collation_v2","int",["sqlite3*","string","int","*",new o.xWrap.FuncPtrAdapter({name:"xCompare",signature:"i(pipip)",contextKey:S}),new o.xWrap.FuncPtrAdapter({name:"xDestroy",signature:"v(p)",contextKey:S})]);a.sqlite3_create_collation_v2=function(O,M,F,P,B,m){if(arguments.length!==6)return j(O,"sqlite3_create_collation_v2",6);if(!(F&15))F|=a.SQLITE_UTF8;else if(a.SQLITE_UTF8!==(F&15))return ce(O);try{const y=k(O,M,F,P,B,m);return y===0&&B instanceof Function&&D.addCollation(O,M),y}catch(y){return h.sqlite3__wasm_db_error(O,y)}},a.sqlite3_create_collation=(O,M,F,P,B)=>arguments.length===5?a.sqlite3_create_collation_v2(O,M,F,P,B,0):j(O,"sqlite3_create_collation",5)}{const S=function(F,P){return F[0]+":"+(F[2]<0?-1:F[2])+":"+P+":"+o.cstrToJs(F[1]).toLowerCase()},k=Object.assign(Object.create(null),{xInverseAndStep:{signature:"v(pip)",contextKey:S,callProxy:F=>(P,B,m)=>{try{F(P,...a.sqlite3_values_to_js(B,m))}catch(y){a.sqlite3_result_error_js(P,y)}}},xFinalAndValue:{signature:"v(p)",contextKey:S,callProxy:F=>P=>{try{a.sqlite3_result_js(P,F(P))}catch(B){a.sqlite3_result_error_js(P,B)}}},xFunc:{signature:"v(pip)",contextKey:S,callProxy:F=>(P,B,m)=>{try{a.sqlite3_result_js(P,F(P,...a.sqlite3_values_to_js(B,m)))}catch(y){a.sqlite3_result_error_js(P,y)}}},xDestroy:{signature:"v(p)",contextKey:S,callProxy:F=>P=>{try{F(P)}catch(B){console.error("UDF xDestroy method threw:",B)}}}}),O=o.xWrap("sqlite3_create_function_v2","int",["sqlite3*","string","int","int","*",new o.xWrap.FuncPtrAdapter({name:"xFunc",...k.xFunc}),new o.xWrap.FuncPtrAdapter({name:"xStep",...k.xInverseAndStep}),new o.xWrap.FuncPtrAdapter({name:"xFinal",...k.xFinalAndValue}),new o.xWrap.FuncPtrAdapter({name:"xDestroy",...k.xDestroy})]),M=o.exports.sqlite3_create_window_function?o.xWrap("sqlite3_create_window_function","int",["sqlite3*","string","int","int","*",new o.xWrap.FuncPtrAdapter({name:"xStep",...k.xInverseAndStep}),new o.xWrap.FuncPtrAdapter({name:"xFinal",...k.xFinalAndValue}),new o.xWrap.FuncPtrAdapter({name:"xValue",...k.xFinalAndValue}),new o.xWrap.FuncPtrAdapter({name:"xInverse",...k.xInverseAndStep}),new o.xWrap.FuncPtrAdapter({name:"xDestroy",...k.xDestroy})]):void 0;a.sqlite3_create_function_v2=function F(P,B,m,y,I,Z,re,me,be){if(F.length!==arguments.length)return j(P,"sqlite3_create_function_v2",F.length);if(!(y&15))y|=a.SQLITE_UTF8;else if(a.SQLITE_UTF8!==(y&15))return ce(P);try{const w=O(P,B,m,y,I,Z,re,me,be);return w===0&&(Z instanceof Function||re instanceof Function||me instanceof Function||be instanceof Function)&&D.addFunction(P,B,m),w}catch(w){return console.error("sqlite3_create_function_v2() setup threw:",w),h.sqlite3__wasm_db_error(P,w,"Creation of UDF threw: "+w)}},a.sqlite3_create_function=function F(P,B,m,y,I,Z,re,me){return F.length===arguments.length?a.sqlite3_create_function_v2(P,B,m,y,I,Z,re,me,0):j(P,"sqlite3_create_function",F.length)},M?a.sqlite3_create_window_function=function F(P,B,m,y,I,Z,re,me,be,w){if(F.length!==arguments.length)return j(P,"sqlite3_create_window_function",F.length);if(!(y&15))y|=a.SQLITE_UTF8;else if(a.SQLITE_UTF8!==(y&15))return ce(P);try{const u=M(P,B,m,y,I,Z,re,me,be,w);return u===0&&(Z instanceof Function||re instanceof Function||me instanceof Function||be instanceof Function||w instanceof Function)&&D.addWindowFunc(P,B,m),u}catch(u){return console.error("sqlite3_create_window_function() setup threw:",u),h.sqlite3__wasm_db_error(P,u,"Creation of UDF threw: "+u)}}:delete a.sqlite3_create_window_function,a.sqlite3_create_function_v2.udfSetResult=a.sqlite3_create_function.udfSetResult=a.sqlite3_result_js,a.sqlite3_create_window_function&&(a.sqlite3_create_window_function.udfSetResult=a.sqlite3_result_js),a.sqlite3_create_function_v2.udfConvertArgs=a.sqlite3_create_function.udfConvertArgs=a.sqlite3_values_to_js,a.sqlite3_create_window_function&&(a.sqlite3_create_window_function.udfConvertArgs=a.sqlite3_values_to_js),a.sqlite3_create_function_v2.udfSetError=a.sqlite3_create_function.udfSetError=a.sqlite3_result_error_js,a.sqlite3_create_window_function&&(a.sqlite3_create_window_function.udfSetError=a.sqlite3_result_error_js)}{const S=(O,M)=>(typeof O=="string"?M=-1:h.isSQLableTypedArray(O)?(M=O.byteLength,O=o.typedArrayToString(O instanceof ArrayBuffer?new Uint8Array(O):O)):Array.isArray(O)&&(O=O.join(""),M=-1),[O,M]),k={basic:o.xWrap("sqlite3_prepare_v3","int",["sqlite3*","string","int","int","**","**"]),full:o.xWrap("sqlite3_prepare_v3","int",["sqlite3*","*","int","int","**","**"])};a.sqlite3_prepare_v3=function O(M,F,P,B,m,y){if(O.length!==arguments.length)return j(M,"sqlite3_prepare_v3",O.length);const[I,Z]=S(F,Number(P));switch(typeof I){case"string":return k.basic(M,I,Z,B,m,null);case typeof o.ptr.null:return k.full(M,o.ptr.coerce(I),Z,B,m,y);default:return h.sqlite3__wasm_db_error(M,a.SQLITE_MISUSE,"Invalid SQL argument type for sqlite3_prepare_v2/v3(). typeof="+typeof I)}},a.sqlite3_prepare_v2=function O(M,F,P,B,m){return O.length===arguments.length?a.sqlite3_prepare_v3(M,F,P,0,B,m):j(M,"sqlite3_prepare_v2",O.length)}}{const S=o.xWrap("sqlite3_bind_text","int",["sqlite3_stmt*","int","string","int","*"]),k=o.xWrap("sqlite3_bind_blob","int",["sqlite3_stmt*","int","*","int","*"]);a.sqlite3_bind_text=function O(M,F,P,B,m){if(O.length!==arguments.length)return j(a.sqlite3_db_handle(M),"sqlite3_bind_text",O.length);if(o.isPtr(P)||P===null)return S(M,F,P,B,m);P instanceof ArrayBuffer?P=new Uint8Array(P):Array.isArray(pMem)&&(P=pMem.join(""));let y,I;try{if(h.isSQLableTypedArray(P))y=o.allocFromTypedArray(P),I=P.byteLength;else if(typeof P=="string")[y,I]=o.allocCString(P);else return h.sqlite3__wasm_db_error(a.sqlite3_db_handle(M),a.SQLITE_MISUSE,"Invalid 3rd argument type for sqlite3_bind_text().");return S(M,F,y,I,a.SQLITE_WASM_DEALLOC)}catch(Z){return o.dealloc(y),h.sqlite3__wasm_db_error(a.sqlite3_db_handle(M),Z)}},a.sqlite3_bind_blob=function O(M,F,P,B,m){if(O.length!==arguments.length)return j(a.sqlite3_db_handle(M),"sqlite3_bind_blob",O.length);if(o.isPtr(P)||P===null)return k(M,F,P,B,m);P instanceof ArrayBuffer?P=new Uint8Array(P):Array.isArray(P)&&(P=P.join(""));let y,I;try{if(h.isBindableTypedArray(P))y=o.allocFromTypedArray(P),I=B>=0?B:P.byteLength;else if(typeof P=="string")[y,I]=o.allocCString(P);else return h.sqlite3__wasm_db_error(a.sqlite3_db_handle(M),a.SQLITE_MISUSE,"Invalid 3rd argument type for sqlite3_bind_blob().");return k(M,F,y,I,a.SQLITE_WASM_DEALLOC)}catch(Z){return o.dealloc(y),h.sqlite3__wasm_db_error(a.sqlite3_db_handle(M),Z)}}}a.sqlite3_config=function(S,...k){if(arguments.length<2)return a.SQLITE_MISUSE;switch(S){case a.SQLITE_CONFIG_COVERING_INDEX_SCAN:case a.SQLITE_CONFIG_MEMSTATUS:case a.SQLITE_CONFIG_SMALL_MALLOC:case a.SQLITE_CONFIG_SORTERREF_SIZE:case a.SQLITE_CONFIG_STMTJRNL_SPILL:case a.SQLITE_CONFIG_URI:return o.exports.sqlite3__wasm_config_i(S,k[0]);case a.SQLITE_CONFIG_LOOKASIDE:return o.exports.sqlite3__wasm_config_ii(S,k[0],k[1]);case a.SQLITE_CONFIG_MEMDB_MAXSIZE:return o.exports.sqlite3__wasm_config_j(S,k[0]);case a.SQLITE_CONFIG_GETMALLOC:case a.SQLITE_CONFIG_GETMUTEX:case a.SQLITE_CONFIG_GETPCACHE2:case a.SQLITE_CONFIG_GETPCACHE:case a.SQLITE_CONFIG_HEAP:case a.SQLITE_CONFIG_LOG:case a.SQLITE_CONFIG_MALLOC:case a.SQLITE_CONFIG_MMAP_SIZE:case a.SQLITE_CONFIG_MULTITHREAD:case a.SQLITE_CONFIG_MUTEX:case a.SQLITE_CONFIG_PAGECACHE:case a.SQLITE_CONFIG_PCACHE2:case a.SQLITE_CONFIG_PCACHE:case a.SQLITE_CONFIG_PCACHE_HDRSZ:case a.SQLITE_CONFIG_PMASZ:case a.SQLITE_CONFIG_SERIALIZED:case a.SQLITE_CONFIG_SINGLETHREAD:case a.SQLITE_CONFIG_SQLLOG:case a.SQLITE_CONFIG_WIN32_HEAPSIZE:default:return a.SQLITE_NOTFOUND}};{const S=new Set;a.sqlite3_auto_extension=function(k){if(k instanceof Function)k=o.installFunction("i(ppp)",k);else if(arguments.length!==1||!o.isPtr(k))return a.SQLITE_MISUSE;const O=o.exports.sqlite3_auto_extension(k);return k!==arguments[0]&&(O===0?S.add(k):o.uninstallFunction(k)),O},a.sqlite3_cancel_auto_extension=function(k){return!k||arguments.length!==1||!o.isPtr(k)?0:o.exports.sqlite3_cancel_auto_extension(k)},a.sqlite3_reset_auto_extension=function(){o.exports.sqlite3_reset_auto_extension();for(const k of S)o.uninstallFunction(k);S.clear()}}const C=a.sqlite3_vfs_find("kvvfs");if(C)if(h.isUIThread()){const S=new a.sqlite3_kvvfs_methods(o.exports.sqlite3__wasm_kvvfs_methods());delete a.sqlite3_kvvfs_methods;const k=o.exports.sqlite3__wasm_kvvfsMakeKeyOnPstack,O=o.pstack,M=P=>o.peek(P)===115?sessionStorage:localStorage,F={xRead:(P,B,m,y)=>{const I=O.pointer,Z=o.scopedAllocPush();try{const re=k(P,B);if(!re)return-3;const me=o.cstrToJs(re),be=M(P).getItem(me);if(!be)return-1;const w=be.length;if(y<=0)return w;if(y===1)return o.poke(m,0),w;const u=o.scopedAllocCString(be);return y>w+1&&(y=w+1),o.heap8u().copyWithin(Number(m),Number(u),o.ptr.addn(u,y,-1)),o.poke(o.ptr.add(m,y,-1),0),y-1}catch(re){return i.config.error("kvstorageRead()",re),-2}finally{O.restore(I),o.scopedAllocPop(Z)}},xWrite:(P,B,m)=>{const y=O.pointer;try{const I=k(P,B);if(!I)return 1;const Z=o.cstrToJs(I);return M(P).setItem(Z,o.cstrToJs(m)),0}catch(I){return i.config.error("kvstorageWrite()",I),a.SQLITE_IOERR}finally{O.restore(y)}},xDelete:(P,B)=>{const m=O.pointer;try{const y=k(P,B);return y?(M(P).removeItem(o.cstrToJs(y)),0):1}catch(y){return i.config.error("kvstorageDelete()",y),a.SQLITE_IOERR}finally{O.restore(m)}}};for(const P of Object.keys(F))S[S.memberKey(P)]=o.installFunction(S.memberSignature(P),F[P])}else a.sqlite3_vfs_unregister(C);o.xWrap.FuncPtrAdapter.warnOnUse=!0;const $=i.StructBinder,le=function S(k,O,M,F=S.installMethodArgcCheck){if(k instanceof $.StructType?!(M instanceof Function)&&!o.isPtr(M)&&p("Usage error: expecting a Function or WASM pointer to one."):p("Usage error: target object is-not-a StructType."),arguments.length===1)return(y,I)=>S(k,y,I,F);S.argcProxy||(S.argcProxy=function(y,I,Z,re){return function(...me){return Z.length!==arguments.length&&p("Argument mismatch for",y.structInfo.name+"::"+I+": Native signature is:",re),Z.apply(this,me)}},S.removeFuncList=function(){this.ondispose.__removeFuncList&&(this.ondispose.__removeFuncList.forEach((y,I)=>{if(o.isPtr(y))try{o.uninstallFunction(y)}catch{}}),delete this.ondispose.__removeFuncList)});const P=k.memberSignature(O);P.length<2&&p("Member",O,"does not have a function pointer signature:",P);const B=k.memberKey(O),m=F&&!o.isPtr(M)?S.argcProxy(k,B,M,P):M;if(o.isPtr(m))m&&!o.functionEntry(m)&&p("Pointer",m,"is not a WASM function table entry."),k[B]=m;else{const y=o.installFunction(m,k.memberSignature(O));k[B]=y,(!k.ondispose||!k.ondispose.__removeFuncList)&&(k.addOnDispose("ondispose.__removeFuncList handler",S.removeFuncList),k.ondispose.__removeFuncList=[]),k.ondispose.__removeFuncList.push(B,y)}return(y,I)=>S(k,y,I,F)};le.installMethodArgcCheck=!1;const J=function(S,k,O=le.installMethodArgcCheck){const M=new Map;for(const F of Object.keys(k)){const P=k[F],B=M.get(P);if(B){const m=S.memberKey(F);S[m]=S[S.memberKey(B)]}else le(S,F,P,O),M.set(P,F)}return S};$.StructType.prototype.installMethod=function(k,O,M=le.installMethodArgcCheck){return arguments.length<3&&k&&typeof k=="object"?J(this,...arguments):le(this,...arguments)},$.StructType.prototype.installMethods=function(S,k=le.installMethodArgcCheck){return J(this,S,k)}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){i.version={libVersion:"3.51.0",libVersionNumber:3051e3,sourceId:"2025-11-04 19:38:17 fb2c931ae597f8d00a37574ff67aeed3eced4e5547f9120744ae4bfa8e74527b",downloadVersion:351e4,scm:{"sha3-256":"fb2c931ae597f8d00a37574ff67aeed3eced4e5547f9120744ae4bfa8e74527b",branch:"trunk",tags:"release major-release version-3.51.0",datetime:"2025-11-04T19:38:17.314Z"}}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const p=(...w)=>{throw new i.SQLite3Error(...w)},a=i.capi,o=i.wasm,h=i.util,R=new WeakMap,j=new Set,ce=new WeakMap,V=(w,u,_)=>{const b=Object.getOwnPropertyDescriptor(w,u);return b?b.value:_},L=function(w,u){return u&&(w instanceof le&&(w=w.pointer),p(u,"sqlite3 result code",u+":",w?a.sqlite3_errmsg(w):a.sqlite3_errstr(u))),arguments[0]},D=o.installFunction("i(ippp)",(function(w,u,_,b){a.SQLITE_TRACE_STMT===w&&console.log("SQL TRACE #"+ ++this.counter+" via sqlite3@"+u+":",o.cstrToJs(b))}).bind({counter:0})),C=Object.create(null),$=function w(...u){if(!w._name2vfs){w._name2vfs=Object.create(null);const E=typeof importScripts=="function"?H=>p("The VFS for",H,"is only available in the main window thread."):!1;w._name2vfs[":localStorage:"]={vfs:"kvvfs",filename:E||(()=>"local")},w._name2vfs[":sessionStorage:"]={vfs:"kvvfs",filename:E||(()=>"session")}}const _=w.normalizeArgs(...u);let b;if(b=_["sqlite3*"])_["sqlite3*:takeOwnership"]||j.add(this),this.filename=a.sqlite3_db_filename(b,"main");else{let E=_.filename,H=_.vfs,te=_.flags;(typeof E!="string"&&!o.isPtr(E)||typeof te!="string"||H&&typeof H!="string"&&!o.isPtr(H))&&(i.config.error("Invalid DB ctor args",_,arguments),p("Invalid arguments for DB constructor:",arguments,"opts:",_));let he=o.isPtr(E)?o.cstrToJs(E):E;const se=w._name2vfs[he];se&&(H=se.vfs,E=he=se.filename(he));let Ee=0;te.indexOf("c")>=0&&(Ee|=a.SQLITE_OPEN_CREATE|a.SQLITE_OPEN_READWRITE),te.indexOf("w")>=0&&(Ee|=a.SQLITE_OPEN_READWRITE),Ee===0&&(Ee|=a.SQLITE_OPEN_READONLY),Ee|=a.SQLITE_OPEN_EXRESCODE;const ye=o.pstack.pointer;try{const Pe=o.pstack.allocPtr();let xe=a.sqlite3_open_v2(E,Pe,Ee,H||o.ptr.null);b=o.peekPtr(Pe),L(b,xe),a.sqlite3_extended_result_codes(b,1),te.indexOf("t")>=0&&a.sqlite3_trace_v2(b,a.SQLITE_TRACE_STMT,D,b)}catch(Pe){throw b&&a.sqlite3_close_v2(b),Pe}finally{o.pstack.restore(ye)}this.filename=he}if(R.set(this,b),ce.set(this,Object.create(null)),!_["sqlite3*"])try{const E=a.sqlite3_js_db_vfs(b)||p("Internal error: cannot get VFS for new db handle."),H=C[E];H&&(H instanceof Function?H(this,i):L(b,a.sqlite3_exec(b,H,0,0,0)))}catch(E){throw this.close(),E}};$.setVfsPostOpenCallback=function(w,u){u instanceof Function||p("dbCtorHelper.setVfsPostOpenCallback() should not be used with a non-function argument.",arguments),C[w]=u},$.normalizeArgs=function(w=":memory:",u="c",_=null){const b={};return arguments.length===1&&arguments[0]&&typeof arguments[0]=="object"?(Object.assign(b,arguments[0]),b.flags===void 0&&(b.flags="c"),b.vfs===void 0&&(b.vfs=null),b.filename===void 0&&(b.filename=":memory:")):(b.filename=w,b.flags=u,b.vfs=_),b};const le=function(...w){$.apply(this,w)};le.dbCtorHelper=$;const J={null:1,number:2,string:3,boolean:4,blob:5};o.bigIntEnabled&&(J.bigint=J.number);const S=function(){J!==arguments[2]&&p(a.SQLITE_MISUSE,"Do not call the Stmt constructor directly. Use DB.prepare()."),this.db=arguments[0],R.set(this,arguments[1]),arguments.length>3&&!arguments[3]&&j.add(this)},k=function(w){return w.pointer||p("DB has been closed."),w},O=function(w,u){return(u!==(u|0)||u<0||u>=w.columnCount)&&p("Column index",u,"is out of range."),w},M=function(w,u){const _=Object.create(null);switch(_.opt=Object.create(null),u.length){case 1:typeof u[0]=="string"||h.isSQLableTypedArray(u[0])||Array.isArray(u[0])?_.sql=u[0]:u[0]&&typeof u[0]=="object"&&(_.opt=u[0],_.sql=_.opt.sql);break;case 2:_.sql=u[0],_.opt=u[1];break;default:p("Invalid argument count for exec().")}_.sql=h.flexibleString(_.sql),typeof _.sql!="string"&&p("Missing SQL argument or unsupported SQL value type.");const b=_.opt;switch(b.returnValue){case"resultRows":b.resultRows||(b.resultRows=[]),_.returnVal=()=>b.resultRows;break;case"saveSql":b.saveSql||(b.saveSql=[]),_.returnVal=()=>b.saveSql;break;case void 0:case"this":_.returnVal=()=>w;break;default:p("Invalid returnValue value:",b.returnValue)}if(!b.callback&&!b.returnValue&&b.rowMode!==void 0&&(b.resultRows||(b.resultRows=[]),_.returnVal=()=>b.resultRows),b.callback||b.resultRows)switch(b.rowMode===void 0?"array":b.rowMode){case"object":_.cbArg=(E,H)=>{H.columnNames||(H.columnNames=E.getColumnNames([]));const te=E.get([]),he=Object.create(null);for(const se in H.columnNames)he[H.columnNames[se]]=te[se];return he};break;case"array":_.cbArg=E=>E.get([]);break;case"stmt":Array.isArray(b.resultRows)&&p("exec(): invalid rowMode for a resultRows array: must","be one of 'array', 'object',","a result column number, or column name reference."),_.cbArg=E=>E;break;default:if(h.isInt32(b.rowMode)){_.cbArg=E=>E.get(b.rowMode);break}else if(typeof b.rowMode=="string"&&b.rowMode.length>1&&b.rowMode[0]==="$"){const E=b.rowMode.substr(1);_.cbArg=H=>{const te=H.get(Object.create(null))[E];return te===void 0?p(a.SQLITE_NOTFOUND,"exec(): unknown result column:",E):te};break}p("Invalid rowMode:",b.rowMode)}return _},F=(w,u,_,...b)=>{const E=w.prepare(u);try{const H=E.bind(_).step()?E.get(...b):void 0;return E.reset(),H}finally{E.finalize()}},P=(w,u,_,b)=>w.exec({sql:u,bind:_,rowMode:b,returnValue:"resultRows"});le.checkRc=(w,u)=>L(w,u),le.prototype={isOpen:function(){return!!this.pointer},affirmOpen:function(){return k(this)},close:function(){const w=this.pointer;if(w){if(this.onclose&&this.onclose.before instanceof Function)try{this.onclose.before(this)}catch{}if(Object.keys(ce.get(this)).forEach((u,_)=>{if(_&&_.pointer)try{_.finalize()}catch{}}),R.delete(this),ce.delete(this),j.delete(this)||a.sqlite3_close_v2(w),this.onclose&&this.onclose.after instanceof Function)try{this.onclose.after(this)}catch{}delete this.filename}},changes:function(w=!1,u=!1){const _=k(this).pointer;return w?u?a.sqlite3_total_changes64(_):a.sqlite3_total_changes(_):u?a.sqlite3_changes64(_):a.sqlite3_changes(_)},dbFilename:function(w="main"){return a.sqlite3_db_filename(k(this).pointer,w)},dbName:function(w=0){return a.sqlite3_db_name(k(this).pointer,w)},dbVfsName:function(w=0){let u;const _=a.sqlite3_js_db_vfs(k(this).pointer,w);if(_){const b=new a.sqlite3_vfs(_);try{u=o.cstrToJs(b.$zName)}finally{b.dispose()}}return u},prepare:function(w){k(this);const u=o.pstack.pointer;let _,b;try{_=o.pstack.alloc(8),le.checkRc(this,a.sqlite3_prepare_v2(this.pointer,w,-1,_,null)),b=o.peekPtr(_)}finally{o.pstack.restore(u)}b||p("Cannot prepare empty SQL.");const E=new S(this,b,J);return ce.get(this)[b]=E,E},exec:function(){k(this);const w=M(this,arguments);if(!w.sql)return p("exec() requires an SQL string.");const u=w.opt,_=u.callback,b=Array.isArray(u.resultRows)?u.resultRows:void 0;let E,H=u.bind,te=!!(w.cbArg||u.columnNames||b);const he=o.scopedAllocPush(),se=Array.isArray(u.saveSql)?u.saveSql:void 0;try{const Ee=h.isSQLableTypedArray(w.sql);let ye=Ee?w.sql.byteLength:o.jstrlen(w.sql);const Pe=o.scopedAlloc(2*o.ptr.size+(ye+1)),xe=o.ptr.add(Pe,o.ptr.size);let ze=o.ptr.add(xe,o.ptr.size);const et=o.ptr.add(ze,ye);for(Ee?o.heap8().set(w.sql,ze):o.jstrcpy(w.sql,o.heap8(),ze,ye,!1),o.poke(o.ptr.add(ze,ye),0);ze&&o.peek(ze,"i8");){o.pokePtr([Pe,xe],0),le.checkRc(this,a.sqlite3_prepare_v3(this.pointer,ze,ye,0,Pe,xe));const x=o.peekPtr(Pe);if(ze=o.peekPtr(xe),ye=Number(o.ptr.add(et,-ze)),!!x){if(se&&se.push(a.sqlite3_sql(x).trim()),E=new S(this,x,J),H&&E.parameterCount&&(E.bind(H),H=null),te&&E.columnCount){let K=Array.isArray(u.columnNames)?0:1;if(te=!1,w.cbArg||b){const Y=Object.create(null);for(;E.step();Z.delete(E)){K++===0&&E.getColumnNames(Y.columnNames=u.columnNames||[]),Z.add(E);const _e=w.cbArg(E,Y);if(b&&b.push(_e),_&&_.call(u,_e,E)===!1)break}Z.delete(E)}K===0&&E.getColumnNames(u.columnNames)}else E.step();E.reset().finalize(),E=null}}}finally{o.scopedAllocPop(he),E&&(Z.delete(E),E.finalize())}return w.returnVal()},createFunction:function(u,_,b){const E=Y=>Y instanceof Function;switch(arguments.length){case 1:b=u,u=b.name,_=b.xFunc||0;break;case 2:E(_)||(b=_,_=b.xFunc||0);break}b||(b={}),typeof u!="string"&&p("Invalid arguments: missing function name.");let H=b.xStep||0,te=b.xFinal||0;const he=b.xValue||0,se=b.xInverse||0;let Ee;E(_)?(Ee=!1,(E(H)||E(te))&&p("Ambiguous arguments: scalar or aggregate?"),H=te=null):E(H)?(E(te)||p("Missing xFinal() callback for aggregate or window UDF."),_=null):E(te)?p("Missing xStep() callback for aggregate or window UDF."):p("Missing function-type properties."),Ee===!1?(E(he)||E(se))&&p("xValue and xInverse are not permitted for non-window UDFs."):E(he)?(E(se)||p("xInverse must be provided if xValue is."),Ee=!0):E(se)&&p("xValue must be provided if xInverse is.");const ye=b.pApp;ye!=null&&!o.isPtr(ye)&&p("Invalid value for pApp property. Must be a legal WASM pointer value.");const Pe=b.xDestroy||0;Pe&&!E(Pe)&&p("xDestroy property must be a function.");let xe=0;V(b,"deterministic")&&(xe|=a.SQLITE_DETERMINISTIC),V(b,"directOnly")&&(xe|=a.SQLITE_DIRECTONLY),V(b,"innocuous")&&(xe|=a.SQLITE_INNOCUOUS),u=u.toLowerCase();const ze=_||H,et=V(b,"arity"),x=typeof et=="number"?et:ze.length?ze.length-1:0;let K;return Ee?K=a.sqlite3_create_window_function(this.pointer,u,x,a.SQLITE_UTF8|xe,ye||0,H,te,he,se,Pe):K=a.sqlite3_create_function_v2(this.pointer,u,x,a.SQLITE_UTF8|xe,ye||0,_,H,te,Pe),le.checkRc(this,K),this},selectValue:function(w,u,_){return F(this,w,u,0,_)},selectValues:function(w,u,_){const b=this.prepare(w),E=[];try{for(b.bind(u);b.step();)E.push(b.get(0,_));b.reset()}finally{b.finalize()}return E},selectArray:function(w,u){return F(this,w,u,[])},selectObject:function(w,u){return F(this,w,u,{})},selectArrays:function(w,u){return P(this,w,u,"array")},selectObjects:function(w,u){return P(this,w,u,"object")},openStatementCount:function(){return this.pointer?Object.keys(ce.get(this)).length:0},transaction:function(w){let u="BEGIN";arguments.length>1&&(/[^a-zA-Z]/.test(arguments[0])&&p(a.SQLITE_MISUSE,"Invalid argument for BEGIN qualifier."),u+=" "+arguments[0],w=arguments[1]),k(this).exec(u);try{const _=w(this);return this.exec("COMMIT"),_}catch(_){throw this.exec("ROLLBACK"),_}},savepoint:function(w){k(this).exec("SAVEPOINT oo1");try{const u=w(this);return this.exec("RELEASE oo1"),u}catch(u){throw this.exec("ROLLBACK to SAVEPOINT oo1; RELEASE SAVEPOINT oo1"),u}},checkRc:function(w){return L(this,w)}},le.wrapHandle=function(w,u=!1){if(!w||!o.isPtr(w))throw new i.SQLite3Error(a.SQLITE_MISUSE,"Argument must be a WASM sqlite3 pointer");return new le({"sqlite3*":w,"sqlite3*:takeOwnership":!!u})};const B=function(w){return w.pointer||p("Stmt has been closed."),w},m=function(w){let u=J[w==null?"null":typeof w];switch(u){case J.boolean:case J.null:case J.number:case J.string:return u;case J.bigint:return o.bigIntEnabled?u:void 0;default:return h.isBindableTypedArray(w)?J.blob:void 0}},y=function(w){return m(w)||p("Unsupported bind() argument type:",typeof w)},I=function(w,u){const _=typeof u=="number"?u:a.sqlite3_bind_parameter_index(w.pointer,u);return _===0||!h.isInt32(_)?p("Invalid bind() parameter name: "+u):(_<1||_>w.parameterCount)&&p("Bind index",u,"is out of range."),_},Z=new Set,re=new Set,me=function(w,u){return Z.has(w)&&p("Operation is illegal when statement is locked:",u),w},be=function w(u,_,b,E){me(B(u),"bind()"),w._||(w._tooBigInt=te=>p("BigInt value is too big to store without precision loss:",te),w._={string:function(te,he,se,Ee){const[ye,Pe]=o.allocCString(se,!0);return(Ee?a.sqlite3_bind_blob:a.sqlite3_bind_text)(te.pointer,he,ye,Pe,a.SQLITE_WASM_DEALLOC)}}),y(E),_=I(u,_);let H=0;switch(E==null?J.null:b){case J.null:H=a.sqlite3_bind_null(u.pointer,_);break;case J.string:H=w._.string(u,_,E,!1);break;case J.number:{let te;h.isInt32(E)?te=a.sqlite3_bind_int:typeof E=="bigint"?h.bigIntFits64(E)?o.bigIntEnabled?te=a.sqlite3_bind_int64:h.bigIntFitsDouble(E)?(E=Number(E),te=a.sqlite3_bind_double):w._tooBigInt(E):w._tooBigInt(E):(E=Number(E),o.bigIntEnabled&&Number.isInteger(E)?te=a.sqlite3_bind_int64:te=a.sqlite3_bind_double),H=te(u.pointer,_,E);break}case J.boolean:H=a.sqlite3_bind_int(u.pointer,_,E?1:0);break;case J.blob:{if(typeof E=="string"){H=w._.string(u,_,E,!0);break}else E instanceof ArrayBuffer?E=new Uint8Array(E):h.isBindableTypedArray(E)||p("Binding a value as a blob requires","that it be a string, Uint8Array, Int8Array, or ArrayBuffer.");const te=o.alloc(E.byteLength||1);o.heap8().set(E.byteLength?E:[0],Number(te)),H=a.sqlite3_bind_blob(u.pointer,_,te,E.byteLength,a.SQLITE_WASM_DEALLOC);break}default:i.config.warn("Unsupported bind() argument type:",E),p("Unsupported bind() argument type: "+typeof E)}return H&&le.checkRc(u.db.pointer,H),u};S.prototype={finalize:function(){const w=this.pointer;if(w){me(this,"finalize()");const u=j.delete(this)?0:a.sqlite3_finalize(w);return delete ce.get(this.db)[w],R.delete(this),Z.delete(this),re.delete(this),delete this.parameterCount,delete this.db,u}},clearBindings:function(){return me(B(this),"clearBindings()"),a.sqlite3_clear_bindings(this.pointer),re.delete(this),this},reset:function(w){me(this,"reset()"),w&&this.clearBindings();const u=a.sqlite3_reset(B(this).pointer);return re.delete(this),L(this.db,u),this},bind:function(){B(this);let w,u;switch(arguments.length){case 1:w=1,u=arguments[0];break;case 2:w=arguments[0],u=arguments[1];break;default:p("Invalid bind() arguments.")}return u===void 0?this:(this.parameterCount||p("This statement has no bindable parameters."),re.delete(this),u===null?be(this,w,J.null,u):Array.isArray(u)?(arguments.length!==1&&p("When binding an array, an index argument is not permitted."),u.forEach((_,b)=>be(this,b+1,y(_),_)),this):(u instanceof ArrayBuffer&&(u=new Uint8Array(u)),typeof u=="object"&&!h.isBindableTypedArray(u)?(arguments.length!==1&&p("When binding an object, an index argument is not permitted."),Object.keys(u).forEach(_=>be(this,_,y(u[_]),u[_])),this):be(this,w,y(u),u)))},bindAsBlob:function(w,u){B(this),arguments.length===1&&(u=w,w=1);const _=y(u);return J.string!==_&&J.blob!==_&&J.null!==_&&p("Invalid value type for bindAsBlob()"),be(this,w,J.blob,u)},step:function(){me(this,"step()");const w=a.sqlite3_step(B(this).pointer);switch(w){case a.SQLITE_DONE:return re.delete(this),!1;case a.SQLITE_ROW:return re.add(this),!0;default:re.delete(this),i.config.warn("sqlite3_step() rc=",w,a.sqlite3_js_rc_str(w),"SQL =",a.sqlite3_sql(this.pointer)),le.checkRc(this.db.pointer,w)}},stepReset:function(){return this.step(),this.reset()},stepFinalize:function(){try{const w=this.step();return this.reset(),w}finally{try{this.finalize()}catch{}}},get:function(w,u){if(re.has(B(this))||p("Stmt.step() has not (recently) returned true."),Array.isArray(w)){let _=0;const b=this.columnCount;for(;_<b;)w[_]=this.get(_++);return w}else if(w&&typeof w=="object"){let _=0;const b=this.columnCount;for(;_<b;)w[a.sqlite3_column_name(this.pointer,_)]=this.get(_++);return w}switch(O(this,w),u===void 0?a.sqlite3_column_type(this.pointer,w):u){case a.SQLITE_NULL:return null;case a.SQLITE_INTEGER:if(o.bigIntEnabled){const _=a.sqlite3_column_int64(this.pointer,w);return _>=Number.MIN_SAFE_INTEGER&&_<=Number.MAX_SAFE_INTEGER?Number(_).valueOf():_}else{const _=a.sqlite3_column_double(this.pointer,w);return(_>Number.MAX_SAFE_INTEGER||_<Number.MIN_SAFE_INTEGER)&&p("Integer is out of range for JS integer range: "+_),h.isInt32(_)?_|0:_}case a.SQLITE_FLOAT:return a.sqlite3_column_double(this.pointer,w);case a.SQLITE_TEXT:return a.sqlite3_column_text(this.pointer,w);case a.SQLITE_BLOB:{const _=a.sqlite3_column_bytes(this.pointer,w),b=a.sqlite3_column_blob(this.pointer,w),E=new Uint8Array(_);return _&&(E.set(o.heap8u().slice(Number(b),Number(b)+_),0),this.db._blobXfer instanceof Array&&this.db._blobXfer.push(E.buffer)),E}default:p("Don't know how to translate","type of result column #"+w+".")}p("Not reached.")},getInt:function(w){return this.get(w,a.SQLITE_INTEGER)},getFloat:function(w){return this.get(w,a.SQLITE_FLOAT)},getString:function(w){return this.get(w,a.SQLITE_TEXT)},getBlob:function(w){return this.get(w,a.SQLITE_BLOB)},getJSON:function(w){const u=this.get(w,a.SQLITE_STRING);return u===null?u:JSON.parse(u)},getColumnName:function(w){return a.sqlite3_column_name(O(B(this),w).pointer,w)},getColumnNames:function(w=[]){O(B(this),0);const u=this.columnCount;for(let _=0;_<u;++_)w.push(a.sqlite3_column_name(this.pointer,_));return w},getParamIndex:function(w){return B(this).parameterCount?a.sqlite3_bind_parameter_index(this.pointer,w):void 0},getParamName:function(w){return B(this).parameterCount?a.sqlite3_bind_parameter_name(this.pointer,w):void 0},isBusy:function(){return a.sqlite3_stmt_busy(B(this))!==0},isReadOnly:function(){return a.sqlite3_stmt_readonly(B(this))!==0}};{const w={enumerable:!0,get:function(){return R.get(this)},set:()=>p("The pointer property is read-only.")};Object.defineProperty(S.prototype,"pointer",w),Object.defineProperty(le.prototype,"pointer",w)}if(Object.defineProperty(S.prototype,"columnCount",{enumerable:!1,get:function(){return a.sqlite3_column_count(this.pointer)},set:()=>p("The columnCount property is read-only.")}),Object.defineProperty(S.prototype,"parameterCount",{enumerable:!1,get:function(){return a.sqlite3_bind_parameter_count(this.pointer)},set:()=>p("The parameterCount property is read-only.")}),S.wrapHandle=function(w,u,_=!1){if(!(w instanceof le)||!w.pointer)throw new i.SQLite3Error(i.SQLITE_MISUSE,"First argument must be an opened sqlite3.oo1.DB instance");if(!u||!o.isPtr(u))throw new i.SQLite3Error(i.SQLITE_MISUSE,"Second argument must be a WASM sqlite3_stmt pointer");return new S(w,u,J,!!_)},i.oo1={DB:le,Stmt:S},h.isUIThread()){i.oo1.JsStorageDb=function(u="session"){const _=$.normalizeArgs(...arguments);u=_.filename,u!=="session"&&u!=="local"&&p("JsStorageDb db name must be one of 'session' or 'local'."),_.vfs="kvvfs",$.call(this,_)};const w=i.oo1.JsStorageDb;w.prototype=Object.create(le.prototype),w.clearStorage=a.sqlite3_js_kvvfs_clear,w.prototype.clearStorage=function(){return w.clearStorage(k(this).filename)},w.storageSize=a.sqlite3_js_kvvfs_size,w.prototype.storageSize=function(){return w.storageSize(k(this).filename)}}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const p=i.util;i.initWorker1API=(function(){const a=(...C)=>{throw new Error(C.join(" "))};globalThis.WorkerGlobalScope instanceof Function||a("initWorker1API() must be run from a Worker thread.");const o=this.sqlite3||a("Missing this.sqlite3 object."),h=o.oo1.DB,R=function(C){let $=j.idMap.get(C);return $||($="db#"+ ++j.idSeq+":"+Math.floor(Math.random()*1e8)+":"+Math.floor(Math.random()*1e8),j.idMap.set(C,$),$)},j={dbList:[],idSeq:0,idMap:new WeakMap,xfer:[],open:function(C){const $=new h(C);return this.dbs[R($)]=$,this.dbList.indexOf($)<0&&this.dbList.push($),$},close:function(C,$){if(C){delete this.dbs[R(C)];const le=C.filename,J=p.sqlite3__wasm_db_vfs(C.pointer,0);C.close();const S=this.dbList.indexOf(C);S>=0&&this.dbList.splice(S,1),$&&le&&J&&p.sqlite3__wasm_vfs_unlink(J,le)}},post:function(C,$){$&&$.length?(globalThis.postMessage(C,Array.from($)),$.length=0):globalThis.postMessage(C)},dbs:Object.create(null),getDb:function(C,$=!0){return this.dbs[C]||($?a("Unknown (or closed) DB ID:",C):void 0)}},ce=function(C=j.dbList[0]){return C&&C.pointer?C:a("DB is not opened.")},V=function(C,$=!0){const le=j.getDb(C.dbId,!1)||j.dbList[0];return $?ce(le):le},L=function(){return j.dbList[0]&&R(j.dbList[0])},D={open:function(C){const $=Object.create(null),le=C.args||Object.create(null);le.simulateError&&a("Throwing because of simulateError flag.");const J=Object.create(null);$.vfs=le.vfs,$.filename=le.filename||"";const S=j.open($);return J.filename=S.filename,J.persistent=!!o.capi.sqlite3_js_db_uses_vfs(S.pointer,"opfs"),J.dbId=R(S),J.vfs=S.dbVfsName(),J},close:function(C){const $=V(C,!1),le={filename:$&&$.filename};if($){const J=C.args&&typeof C.args=="object"?!!C.args.unlink:!1;j.close($,J)}return le},exec:function(C){const $=typeof C.args=="string"?{sql:C.args}:C.args||Object.create(null);$.rowMode==="stmt"?a("Invalid rowMode for 'exec': stmt mode","does not work in the Worker API."):$.sql||a("'exec' requires input SQL.");const le=V(C);($.callback||Array.isArray($.resultRows))&&(le._blobXfer=j.xfer);const J=$.callback;let S=0;const k=!!$.columnNames;typeof J=="string"&&(k||($.columnNames=[]),$.callback=function(O,M){j.post({type:J,columnNames:$.columnNames,rowNumber:++S,row:O},j.xfer)});try{const O=$.countChanges?le.changes(!0,$.countChanges===64):void 0;le.exec($),O!==void 0&&($.changeCount=le.changes(!0,$.countChanges===64)-O);const M=$.lastInsertRowId?o.capi.sqlite3_last_insert_rowid(le):void 0;M!==void 0&&($.lastInsertRowId=M),$.callback instanceof Function&&($.callback=J,j.post({type:J,columnNames:$.columnNames,rowNumber:null,row:void 0}))}finally{delete le._blobXfer,$.callback&&($.callback=J)}return $},"config-get":function(){const C=Object.create(null),$=o.config;return["bigIntEnabled"].forEach(function(le){Object.getOwnPropertyDescriptor($,le)&&(C[le]=$[le])}),C.version=o.version,C.vfsList=o.capi.sqlite3_js_vfs_list(),C},export:function(C){const $=V(C),le={byteArray:o.capi.sqlite3_js_db_export($.pointer),filename:$.filename,mimetype:"application/x-sqlite3"};return j.xfer.push(le.byteArray.buffer),le},toss:function(C){a("Testing worker exception")}};globalThis.onmessage=async function(C){C=C.data;let $,le=C.dbId,J=C.type;const S=performance.now();try{D.hasOwnProperty(J)&&D[J]instanceof Function?$=await D[J](C):a("Unknown db worker message type:",C.type)}catch(k){J="error",$={operation:C.type,message:k.message,errorClass:k.name,input:C},k.stack&&($.stack=typeof k.stack=="string"?k.stack.split(/\n\s*/):k.stack)}le||(le=$.dbId||L()),j.post({type:J,dbId:le,messageId:C.messageId,workerReceivedTime:S,workerRespondTime:performance.now(),departureTime:C.departureTime,result:$},j.xfer)},globalThis.postMessage({type:"sqlite3-api",result:"worker1-ready"})}).bind({sqlite3:i})}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const p=i.wasm,a=i.capi,o=i.util.toss3,h=Object.create(null);i.vfs=h,a.sqlite3_vfs.prototype.registerVfs=function(R=!1){this instanceof i.capi.sqlite3_vfs||o("Expecting a sqlite3_vfs-type argument.");const j=a.sqlite3_vfs_register(this,R?1:0);return j&&o("sqlite3_vfs_register(",this,") failed with rc",j),this.pointer!==a.sqlite3_vfs_find(this.$zName)&&o("BUG: sqlite3_vfs_find(vfs.$zName) failed for just-installed VFS",this),this},h.installVfs=function(R){let j=0;const ce=["io","vfs"];for(const V of ce){const L=R[V];L&&(++j,L.struct.installMethods(L.methods,!!L.applyArgcCheck),V==="vfs"&&(!L.struct.$zName&&typeof L.name=="string"&&L.struct.addOnDispose(L.struct.$zName=p.allocCString(L.name)),L.struct.registerVfs(!!L.asDefault)))}return j||o("Misuse: installVfs() options object requires at least","one of:",ce),this}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){if(!i.wasm.exports.sqlite3_declare_vtab)return;const p=i.wasm,a=i.capi,o=i.util.toss3,h=Object.create(null);i.vtab=h;const R=a.sqlite3_index_info;R.prototype.nthConstraint=function(V,L=!1){if(V<0||V>=this.$nConstraint)return!1;const D=p.ptr.add(this.$aConstraint,R.sqlite3_index_constraint.structInfo.sizeof*V);return L?D:new R.sqlite3_index_constraint(D)},R.prototype.nthConstraintUsage=function(V,L=!1){if(V<0||V>=this.$nConstraint)return!1;const D=p.ptr.add(this.$aConstraintUsage,R.sqlite3_index_constraint_usage.structInfo.sizeof*V);return L?D:new R.sqlite3_index_constraint_usage(D)},R.prototype.nthOrderBy=function(V,L=!1){if(V<0||V>=this.$nOrderBy)return!1;const D=p.ptr.add(this.$aOrderBy,R.sqlite3_index_orderby.structInfo.sizeof*V);return L?D:new R.sqlite3_index_orderby(D)};const j=function(V,L){return(function(D,C=!1){if(arguments.length===0&&(D=new L),D instanceof L)return this.set(D.pointer,D),D;p.isPtr(D)||i.SQLite3Error.toss("Invalid argument to",V+"()");let $=this.get(D);return C&&this.delete(D),$}).bind(new Map)},ce=function(V,L){const D=j(V,L);return Object.assign(Object.create(null),{StructType:L,create:C=>{const $=D();return p.pokePtr(C,$.pointer),$},get:C=>D(C),unget:C=>D(C,!0),dispose:C=>{const $=D(C,!0);$&&$.dispose()}})};h.xVtab=ce("xVtab",a.sqlite3_vtab),h.xCursor=ce("xCursor",a.sqlite3_vtab_cursor),h.xIndexInfo=V=>new a.sqlite3_index_info(V),h.xError=function V(L,D,C){if(V.errorReporter instanceof Function)try{V.errorReporter("sqlite3_module::"+L+"(): "+D.message)}catch{}let $;return D instanceof i.WasmAllocError?$=a.SQLITE_NOMEM:arguments.length>2?$=C:D instanceof i.SQLite3Error&&($=D.resultCode),$||a.SQLITE_ERROR},h.xError.errorReporter=i.config.error.bind(i.config),h.xRowid=(V,L)=>p.poke(V,L,"i64"),h.setupModule=function(V){let L=!1;const D=this instanceof a.sqlite3_module?this:V.struct||(L=new a.sqlite3_module);try{const C=V.methods||o("Missing 'methods' object.");for(const $ of Object.entries({xConnect:"xCreate",xDisconnect:"xDestroy"})){const le=$[0],J=$[1];C[le]===!0?C[le]=C[J]:C[J]===!0&&(C[J]=C[le])}if(V.catchExceptions){const $=function(S,k){return["xConnect","xCreate"].indexOf(S)>=0?function(O,M,F,P,B,m){try{return k(...arguments)||0}catch(y){return y instanceof i.WasmAllocError||(p.dealloc(p.peekPtr(m)),p.pokePtr(m,p.allocCString(y.message))),h.xError(S,y)}}:function(...O){try{return k(...O)||0}catch(M){return h.xError(S,M)}}},le=["xCreate","xConnect","xBestIndex","xDisconnect","xDestroy","xOpen","xClose","xFilter","xNext","xEof","xColumn","xRowid","xUpdate","xBegin","xSync","xCommit","xRollback","xFindFunction","xRename","xSavepoint","xRelease","xRollbackTo","xShadowName"],J=Object.create(null);for(const S of le){const k=C[S];if(k instanceof Function)S==="xConnect"&&C.xCreate===k?J[S]=C.xCreate:S==="xCreate"&&C.xConnect===k?J[S]=C.xConnect:J[S]=$(S,k);else continue}D.installMethods(J,!1)}else D.installMethods(C,!!V.applyArgcCheck);if(D.$iVersion===0){let $;typeof V.iVersion=="number"?$=V.iVersion:D.$xIntegrity?$=4:D.$xShadowName?$=3:D.$xSavePoint||D.$xRelease||D.$xRollbackTo?$=2:$=1,D.$iVersion=$}}catch(C){throw L&&L.dispose(),C}return D},a.sqlite3_module.prototype.setupModule=function(V){return h.setupModule.call(this,V)}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const p=function a(o){var j;if(!globalThis.SharedArrayBuffer||!globalThis.Atomics)return Promise.reject(new Error("Cannot install OPFS: Missing SharedArrayBuffer and/or Atomics. The server must emit the COOP/COEP response headers to enable those. See https://sqlite.org/wasm/doc/trunk/persistence.md#coop-coep"));if(typeof WorkerGlobalScope>"u")return Promise.reject(new Error("The OPFS sqlite3_vfs cannot run in the main thread because it requires Atomics.wait()."));if(!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle||!globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle||!((j=navigator==null?void 0:navigator.storage)!=null&&j.getDirectory))return Promise.reject(new Error("Missing required OPFS APIs."));(!o||typeof o!="object")&&(o=Object.create(null));const h=new URL(globalThis.location.href).searchParams;return h.has("opfs-disable")?Promise.resolve(i):(o.verbose===void 0&&(o.verbose=h.has("opfs-verbose")?+h.get("opfs-verbose")||2:1),o.sanityChecks===void 0&&(o.sanityChecks=h.has("opfs-sanity-check")),o.proxyUri===void 0&&(o.proxyUri=a.defaultProxyUri),typeof o.proxyUri=="function"&&(o.proxyUri=o.proxyUri()),new Promise(function(ce,V){const L=[i.config.error,i.config.warn,i.config.log],D=(x,...K)=>{o.verbose>x&&L[x]("OPFS syncer:",...K)},C=(...x)=>D(2,...x),$=(...x)=>D(1,...x),le=(...x)=>D(0,...x),J=i.util.toss,S=i.capi,k=i.util,O=i.wasm,M=S.sqlite3_vfs,F=S.sqlite3_file,P=S.sqlite3_io_methods,B=Object.create(null),m=()=>{var x;return globalThis.FileSystemHandle&&globalThis.FileSystemDirectoryHandle&&globalThis.FileSystemFileHandle&&globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle&&((x=navigator==null?void 0:navigator.storage)==null?void 0:x.getDirectory)};B.metrics={dump:function(){let x,K=0,Y=0,_e=0;for(x in _.opIds){const ue=b[x];K+=ue.count,Y+=ue.time,_e+=ue.wait,ue.avgTime=ue.count&&ue.time?ue.time/ue.count:0,ue.avgWait=ue.count&&ue.wait?ue.wait/ue.count:0}i.config.log(globalThis.location.href,"metrics for",globalThis.location.href,":",b,`
Total of`,K,"op(s) for",Y,"ms (incl. "+_e+" ms of waiting on the async side)"),i.config.log("Serialization metrics:",b.s11n),be.postMessage({type:"opfs-async-metrics"})},reset:function(){let x;const K=_e=>_e.count=_e.time=_e.wait=0;for(x in _.opIds)K(b[x]=Object.create(null));let Y=b.s11n=Object.create(null);Y=Y.serialize=Object.create(null),Y.count=Y.time=0,Y=b.s11n.deserialize=Object.create(null),Y.count=Y.time=0}};const y=new P,I=new M().addOnDispose(()=>y.dispose());let Z;const re=x=>(Z=!0,I.dispose(),V(x)),me=()=>(Z=!1,ce(i)),be=new Worker(new URL(o.proxyUri,import.meta.url));setTimeout(()=>{Z===void 0&&re(new Error("Timeout while waiting for OPFS async proxy worker."))},4e3),be._originalOnError=be.onerror,be.onerror=function(x){le("Error initializing OPFS asyncer:",x),re(new Error("Loading OPFS async Worker failed for unknown reasons."))};const w=S.sqlite3_vfs_find(null),u=w?new M(w):null;y.$iVersion=1,I.$iVersion=2,I.$szOsFile=S.sqlite3_file.structInfo.sizeof,I.$mxPathname=1024,I.$zName=O.allocCString("opfs"),I.$xDlOpen=I.$xDlError=I.$xDlSym=I.$xDlClose=null,I.addOnDispose("$zName",I.$zName,"cleanup default VFS wrapper",()=>u?u.dispose():null);const _=Object.create(null);_.verbose=o.verbose,_.littleEndian=(()=>{const x=new ArrayBuffer(2);return new DataView(x).setInt16(0,256,!0),new Int16Array(x)[0]===256})(),_.asyncIdleWaitTime=150,_.asyncS11nExceptions=1,_.fileBufferSize=1024*64,_.sabS11nOffset=_.fileBufferSize,_.sabS11nSize=I.$mxPathname*2,_.sabIO=new SharedArrayBuffer(_.fileBufferSize+_.sabS11nSize),_.opIds=Object.create(null);const b=Object.create(null);{let x=0;_.opIds.whichOp=x++,_.opIds.rc=x++,_.opIds.xAccess=x++,_.opIds.xClose=x++,_.opIds.xDelete=x++,_.opIds.xDeleteNoWait=x++,_.opIds.xFileSize=x++,_.opIds.xLock=x++,_.opIds.xOpen=x++,_.opIds.xRead=x++,_.opIds.xSleep=x++,_.opIds.xSync=x++,_.opIds.xTruncate=x++,_.opIds.xUnlock=x++,_.opIds.xWrite=x++,_.opIds.mkdir=x++,_.opIds["opfs-async-metrics"]=x++,_.opIds["opfs-async-shutdown"]=x++,_.opIds.retry=x++,_.sabOP=new SharedArrayBuffer(x*4),B.metrics.reset()}_.sq3Codes=Object.create(null),["SQLITE_ACCESS_EXISTS","SQLITE_ACCESS_READWRITE","SQLITE_BUSY","SQLITE_CANTOPEN","SQLITE_ERROR","SQLITE_IOERR","SQLITE_IOERR_ACCESS","SQLITE_IOERR_CLOSE","SQLITE_IOERR_DELETE","SQLITE_IOERR_FSYNC","SQLITE_IOERR_LOCK","SQLITE_IOERR_READ","SQLITE_IOERR_SHORT_READ","SQLITE_IOERR_TRUNCATE","SQLITE_IOERR_UNLOCK","SQLITE_IOERR_WRITE","SQLITE_LOCK_EXCLUSIVE","SQLITE_LOCK_NONE","SQLITE_LOCK_PENDING","SQLITE_LOCK_RESERVED","SQLITE_LOCK_SHARED","SQLITE_LOCKED","SQLITE_MISUSE","SQLITE_NOTFOUND","SQLITE_OPEN_CREATE","SQLITE_OPEN_DELETEONCLOSE","SQLITE_OPEN_MAIN_DB","SQLITE_OPEN_READONLY"].forEach(x=>{(_.sq3Codes[x]=S[x])===void 0&&J("Maintenance required: not found:",x)}),_.opfsFlags=Object.assign(Object.create(null),{OPFS_UNLOCK_ASAP:1,OPFS_UNLINK_BEFORE_OPEN:2,defaultUnlockAsap:!1});const E=(x,...K)=>{const Y=_.opIds[x]||J("Invalid op ID:",x);_.s11n.serialize(...K),Atomics.store(_.sabOPView,_.opIds.rc,-1),Atomics.store(_.sabOPView,_.opIds.whichOp,Y),Atomics.notify(_.sabOPView,_.opIds.whichOp);const _e=performance.now();for(;Atomics.wait(_.sabOPView,_.opIds.rc,-1)!=="not-equal";);const ue=Atomics.load(_.sabOPView,_.opIds.rc);if(b[x].wait+=performance.now()-_e,ue&&_.asyncS11nExceptions){const Se=_.s11n.deserialize();Se&&le(x+"() async error:",...Se)}return ue};B.debug={asyncShutdown:()=>{$("Shutting down OPFS async listener. The OPFS VFS will no longer work."),E("opfs-async-shutdown")},asyncRestart:()=>{$("Attempting to restart OPFS VFS async listener. Might work, might not."),be.postMessage({type:"opfs-async-restart"})}};const H=()=>{if(_.s11n)return _.s11n;const x=new TextDecoder,K=new TextEncoder("utf-8"),Y=new Uint8Array(_.sabIO,_.sabS11nOffset,_.sabS11nSize),_e=new DataView(_.sabIO,_.sabS11nOffset,_.sabS11nSize);_.s11n=Object.create(null);const ue=Object.create(null);ue.number={id:1,size:8,getter:"getFloat64",setter:"setFloat64"},ue.bigint={id:2,size:8,getter:"getBigInt64",setter:"setBigInt64"},ue.boolean={id:3,size:4,getter:"getInt32",setter:"setInt32"},ue.string={id:4};const Se=W=>ue[typeof W]||J("Maintenance required: this value type cannot be serialized.",W),ve=W=>{switch(W){case ue.number.id:return ue.number;case ue.bigint.id:return ue.bigint;case ue.boolean.id:return ue.boolean;case ue.string.id:return ue.string;default:J("Invalid type ID:",W)}};return _.s11n.deserialize=function(W=!1){++b.s11n.deserialize.count;const A=performance.now(),U=Y[0],X=U?[]:null;if(U){const ie=[];let fe=1,Ae,Re,N;for(Ae=0;Ae<U;++Ae,++fe)ie.push(ve(Y[fe]));for(Ae=0;Ae<U;++Ae){const oe=ie[Ae];oe.getter?(N=_e[oe.getter](fe,_.littleEndian),fe+=oe.size):(Re=_e.getInt32(fe,_.littleEndian),fe+=4,N=x.decode(Y.slice(fe,fe+Re)),fe+=Re),X.push(N)}}return W&&(Y[0]=0),b.s11n.deserialize.time+=performance.now()-A,X},_.s11n.serialize=function(...W){const A=performance.now();if(++b.s11n.serialize.count,W.length){const U=[];let X=0,ie=1;for(Y[0]=W.length&255;X<W.length;++X,++ie)U.push(Se(W[X])),Y[ie]=U[X].id;for(X=0;X<W.length;++X){const fe=U[X];if(fe.setter)_e[fe.setter](ie,W[X],_.littleEndian),ie+=fe.size;else{const Ae=K.encode(W[X]);_e.setInt32(ie,Ae.byteLength,_.littleEndian),ie+=4,Y.set(Ae,ie),ie+=Ae.byteLength}}}else Y[0]=0;b.s11n.serialize.time+=performance.now()-A},_.s11n},te=function x(K=16){x._chars||(x._chars="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ012346789",x._n=x._chars.length);const Y=[];let _e=0;for(;_e<K;++_e){const ue=Math.random()*(x._n*64)%x._n|0;Y[_e]=x._chars[ue]}return Y.join("")},he=Object.create(null),se=Object.create(null);se.op=void 0,se.start=void 0;const Ee=x=>{se.start=performance.now(),se.op=x,++b[x].count},ye=()=>b[se.op].time+=performance.now()-se.start,Pe={xCheckReservedLock:function(x,K){return O.poke(K,0,"i32"),0},xClose:function(x){Ee("xClose");let K=0;const Y=he[x];return Y&&(delete he[x],K=E("xClose",x),Y.sq3File&&Y.sq3File.dispose()),ye(),K},xDeviceCharacteristics:function(x){return S.SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN},xFileControl:function(x,K,Y){return S.SQLITE_NOTFOUND},xFileSize:function(x,K){Ee("xFileSize");let Y=E("xFileSize",x);if(Y==0)try{const _e=_.s11n.deserialize()[0];O.poke(K,_e,"i64")}catch(_e){le("Unexpected error reading xFileSize() result:",_e),Y=_.sq3Codes.SQLITE_IOERR}return ye(),Y},xLock:function(x,K){Ee("xLock");const Y=he[x];let _e=0;return Y.lockType?Y.lockType=K:(_e=E("xLock",x,K),_e===0&&(Y.lockType=K)),ye(),_e},xRead:function(x,K,Y,_e){Ee("xRead");const ue=he[x];let Se;try{Se=E("xRead",x,Y,Number(_e)),(Se===0||S.SQLITE_IOERR_SHORT_READ===Se)&&O.heap8u().set(ue.sabView.subarray(0,Y),Number(K))}catch(ve){le("xRead(",arguments,") failed:",ve,ue),Se=S.SQLITE_IOERR_READ}return ye(),Se},xSync:function(x,K){Ee("xSync"),++b.xSync.count;const Y=E("xSync",x,K);return ye(),Y},xTruncate:function(x,K){Ee("xTruncate");const Y=E("xTruncate",x,Number(K));return ye(),Y},xUnlock:function(x,K){Ee("xUnlock");const Y=he[x];let _e=0;return S.SQLITE_LOCK_NONE===K&&Y.lockType&&(_e=E("xUnlock",x,K)),_e===0&&(Y.lockType=K),ye(),_e},xWrite:function(x,K,Y,_e){Ee("xWrite");const ue=he[x];let Se;try{ue.sabView.set(O.heap8u().subarray(Number(K),Number(K)+Y)),Se=E("xWrite",x,Y,Number(_e))}catch(ve){le("xWrite(",arguments,") failed:",ve,ue),Se=S.SQLITE_IOERR_WRITE}return ye(),Se}},xe={xAccess:function(x,K,Y,_e){Ee("xAccess");const ue=E("xAccess",O.cstrToJs(K));return O.poke(_e,ue?0:1,"i32"),ye(),0},xCurrentTime:function(x,K){return O.poke(K,24405875e-1+new Date().getTime()/864e5,"double"),0},xCurrentTimeInt64:function(x,K){return O.poke(K,24405875e-1*864e5+new Date().getTime(),"i64"),0},xDelete:function(x,K,Y){Ee("xDelete");const _e=E("xDelete",O.cstrToJs(K),Y,!1);return ye(),_e},xFullPathname:function(x,K,Y,_e){return O.cstrncpy(_e,K,Y)<Y?0:S.SQLITE_CANTOPEN},xGetLastError:function(x,K,Y){return $("OPFS xGetLastError() has nothing sensible to return."),0},xOpen:function(K,Y,_e,ue,Se){Ee("xOpen");let ve=0;Y===0?Y=te():O.isPtr(Y)&&(S.sqlite3_uri_boolean(Y,"opfs-unlock-asap",0)&&(ve|=_.opfsFlags.OPFS_UNLOCK_ASAP),S.sqlite3_uri_boolean(Y,"delete-before-open",0)&&(ve|=_.opfsFlags.OPFS_UNLINK_BEFORE_OPEN),Y=O.cstrToJs(Y));const W=Object.create(null);W.fid=_e,W.filename=Y,W.sab=new SharedArrayBuffer(_.fileBufferSize),W.flags=ue,W.readOnly=!(i.SQLITE_OPEN_CREATE&ue)&&!!(ue&S.SQLITE_OPEN_READONLY);const A=E("xOpen",_e,Y,ue,ve);return A||(W.readOnly&&O.poke(Se,S.SQLITE_OPEN_READONLY,"i32"),he[_e]=W,W.sabView=_.sabFileBufView,W.sq3File=new F(_e),W.sq3File.$pMethods=y.pointer,W.lockType=S.SQLITE_LOCK_NONE),ye(),A}};u&&(I.$xRandomness=u.$xRandomness,I.$xSleep=u.$xSleep),I.$xRandomness||(xe.xRandomness=function(x,K,Y){const _e=O.heap8u();let ue=0;const Se=Number(Y);for(;ue<K;++ue)_e[Se+ue]=Math.random()*255e3&255;return ue}),I.$xSleep||(xe.xSleep=function(x,K){return Atomics.wait(_.sabOPView,_.opIds.xSleep,0,K),0}),B.getResolvedPath=function(x,K){const Y=new URL(x,"file://irrelevant").pathname;return K?Y.split("/").filter(_e=>!!_e):Y},B.getDirForFilename=async function(K,Y=!1){const _e=B.getResolvedPath(K,!0),ue=_e.pop();let Se=B.rootDirectory;for(const ve of _e)ve&&(Se=await Se.getDirectoryHandle(ve,{create:!!Y}));return[Se,ue]},B.mkdir=async function(x){try{return await B.getDirForFilename(x+"/filepart",!0),!0}catch{return!1}},B.entryExists=async function(x){try{const[K,Y]=await B.getDirForFilename(x);return await K.getFileHandle(Y),!0}catch{return!1}},B.randomFilename=te,B.treeList=async function(){const x=async function Y(_e,ue){ue.name=_e.name,ue.dirs=[],ue.files=[];for await(const Se of _e.values())if(Se.kind==="directory"){const ve=Object.create(null);ue.dirs.push(ve),await Y(Se,ve)}else ue.files.push(Se.name)},K=Object.create(null);return await x(B.rootDirectory,K),K},B.rmfr=async function(){const x=B.rootDirectory,K={recurse:!0};for await(const Y of x.values())x.removeEntry(Y.name,K)},B.unlink=async function(x,K=!1,Y=!1){try{const[_e,ue]=await B.getDirForFilename(x,!1);return await _e.removeEntry(ue,{recursive:K}),!0}catch(_e){if(Y)throw new Error("unlink(",arguments[0],") failed: "+_e.message,{cause:_e});return!1}},B.traverse=async function(x){const K={recursive:!0,directory:B.rootDirectory};typeof x=="function"&&(x={callback:x}),x=Object.assign(K,x||{}),async function _e(ue,Se){for await(const ve of ue.values()){if(x.callback(ve,ue,Se)===!1)return!1;if(x.recursive&&ve.kind==="directory"&&await _e(ve,Se+1)===!1)break}}(x.directory,0)};const ze=async function(x,K){const[Y,_e]=await B.getDirForFilename(x,!0);let Se=await(await Y.getFileHandle(_e,{create:!0})).createSyncAccessHandle(),ve=0,W,A=!1;try{for(Se.truncate(0);(W=await K())!==void 0;)W instanceof ArrayBuffer&&(W=new Uint8Array(W)),!A&&ve===0&&W.byteLength>=15&&(k.affirmDbHeader(W),A=!0),Se.write(W,{at:ve}),ve+=W.byteLength;if((ve<512||ve%512!==0)&&J("Input size",ve,"is not correct for an SQLite database."),!A){const U=new Uint8Array(20);Se.read(U,{at:0}),k.affirmDbHeader(U)}return Se.write(new Uint8Array([1,1]),{at:18}),ve}catch(U){throw await Se.close(),Se=void 0,await Y.removeEntry(_e).catch(()=>{}),U}finally{Se&&await Se.close()}};if(B.importDb=async function(x,K){if(K instanceof Function)return ze(x,K);K instanceof ArrayBuffer&&(K=new Uint8Array(K)),k.affirmIsDb(K);const Y=K.byteLength,[_e,ue]=await B.getDirForFilename(x,!0);let Se,ve=0;try{return Se=await(await _e.getFileHandle(ue,{create:!0})).createSyncAccessHandle(),Se.truncate(0),ve=Se.write(K,{at:0}),ve!=Y&&J("Expected to write "+Y+" bytes but wrote "+ve+"."),Se.write(new Uint8Array([1,1]),{at:18}),ve}catch(W){throw Se&&(await Se.close(),Se=void 0),await _e.removeEntry(ue).catch(()=>{}),W}finally{Se&&await Se.close()}},i.oo1){const x=function(...K){const Y=i.oo1.DB.dbCtorHelper.normalizeArgs(...K);Y.vfs=I.$zName,i.oo1.DB.dbCtorHelper.call(this,Y)};x.prototype=Object.create(i.oo1.DB.prototype),i.oo1.OpfsDb=x,x.importDb=B.importDb,i.oo1.DB.dbCtorHelper.setVfsPostOpenCallback(I.pointer,function(K,Y){Y.capi.sqlite3_busy_timeout(K,1e4)})}const et=function(){const x=O.scopedAllocPush(),K=new F;try{const Y=K.pointer,_e=S.SQLITE_OPEN_CREATE|S.SQLITE_OPEN_READWRITE|S.SQLITE_OPEN_MAIN_DB,ue=O.scopedAlloc(8),Se="/sanity/check/file"+te(8),ve=O.scopedAllocCString(Se);let W;if(_.s11n.serialize("This is  string."),W=_.s11n.deserialize(),C("deserialize() says:",W),W[0]!=="This is  string."&&J("String d13n error."),xe.xAccess(I.pointer,ve,0,ue),W=O.peek(ue,"i32"),C("xAccess(",Se,") exists ?=",W),W=xe.xOpen(I.pointer,ve,Y,_e,ue),C("open rc =",W,"state.sabOPView[xOpen] =",_.sabOPView[_.opIds.xOpen]),W!==0){le("open failed with code",W);return}xe.xAccess(I.pointer,ve,0,ue),W=O.peek(ue,"i32"),W||J("xAccess() failed to detect file."),W=Pe.xSync(K.pointer,0),W&&J("sync failed w/ rc",W),W=Pe.xTruncate(K.pointer,1024),W&&J("truncate failed w/ rc",W),O.poke(ue,0,"i64"),W=Pe.xFileSize(K.pointer,ue),W&&J("xFileSize failed w/ rc",W),C("xFileSize says:",O.peek(ue,"i64")),W=Pe.xWrite(K.pointer,ve,10,1),W&&J("xWrite() failed!");const A=O.scopedAlloc(16);W=Pe.xRead(K.pointer,A,6,2),O.poke(A+6,0);let U=O.cstrToJs(A);C("xRead() got:",U),U!=="sanity"&&J("Unexpected xRead() value."),xe.xSleep&&(C("xSleep()ing before close()ing..."),xe.xSleep(I.pointer,2e3),C("waking up from xSleep()")),W=Pe.xClose(Y),C("xClose rc =",W,"sabOPView =",_.sabOPView),C("Deleting file:",Se),xe.xDelete(I.pointer,ve,4660),xe.xAccess(I.pointer,ve,0,ue),W=O.peek(ue,"i32"),W&&J("Expecting 0 from xAccess(",Se,") after xDelete()."),$("End of OPFS sanity checks.")}finally{K.dispose(),O.scopedAllocPop(x)}};be.onmessage=function({data:x}){switch(x.type){case"opfs-unavailable":re(new Error(x.payload.join(" ")));break;case"opfs-async-loaded":be.postMessage({type:"opfs-async-init",args:_});break;case"opfs-async-inited":{if(Z===!0)break;try{i.vfs.installVfs({io:{struct:y,methods:Pe},vfs:{struct:I,methods:xe}}),_.sabOPView=new Int32Array(_.sabOP),_.sabFileBufView=new Uint8Array(_.sabIO,0,_.fileBufferSize),_.sabS11nView=new Uint8Array(_.sabIO,_.sabS11nOffset,_.sabS11nSize),H(),o.sanityChecks&&($("Running sanity checks because of opfs-sanity-check URL arg..."),et()),m()?navigator.storage.getDirectory().then(K=>{be.onerror=be._originalOnError,delete be._originalOnError,i.opfs=B,B.rootDirectory=K,C("End of OPFS sqlite3_vfs setup.",I),me()}).catch(re):me()}catch(K){le(K),re(K)}break}default:{const K="Unexpected message from the OPFS async worker: "+JSON.stringify(x);le(K),re(new Error(K));break}}}}))};p.defaultProxyUri="sqlite3-opfs-async-proxy.js",globalThis.sqlite3ApiBootstrap.initializersAsync.push(async a=>{try{let o=p.defaultProxyUri;return a.scriptInfo.sqlite3Dir&&(p.defaultProxyUri=a.scriptInfo.sqlite3Dir+o),p().catch(h=>{a.config.warn("Ignoring inability to install OPFS sqlite3_vfs:",h.message)})}catch(o){return a.config.error("installOpfsVfs() exception:",o),Promise.reject(o)}})}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){var se,Ee,ye,Pe,xe,ze,et,x,K,Y,_e,ue,Kt,ve;const p=i.util.toss,a=i.util.toss3,o=Object.create(null),h=i.capi,R=i.util,j=i.wasm,ce=4096,V=512,L=4,D=8,C=V+L,$=V,le=C,J=ce,S=h.SQLITE_OPEN_MAIN_DB|h.SQLITE_OPEN_MAIN_JOURNAL|h.SQLITE_OPEN_SUPER_JOURNAL|h.SQLITE_OPEN_WAL,k=h.SQLITE_OPEN_MEMORY,O=".opaque",M=()=>Math.random().toString(36).slice(2),F=new TextDecoder,P=new TextEncoder,B=Object.assign(Object.create(null),{name:"opfs-sahpool",directory:void 0,initialCapacity:6,clearOnInit:!1,verbosity:2,forceReinitIfPreviouslyFailed:!1}),m=[i.config.error,i.config.warn,i.config.log];i.config.log;const y=i.config.warn;i.config.error;const I=new Map,Z=W=>I.get(W),re=(W,A)=>{A?I.set(W,A):I.delete(W)},me=new Map,be=W=>me.get(W),w=(W,A)=>{A?me.set(W,A):me.delete(W)},u={xCheckReservedLock:function(W,A){const U=be(W);return U.log("xCheckReservedLock"),U.storeErr(),j.poke32(A,1),0},xClose:function(W){const A=be(W);A.storeErr();const U=A.getOFileForS3File(W);if(U)try{A.log(`xClose ${U.path}`),A.mapS3FileToOFile(W,!1),U.sah.flush(),U.flags&h.SQLITE_OPEN_DELETEONCLOSE&&A.deletePath(U.path)}catch(X){return A.storeErr(X,h.SQLITE_IOERR)}return 0},xDeviceCharacteristics:function(W){return h.SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN},xFileControl:function(W,A,U){return h.SQLITE_NOTFOUND},xFileSize:function(W,A){const U=be(W);U.log("xFileSize");const ie=U.getOFileForS3File(W).sah.getSize()-J;return j.poke64(A,BigInt(ie)),0},xLock:function(W,A){const U=be(W);U.log(`xLock ${A}`),U.storeErr();const X=U.getOFileForS3File(W);return X.lockType=A,0},xRead:function(W,A,U,X){const ie=be(W);ie.storeErr();const fe=ie.getOFileForS3File(W);ie.log(`xRead ${fe.path} ${U} @ ${X}`);try{const Ae=fe.sah.read(j.heap8u().subarray(Number(A),Number(A)+U),{at:J+Number(X)});return Ae<U?(j.heap8u().fill(0,Number(A)+Ae,Number(A)+U),h.SQLITE_IOERR_SHORT_READ):0}catch(Ae){return ie.storeErr(Ae,h.SQLITE_IOERR)}},xSectorSize:function(W){return ce},xSync:function(W,A){const U=be(W);U.log(`xSync ${A}`),U.storeErr();const X=U.getOFileForS3File(W);try{return X.sah.flush(),0}catch(ie){return U.storeErr(ie,h.SQLITE_IOERR)}},xTruncate:function(W,A){const U=be(W);U.log(`xTruncate ${A}`),U.storeErr();const X=U.getOFileForS3File(W);try{return X.sah.truncate(J+Number(A)),0}catch(ie){return U.storeErr(ie,h.SQLITE_IOERR)}},xUnlock:function(W,A){const U=be(W);U.log("xUnlock");const X=U.getOFileForS3File(W);return X.lockType=A,0},xWrite:function(W,A,U,X){const ie=be(W);ie.storeErr();const fe=ie.getOFileForS3File(W);ie.log(`xWrite ${fe.path} ${U} ${X}`);try{const Ae=fe.sah.write(j.heap8u().subarray(Number(A),Number(A)+U),{at:J+Number(X)});return U===Ae?0:p("Unknown write() failure.")}catch(Ae){return ie.storeErr(Ae,h.SQLITE_IOERR)}}},_=new h.sqlite3_io_methods;_.$iVersion=1,i.vfs.installVfs({io:{struct:_,methods:u}});const b={xAccess:function(W,A,U,X){const ie=Z(W);ie.storeErr();try{const fe=ie.getPath(A);j.poke32(X,ie.hasFilename(fe)?1:0)}catch{j.poke32(X,0)}return 0},xCurrentTime:function(W,A){return j.poke(A,24405875e-1+new Date().getTime()/864e5,"double"),0},xCurrentTimeInt64:function(W,A){return j.poke(A,24405875e-1*864e5+new Date().getTime(),"i64"),0},xDelete:function(W,A,U){const X=Z(W);X.log(`xDelete ${j.cstrToJs(A)}`),X.storeErr();try{return X.deletePath(X.getPath(A)),0}catch(ie){return X.storeErr(ie),h.SQLITE_IOERR_DELETE}},xFullPathname:function(W,A,U,X){return j.cstrncpy(X,A,U)<U?0:h.SQLITE_CANTOPEN},xGetLastError:function(W,A,U){const X=Z(W),ie=X.popErr();if(X.log(`xGetLastError ${A} e =`,ie),ie){const fe=j.scopedAllocPush();try{const[Ae,Re]=j.scopedAllocCString(ie.message,!0);j.cstrncpy(U,Ae,A),Re>A&&j.poke8(U+A-1,0)}catch{return h.SQLITE_NOMEM}finally{j.scopedAllocPop(fe)}}return ie?ie.sqlite3Rc||h.SQLITE_IOERR:0},xOpen:function(A,U,X,ie,fe){const Ae=Z(A);try{ie&=~k,Ae.log(`xOpen ${j.cstrToJs(U)} ${ie}`);const Re=U&&j.peek8(U)?Ae.getPath(U):M();let N=Ae.getSAHForPath(Re);!N&&ie&h.SQLITE_OPEN_CREATE&&(Ae.getFileCount()<Ae.getCapacity()?(N=Ae.nextAvailableSAH(),Ae.setAssociatedPath(N,Re,ie)):p("SAH pool is full. Cannot create file",Re)),N||p("file not found:",Re);const oe={path:Re,flags:ie,sah:N};Ae.mapS3FileToOFile(X,oe),oe.lockType=h.SQLITE_LOCK_NONE;const pe=new h.sqlite3_file(X);return pe.$pMethods=_.pointer,pe.dispose(),j.poke32(fe,ie),0}catch(Re){return Ae.storeErr(Re),h.SQLITE_CANTOPEN}}},E=function(W){i.capi.sqlite3_vfs_find(W)&&a("VFS name is already registered:",W);const A=new h.sqlite3_vfs,U=h.sqlite3_vfs_find(null),X=U?new h.sqlite3_vfs(U):null;return A.$iVersion=2,A.$szOsFile=h.sqlite3_file.structInfo.sizeof,A.$mxPathname=V,A.addOnDispose(A.$zName=j.allocCString(W),()=>re(A.pointer,0)),X&&(A.$xRandomness=X.$xRandomness,A.$xSleep=X.$xSleep,X.dispose()),!A.$xRandomness&&!b.xRandomness&&(b.xRandomness=function(ie,fe,Ae){const Re=j.heap8u();let N=0;const oe=Number(Ae);for(;N<fe;++N)Re[oe+N]=Math.random()*255e3&255;return N}),!A.$xSleep&&!b.xSleep&&(b.xSleep=(ie,fe)=>0),i.vfs.installVfs({vfs:{struct:A,methods:b}}),A};class H{constructor(A=Object.create(null)){lt(this,ue);Ye(this,"vfsDir");lt(this,se);lt(this,Ee);lt(this,ye);lt(this,Pe,new Map);lt(this,xe,new Map);lt(this,ze,new Set);lt(this,et,new Map);lt(this,x,new Uint8Array(C));lt(this,K);lt(this,Y);lt(this,_e);ft(this,_e,A.verbosity??B.verbosity),this.vfsName=A.name||B.name,ft(this,Y,E(this.vfsName)),re(de(this,Y).pointer,this),this.vfsDir=A.directory||"."+this.vfsName,ft(this,K,new DataView(de(this,x).buffer,de(this,x).byteOffset)),this.isReady=this.reset(!!(A.clearOnInit??B.clearOnInit)).then(()=>{if(this.$error)throw this.$error;return this.getCapacity()?Promise.resolve(void 0):this.addCapacity(A.initialCapacity||B.initialCapacity)})}log(...A){Wt(this,ue,Kt).call(this,2,...A)}warn(...A){Wt(this,ue,Kt).call(this,1,...A)}error(...A){Wt(this,ue,Kt).call(this,0,...A)}getVfs(){return de(this,Y)}getCapacity(){return de(this,Pe).size}getFileCount(){return de(this,xe).size}getFileNames(){const A=[];for(const U of de(this,xe).keys())A.push(U);return A}async addCapacity(A){for(let U=0;U<A;++U){const X=M(),fe=await(await de(this,Ee).getFileHandle(X,{create:!0})).createSyncAccessHandle();de(this,Pe).set(fe,X),this.setAssociatedPath(fe,"",0)}return this.getCapacity()}async reduceCapacity(A){let U=0;for(const X of Array.from(de(this,ze))){if(U===A||this.getFileCount()===this.getCapacity())break;const ie=de(this,Pe).get(X);X.close(),await de(this,Ee).removeEntry(ie),de(this,Pe).delete(X),de(this,ze).delete(X),++U}return U}releaseAccessHandles(){for(const A of de(this,Pe).keys())A.close();de(this,Pe).clear(),de(this,xe).clear(),de(this,ze).clear()}async acquireAccessHandles(A=!1){const U=[];for await(const[X,ie]of de(this,Ee))ie.kind==="file"&&U.push([X,ie]);return Promise.all(U.map(async([X,ie])=>{try{const fe=await ie.createSyncAccessHandle();if(de(this,Pe).set(fe,X),A)fe.truncate(J),this.setAssociatedPath(fe,"",0);else{const Ae=this.getAssociatedPath(fe);Ae?de(this,xe).set(Ae,fe):de(this,ze).add(fe)}}catch(fe){throw this.storeErr(fe),this.releaseAccessHandles(),fe}}))}getAssociatedPath(A){A.read(de(this,x),{at:0});const U=de(this,K).getUint32($);if(de(this,x)[0]&&(U&h.SQLITE_OPEN_DELETEONCLOSE||!(U&S)))return y(`Removing file with unexpected flags ${U.toString(16)}`,de(this,x)),this.setAssociatedPath(A,"",0),"";const X=new Uint32Array(D/4);A.read(X,{at:le});const ie=this.computeDigest(de(this,x),U);if(X.every((fe,Ae)=>fe===ie[Ae])){const fe=de(this,x).findIndex(Ae=>Ae===0);return fe===0&&A.truncate(J),fe?F.decode(de(this,x).subarray(0,fe)):""}else return y("Disassociating file with bad digest."),this.setAssociatedPath(A,"",0),""}setAssociatedPath(A,U,X){const ie=P.encodeInto(U,de(this,x));V<=ie.written+1&&p("Path too long:",U),U&&X&&(X|=k),de(this,x).fill(0,ie.written,V),de(this,K).setUint32($,X);const fe=this.computeDigest(de(this,x),X);A.write(de(this,x),{at:0}),A.write(fe,{at:le}),A.flush(),U?(de(this,xe).set(U,A),de(this,ze).delete(A)):(A.truncate(J),de(this,ze).add(A))}computeDigest(A,U){if(U&k){let X=3735928559,ie=1103547991;for(const fe of A)X=Math.imul(X^fe,2654435761),ie=Math.imul(ie^fe,104729);return new Uint32Array([X>>>0,ie>>>0])}else return new Uint32Array([0,0])}async reset(A){await this.isReady;let U=await navigator.storage.getDirectory(),X;for(const ie of this.vfsDir.split("/"))ie&&(X=U,U=await U.getDirectoryHandle(ie,{create:!0}));return ft(this,se,U),ft(this,ye,X),ft(this,Ee,await de(this,se).getDirectoryHandle(O,{create:!0})),this.releaseAccessHandles(),this.acquireAccessHandles(A)}getPath(A){return j.isPtr(A)&&(A=j.cstrToJs(A)),(A instanceof URL?A:new URL(A,"file://localhost/")).pathname}deletePath(A){const U=de(this,xe).get(A);return U&&(de(this,xe).delete(A),this.setAssociatedPath(U,"",0)),!!U}storeErr(A,U){return A&&(A.sqlite3Rc=U||h.SQLITE_IOERR,this.error(A)),this.$error=A,U}popErr(){const A=this.$error;return this.$error=void 0,A}nextAvailableSAH(){const[A]=de(this,ze).keys();return A}getOFileForS3File(A){return de(this,et).get(A)}mapS3FileToOFile(A,U){U?(de(this,et).set(A,U),w(A,this)):(de(this,et).delete(A),w(A,!1))}hasFilename(A){return de(this,xe).has(A)}getSAHForPath(A){return de(this,xe).get(A)}async removeVfs(){if(!de(this,Y).pointer||!de(this,Ee))return!1;h.sqlite3_vfs_unregister(de(this,Y).pointer),de(this,Y).dispose(),delete o[this.vfsName];try{this.releaseAccessHandles(),await de(this,se).removeEntry(O,{recursive:!0}),ft(this,Ee,void 0),await de(this,ye).removeEntry(de(this,se).name,{recursive:!0}),ft(this,se,ft(this,ye,void 0))}catch(A){i.config.error(this.vfsName,"removeVfs() failed with no recovery strategy:",A)}return!0}pauseVfs(){return de(this,et).size>0&&i.SQLite3Error.toss(h.SQLITE_MISUSE,"Cannot pause VFS",this.vfsName,"because it has opened files."),de(this,Pe).size>0&&(h.sqlite3_vfs_unregister(this.vfsName),this.releaseAccessHandles()),this}isPaused(){return de(this,Pe).size===0}async unpauseVfs(){return de(this,Pe).size===0?this.acquireAccessHandles(!1).then(()=>h.sqlite3_vfs_register(de(this,Y),0),this):this}exportFile(A){const U=de(this,xe).get(A)||p("File not found:",A),X=U.getSize()-J,ie=new Uint8Array(X>0?X:0);if(X>0){const fe=U.read(ie,{at:J});fe!=X&&p("Expected to read "+X+" bytes but read "+fe+".")}return ie}async importDbChunked(A,U){const X=de(this,xe).get(A)||this.nextAvailableSAH()||p("No available handles to import to.");X.truncate(0);let ie=0,fe,Ae=!1;try{for(;(fe=await U())!==void 0;)fe instanceof ArrayBuffer&&(fe=new Uint8Array(fe)),!Ae&&ie===0&&fe.byteLength>=15&&(R.affirmDbHeader(fe),Ae=!0),X.write(fe,{at:J+ie}),ie+=fe.byteLength;if((ie<512||ie%512!==0)&&p("Input size",ie,"is not correct for an SQLite database."),!Ae){const Re=new Uint8Array(20);X.read(Re,{at:0}),R.affirmDbHeader(Re)}X.write(new Uint8Array([1,1]),{at:J+18})}catch(Re){throw this.setAssociatedPath(X,"",0),Re}return this.setAssociatedPath(X,A,h.SQLITE_OPEN_MAIN_DB),ie}importDb(A,U){if(U instanceof ArrayBuffer)U=new Uint8Array(U);else if(U instanceof Function)return this.importDbChunked(A,U);const X=de(this,xe).get(A)||this.nextAvailableSAH()||p("No available handles to import to."),ie=U.byteLength;(ie<512||ie%512!=0)&&p("Byte array size is invalid for an SQLite db.");const fe="SQLite format 3";for(let Re=0;Re<fe.length;++Re)fe.charCodeAt(Re)!==U[Re]&&p("Input does not contain an SQLite database header.");const Ae=X.write(U,{at:J});return Ae!=ie?(this.setAssociatedPath(X,"",0),p("Expected to write "+ie+" bytes but wrote "+Ae+".")):(X.write(new Uint8Array([1,1]),{at:J+18}),this.setAssociatedPath(X,A,h.SQLITE_OPEN_MAIN_DB)),Ae}}se=new WeakMap,Ee=new WeakMap,ye=new WeakMap,Pe=new WeakMap,xe=new WeakMap,ze=new WeakMap,et=new WeakMap,x=new WeakMap,K=new WeakMap,Y=new WeakMap,_e=new WeakMap,ue=new WeakSet,Kt=function(A,...U){de(this,_e)>A&&m[A](this.vfsName+":",...U)};class te{constructor(A){lt(this,ve);ft(this,ve,A),this.vfsName=A.vfsName}async addCapacity(A){return de(this,ve).addCapacity(A)}async reduceCapacity(A){return de(this,ve).reduceCapacity(A)}getCapacity(){return de(this,ve).getCapacity(de(this,ve))}getFileCount(){return de(this,ve).getFileCount()}getFileNames(){return de(this,ve).getFileNames()}async reserveMinimumCapacity(A){const U=de(this,ve).getCapacity();return U<A?de(this,ve).addCapacity(A-U):U}exportFile(A){return de(this,ve).exportFile(A)}importDb(A,U){return de(this,ve).importDb(A,U)}async wipeFiles(){return de(this,ve).reset(!0)}unlink(A){return de(this,ve).deletePath(A)}async removeVfs(){return de(this,ve).removeVfs()}pauseVfs(){return de(this,ve).pauseVfs(),this}async unpauseVfs(){return de(this,ve).unpauseVfs().then(()=>this)}isPaused(){return de(this,ve).isPaused()}}ve=new WeakMap;const he=async()=>{const W=await navigator.storage.getDirectory(),A=".opfs-sahpool-sync-check-"+M(),ie=(await(await W.getFileHandle(A,{create:!0})).createSyncAccessHandle()).close();return await ie,await W.removeEntry(A),ie!=null&&ie.then&&p("The local OPFS API is too old for opfs-sahpool:","it has an async FileSystemSyncAccessHandle.close() method."),!0};i.installOpfsSAHPoolVfs=async function(W=Object.create(null)){var U;W=Object.assign(Object.create(null),B,W||{});const A=W.name;if(W.$testThrowPhase1)throw W.$testThrowPhase1;if(o[A])try{return await o[A]}catch(X){if(W.forceReinitIfPreviouslyFailed)delete o[A];else throw X}return!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle||!globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle||!((U=navigator==null?void 0:navigator.storage)!=null&&U.getDirectory)?o[A]=Promise.reject(new Error("Missing required OPFS APIs.")):o[A]=he().then(async function(){if(W.$testThrowPhase2)throw W.$testThrowPhase2;const X=new H(W);return X.isReady.then(async()=>{const ie=new te(X);if(i.oo1){const fe=i.oo1,Ae=X.getVfs(),Re=function(...N){const oe=fe.DB.dbCtorHelper.normalizeArgs(...N);oe.vfs=Ae.$zName,fe.DB.dbCtorHelper.call(this,oe)};Re.prototype=Object.create(fe.DB.prototype),ie.OpfsSAHPoolDb=Re}return X.log("VFS initialized."),ie}).catch(async ie=>{throw await X.removeVfs().catch(()=>{}),ie})}).catch(X=>o[A]=Promise.reject(X))}}),typeof s>"u")throw console.warn("This is not running in the context of Module.runSQLite3PostLoadInit()"),new Error("sqlite3-api-cleanup.js expects to be running in the context of its Emscripten module loader.");try{const i=Object.assign(Object.create(null),globalThis.sqlite3ApiBootstrap.defaultConfig,globalThis.sqlite3ApiConfig||{},{memory:typeof it<"u"?it:s.wasmMemory,exports:typeof Tt<"u"?Tt:Object.prototype.hasOwnProperty.call(s,"wasmExports")?s.wasmExports:s.asm});i.wasmPtrIR=typeof i.exports.sqlite3_libversion()=="number"?"i32":"i64";const p=n;p.debugModule("Bootstrapping lib config",p);const a=globalThis.sqlite3ApiBootstrap(i);return delete globalThis.sqlite3ApiBootstrap,a}catch(i){throw console.error("sqlite3ApiBootstrap() error:",i),i}throw new Error("Maintenance required: this line should never be reached")},Fn?t=r:t=new Promise((n,s)=>{Qe=n,rt=s}),t}const iu=function(){var l,f;const e=On;if(!e)throw new Error("Expecting globalThis.sqlite3InitModule to be defined by the Emscripten build.");const t=globalThis.sqlite3InitModuleState=Object.assign(Object.create(null),{moduleScript:(l=globalThis==null?void 0:globalThis.document)==null?void 0:l.currentScript,isWorker:typeof WorkerGlobalScope<"u",location:globalThis.location,urlParams:(f=globalThis==null?void 0:globalThis.location)!=null&&f.href?new URL(globalThis.location.href).searchParams:new URLSearchParams,wasmFilename:"sqlite3.wasm"});if(t.debugModule=t.urlParams.has("sqlite3.debugModule")?(...g)=>console.warn("sqlite3.debugModule:",...g):()=>{},t.urlParams.has("sqlite3.dir"))t.sqlite3Dir=t.urlParams.get("sqlite3.dir")+"/";else if(t.moduleScript){const g=t.moduleScript.src.split("/");g.pop(),t.sqlite3Dir=g.join("/")+"/"}const r=globalThis.sqlite3InitModule=function g(...q){return e(...q).then(T=>{t.debugModule("sqlite3InitModule() sIMS =",t),t.debugModule("sqlite3InitModule() EmscriptenModule =",T);const z=T.runSQLite3PostLoadInit(t,T,!!g.__isUnderTest);return t.debugModule("sqlite3InitModule() sqlite3 =",z),z}).catch(T=>{throw console.error("Exception loading sqlite3 module:",T),T})};if(r.ready=e.ready,t.moduleScript){let g=t.moduleScript.src.split("/");g.pop(),t.scriptDir=g.join("/")+"/"}return t.debugModule("extern-post-js.c-pp.js sqlite3InitModuleState =",t),r}();On=iu;var su=On;globalThis.sqlite3Worker1Promiser=function e(t=e.defaultConfig){if(arguments.length===1&&typeof arguments[0]=="function"){const Q=t;t=Object.assign(Object.create(null),e.defaultConfig),t.onready=Q}else t=Object.assign(Object.create(null),e.defaultConfig,t);const r=Object.create(null),l=function(){},f=t.onerror||l,g=t.debug||l,q=t.generateMessageId?void 0:Object.create(null),T=t.generateMessageId||function(Q){return Q.type+"#"+(q[Q.type]=(q[Q.type]||0)+1)},z=(...Q)=>{throw new Error(Q.join(" "))};t.worker||(t.worker=e.defaultConfig.worker),typeof t.worker=="function"&&(t.worker=t.worker());let ee,ne;return t.worker.onmessage=function(Q){Q=Q.data,g("worker1.onmessage",Q);let ae=r[Q.messageId];if(!ae){if(Q&&Q.type==="sqlite3-api"&&Q.result==="worker1-ready"){t.onready&&t.onready(ne);return}if(ae=r[Q.type],ae&&ae.onrow){ae.onrow(Q);return}t.onunhandled?t.onunhandled(arguments[0]):f("sqlite3Worker1Promiser() unhandled worker message:",Q);return}switch(delete r[Q.messageId],Q.type){case"error":ae.reject(Q);return;case"open":ee||(ee=Q.dbId);break;case"close":Q.dbId===ee&&(ee=void 0);break}try{ae.resolve(Q)}catch(ge){ae.reject(ge)}},ne=function(){let Q;arguments.length===1?Q=arguments[0]:arguments.length===2?(Q=Object.create(null),Q.type=arguments[0],Q.args=arguments[1],Q.dbId=Q.args.dbId):z("Invalid arguments for sqlite3Worker1Promiser()-created factory."),!Q.dbId&&Q.type!=="open"&&(Q.dbId=ee),Q.messageId=T(Q),Q.departureTime=performance.now();const ae=Object.create(null);ae.message=Q;let ge;Q.type==="exec"&&Q.args&&(typeof Q.args.callback=="function"?(ge=Q.messageId+":row",ae.onrow=Q.args.callback,Q.args.callback=ge,r[ge]=ae):typeof Q.args.callback=="string"&&z("exec callback may not be a string when using the Promise interface."));let Ce=new Promise(function(Qe,rt){ae.resolve=Qe,ae.reject=rt,r[Q.messageId]=ae,g("Posting",Q.type,"message to Worker dbId="+(ee||"default")+":",Q),t.worker.postMessage(Q)});return ge&&(Ce=Ce.finally(()=>delete r[ge])),Ce}};globalThis.sqlite3Worker1Promiser.defaultConfig={worker:function(){return new Worker(new URL("/assets/sqlite3-worker1-HKXiBUt9.js",import.meta.url))},onerror:(...e)=>console.error("worker1 promiser error",...e)};globalThis.sqlite3Worker1Promiser.v2=(function e(t=e.defaultConfig){let r;typeof t=="function"?(r=t,t={}):typeof(t==null?void 0:t.onready)=="function"&&(r=t.onready,delete t.onready);const l=Object.create(null);t=Object.assign(t||Object.create(null),{onready:async function(g){try{r&&await r(g),l.resolve(g)}catch(q){l.reject(q)}}});const f=new Promise(function(g,q){l.resolve=g,l.reject=q});try{this.original(t)}catch(g){l.reject(g)}return f}).bind({original:sqlite3Worker1Promiser});globalThis.sqlite3Worker1Promiser.v2.defaultConfig=globalThis.sqlite3Worker1Promiser.defaultConfig;sqlite3Worker1Promiser.v2;const ou={fts:.35,vector:.4,entity:.15,graph:.1},ht={FTS_SEARCH:`
    SELECT
      m.gid,
      m.page_no,
      m.title,
      snippet(meta_fts, 3, '<mark>', '</mark>', '', 18) AS snippet,
      meta_fts.rank,
      (1.0 / (ABS(meta_fts.rank) + 1.0)) AS score
    FROM meta_fts
    JOIN meta_index m ON m.rowid = meta_fts.rowid
    WHERE meta_fts MATCH ?
    ORDER BY meta_fts.rank
    LIMIT ?
  `,FTS_SEARCH_WITH_ENTITIES:`
    SELECT
      m.gid,
      m.page_no,
      m.title,
      snippet(meta_fts, 3, '<mark>', '</mark>', '', 18) AS snippet,
      meta_fts.rank,
      (1.0 / (ABS(meta_fts.rank) + 1.0)) AS score
    FROM meta_fts
    JOIN meta_index m ON m.rowid = meta_fts.rowid
    WHERE meta_fts MATCH ?
      AND m.gid IN (
        SELECT DISTINCT gid
        FROM entities
        WHERE (entity_type = ? OR ? IS NULL)
          AND (normalized_value = ? OR ? IS NULL)
      )
    ORDER BY meta_fts.rank
    LIMIT ?
  `,LIST_ENTITY_FACETS:`
    SELECT
      entity_type,
      normalized_value,
      COUNT(*) AS count
    FROM entities
    WHERE entity_type = COALESCE(?, entity_type)
    GROUP BY entity_type, normalized_value
    ORDER BY count DESC, entity_type, normalized_value
    LIMIT ?
  `,LIST_ENTITY_TYPES:`
    SELECT DISTINCT entity_type, COUNT(*) AS count
    FROM entities
    GROUP BY entity_type
    ORDER BY count DESC
  `,GET_PAGE_LIST:`
    SELECT
      gid,
      doc_id,
      page_no,
      title,
      tags,
      updated_ts
    FROM meta_index
    ORDER BY page_no
    LIMIT ? OFFSET ?
  `,GET_PAGE_BLOB:`
    SELECT data, sz
    FROM sqlar
    WHERE name = ?
    LIMIT 1
  `,GET_VECTOR_META:`
    SELECT gid, model_id, dim
    FROM leann_meta
    WHERE gid = ? AND model_id = ?
    LIMIT 1
  `,GET_CACHED_VECTOR:`
    SELECT embedding
    FROM leann_vec
    WHERE gid = ? AND model_id = ?
    LIMIT 1
  `,GET_ALL_VECTORS:`
    SELECT
      lm.gid,
      lm.page_no,
      m.title,
      lv.embedding
    FROM leann_vec lv
    JOIN leann_meta lm ON lm.gid = lv.gid AND lm.model_id = lv.model_id
    JOIN meta_index m ON m.gid = lm.gid
    WHERE lv.model_id = ?
    ORDER BY lm.page_no
  `,GET_PAGE_ENTITIES:`
    SELECT
      entity_type,
      entity_text,
      normalized_value,
      confidence
    FROM entities
    WHERE gid = ?
    ORDER BY confidence DESC
  `,GET_CHECKPOINTS:`
    SELECT
      epoch,
      merkle_root,
      pages_count,
      anchors_json,
      created_ts
    FROM checkpoints
    ORDER BY epoch DESC
  `,VERIFY_PAGE:`
    SELECT
      gr.gid,
      gr.content_sha,
      gr.signer,
      gr.sig,
      gr.epoch,
      gr.merkle_root,
      m.full_text
    FROM glyph_receipts gr
    JOIN meta_index m ON m.gid = gr.gid
    WHERE gr.gid = ?
    LIMIT 1
  `,GET_GRAPH_NEIGHBORS:`
    SELECT
      n2.gid,
      n2.page_no,
      m.title,
      e.pred,
      e.weight
    FROM node_index n1
    JOIN edges e ON e.fromNode = n1.node_id
    JOIN node_index n2 ON n2.node_id = e.toNode
    JOIN meta_index m ON m.gid = n2.gid
    WHERE n1.gid = ?
    ORDER BY e.weight DESC
    LIMIT ?
  `};function au(e,t){if(e.length!==t.length)throw new Error("Vectors must have same length");let r=0,l=0,f=0;for(let q=0;q<e.length;q++)r+=e[q]*t[q],l+=e[q]*e[q],f+=t[q]*t[q];const g=Math.sqrt(l)*Math.sqrt(f);return g===0?0:r/g}async function lu(e){const r=new TextEncoder().encode(e),l=await crypto.subtle.digest("SHA-256",r);return Array.from(new Uint8Array(l)).map(g=>g.toString(16).padStart(2,"0")).join("")}function cu(e){if(!e)return null;try{return JSON.parse(e)}catch{return null}}function Qr(e){return new Float32Array(e.buffer,e.byteOffset,e.byteLength/4)}function bt(){return typeof navigator<"u"&&"storage"in navigator&&"getDirectory"in navigator.storage}async function uu(){if(!bt())throw new Error("OPFS not supported in this browser");return await navigator.storage.getDirectory()}async function xn(){return await(await uu()).getDirectoryHandle("capsules",{create:!0})}async function fu(e){if(!bt())throw new Error("OPFS not supported");const f=await(await(await(await xn()).getFileHandle(e)).getFile()).arrayBuffer();return new Uint8Array(f)}async function _u(e){if(!bt())throw new Error("OPFS not supported");await(await xn()).removeEntry(e),console.log(`[OPFS] Removed file: ${e}`)}async function du(){if(!bt())return[];try{const e=await xn(),t=[];for await(const[r,l]of e.entries())if(l.kind==="file"){const f=await l.getFile();t.push({path:r,size:f.size,lastModified:f.lastModified})}return t.sort((r,l)=>l.lastModified-r.lastModified)}catch(e){return console.error("[OPFS] Failed to list files:",e),[]}}function Gt(e,t){let r=0,l=0,f=0;for(let g=0;g<e.length;g++)r+=e[g]*t[g],l+=e[g]*e[g],f+=t[g]*t[g];return l===0||f===0?0:r/(Math.sqrt(l)*Math.sqrt(f))}class pu{constructor(t){Ye(this,"centroid");Ye(this,"entries");this.centroid=t,this.entries=[]}addEntry(t){this.entries.push(t)}updateCentroid(){if(this.entries.length===0)return;const t=this.centroid.length,r=new Float32Array(t);for(const l of this.entries)for(let f=0;f<t;f++)r[f]+=l.vector[f];for(let l=0;l<t;l++)r[l]/=this.entries.length;this.centroid=r}}class hu{constructor(t=100){Ye(this,"clusters",[]);Ye(this,"allEntries",[]);Ye(this,"dimension",0);Ye(this,"numClusters");this.numClusters=t}async build(t){if(t.length===0)return;if(this.allEntries=t,this.dimension=t[0].vector.length,t.length<100){console.log("[VectorIndex] Small dataset, using brute force");return}const r=performance.now(),l=Math.max(10,Math.min(this.numClusters,Math.ceil(Math.sqrt(t.length)))),f=new Set;for(;f.size<l;)f.add(Math.floor(Math.random()*t.length));this.clusters=Array.from(f).map(q=>new pu(Float32Array.from(t[q].vector)));for(let q=0;q<10;q++){for(const T of this.clusters)T.entries=[];for(const T of t){let z=this.clusters[0],ee=-1;for(const ne of this.clusters){const Q=Gt(T.vector,ne.centroid);Q>ee&&(ee=Q,z=ne)}z.addEntry(T)}for(const T of this.clusters)T.updateCentroid()}const g=performance.now()-r;console.log(`[VectorIndex] Built index with ${this.clusters.length} clusters in ${g.toFixed(1)}ms`),console.log(`[VectorIndex] Average cluster size: ${(t.length/this.clusters.length).toFixed(1)}`)}search(t,r=20){if(this.allEntries.length===0)return[];const l=performance.now();if(this.clusters.length===0||this.allEntries.length<100){const ne=this.bruteForceSearch(t,r),Q=performance.now()-l;return console.log(`[VectorIndex] Brute force search: ${Q.toFixed(2)}ms`),ne}const f=Math.max(3,Math.ceil(this.clusters.length*.2)),g=this.clusters.map((ne,Q)=>({cluster:ne,similarity:Gt(t,ne.centroid),idx:Q}));g.sort((ne,Q)=>Q.similarity-ne.similarity);const q=[];let T=0;for(let ne=0;ne<f&&ne<g.length;ne++){const Q=g[ne].cluster;for(const ae of Q.entries){const ge=Gt(t,ae.vector);q.push({gid:ae.gid,similarity:ge,metadata:ae.metadata}),T++}}q.sort((ne,Q)=>Q.similarity-ne.similarity);const z=q.slice(0,r),ee=performance.now()-l;return console.log(`[VectorIndex] ANN search: ${ee.toFixed(2)}ms (scanned ${T}/${this.allEntries.length} entries)`),z}bruteForceSearch(t,r){const l=[];for(const f of this.allEntries){const g=Gt(t,f.vector);l.push({gid:f.gid,similarity:g,metadata:f.metadata})}return l.sort((f,g)=>g.similarity-f.similarity),l.slice(0,r)}getStats(){return{totalEntries:this.allEntries.length,numClusters:this.clusters.length,dimension:this.dimension,avgClusterSize:this.clusters.length>0?(this.allEntries.length/this.clusters.length).toFixed(1):0}}clear(){this.clusters=[],this.allEntries=[],this.dimension=0}}const mu=["sqlar","meta_index","meta_fts","entities","node_index","edges","ledger_blocks","checkpoints","keys"],$t=1e4,gu=1e3;let Ie=null,De=null,dt=null,_t=null;async function bu(){De||(console.log("[Worker] Initializing SQLite WASM..."),De=await su({print:console.log,printErr:console.error}),console.log("[Worker] SQLite WASM initialized:",De.version.libVersion))}function Vr(){if(!Ie)return{valid:!1,missing:["no database open"]};const e=new Set,t=Ie.prepare('SELECT name FROM sqlite_master WHERE type="table"');try{for(;t.step();)e.add(t.get([])[0])}finally{t.finalize()}const r=mu.filter(l=>!e.has(l));return{valid:r.length===0,missing:r}}async function Gr(e,t,r){if(!Ie)throw new Error("No database open");let l="unknown",f=Ie.prepare("SELECT doc_id FROM meta_index LIMIT 1");try{f.step()&&(l=f.get([])[0])}finally{f.finalize()}f=Ie.prepare("SELECT COUNT(*) FROM meta_index");let g=0;try{f.step()&&(g=f.get([])[0])}finally{f.finalize()}f=Ie.prepare("SELECT COUNT(*) FROM entities");let q=0;try{f.step()&&(q=f.get([])[0])}finally{f.finalize()}f=Ie.prepare("SELECT COUNT(*) FROM edges");let T=0;try{f.step()&&(T=f.get([])[0])}finally{f.finalize()}let z=!1,ee,ne;f=Ie.prepare(`
    SELECT name FROM sqlite_master
    WHERE type='table' AND name='leann_vec'
  `);try{if(f.step()){z=!0;const ae=Ie.prepare("SELECT model_id, dim FROM leann_meta LIMIT 1");try{if(ae.step()){const ge=ae.get([]);ee=ge[0],ne=ge[1]}}finally{ae.finalize()}}}finally{f.finalize()}const Q={fileName:e,fileSize:t,docId:l,pageCount:g,entityCount:q,edgeCount:T,hasVectors:z,vectorModel:ee,vectorDim:ne,opfsPath:r};return z&&await yu(),Q}async function yu(){if(!(!Ie||!(dt!=null&&dt.hasVectors)))try{const e=performance.now();console.log("[Worker] Building vector index..."),_t&&_t.clear(),_t=new hu(100);const t=[],r=dt.vectorModel||"gte-small-384",l=Ie.prepare(`
      SELECT lv.gid, lv.embedding, m.page_no, m.title
      FROM leann_vec lv
      JOIN meta_index m ON m.gid = lv.gid
      WHERE lv.model_id = ?
      LIMIT 10000
    `);try{for(l.bind([r]);l.step();){const q=l.get([]),T=Qr(q[1]);t.push({gid:q[0],vector:T,metadata:{pageNo:q[2],title:q[3]}})}}finally{l.finalize()}await _t.build(t);const f=performance.now()-e,g=_t.getStats();console.log(`[Worker] Vector index built in ${f.toFixed(1)}ms:`,g)}catch(e){console.error("[Worker] Failed to build vector index:",e),_t=null}}async function Kr(e){try{const t=await e.arrayBuffer(),r=new Uint8Array(t);Ie&&(Ie.close(),Ie=null),Ie=new De.oo1.DB(":memory:");const l=De.capi.sqlite3_deserialize(Ie.pointer,"main",r,r.length,r.length,De.capi.SQLITE_DESERIALIZE_FREEONCLOSE|De.capi.SQLITE_DESERIALIZE_RESIZEABLE);if(l!==De.capi.SQLITE_OK)throw new Error(`Failed to deserialize database: ${l}`);const f=Vr();if(!f.valid)throw new Error(`Invalid schema. Missing tables: ${f.missing.join(", ")}`);const g=await Gr(e.name,e.size);return dt=g,console.log("[Worker] Capsule opened:",g),{ok:!0,data:g}}catch(t){return console.error("[Worker] Failed to open capsule:",t),{ok:!1,error:String(t)}}}async function vu(){try{const e=await fetch("/memglyph-demo.mgx.sqlite");if(!e.ok)throw new Error(`Failed to fetch demo capsule: ${e.statusText}`);const t=await e.arrayBuffer(),r=new Blob([t],{type:"application/x-sqlite3"}),l=new File([r],"memglyph-demo.mgx.sqlite",{type:"application/x-sqlite3"});return await Kr(l)}catch(e){return console.error("[Worker] Failed to open demo capsule:",e),{ok:!1,error:String(e)}}}async function wu(e){try{if(!bt())throw new Error("OPFS not supported in this browser");const t=await fu(e);Ie&&(Ie.close(),Ie=null),Ie=new De.oo1.DB(":memory:");const r=De.capi.sqlite3_deserialize(Ie.pointer,"main",t,t.length,t.length,De.capi.SQLITE_DESERIALIZE_FREEONCLOSE|De.capi.SQLITE_DESERIALIZE_RESIZEABLE);if(r!==De.capi.SQLITE_OK)throw new Error(`Failed to deserialize database: ${r}`);const l=Vr();if(!l.valid)throw new Error(`Invalid schema. Missing tables: ${l.missing.join(", ")}`);const f=await Gr(e,t.length,e);return dt=f,console.log("[Worker] Capsule opened from OPFS:",f),Xt(f)}catch(t){return console.error("[Worker] Failed to open capsule from OPFS:",t),sn(t)}}async function qu(e){try{throw Ie?bt()?De.capi.sqlite3_serialize(Ie.pointer,"main",0,0)?new Error("SAVE_TO_OPFS should be handled by main thread, not worker"):new Error("Failed to serialize database"):new Error("OPFS not supported in this browser"):new Error("No database open")}catch(t){return console.error("[Worker] Failed to save to OPFS:",t),sn(t)}}async function Eu(e){try{if(!bt())throw new Error("OPFS not supported in this browser");return await _u(e),console.log(`[Worker] Removed file from OPFS: ${e}`),Xt(void 0)}catch(t){return console.error("[Worker] Failed to remove file from OPFS:",t),sn(t)}}async function Su(){try{if(!bt())return Xt([]);const e=await du();return Xt(e)}catch(e){return console.error("[Worker] Failed to list OPFS files:",e),sn(e)}}function Au(){return Ie?(Ie.close(),Ie=null,dt=null,_t&&(_t.clear(),_t=null),{ok:!0,data:void 0}):{ok:!1,error:"No database open"}}function Jr(e,t,r,l){if(!Ie)return{ok:!1,error:"No database open"};const f=Math.min(t,gu),g=[],q=r||l,T=q?ht.FTS_SEARCH_WITH_ENTITIES:ht.FTS_SEARCH,z=Ie.prepare(T);try{for(q?z.bind([e,r||null,r||null,l||null,l||null,f]):z.bind([e,f]);z.step();){const ee=z.get([]);g.push({gid:ee[0],pageNo:ee[1],title:ee[2],snippet:ee[3],rank:ee[4],score:ee[5]})}return{ok:!0,data:g}}catch(ee){return{ok:!1,error:String(ee)}}finally{z.finalize()}}function Iu(e,t){if(!Ie)return{ok:!1,error:"No database open"};if(!(dt!=null&&dt.hasVectors))return{ok:!1,error:"No vectors available in capsule"};const r=Math.min(t,$t),l=performance.now();if(_t){const z=_t.search(e,r).map(ne=>({gid:ne.gid,pageNo:ne.metadata.pageNo,title:ne.metadata.title,similarity:ne.similarity})),ee=performance.now()-l;return console.log(`[Worker] Vector search (indexed): ${ee.toFixed(2)}ms, ${z.length} results`),{ok:!0,data:z}}console.log("[Worker] Vector search (brute force fallback)");const f=[],g=dt.vectorModel||"gte-small-384",q=Ie.prepare(ht.GET_ALL_VECTORS);try{q.bind([g]);const T=[];for(;q.step();){const z=q.get([]),ee=Qr(z[3]);T.push({gid:z[0],pageNo:z[1],title:z[2],vector:ee})}for(const z of T){const ee=au(e,z.vector);f.push({gid:z.gid,pageNo:z.pageNo,title:z.title,similarity:ee})}return f.sort((z,ee)=>ee.similarity-z.similarity),f.splice(r),{ok:!0,data:f}}catch(T){return{ok:!1,error:String(T)}}finally{q.finalize()}}function ku(e,t,r){if(!Ie)return{ok:!1,error:"No database open"};const l=Math.min(t,$t),f={...ou,...r};try{const g=Jr(e,Math.min(l*3,50));if(!g.ok)return g;const q=g.data,T=new Map;for(const Q of q)T.set(Q.gid,{gid:Q.gid,pageNo:Q.pageNo,title:Q.title,snippet:Q.snippet,ftsScore:Q.score,vectorScore:0,entityScore:0,graphScore:0});const z=e.toLowerCase().split(/\s+/).filter(Q=>Q.length>2);if(z.length>0)for(const[Q,ae]of T){const ge=Ie.prepare(ht.GET_PAGE_ENTITIES);try{ge.bind([Q]);let Ce=0;for(;ge.step();){const Qe=ge.get([]),rt=String(Qe[1]).toLowerCase();for(const it of z)if(rt.includes(it)){Ce++;break}}ae.entityScore=Math.min(Ce/3,1)}finally{ge.finalize()}}const ee=Array.from(T.keys()).slice(0,Math.min(10,l));for(const Q of ee){const ae=T.get(Q),ge=Ie.prepare(ht.GET_GRAPH_NEIGHBORS);try{ge.bind([Q,5]);let Ce=0;for(;ge.step();){const rt=ge.get([])[0];T.has(rt)&&Ce++}ae.graphScore=Math.min(Ce/3,1)}finally{ge.finalize()}}const ne=[];for(const[Q,ae]of T){const ge=f.fts*ae.ftsScore+f.vector*ae.vectorScore+f.entity*ae.entityScore+f.graph*ae.graphScore;ne.push({gid:ae.gid,pageNo:ae.pageNo,title:ae.title,snippet:ae.snippet,scores:{fts:ae.ftsScore,vector:ae.vectorScore,entity:ae.entityScore,graph:ae.graphScore,final:ge}})}return ne.sort((Q,ae)=>ae.scores.final-Q.scores.final),ne.splice(l),{ok:!0,data:ne}}catch(g){return{ok:!1,error:String(g)}}}function Tu(e,t=100){if(!Ie)return{ok:!1,error:"No database open"};const r=Math.min(t,$t),l=[],f=Ie.prepare(ht.LIST_ENTITY_FACETS);try{for(f.bind([e||null,r]);f.step();){const g=f.get([]);l.push({entityType:g[0],normalizedValue:g[1],count:g[2]})}return{ok:!0,data:l}}catch(g){return{ok:!1,error:String(g)}}finally{f.finalize()}}function Ou(e,t){if(!Ie)return{ok:!1,error:"No database open"};const r=Math.min(e,$t),l=[],f=Ie.prepare(ht.GET_PAGE_LIST);try{for(f.bind([r,t]);f.step();){const g=f.get([]);l.push({gid:g[0],docId:g[1],pageNo:g[2],title:g[3],tags:g[4],updatedTs:g[5]})}return{ok:!0,data:l}}catch(g){return{ok:!1,error:String(g)}}finally{f.finalize()}}function xu(e){if(!Ie)return{ok:!1,error:"No database open"};const t=Ie.prepare(ht.GET_PAGE_BLOB);try{return t.bind([e]),t.step()?{ok:!0,data:t.get([])[0]}:{ok:!1,error:`Blob not found: ${e}`}}catch(r){return{ok:!1,error:String(r)}}finally{t.finalize()}}async function Fu(e){if(!Ie)return{ok:!1,error:"No database open"};const t=Ie.prepare(ht.VERIFY_PAGE);try{if(t.bind([e]),t.step()){const r=t.get([]),l=r[1],f=r[6],g=await lu(f||"");return{ok:!0,data:{gid:r[0],contentSha:l,expectedSha:g,verified:l===g,signer:r[2],signature:r[3],epoch:r[4],merkleRoot:r[5]}}}return{ok:!1,error:`No receipt found for GID: ${e}`}}catch(r){return{ok:!1,error:String(r)}}finally{t.finalize()}}function Pu(){if(!Ie)return{ok:!1,error:"No database open"};const e=[],t=Ie.prepare(ht.GET_CHECKPOINTS);try{for(;t.step();){const r=t.get([]);e.push({epoch:r[0],merkleRoot:r[1],pagesCount:r[2],createdTs:r[4],anchors:cu(r[3])})}return{ok:!0,data:e}}catch(r){return{ok:!1,error:String(r)}}finally{t.finalize()}}function Lu(e,t,r=3,l=50){if(!Ie)return{ok:!1,error:"No database open"};const f=Math.min(l,$t);try{const g=[],q=[],T={},z=new Set,ee=[];for(ee.push({gid:e,distance:0}),T[e]=0;ee.length>0&&g.length<f;){const{gid:ne,distance:Q}=ee.shift();if(z.has(ne)||Q>r)continue;z.add(ne);const ae=Ie.prepare("SELECT gid, page_no, title FROM meta_index WHERE gid = ?");try{if(ae.bind([ne]),ae.step()){const ge=ae.get([]);g.push({gid:ge[0],pageNo:ge[1],title:ge[2]})}}finally{ae.finalize()}if(Q<r){const ge=Ie.prepare(`
          SELECT
            n2.gid,
            e.pred,
            e.weight
          FROM node_index n1
          JOIN edges e ON e.fromNode = n1.node_id
          JOIN node_index n2 ON n2.node_id = e.toNode
          WHERE n1.gid = ?
          ${t?"AND e.pred = ?":""}
          ORDER BY e.weight DESC
        `);try{for(t?ge.bind([ne,t]):ge.bind([ne]);ge.step();){const Ce=ge.get([]),Qe=Ce[0],rt=Ce[1],it=Ce[2];q.push({fromGid:ne,toGid:Qe,predicate:rt,weight:it}),!z.has(Qe)&&!(Qe in T)&&(T[Qe]=Q+1,ee.push({gid:Qe,distance:Q+1}))}}finally{ge.finalize()}}}return{ok:!0,data:{nodes:g,edges:q,distances:T}}}catch(g){return{ok:!1,error:String(g)}}}function Nu(e,t){if(!Ie)return{ok:!1,error:"No database open"};try{const r=Ie.prepare(e),l=[];try{for(r.bind(t);r.step();)l.push(r.get([]))}finally{r.finalize()}return{ok:!0,data:l}}catch(r){return{ok:!1,error:String(r)}}}function Ru(){if(!Ie)return{ok:!1,error:"No database open"};try{const e=De.capi.sqlite3_js_db_export(Ie.pointer);return e?(console.log(`[Worker] Exported Core database: ${e.byteLength} bytes`),{ok:!0,data:e}):{ok:!1,error:"Failed to export database"}}catch(e){return{ok:!1,error:String(e)}}}async function Yr(e){const t=await e.arrayBuffer(),r=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(r)).map(f=>f.toString(16).padStart(2,"0")).join("")}function Cu(e){const t=new De.oo1.DB(":memory:");try{if(De.capi.sqlite3_deserialize(t.pointer,"main",e,e.byteLength,e.byteLength,De.capi.SQLITE_DESERIALIZE_FREEONCLOSE|De.capi.SQLITE_DESERIALIZE_RESIZEABLE)!==0)return{ok:!0,data:!1};const l=t.prepare(`
      SELECT COUNT(*)
      FROM sqlite_master
      WHERE type='table' AND name='_envelope_meta'
    `);try{return l.step()?{ok:!0,data:l.get([])[0]>0}:{ok:!0,data:!1}}finally{l.finalize()}}catch(r){return console.warn("[Worker] Error checking for envelope tables:",r),{ok:!0,data:!1}}finally{t.close()}}async function zu(e){try{const r=`/envelopes/${await Yr(e)}.db`;console.log("[Worker] Extracting envelope from canonical .gcase+ file...");const l=new Uint8Array(await e.arrayBuffer()),g=await(await navigator.storage.getDirectory()).getDirectoryHandle("envelopes",{create:!0}),q=new De.oo1.OpfsDb(r,"c"),T=new De.oo1.DB(":memory:");try{const z=De.capi.sqlite3_deserialize(T.pointer,"main",l,l.byteLength,l.byteLength,De.capi.SQLITE_DESERIALIZE_FREEONCLOSE|De.capi.SQLITE_DESERIALIZE_RESIZEABLE);if(z!==0)throw new Error(`Failed to deserialize source database: ${z}`);T.exec(`ATTACH DATABASE '${r}' AS sidecar`);const ee=["_envelope_meta","_env_chain","env_retrieval_log","env_embeddings","env_feedback","env_context_summaries"];for(const ae of ee){const ge=T.prepare(`
          SELECT sql FROM main.sqlite_master
          WHERE type='table' AND name=?
        `);try{if(ge.bind([ae]),ge.step()){const Ce=ge.get([])[0];Ce&&(q.exec(Ce),T.exec(`INSERT INTO sidecar.${ae} SELECT * FROM main.${ae}`),console.log(`[Worker] Copied table: ${ae}`))}}finally{ge.finalize()}}const ne=T.prepare(`
        SELECT sql FROM main.sqlite_master
        WHERE type='index'
          AND name LIKE 'env_%'
          AND sql IS NOT NULL
      `);try{for(;ne.step();){const ae=ne.get([])[0];ae&&q.exec(ae)}}finally{ne.finalize()}const Q=T.prepare(`
        SELECT sql FROM main.sqlite_master
        WHERE type='view' AND name LIKE 'env_%'
      `);try{for(;Q.step();){const ae=Q.get([])[0];ae&&q.exec(ae)}}finally{Q.finalize()}return T.exec("DETACH DATABASE sidecar"),console.log("[Worker] Envelope extraction complete"),{ok:!0,data:void 0}}finally{T.close(),q.close()}}catch(t){return{ok:!1,error:String(t)}}}async function Du(e){if(!Ie)return{ok:!1,error:"No database open"};try{const t=De.capi.sqlite3_js_db_export(Ie.pointer);if(!t)return{ok:!1,error:"Failed to export Core database"};const r=await Yr(e),l=`/envelopes/${r}.db`;console.log(`[Worker] Merging Core (${t.byteLength} bytes) with envelope sidecar...`);try{await(await(await navigator.storage.getDirectory()).getDirectoryHandle("envelopes",{create:!1})).getFileHandle(`${r}.db`,{create:!1})}catch{return console.log("[Worker] No envelope sidecar found, returning Core only"),{ok:!0,data:t}}const f=new De.oo1.DB(":memory:");try{const g=De.capi.sqlite3_deserialize(f.pointer,"main",t,t.byteLength,t.byteLength,De.capi.SQLITE_DESERIALIZE_FREEONCLOSE|De.capi.SQLITE_DESERIALIZE_RESIZEABLE);if(g!==0)throw new Error(`Failed to deserialize Core database: ${g}`);console.log("[Worker] Core database loaded into memory"),f.exec(`ATTACH DATABASE '${l}' AS envelope`),console.log("[Worker] Attached envelope sidecar");const q=["_envelope_meta","_env_chain","env_retrieval_log","env_embeddings","env_feedback","env_context_summaries"];for(const ne of q){const Q=f.prepare(`
          SELECT sql FROM envelope.sqlite_master
          WHERE type='table' AND name=?
        `);try{if(Q.bind([ne]),Q.step()){const ae=Q.get([])[0];ae&&(f.exec(ae),f.exec(`INSERT INTO main.${ne} SELECT * FROM envelope.${ne}`),console.log(`[Worker] Copied table: ${ne}`))}}finally{Q.finalize()}}const T=f.prepare(`
        SELECT sql FROM envelope.sqlite_master
        WHERE type='view' AND name LIKE 'env_%'
      `);try{for(;T.step();){const ne=T.get([])[0];ne&&(f.exec(ne),console.log("[Worker] Copied view"))}}finally{T.finalize()}const z=f.prepare(`
        SELECT sql FROM envelope.sqlite_master
        WHERE type='index' AND sql IS NOT NULL AND name LIKE 'idx_%'
      `);try{for(;z.step();){const ne=z.get([])[0];if(ne&&(ne.includes("env_")||ne.includes("_env_")))try{f.exec(ne)}catch(Q){console.warn("[Worker] Index copy failed:",Q)}}}finally{z.finalize()}f.exec("DETACH DATABASE envelope"),console.log("[Worker] Detached envelope sidecar");const ee=De.capi.sqlite3_js_db_export(f.pointer);if(!ee)throw new Error("Failed to export merged database");return console.log(`[Worker] Merge complete: ${ee.byteLength} bytes`),{ok:!0,data:ee}}finally{f.close()}}catch(t){return{ok:!1,error:String(t)}}}async function Mu(e){try{switch(e.type){case"OPEN_FROM_FILE":return await Kr(e.file);case"OPEN_FROM_OPFS":return await wu(e.path);case"OPEN_DEMO":return await vu();case"SAVE_TO_OPFS":return await qu(e.path);case"REMOVE_FROM_OPFS":return await Eu(e.path);case"LIST_OPFS_FILES":return await Su();case"CLOSE":return Au();case"FTS_SEARCH":return Jr(e.query,e.limit||20,e.entityType,e.entityValue);case"VECTOR_SEARCH":return Iu(e.queryVector,e.limit||20);case"HYBRID_SEARCH":return ku(e.query,e.limit||20,e.weights);case"LIST_ENTITIES":return Tu(e.entityType,e.limit||100);case"GET_PAGE_LIST":return Ou(e.limit||100,e.offset||0);case"GET_PAGE_BLOB":return xu(e.name);case"VERIFY_PAGE":return await Fu(e.gid);case"GET_CHECKPOINTS":return Pu();case"GRAPH_HOPS":return Lu(e.seedGid,e.predicate,e.maxHops||3,e.limit||50);case"EXPORT_DATABASE":return Ru();case"HAS_ENVELOPE_TABLES":return Cu(e.fileBytes);case"EXTRACT_ENVELOPE":return await zu(e.file);case"MERGE_ENVELOPE":return await Du(e.file);case"QUERY":return Nu(e.sql,e.params||[]);default:return{ok:!1,error:`Unknown request type: ${e.type}`}}}catch(t){return{ok:!1,error:String(t)}}}self.onmessage=async e=>{const{id:t,request:r}=e.data;De||await bu();const l=await Mu(r),f={id:t,response:l};self.postMessage(f)};self.postMessage({type:"READY"});console.log("[Worker] SQLite worker loaded and ready");
